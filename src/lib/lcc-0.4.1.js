/* eslint-disable */
// @ts-expect-error: 型定義がないため無視
const t=0,e=1,s=2,i=3,r=0,a=1,n=2,o={1:"\n        data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQQAAAAVCAYAAACg9ZCAAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAuESURBVHhe7ZvrjuO4EYUpuW+TSX4k+ZEAm8dOgDzNIg+1wc5Mt62c7xSLotyS+rLpxS5Gp6dMqi6HRUksy/ZwmIRy4MCBA8JY2wMHDhwo7QnhL38/l5++nMrptpTLINXNVIbboZS7Syn3UxkfhjKdzjoeynAv3c2lTA+ncvkkkj+UMuF3qxjF3ny+K+XTKN1QLoq74C+/cieek0IfxvL0SfGyn+7l9zCVST4XOBRaNO54Yjzx3Z0k4lDcNF6KehJSniLP8qjuV+meyjR8UfuoST3KKr1eo/1W5Wfl98Ux03RTboYfy6fpX4q5NaemXm4k99NQ7jX18XImlfIwyheuSTnr+AflANR1RVVqjrtNDqV1kgv606i54HjRXKR3jF5uJKdhlI/Op3S6EOrr3BGDaCCO7/R6O8gLf3mO4mBMhJzwv5SvPja35G64Myv+wQX3oDGDc9SxBZtzCT/iNUl5BCKv4OSIY+LDV7lwXHniWK9yGvRCy/knO/fUyFUe4RtmKdBLdHosuqhlIER968/KR7cdupNsjEHMYJ2cZC/qN5FPuSgjWjiYD+PIBp/5yVjnd3qU7fHi6zBMmtmT1N/OZXjStXIOcCn2SQeMo4ZcdBe4dR5S42v/J/GeFSM5i2cSz3geda7FT07EMMZZ9/pFLHDqeLREjrrJ9aKGnD0+Bxwra90Hl6/n8vjlUa6j7rOTlqGurPMW56NyF8f47Ulr5t7c6OK8KJfLTbl8eSLSOmLwL5p/+fm/DMt9yMil/OnP5/Lzk06KbK0gaCGWW2WkBTt+YlFqQK0QCoILgBYzC374LHIWPQVBd+zNZy2NT7pt5NsKgorGakGg0DxEfF8QBq0YCsJ4rwAXBNmUThaESTlOnikzoyBokWdB0OKfuLq6SpOKg4uGFs1cELDfiPbH8sfyb/mrEOpuycVMMbjXHT3qwlEQ7rMgeLxS/uHXAJePBcLCJHVai3iUvm42zUUcStL/rMMu3W5BUD99KSAj+VRflVBLjoUfeYQNXlpmFQv9eUG4tMJCfuEfohPDa0NyDtyQap2X9fVY/hFb8yMAaYAvOKGOohjzsIJ/Eq0PixetEItMV5ubui7QmKciselSsBC8YOttYFkrCPjAzTEFgQWqRcuCXRQE3lu8qDRe44Jfwa3wwCc/9Z2r1MzJC1eLn2IwSViI8J+0YE/idiz5Vo6LeSUaf1Bh8lwoJvXkRUFQB17l4YKgv8uT7nAVhfPTOQqCxAXhaxYErm9cDcaaXMzEwTlUfhSUUfe+dRrbxZaCcGaN1HsAUIwYP8ENyMX1BQYyeuIV0cfBhxHcBLLO2W+RM5SaeIMfglqTFmgRlZMbskcbfw3pu+mDLvS+Qe1XITUnHw7nJ9ukJwXmE8sr4gC9XoD7ldO8vrASXRfr+BMxQ+gS+k+3R+Xgr+JqvomZW74p6DtZh4LihAiKUQ6+xtK1mw8RAfNuEt7272XkyUcyIFWHs2mg04ufqNyGzly8MKYWhBeW9KyNsNc/Fi1Ln4UaAQHOSS+daRfpxxg1j9XYzq8BXa/32Nmv4nnwVqUr6flKqX8syzgvXO8UmSTjqOXt+bEEuwGS01Kd95C+DcToH3lwVMN5A23D0IZbUyVaQehJTRIvampIHDZEnozsw9mOkAyVDXQx66gE3fgLVM5n52WPN21u14hn3bNzjunqrrGPe0yqi72ShspZ36TCBhXSX/89bPmYRy9uxSzJMdpY74H5orvAlv5DEPPx4wvt9YzqfJt0pl2kn+bRruVabOfXgC7Fl583hqVLwvpqtLte+vCUXSS5Rd7IHtK3h47zFqE2WTXfxC0R262YMReELRBB5FuA/1tjDhz4LSLvZeSFYl7X2W8Kb12Gc0FYifTjJPqcaTfbKFwyZlzvI3mpsL0aW3x7/Glzu3ZKZt2zIuz56sW6MNjHveUdQa+XhsrpNzod2gYVsnzI2MaWj3n04lbMkhyjjfUemC+6C2zpPwQxn3i0ytkgFXW+TTrTLtJP82jXci2282vI+SO+dtuDYtm2vhL9eDnPPaTvBjL8zR8Zev8ZutkyCoLOIfoyYgfVZ833PUjama9pjDb+GtJ30wdd6OFZ5IraJ8OdUOFD+4qPDO5Xzjku+qZ74V0moIir+SZmbop1FfSd7OO5F+kk7zW29P9PQB9DKC/mo0oa1/sqV3S9dKZdpF+diw/XYju/hkwO8bXbHhTLtvWV6MfLee4hfTeQ4W/+yND7J7jVfDMkQecQfRmxg+qz5vseQGvqysU3wz2Cf6lryDvYbSbYA13EBre7AUw+Ge6ECh+1fMsbvQC9XgBt/xE4banzz1NqMW9DEZ5vsgaSZ1RufJMc7VufEMxS2wC5kFs+0STsWfUfCehjCN6ANCc9ITCvyKDLCF0vnWkX6cf8EPprsZ1fQyaH/F6eEKrO6hruAptUtFDXbo+2onr/BLcaehsg6ByiLyN2UH3WfN8DaE1duSavpBnBv9Q1OOlsM8Ee6CI2uN0NYPLJcCdU+KjlF4HoBej1Amj7J960pS7XOeZtKCIrR4fk4Wfhi+zRvucJYclNLuTmHENl2LPqPxLQxxDxZHBRBYr/Y5JSga6XzrSL9GN+CP212M6vIZNDfO22B8WybX0l+vFynntI3wZi9DrEG4V/cuWL0LwhAZTh9izfVhDaierw7icEKduvE9ZZ2ZA/dTV1fiXagUOr5BPnpaVqxPhLXYOTzvaK2EAXscHtbkCmeLxSliSo7mk4xU909pv56PUCaP1OqzWHP3H+rZ8+69C/Y3OByCD++IkNap9vSGA5nhB8vMgIXS+daRfpx/wQ+muxnV9DJoe4jm4PimXb+kr04+U895C+DZHFYvkhbeJCuFifqsS8ohakiboIKkEfHXnKmHG9Tz84WOWe0bv2cJiMcV6uSBy0QZyEjlnzmfXPzjnqq/zTe/5cG2j6Kglz6sy65Th1VV6FldyXPCoeKWmr8jJWPJO3HgJ7Vf2vgzofVaD5XHcZoeulM+0i/fo5rsV2fg30U1xHtwfFsm19Jfrxcp57SN+GZUya3vwdwpI08P5fGfLd9DVYGbhH5XzGt8efNrdr/LMO3gU3pv7k9WBefeyVNMBZnxAW+rdgbXyAnicXt2J3TnMOv2i8tTG39B+CmE98dsnZIBV1vk060y7ST/No12QttvNryPkjv5cnhC4mTS6wqabFrXZ7zAXhwIED3z12PzL4vxhnGUmpiCIkY8b1Pgp6qbDNWBm4R+V8xrfHnza3a/yzDt4FN6att3bm1cdeSQOc3UeGd2FtfIA+v3NxnpFRL++C+aK7wJb+QxDziS8zcjZIRZ1vk860i/TTPNo1WYvt/Bpy/sj3/pEBdy+WStBHx5gyZlzvo6CX5jFjdWDDFvHEebnyM/9GbI7tmDWfWR/c7gZQ9ydPSO/IAQk0fZWEObuPDJY6zmKsPazkvuThHFdJW5WXseKZvPUQ2Kvqfx3U+egjw3yuu4zQ9dKZdpF+/RzXYju/Bvop38FHhrbb8a9/O5efvp7KeCtHVWjvamQr3d3FuxCf7XZkF+TabkcNvLrbcXP787C+27Fuf379bsdu+/Pqbsd++3PsdrwZ/lMeyj/lf+tde949qLMRux1VLbvdjuzyYzxO4A8+lQEqKluefKqk9+5DjuXi3Yr8OkEQManDLt1rdjveSZPbn71ZRrbr3Y7T9M15hI3c17Y/MybH7IbjOGzBpVjZgoPnwiX8O4huMvTOC131j63U4ZNxMV8gg0QuBmqbONbldEujNjc6ZT8LAzsd2QJNgfUvNTBgZ5feL9ntqPZVux0JYrejfH0b5XhQmq+O68VLX7zsdvxGDOdLawpufLyjkblI8K/jF7Yhw4+PzyrDQq4O/OQq/9Xtz2u7Hdn+fKtFJb7Fbkedl83djtfbnw8cOHAgytGBAwcOCEdBOHDgQEUp/wMm4LHFroKZGQAAAABJRU5ErkJggg==\n    "},h=0,l=1,c=1,u="Unknown",d="Windows",m="MacOS",p="Linux",f="Android",x="IOS",g="Unknown",y="Edge",M="Chrome",b="Firefox",w="Safari",v="Opera",S="IE",C="MicroMessenger",_="Feishu",T="DingTalk",D="Bytedance",P="NewsArticle",z="Zhihu",A="Weibo",E="AlipayClient",I="MQQBrowser",F="Unknown",R="NVIDIA",k="AMD",N="APPLE";class B{constructor(t=0,e=0,s=0,i=1){B.prototype.isVector4=!0,this.x=t,this.y=e,this.z=s,this.w=i}get width(){return this.z}set width(t){this.z=t}get height(){return this.w}set height(t){this.w=t}set(t,e,s,i){return this.x=t,this.y=e,this.z=s,this.w=i,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this.w=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=void 0!==t.w?t.w:1,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}applyMatrix4(t){const e=this.x,s=this.y,i=this.z,r=this.w,a=t.elements;return this.x=a[0]*e+a[4]*s+a[8]*i+a[12]*r,this.y=a[1]*e+a[5]*s+a[9]*i+a[13]*r,this.z=a[2]*e+a[6]*s+a[10]*i+a[14]*r,this.w=a[3]*e+a[7]*s+a[11]*i+a[15]*r,this}divideScalar(t){return this.multiplyScalar(1/t)}setAxisAngleFromQuaternion(t){this.w=2*Math.acos(t.w);const e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this}setAxisAngleFromRotationMatrix(t){let e,s,i,r;const a=.01,n=.1,o=t.elements,h=o[0],l=o[4],c=o[8],u=o[1],d=o[5],m=o[9],p=o[2],f=o[6],x=o[10];if(Math.abs(l-u)<a&&Math.abs(c-p)<a&&Math.abs(m-f)<a){if(Math.abs(l+u)<n&&Math.abs(c+p)<n&&Math.abs(m+f)<n&&Math.abs(h+d+x-3)<n)return this.set(1,0,0,0),this;e=Math.PI;const t=(h+1)/2,o=(d+1)/2,g=(x+1)/2,y=(l+u)/4,M=(c+p)/4,b=(m+f)/4;return t>o&&t>g?t<a?(s=0,i=.707106781,r=.707106781):(s=Math.sqrt(t),i=y/s,r=M/s):o>g?o<a?(s=.707106781,i=0,r=.707106781):(i=Math.sqrt(o),s=y/i,r=b/i):g<a?(s=.707106781,i=.707106781,r=0):(r=Math.sqrt(g),s=M/r,i=b/r),this.set(s,i,r,e),this}let g=Math.sqrt((f-m)*(f-m)+(c-p)*(c-p)+(u-l)*(u-l));return Math.abs(g)<.001&&(g=1),this.x=(f-m)/g,this.y=(c-p)/g,this.z=(u-l)/g,this.w=Math.acos((h+d+x-1)/2),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this.w=e[15],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this.w=Math.max(t,Math.min(e,this.w)),this}clampLength(t,e){const s=this.length();return this.divideScalar(s||1).multiplyScalar(Math.max(t,Math.min(e,s)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this}lerpVectors(t,e,s){return this.x=t.x+(e.x-t.x)*s,this.y=t.y+(e.y-t.y)*s,this.z=t.z+(e.z-t.z)*s,this.w=t.w+(e.w-t.w)*s,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class L{type=u;version="Unknown"}class q{type=F;series="Unknown";model=0;textureSize=0;textureUnitsCount=0;limitLoadSplatCount=0}class H{type=g;version="Unknown"}class U{browser;gpu;os;libType;constructor(t){this.browser=this.#t(),this.gpu=this.#e(),this.os=this.#s(),this.libType=this.#i(t)}#i(t){let e=n;return t&&(t.BufferGeometry?e=r:t.Cartesian3&&(e=a)),console.log("engine type: "+e),e}#e(){const t=new q,e=document.createElement("canvas").getContext("experimental-webgl");if(!e)return console.log("WebGL not supported"),t;const s=e.getExtension("WEBGL_debug_renderer_info");if(s){const i=e.getParameter(s.UNMASKED_RENDERER_WEBGL),r=e.getParameter(s.UNMASKED_VENDOR_WEBGL);if(console.log(`GPU Renderer: ${i}`),console.log(`GPU Vendor: ${r}`),/NVIDIA/.test(r)){if(t.type=R,i){const e=i.match(/(?:GT|GTX|RTX)\s(\d+)/);if(e){const s=e[0],i=e[1];t.series=s,t.model=this.#r(i)?Number(i):i}}}else if(/AMD/.test(r)){if(t.type=k,i){const e=i.match(/(?:RX|HD|R7|R5)\s(\d+)/);if(e){const s=e[0],i=e[1];t.series=s,t.model=this.#r(i)?Number(i):i}}}else if(/Apple/.test(r)&&(t.type=N,i)){const e=i.match(/Apple\s+(M[12])/);if(e){const s=e[0],i=e[1];t.series=s,t.model=this.#r(i)?Number(i):i}}}else console.log("WEBGL_debug_renderer_info not available");return t.textureUnitsCount=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),t.textureSize=e.getParameter(e.MAX_TEXTURE_SIZE),t.limitLoadSplatCount=t.textureSize*t.textureSize/4,console.log("gpu: ",t.type,t.series,t.model),console.log("gl: ",t.textureUnitsCount,t.textureSize,t.limitLoadSplatCount),t}#s(){const t=navigator.userAgent.toLowerCase();let e=u,s="Unknown";if(t.includes("windows nt")){e=d;const i=t.match(/windows nt (\d+\.\d+)/);i&&i[1]&&(s=i[1])}else if(t.includes("macintosh")||t.includes("mac os x"))if(t.includes("iphone")||t.includes("ipad")){e=x;const i=t.match(/(iphone|cpu) os (\d+[._]\d+[._]?\d*)/);s=i.join("&"),i&&i[2]&&(s=i[2].replace(/_/g,"."))}else{e=m;const i=t.match(/mac os x (\d+[._]\d+)/);i&&i[1]&&(s=i[1].replace("_","."))}else if(t.includes("android")){e=f;const i=t.match(/android (\d+(\.\d+)?)/);i&&i[1]&&(s=i[1])}else t.includes("linux")&&(e=p);console.log("os: "+e+"/"+s);const i=new L;return i.type=e,i.version=s,i}#t(){console.log("userAgent: ",window.navigator.userAgent);const t=navigator.userAgent.toLowerCase();let e=g,s="Unknown";if(/Feishu|DingTalk|MicroMessenger|Bytedance|NewsArticle|Zhihu|Weibo|AlipayClient|MQQBrowser/.test(navigator.userAgent)){let t=navigator.userAgent.match(/Feishu|DingTalk|MicroMessenger|Bytedance|NewsArticle|Zhihu|Weibo|AlipayClient|MQQBrowser/);t=t&&t[0]?t[0]:"Unknown","Feishu"===t?e=_:"DingTalk"===t?e=T:"MicroMessenger"===t?e=C:"Bytedance"===t?e=D:"NewsArticle"===t?e=P:"Zhihu"===t?e=z:"Weibo"===t?e=A:"AlipayClient"===t?e=E:"MQQBrowser"===t&&(e=I),s=navigator.userAgent.match(/(?:Feishu|DingTalk|MicroMessenger|Bytedance|NewsArticle|Zhihu|Weibo|AlipayClient|MQQBrowser)\/([\d.]+)/),s=s&&s[1]?s[1]:"Unknown"}else/edg\//.test(t)?(e=y,s=t.match(/edg\/(\d+)/),s=s&&s[1]?s[1]:"Unknown"):/chrome|crios\//.test(t)&&!/edg\//.test(t)?(e=M,s=t.match(/(?:chrome|crios)\/(\d+)/),s=s&&s[1]?s[1]:"Unknown"):/firefox|fxios\//.test(t)?(e=b,s=t.match(/(?:firefox|fxios)\/(\d+)/),s=s&&s[1]?s[1]:"Unknown"):/safari/.test(t)&&!/chrome/.test(t)?(e=w,s=t.match(/version\/(\d+)/),s=s&&s[1]?s[1]:"Unknown"):/opr\//.test(t)||/opera/.test(t)?(e=v,s=t.match(/opr\/(\d+)/),s=s&&s[1]?s[1]:"Unknown"):(/msie/.test(t)||/trident/.test(t))&&(e=S,s=t.match(/(msie|rv:)(\d+)/),s=s&&s[2]?s[2]:"Unknown");console.log("browser: ",e,s);const i=new H;return i.type=e,i.version=s,i}#r(t){return/^-?\d+(\.\d+)?$/.test(t)}}const O=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let V=1234567;const G=Math.PI/180,j=180/Math.PI;function W(t,e,s){return Math.max(e,Math.min(s,t))}function Q(t,e){return(t%e+e)%e}function X(t,e,s){return(1-s)*t+s*e}const Y={DEG2RAD:G,RAD2DEG:j,generateUUID:function(){const t=4294967295*Math.random()|0,e=4294967295*Math.random()|0,s=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return(O[255&t]+O[t>>8&255]+O[t>>16&255]+O[t>>24&255]+"-"+O[255&e]+O[e>>8&255]+"-"+O[e>>16&15|64]+O[e>>24&255]+"-"+O[63&s|128]+O[s>>8&255]+"-"+O[s>>16&255]+O[s>>24&255]+O[255&i]+O[i>>8&255]+O[i>>16&255]+O[i>>24&255]).toLowerCase()},clamp:W,euclideanModulo:Q,mapLinear:function(t,e,s,i,r){return i+(t-e)*(r-i)/(s-e)},inverseLerp:function(t,e,s){return t!==e?(s-t)/(e-t):0},lerp:X,damp:function(t,e,s,i){return X(t,e,1-Math.exp(-s*i))},pingpong:function(t,e=1){return e-Math.abs(Q(t,2*e)-e)},smoothstep:function(t,e,s){return t<=e?0:t>=s?1:(t=(t-e)/(s-e))*t*(3-2*t)},smootherstep:function(t,e,s){return t<=e?0:t>=s?1:(t=(t-e)/(s-e))*t*t*(t*(6*t-15)+10)},randInt:function(t,e){return t+Math.floor(Math.random()*(e-t+1))},randFloat:function(t,e){return t+Math.random()*(e-t)},randFloatSpread:function(t){return t*(.5-Math.random())},seededRandom:function(t){void 0!==t&&(V=t);let e=V+=1831565813;return e=Math.imul(e^e>>>15,1|e),e^=e+Math.imul(e^e>>>7,61|e),((e^e>>>14)>>>0)/4294967296},degToRad:function(t){return t*G},radToDeg:function(t){return t*j},isPowerOfTwo:function(t){return!(t&t-1)&&0!==t},ceilPowerOfTwo:function(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},floorPowerOfTwo:function(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},setQuaternionFromProperEuler:function(t,e,s,i,r){const a=Math.cos,n=Math.sin,o=a(s/2),h=n(s/2),l=a((e+i)/2),c=n((e+i)/2),u=a((e-i)/2),d=n((e-i)/2),m=a((i-e)/2),p=n((i-e)/2);switch(r){case"XYX":t.set(o*c,h*u,h*d,o*l);break;case"YZY":t.set(h*d,o*c,h*u,o*l);break;case"ZXZ":t.set(h*u,h*d,o*c,o*l);break;case"XZX":t.set(o*c,h*p,h*m,o*l);break;case"YXY":t.set(h*m,o*c,h*p,o*l);break;case"ZYZ":t.set(h*p,h*m,o*c,o*l);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+r)}},normalize:function(t,e){switch(e.constructor){case Float32Array:return t;case Uint32Array:return Math.round(4294967295*t);case Uint16Array:return Math.round(65535*t);case Uint8Array:return Math.round(255*t);case Int32Array:return Math.round(2147483647*t);case Int16Array:return Math.round(32767*t);case Int8Array:return Math.round(127*t);default:throw new Error("Invalid component type.")}},denormalize:function(t,e){switch(e.constructor){case Float32Array:return t;case Uint32Array:return t/4294967295;case Uint16Array:return t/65535;case Uint8Array:return t/255;case Int32Array:return Math.max(t/2147483647,-1);case Int16Array:return Math.max(t/32767,-1);case Int8Array:return Math.max(t/127,-1);default:throw new Error("Invalid component type.")}}};class Z{constructor(t=0,e=0,s=0,i=1){this.isQuaternion=!0,this._x=t,this._y=e,this._z=s,this._w=i}static slerpFlat(t,e,s,i,r,a,n){let o=s[i+0],h=s[i+1],l=s[i+2],c=s[i+3];const u=r[a+0],d=r[a+1],m=r[a+2],p=r[a+3];if(0===n)return t[e+0]=o,t[e+1]=h,t[e+2]=l,void(t[e+3]=c);if(1===n)return t[e+0]=u,t[e+1]=d,t[e+2]=m,void(t[e+3]=p);if(c!==p||o!==u||h!==d||l!==m){let t=1-n;const e=o*u+h*d+l*m+c*p,s=e>=0?1:-1,i=1-e*e;if(i>Number.EPSILON){const r=Math.sqrt(i),a=Math.atan2(r,e*s);t=Math.sin(t*a)/r,n=Math.sin(n*a)/r}const r=n*s;if(o=o*t+u*r,h=h*t+d*r,l=l*t+m*r,c=c*t+p*r,t===1-n){const t=1/Math.sqrt(o*o+h*h+l*l+c*c);o*=t,h*=t,l*=t,c*=t}}t[e]=o,t[e+1]=h,t[e+2]=l,t[e+3]=c}static multiplyQuaternionsFlat(t,e,s,i,r,a){const n=s[i],o=s[i+1],h=s[i+2],l=s[i+3],c=r[a],u=r[a+1],d=r[a+2],m=r[a+3];return t[e]=n*m+l*c+o*d-h*u,t[e+1]=o*m+l*u+h*c-n*d,t[e+2]=h*m+l*d+n*u-o*c,t[e+3]=l*m-n*c-o*u-h*d,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,s,i){return this._x=t,this._y=e,this._z=s,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e=!0){const s=t._x,i=t._y,r=t._z,a=t._order,n=Math.cos,o=Math.sin,h=n(s/2),l=n(i/2),c=n(r/2),u=o(s/2),d=o(i/2),m=o(r/2);switch(a){case"XYZ":this._x=u*l*c+h*d*m,this._y=h*d*c-u*l*m,this._z=h*l*m+u*d*c,this._w=h*l*c-u*d*m;break;case"YXZ":this._x=u*l*c+h*d*m,this._y=h*d*c-u*l*m,this._z=h*l*m-u*d*c,this._w=h*l*c+u*d*m;break;case"ZXY":this._x=u*l*c-h*d*m,this._y=h*d*c+u*l*m,this._z=h*l*m+u*d*c,this._w=h*l*c-u*d*m;break;case"ZYX":this._x=u*l*c-h*d*m,this._y=h*d*c+u*l*m,this._z=h*l*m-u*d*c,this._w=h*l*c+u*d*m;break;case"YZX":this._x=u*l*c+h*d*m,this._y=h*d*c+u*l*m,this._z=h*l*m-u*d*c,this._w=h*l*c-u*d*m;break;case"XZY":this._x=u*l*c-h*d*m,this._y=h*d*c-u*l*m,this._z=h*l*m+u*d*c,this._w=h*l*c+u*d*m;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+a)}return!0===e&&this._onChangeCallback(),this}setFromAxisAngle(t,e){const s=e/2,i=Math.sin(s);return this._x=t.x*i,this._y=t.y*i,this._z=t.z*i,this._w=Math.cos(s),this._onChangeCallback(),this}setFromRotationMatrix(t){const e=t.elements,s=e[0],i=e[4],r=e[8],a=e[1],n=e[5],o=e[9],h=e[2],l=e[6],c=e[10],u=s+n+c;if(u>0){const t=.5/Math.sqrt(u+1);this._w=.25/t,this._x=(l-o)*t,this._y=(r-h)*t,this._z=(a-i)*t}else if(s>n&&s>c){const t=2*Math.sqrt(1+s-n-c);this._w=(l-o)/t,this._x=.25*t,this._y=(i+a)/t,this._z=(r+h)/t}else if(n>c){const t=2*Math.sqrt(1+n-s-c);this._w=(r-h)/t,this._x=(i+a)/t,this._y=.25*t,this._z=(o+l)/t}else{const t=2*Math.sqrt(1+c-s-n);this._w=(a-i)/t,this._x=(r+h)/t,this._y=(o+l)/t,this._z=.25*t}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let s=t.dot(e)+1;return s<Number.EPSILON?(s=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=s):(this._x=0,this._y=-t.z,this._z=t.y,this._w=s)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=s),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(W(this.dot(t),-1,1)))}rotateTowards(t,e){const s=this.angleTo(t);if(0===s)return this;const i=Math.min(1,e/s);return this.slerp(t,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t){return this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){const s=t._x,i=t._y,r=t._z,a=t._w,n=e._x,o=e._y,h=e._z,l=e._w;return this._x=s*l+a*n+i*h-r*o,this._y=i*l+a*o+r*n-s*h,this._z=r*l+a*h+s*o-i*n,this._w=a*l-s*n-i*o-r*h,this._onChangeCallback(),this}slerp(t,e){if(0===e)return this;if(1===e)return this.copy(t);const s=this._x,i=this._y,r=this._z,a=this._w;let n=a*t._w+s*t._x+i*t._y+r*t._z;if(n<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,n=-n):this.copy(t),n>=1)return this._w=a,this._x=s,this._y=i,this._z=r,this;const o=1-n*n;if(o<=Number.EPSILON){const t=1-e;return this._w=t*a+e*this._w,this._x=t*s+e*this._x,this._y=t*i+e*this._y,this._z=t*r+e*this._z,this.normalize(),this}const h=Math.sqrt(o),l=Math.atan2(h,n),c=Math.sin((1-e)*l)/h,u=Math.sin(e*l)/h;return this._w=a*c+this._w*u,this._x=s*c+this._x*u,this._y=i*c+this._y*u,this._z=r*c+this._z*u,this._onChangeCallback(),this}slerpQuaternions(t,e,s){return this.copy(t).slerp(e,s)}random(){const t=2*Math.PI*Math.random(),e=2*Math.PI*Math.random(),s=Math.random(),i=Math.sqrt(1-s),r=Math.sqrt(s);return this.set(i*Math.sin(t),i*Math.cos(t),r*Math.sin(e),r*Math.cos(e))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,e=0){return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this._onChangeCallback(),this}fromCesiumMatrix4(t){let e,s,i,r,a,n=[1,2,0],o=new Array(3);const h=t[0],l=t[5],c=t[10],u=h+l+c;if(u>0)e=Math.sqrt(u+1),a=.5*e,e=.5/e,s=(t[6]-t[9])*e,i=(t[8]-t[2])*e,r=(t[1]-t[4])*e;else{const u=n;let d=0;l>h&&(d=1),c>h&&c>l&&(d=2);const m=u[d],p=u[m];e=Math.sqrt(t[K(d,d)]-t[K(m,m)]-t[K(p,p)]+1);const f=o;f[d]=.5*e,e=.5/e,a=(t[K(p,m)]-t[K(m,p)])*e,f[m]=(t[K(m,d)]+t[K(d,m)])*e,f[p]=(t[K(p,d)]+t[K(d,p)])*e,s=-f[0],i=-f[1],r=-f[2]}return this.x=s,this.y=i,this.z=r,this.w=a,this}toJSON(){return this.toArray()}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}function K(t,e){return 4*t+e}class J{constructor(t=0,e=0,s=0){J.prototype.isVector3=!0,this.x=t,this.y=e,this.z=s}set(t,e,s){return void 0===s&&(s=this.z),this.x=t,this.y=e,this.z=s,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return this.applyQuaternion(tt.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(tt.setFromAxisAngle(t,e))}applyMatrix3(t){const e=this.x,s=this.y,i=this.z,r=t.elements;return this.x=r[0]*e+r[3]*s+r[6]*i,this.y=r[1]*e+r[4]*s+r[7]*i,this.z=r[2]*e+r[5]*s+r[8]*i,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const e=this.x,s=this.y,i=this.z,r=t.elements,a=1/(r[3]*e+r[7]*s+r[11]*i+r[15]);return this.x=(r[0]*e+r[4]*s+r[8]*i+r[12])*a,this.y=(r[1]*e+r[5]*s+r[9]*i+r[13])*a,this.z=(r[2]*e+r[6]*s+r[10]*i+r[14])*a,this}applyQuaternion(t){const e=this.x,s=this.y,i=this.z,r=t.x,a=t.y,n=t.z,o=t.w,h=2*(a*i-n*s),l=2*(n*e-r*i),c=2*(r*s-a*e);return this.x=e+o*h+a*c-n*l,this.y=s+o*l+n*h-r*c,this.z=i+o*c+r*l-a*h,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const e=this.x,s=this.y,i=this.z,r=t.elements;return this.x=r[0]*e+r[4]*s+r[8]*i,this.y=r[1]*e+r[5]*s+r[9]*i,this.z=r[2]*e+r[6]*s+r[10]*i,this.normalize()}transformDirectionWithoutNormlize(t){const e=this.x,s=this.y,i=this.z,r=t.elements;return this.x=r[0]*e+r[4]*s+r[8]*i,this.y=r[1]*e+r[5]*s+r[9]*i,this.z=r[2]*e+r[6]*s+r[10]*i,this}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this}clampLength(t,e){const s=this.length();return this.divideScalar(s||1).multiplyScalar(Math.max(t,Math.min(e,s)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,s){return this.x=t.x+(e.x-t.x)*s,this.y=t.y+(e.y-t.y)*s,this.z=t.z+(e.z-t.z)*s,this}cross(t){return this.crossVectors(this,t)}crossVectors(t,e){const s=t.x,i=t.y,r=t.z,a=e.x,n=e.y,o=e.z;return this.x=i*o-r*n,this.y=r*a-s*o,this.z=s*n-i*a,this}projectOnVector(t){const e=t.lengthSq();if(0===e)return this.set(0,0,0);const s=t.dot(this)/e;return this.copy(t).multiplyScalar(s)}projectOnPlane(t){return $.copy(this).projectOnVector(t),this.sub($)}reflect(t){return this.sub($.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;const s=this.dot(t)/e;return Math.acos(W(s,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,s=this.y-t.y,i=this.z-t.z;return e*e+s*s+i*i}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,s){const i=Math.sin(e)*t;return this.x=i*Math.sin(s),this.y=Math.cos(e)*t,this.z=i*Math.cos(s),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,s){return this.x=t*Math.sin(e),this.y=s,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){const e=this.setFromMatrixColumn(t,0).length(),s=this.setFromMatrixColumn(t,1).length(),i=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=s,this.z=i,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,4*e)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,3*e)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}setFromColor(t){return this.x=t.r,this.y=t.g,this.z=t.b,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const t=Math.random()*Math.PI*2,e=2*Math.random()-1,s=Math.sqrt(1-e*e);return this.x=s*Math.cos(t),this.y=e,this.z=s*Math.sin(t),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const $=new J,tt=new Z;function et(t){return"number"==typeof t&&Number.isFinite(t)}function st(t){return!et(t)}function it(t){const e={x:2,y:2};for(;e.x*e.y<t;)e.y>e.x?e.x*=2:e.y*=2;return e}function rt(t){if(!t)return 0;const e=Math.log2(t);return(e+1)*e/2}function at(t,e){if(!e[t])return;const s=new J,i=e[t];if(Array.isArray(i)&&3===i.length)s.x=i[0],s.y=i[1],s.z=i[2];else{if(void 0===i?.x||void 0===i?.y||void 0===i?.z)return void console.error(`Set clip box ${t} failed, plase input [x, y, z] or {x, y, z}`);s.x=i.x,s.y=i.y,s.z=i.z}return s}function nt(t,e){let s,i;const r=e.x,a=e.y;if(t){const e=t.getBoundingClientRect(),n=e.left,o=e.top;s=(r-n)/e.width,i=(a-o)/e.height}else s=r/window.innerWidth,i=a/window.innerHeight,console.warn("没有传入canvas, 计算依据window窗口大小!");return new J(2*s-1,2*-i+1,.5)}class ot{MaxCPUCacheSize=1610612736;MaxGPUCacheSize=3221225472;MaxCPUCollCacheSize=524288e3;MaxGPUCollCacheSize=524288e3;CollBuildThreadNum=2;DecompressThreadNum=4;constructor(t){if(!t)return;const e=t.os;t.gpu,t.browser,e.type!==x&&e.type!==f||(this.MaxCPUCacheSize=104857600,this.MaxGPUCacheSize=209715200,this.MaxCPUCollCacheSize=52428800,this.MaxGPUCollCacheSize=209715200,this.CollBuildThreadNum=1,this.DecompressThreadNum=2)}}class ht{LodStrategy=c;MaxLodDistance=200;LodStepDistance=20;MinValidSplatsInUnit=100;MinValidSplatsInNode=50;LodLevelUpSpatsInNode=8e5;MergeSplatsReqThreshold=8192;MergeSplatsReqEnable=!0;GloballHeight=20;CpuSortThreadNum=4;CameraPosChangedSortThreshold=.3;CameraAngleChangedSortThreshold=Math.cos(10*Math.PI/180);sortDrawCallCount=100;WebglSortingEnable=!1;AlwaysDownloadAround=!0;MinLodUsed=1;MaxDistaneLimit=200;maxLoadSplatCount=3e6;useSH=!1;useEnv=!0;pointsOnly=!1;visible=!0;alpha=1;pointsColor=l;gpuAcceleration=!1;constructor(t){if(!t)return;const e=t.os,s=t.gpu,i=t.browser;e.type===d?i.type!==b&&(s.type===R&&et(s.model)?s.model<1050?this.maxLoadSplatCount=1e6:s.model<2060&&(this.maxLoadSplatCount=2e6):s.type===k&&et(s.model)&&(s.model<560?this.maxLoadSplatCount=1e6:s.model<5600&&(this.maxLoadSplatCount=2e6))):e.type===m?this.maxLoadSplatCount=3e6:(e.type===x||e.type===f)&&(this.maxLoadSplatCount=8e5),e.type!==x&&e.type!==f||(this.MaxLodDistance=30,this.LodLevelUpSpatsInNode=5e5,this.CpuSortThreadNum=2,this.MinLodUsed=1,this.MaxDistaneLimit=100),this.maxLoadSplatCount=Math.min(s.limitLoadSplatCount,this.maxLoadSplatCount),console.log("m: ",this.maxLoadSplatCount)}getUserConfig(){return{useSH:this.useSH,useEnv:this.useEnv,pointsOnly:this.pointsOnly,pointsColor:this.pointsColor===h?"default":"rainbow",maxLoadSplatCount:this.maxLoadSplatCount,visible:this.visible}}setUserConfig(t){"boolean"==typeof t?.useSH&&(this.useSH=t.useSH),"boolean"==typeof t?.useEnv&&(this.useEnv=t.useEnv),"boolean"==typeof t?.pointsOnly&&(this.pointsOnly=t.pointsOnly),"default"!==t?.pointsColor&&"rainbow"!==t?.pointsColor||(this.pointsColor="default"===t?.pointsColor?h:l),"number"==typeof t?.maxLoadSplatCount&&(this.maxLoadSplatCount=t.maxLoadSplatCount),"boolean"==typeof t?.visible&&(this.visible=t.visible)}}class lt{constructor(){}get maxLoadSplatCount(){throw new Error("Must be implemented by subclass")}set maxLoadSplatCount(t){throw new Error("Must be implemented by subclass")}dispose(){throw new Error("Must be implemented by subclass")}update(t){throw new Error("Must be implemented by subclass")}load(t,e,s,i){throw new Error("Must be implemented by subclass")}getInstancedMesh(){throw new Error("Must be implemented by subclass")}getEnvInstancedMesh(){throw new Error("Must be implemented by subclass")}getBounds(){throw new Error("Must be implemented by subclass")}togglePointsDisplayMode(){throw new Error("Must be implemented by subclass")}useEnvironment(t){throw new Error("Must be implemented by subclass")}useShcoef(t,e){throw new Error("Must be implemented by subclass")}hasShcoef(){throw new Error("Must be implemented by subclass")}setVisible(t){throw new Error("Must be implemented by subclass")}setAlpha(t){throw new Error("Must be implemented by subclass")}setStartLod(t){throw new Error("Must be implemented by subclass")}setMaxDistance(t){throw new Error("Must be implemented by subclass")}setMaxSplats(t){throw new Error("Must be implemented by subclass")}setClipBox(t){throw new Error("Must be implemented by subclass")}setClipPlane(t,e){throw new Error("Must be implemented by subclass")}getCurrentConfig(){throw new Error("Must be implemented by subclass")}updateCurrentConfig(t){throw new Error("Must be implemented by subclass")}raycast(t){throw new Error("Must be implemented by subclass")}raycastFromOrigin(t){throw new Error("Must be implemented by subclass")}hasCollision(){throw new Error("Must be implemented by subclass")}intersectsRay(t){throw new Error("Must be implemented by subclass")}intersectsRayFromOrigin(t){throw new Error("Must be implemented by subclass")}intersectsSphere(t){throw new Error("Must be implemented by subclass")}intersectsCapsule(t){throw new Error("Must be implemented by subclass")}}class ct{constructor(t,e,s){this.prev=null,this.next=null,this.id=t,this.obj=e,this.size=s,this.refCnt=0}dispose(){this.prev=null,this.next=null,this.id=0,this.obj=null,this.size=0}}class ut{#a;#n;#o;#h;#l;#c;#u;constructor(t,e,s=null){this.#a=new ct(0,null,0),this.#a.prev=this.#a,this.#a.next=this.#a,this.#n=Object.create(null),this.#o=0,this.#h=0,this.#l=e,this.#c=s,this.#u=t||""}elements(){return this.#o}contains(t){return!!this.#n[t]}get(t,e=!0){let s=this.#n[t];return s?(e&&(s.prev.next=s.next,s.next.prev=s.prev,s.prev=this.#a,s.next=this.#a.next,this.#a.next.prev=s,this.#a.next=s),s.obj):null}add(t,e,s){if(this.contains(t))return!1;let i=new ct(t,e,s);return this.#n[t]=i,this.#o++,this.#h+=s,i.prev=this.#a,i.next=this.#a.next,this.#a.next.prev=i,this.#a.next=i,!0}flush(t,e,s){let i=this.#n[t];if(!i)return!1;let r=s-i.size;return i.obj=e,i.size=s,this.#h+=r,!0}remove(t){let e=this.#n[t];return!!e&&(this.#d(e),!0)}#d(t){t.prev.next=t.next,t.next.prev=t.prev,this.#o--,this.#h-=t.size,delete this.#n[t.id],this.#c&&this.#c(t.id,t.obj,this.#u),t.dispose()}clear(){for(;this.#a.prev!=this.#a;){let t=this.#a.prev;this.#d(t)}}ref(t){let e=this.#n[t];e&&(e.refCnt+=1)}unref(t){let e=this.#n[t];e&&e.refCnt>0&&(e.refCnt-=1)}freeMemory(){if(this.#o<=1||this.#h<this.#l)return;let t=0,e=0,s=this.#a.prev;for(;this.#h>.7*this.#l;){let i=s;if(s=s.prev,i==this.#a){console.warn("you should never see this. (LRU free memory)");break}i.refCnt>0||(e+=i.size,t+=1,this.#d(i))}t>0&&console.log("LRU "+this.#u+" free memory(MB): ",t,(e/1048576).toFixed(1))}dispose(){this.clear(),this.#n={},this.#a.dispose(),console.log("LRU "+this.#u+" dispose !!!")}toString(){let t="{ ",e=this.#a.next;for(;e!=this.#a;)t+=e.id,e.next!=this.#a&&(t+=", "),e=e.next;return t+="}",t+="("+this.#o+")",t}}class dt{#m=!1;#p=0;#f;#x={};#l;#c;constructor(t,e){this.#l=t,this.#c=e,this.#f=new ut("CPU",t,e)}#g(t,e){return`${t}_${e}`}pushEnv(t,e,s,i,r){return!this.#m&&(this.#x[t]={splatCounts:e,data:s,sh:i,pos:r,size:0},!0)}queryEnv(t){return this.#m?null:this.#x[t]}pushData(t,e,s,i,r){if(this.#m)return!1;let a=this.#g(t,e),n=this.#f.get(a,!1);if(n){if(n.data)return!1;let t=n.size;return n.data=s,n.pos=r,n.size=t+i,this.#f.flush(a,n,n.size),!0}return n={data:s,sh:null,pos:r,size:i},this.#f.add(a,n,i),!0}pushSH(t,e,s,i){if(this.#m)return!1;let r=this.#g(t,e),a=this.#f.get(r,!1);if(a){if(a.sh)return!1;let t=a.size;return a.sh=s,a.size=t+i,this.#f.flush(r,a,a.size),!0}return a={data:null,sh:s,pos:null,size:i},this.#f.add(r,a,i),!0}queryOne(t,e,s=!0){if(this.#m)return null;let i=this.#g(t,e);return this.#f.get(i,s)}hasData(t,e){if(this.#m)return!1;let s=this.#g(t,e),i=this.#f.get(s,!1);return i&&i.data}hasSH(t,e){if(this.#m)return!1;let s=this.#g(t,e),i=this.#f.get(s,!1);return i&&i.sh}clear(t,e){if(this.#m)return!1;Array.isArray(e)?e.forEach((e=>{let s=this.#g(t,e);this.#f.remove(s)})):console.warn("nodeIDs must be Array !!!")}dispose(){this.#m=!0,this.#f.dispose(),Object.keys(this.#x).forEach((t=>{this.#c&&this.#c(t,this.#x[t])})),this.#x={}}update(t){this.#m||this.#f.freeMemory()}}function mt(t,e={}){return new Promise(((s,i)=>{const r={...e},a=new Request(t,{headers:r});fetch(a).then((async t=>{if(t.ok)try{const e=await t.text();s(e)}catch(t){i("file fetch error, please ensure the path of file can access normally!")}else i("file fetch error, please ensure the path of file can access normally!")}))}))}function pt(t,e={}){return new Promise(((s,i)=>{const r={...e},a=new Request(t,{headers:r});fetch(a).then((async t=>{if(t.ok)try{const e=await t.arrayBuffer();s(e)}catch(t){i("fetch bin error")}else i("fetch bin error")}))}))}function ft(t,e,s,i={}){return new Promise(((r,a)=>{"bigint"==typeof e&&(e=Number(e));let n={...i};if(("number"==typeof e||"bigint"==typeof e)&&"number"==typeof s){const t=`bytes=${e}-${e+s-1}`;n.Range=t}const o=new Request(`${t}?${Math.random()}`,{headers:n});try{fetch(o).then((t=>{try{if(!t.ok)throw new Error(`HTTP error! Status: ${t.status}`);t.arrayBuffer().then((t=>{r(t)}))}catch(t){a(t)}})).catch((()=>{a()}))}catch(t){a()}}))}class xt{constructor(){this.items=[]}traverse(t){this.items.forEach((e=>{t(e)}))}get isEmpty(){return 0===this.items.length}get length(){return this.items.length}enqueue(t){this.items.push(t)}dequeue(){return this.isEmpty?null:this.items.shift()}peek(){return this.isEmpty?null:this.items[0]}}async function gt(t){function e(t,e,s,i={}){return new Promise(((r,a)=>{"bigint"==typeof e&&(e=Number(e));let n={...i};if(("number"==typeof e||"bigint"==typeof e)&&"number"==typeof s){const t=`bytes=${e}-${e+s-1}`;n.Range=t}const o=new Request(`${t}?${Math.random()}`,{headers:n});try{fetch(o).then((t=>{try{if(!t.ok)throw new Error(`HTTP error! Status: ${t.status}`);t.arrayBuffer().then((t=>{r(t)}))}catch(t){console.error("catch: ",t),r(void 0)}})).catch((()=>{r(void 0)}))}catch(t){r(void 0)}}))}const s=t.data,i=[];for(let t=0;t<s.length;t++){const{index:r,path:a,offset:n,size:o,headers:h}=s[t],l=e(a,n,o,h);i.push(l)}const r=async function(){const t=i.splice(0,5),e=await Promise.all(t),a=s.splice(0,5),n=[],o=[];for(let t=0;t<a.length;++t)e[t]&&(n.push(a[t]),o.push(e[t]));o.length>0?postMessage({payloads:n,data:o,isFinished:0===i.length},o):postMessage({payloads:n,data:o,isFinished:0===i.length}),i.length>0&&requestAnimationFrame(r)};r()}class yt{static GlobalID=0;isNode=!0;#y;#M=32;#b=64;#w;#v=-1;#S=null;#C=!1;#_=!1;#T=!1;#D=!1;visibleID=0;get id(){return this.#y}get level(){return this.#v}get points(){return this.#w.points}get offset(){return this.#w.offset}get size(){return this.#w.size}get shOffset(){return BigInt(Number(this.offset)/this.#M*this.#b)}get shSize(){return this.size/this.#M*this.#b}get parent(){return this.#S}set parent(t){this.#S=t}get renderID(){return this.#S.renderID}get unitID(){return this.#S.id}isDownloading(e){return e===t?this.#C:this.#_}setDownloading(e,s){e===t?this.#C=s:this.#_=s}isDecompressing(e){return e===t?this.#T:this.#D}setDecompressing(e,s){e===t?this.#T=s:this.#D=s}isDownloadingOrDecompressing(e){return e===t?this.#C||this.#T:this.#_||this.#D}isCache(e){let s=this.#S.cpuCache,i=this.#S.renderID;return e===t?s.hasData(i,this.id):s.hasSH(i,this.id)}queryCache(){let t=this.#S.cpuCache,e=this.#S.renderID;return t.queryOne(e,this.id,!0)}constructor(t,e){this.#y=yt.GlobalID++,this.#w=t,this.#v=e}dispose(){this.#S=null}}class Mt{constructor(t=0,e=0){Mt.prototype.isVector2=!0,this.x=t,this.y=e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const e=this.x,s=this.y,i=t.elements;return this.x=i[0]*e+i[3]*s+i[6],this.y=i[1]*e+i[4]*s+i[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this}clampLength(t,e){const s=this.length();return this.divideScalar(s||1).multiplyScalar(Math.max(t,Math.min(e,s)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;const s=this.dot(t)/e;return Math.acos(W(s,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,s=this.y-t.y;return e*e+s*s}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,s){return this.x=t.x+(e.x-t.x)*s,this.y=t.y+(e.y-t.y)*s,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this}rotateAround(t,e){const s=Math.cos(e),i=Math.sin(e),r=this.x-t.x,a=this.y-t.y;return this.x=r*s-a*i+t.x,this.y=r*i+a*s+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class bt{constructor(t=new J(1/0,1/0,1/0),e=new J(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromArray(t){this.makeEmpty();for(let e=0,s=t.length;e<s;e+=3)this.expandByPoint(vt.fromArray(t,e));return this}setFromBufferAttribute(t){this.makeEmpty();for(let e=0,s=t.count;e<s;e++)this.expandByPoint(vt.fromBufferAttribute(t,e));return this}setFromPoints(t){this.makeEmpty();for(let e=0,s=t.length;e<s;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const s=vt.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(s),this.max.copy(t).add(s),this}setFromObject(t,e=!1){return this.makeEmpty(),this.expandByObject(t,e)}clone(){return(new this.constructor).copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t,e=!1){t.updateWorldMatrix(!1,!1);const s=t.geometry;if(void 0!==s){const i=s.getAttribute("position");if(!0===e&&void 0!==i&&!0!==t.isInstancedMesh)for(let e=0,s=i.count;e<s;e++)!0===t.isMesh?t.getVertexPosition(e,vt):vt.fromBufferAttribute(i,e),vt.applyMatrix4(t.matrixWorld),this.expandByPoint(vt);else void 0!==t.boundingBox?(null===t.boundingBox&&t.computeBoundingBox(),St.copy(t.boundingBox)):(null===s.boundingBox&&s.computeBoundingBox(),St.copy(s.boundingBox)),St.applyMatrix4(t.matrixWorld),this.union(St)}const i=t.children;for(let t=0,s=i.length;t<s;t++)this.expandByObject(i[t],e);return this}containsPoint(t){return t.x>=this.min.x&&t.x<=this.max.x&&t.y>=this.min.y&&t.y<=this.max.y&&t.z>=this.min.z&&t.z<=this.max.z}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return t.max.x>=this.min.x&&t.min.x<=this.max.x&&t.max.y>=this.min.y&&t.min.y<=this.max.y&&t.max.z>=this.min.z&&t.min.z<=this.max.z}intersectsSphere(t){return this.clampPoint(t.center,vt),vt.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let e,s;return t.normal.x>0?(e=t.normal.x*this.min.x,s=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,s=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,s+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,s+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,s+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,s+=t.normal.z*this.min.z),e<=-t.constant&&s>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(At),Et.subVectors(this.max,At),Ct.subVectors(t.a,At),_t.subVectors(t.b,At),Tt.subVectors(t.c,At),Dt.subVectors(_t,Ct),Pt.subVectors(Tt,_t),zt.subVectors(Ct,Tt);let e=[0,-Dt.z,Dt.y,0,-Pt.z,Pt.y,0,-zt.z,zt.y,Dt.z,0,-Dt.x,Pt.z,0,-Pt.x,zt.z,0,-zt.x,-Dt.y,Dt.x,0,-Pt.y,Pt.x,0,-zt.y,zt.x,0];return!!Rt(e,Ct,_t,Tt,Et)&&(e=[1,0,0,0,1,0,0,0,1],!!Rt(e,Ct,_t,Tt,Et)&&(It.crossVectors(Dt,Pt),e=[It.x,It.y,It.z],Rt(e,Ct,_t,Tt,Et)))}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return this.clampPoint(t,vt).distanceTo(t)}getBoundingSphere(t){return this.isEmpty()?t.makeEmpty():(this.getCenter(t.center),t.radius=.5*this.getSize(vt).length()),t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()||(wt[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),wt[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),wt[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),wt[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),wt[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),wt[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),wt[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),wt[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(wt)),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}const wt=[new J,new J,new J,new J,new J,new J,new J,new J],vt=new J,St=new bt,Ct=new J,_t=new J,Tt=new J,Dt=new J,Pt=new J,zt=new J,At=new J,Et=new J,It=new J,Ft=new J;function Rt(t,e,s,i,r){for(let a=0,n=t.length-3;a<=n;a+=3){Ft.fromArray(t,a);const n=r.x*Math.abs(Ft.x)+r.y*Math.abs(Ft.y)+r.z*Math.abs(Ft.z),o=e.dot(Ft),h=s.dot(Ft),l=i.dot(Ft);if(Math.max(-Math.max(o,h,l),Math.min(o,h,l))>n)return!1}return!0}class kt{#m=!1;#p=0;#f;#l;#c;constructor(t,e){this.#l=t,this.#c=e,this.#f=new ut("GPU",t,e)}#g(t,e){return`${t}_${e}`}pushMesh(t,e,s,i){if(this.#m)return!1;let r=this.#g(t,e);return this.#f.add(r,s,i)}flushMesh(t,e,s,i){if(this.#m)return!1;let r=this.#g(t,e);return this.#f.flush(r,s,i)}queryMesh(t,e,s=!0){if(this.#m)return null;let i=this.#g(t,e);return this.#f.get(i,s)}hasMesh(t,e){if(this.#m)return!1;let s=this.#g(t,e);return!!this.#f.get(s,!1)}clear(t,e){if(this.#m)return!1;Array.isArray(e)?e.forEach((e=>{let s=this.#g(t,e);this.#f.remove(s)})):console.warn("nodeIDs must be Array !!!")}dispose(){this.#m=!0,this.#f.dispose()}update(t){this.#m||this.#f.freeMemory()}test(){console.log("gpu lru info: "+this.#f.toString())}}class Nt{#m=!1;#P;#z;constructor(t,e,s,i){this.#P=new ut("CPU_COLL",t,e),this.#z=new ut("GPU_COLL",s,i)}#g(t,e){return`${t}_${e}`}pushMesh(t,e,s,i){if(this.#m)return!1;let r=this.#g(t,e);return this.#z.add(r,s,i)}queryMesh(t,e,s=!0){if(this.#m)return null;let i=this.#g(t,e);return this.#z.get(i,s)}hasMesh(t,e){if(this.#m)return!1;let s=this.#g(t,e);return!!this.#z.get(s,!1)}pushData(t,e,s,i){if(this.#m)return!1;let r=this.#g(t,e);return this.#P.add(r,s,i)}queryData(t,e,s=!0){if(this.#m)return null;let i=this.#g(t,e);return this.#P.get(i,s)}hasData(t,e){if(this.#m)return!1;let s=this.#g(t,e);return!!this.#P.get(s,!1)}clear(t,e){if(this.#m)return!1;Array.isArray(e)?e.forEach((e=>{let s=this.#g(t,e);this.#P.remove(s),this.#z.remove(s)})):console.warn("collIDs must be Array !!!")}dispose(){this.#m=!0,this.#P.dispose(),this.#z.dispose()}update(t){this.#m||(this.#P.freeMemory(),this.#z.freeMemory())}test(){console.log("cpu_coll lru info: "+this.#P.toString()),console.log("gpu_coll lru info: "+this.#z.toString())}}class Bt{vertexes;faces;bvh;bvh_f32;bvh_u16;bvh_u32;vertexNum;faceNum;constructor(t,e,s,i,r){this.vertexes=t,this.faces=e,this.bvh=s,this.vertexNum=i,this.faceNum=r,this.bvh_f32=new Float32Array(this.bvh),this.bvh_u16=new Uint16Array(this.bvh),this.bvh_u32=new Uint32Array(this.bvh)}}class Lt{isColl=!0;#y;#S=null;#A;#E;#I=0;#F=0;#R=!1;#k=!1;get offset(){return this.#A}get size(){return this.#E}get parent(){return this.#S}set parent(t){this.#S=t}get id(){return this.#S.id}get renderID(){return this.#S.renderID}get unitID(){return this.#S.id}get vertexNum(){return this.#I}get faceNum(){return this.#F}isDownloading(t){return this.#R}setDownloading(t,e){this.#R=e}isDecompressing(t){return this.#k}setDecompressing(t,e){this.#k=e}isDownloadingOrDecompressing(t){return this.#R||this.#k}pushCacheData(t,e,s){let i=this.#S.collCache,r=this.#S.renderID,a=t.byteLength+e.byteLength+s.byteLength,n=this.vertexNum,o=this.#F,h=new Bt(t,e,s,n,o);return i.pushData(r,this.id,h,a)}isCacheData(){let t=this.#S.collCache,e=this.#S.renderID;return t.hasData(e,this.id)}queryCacheData(){let t=this.#S.collCache,e=this.#S.renderID;return t.queryData(e,this.id,!0)}pushCacheMesh(t){let e=this.#S.collCache,s=this.#S.renderID;return e.pushMesh(s,this.id,t,this.#E)}isCacheMesh(){let t=this.#S.collCache,e=this.#S.renderID;return t.hasMesh(e,this.id)}queryCacheMesh(){let t=this.#S.collCache,e=this.#S.renderID;return t.queryMesh(e,this.id,!0)}constructor(t,e,s,i){this.#A=t,this.#E=e,this.#I=s,this.#F=i}dispose(){this.#S=null}}class qt{static GlobalID=0;renderID;#N;cpuCache;gpuCache;collCache;#M=32;#b=64;isUnit=!0;#B;#L;#q;#H;#h;#U;#O;#V;#G;#j;#W;#Q;#X=0;#Y=0;nodes=[];id;#Z;sequence;#K;#J;get x(){return this.#j}get y(){return this.#W}get center(){return this.#Q}get totalPoints(){return this.#L}get startAddr(){return this.#q}get endAddr(){return this.#H}get totalSize(){return this.#h}get shStartAddr(){return this.#U}get shEndAddr(){return this.#O}get shTotalSize(){return this.#V}get distanceToCameraSq(){return this.#X}get distance2dToCameraSq(){return this.#Y}get coll(){return this.#Z}setCollInfo(t,e,s,i){this.#Z=new Lt(t,e,s,i),this.#Z.parent=this}updateDistanceToCamera(t){this.#X=this.#Q.distanceToSquared(t);const e=this.#K.set(t.x,t.y),s=this.#J.set(this.#Q.x,this.#Q.y);this.#Y=e.distanceToSquared(s)}getBBox(){return this.#G}searchNearestNode(t,e){null==e&&(e=this.nodes.length);for(let s=t;s<e;++s)if(this.nodes[s])return this.nodes[s];return null}searchNearestNodeInverse(t,e=-1){for(let s=t;s>e;--s)if(this.nodes[s])return this.nodes[s];return null}getNodeByLevel(t){return t>=this.nodes.length||t<0?null:this.nodes[t]}constructor(t,e,s,i,r){this.renderID=t,this.#N=e,this.cpuCache=e.cpuCache,this.gpuCache=e.gpuCache,this.collCache=e.collCache,this.#K=new Mt,this.#J=new Mt,this.id=qt.GlobalID++,this.#B=s,this.#j=s.x,this.#W=s.y,this.#G=new bt(i,r),this.#Q=new J,this.#G.getCenter(this.#Q),this.#L=0,this.#h=0,this.#q=BigInt(-1);for(let t=0;t<s.lods.length;t++){let e=s.lods[t];if(0==e.points){this.nodes[t]=null;continue}this.#q<0&&(this.#q=e.offset);let i=new yt(e,t);i.parent=this,this.nodes[t]=i,this.#L+=e.points,this.#h+=e.size}this.#H=this.#q+BigInt(this.#h),this.#V=this.#L*this.#b,this.#U=BigInt(Number(this.#q)/this.#M*this.#b),this.#O=this.#U+BigInt(this.#V)}dispose(){this.nodes.forEach((t=>{t&&(t.parent=null,t.dispose())})),this.nodes=[],this.cpuCache=null,this.gpuCache=null,this.#N=null,this.#Z?.dispose(),this.#Z=null}}class Ht{isUnitChunk=!0;renderID;#$=[];#q=0n;#H=0n;#h=0;#U=0n;#O=0n;#V=0;#L=0;#X=0;#Y=0;get startAddr(){return this.#q}get endAddr(){return this.#H}get totalSize(){return this.#h}get shStartAddr(){return this.#U}get shEndAddr(){return this.#O}get shTotalSize(){return this.#V}get totalPoints(){return this.#L}get distanceToCameraSq(){return this.#X}get distance2dToCameraSq(){return this.#Y}get allUnits(){return this.#$}setDownloading(t,e){this.#$.forEach((s=>{const i=s.nodes;for(let s=0;s<i.length;++s)i[s]&&i[s].setDownloading(t,e)}))}constructor(t,e){if(!e||0==e.length)throw new Error("units is empty (UnitChunk)");this.renderID=t,this.#$=e,this.#q=e[0].startAddr,this.#H=e[e.length-1].endAddr,this.#h=Number(this.#H-this.#q),this.#U=e[0].shStartAddr,this.#O=e[e.length-1].shEndAddr,this.#V=Number(this.#O-this.#U),this.#X=e[0].distanceToCameraSq,this.#Y=e[0].distance2dToCameraSq,e.forEach((t=>{this.#L+=t.totalPoints,this.#X=Math.min(this.#X,t.distanceToCameraSq),this.#Y=Math.min(this.#Y,t.distance2dToCameraSq)}))}}const Ut=function(t,e="application/javascript"){const s=`onmessage=${String(t)}`,i=URL.createObjectURL(new Blob([s],{type:e}));return new Worker(i)},Ot=function(t){return new Worker(URL.createObjectURL(new Blob(["(",t.toString(),")(self)"],{type:"application/javascript"})))};class Vt{constructor(){}dispose(){throw new Error("Must be implemented by subclass")}update(t){throw new Error("Must be implemented by subclass")}decompress(t,e,s,i){throw new Error("Must be implemented by subclass")}}function Gt(){const t=Math.pow(2,-24),e=32,s=65535,i=40,r=10;function a(){return{boundingData:new Float32Array(6)}}function n(t){return"count"in t?1:1+n(t.left)+n(t.right)}function o(t,e,s,i,r){let a=1/0,n=1/0,o=1/0,h=-1/0,l=-1/0,c=-1/0,u=1/0,d=1/0,m=1/0,p=-1/0,f=-1/0,x=-1/0;for(let i=6*e,r=6*(e+s);i<r;i+=6){const e=t[i+0],s=t[i+1],r=e-s,g=e+s;r<a&&(a=r),g>h&&(h=g),e<u&&(u=e),e>p&&(p=e);const y=t[i+2],M=t[i+3],b=y-M,w=y+M;b<n&&(n=b),w>l&&(l=w),y<d&&(d=y),y>f&&(f=y);const v=t[i+4],S=t[i+5],C=v-S,_=v+S;C<o&&(o=C),_>c&&(c=_),v<m&&(m=v),v>x&&(x=v)}i[0]=a,i[1]=n,i[2]=o,i[3]=h,i[4]=l,i[5]=c,r[0]=u,r[1]=d,r[2]=m,r[3]=p,r[4]=f,r[5]=x}function h(h,l,c,u){const d=function(e,s,i){let r=new Float32Array(6*i*4);for(let a=0;a<i;++a){let i=s[3*a+0],n=s[3*a+1],o=s[3*a+2],h=e[3*i+0],l=e[3*i+1],c=e[3*i+2],u=e[3*n+0],d=e[3*n+1],m=e[3*n+2],p=e[3*o+0],f=e[3*o+1],x=e[3*o+2],g=Math.min(h,Math.min(u,p)),y=Math.max(h,Math.max(u,p)),M=Math.min(l,Math.min(d,f)),b=Math.max(l,Math.max(d,f)),w=Math.min(c,Math.min(m,x)),v=(y-g)/2,S=(b-M)/2,C=(Math.max(c,Math.max(m,x))-w)/2;r[6*a+0]=g+v,r[6*a+1]=v+(Math.abs(g)+v)*t,r[6*a+2]=M+S,r[6*a+3]=S+(Math.abs(M)+S)*t,r[6*a+4]=w+C,r[6*a+5]=C+(Math.abs(w)+C)*t}return r}(h,l,u),m=function(t,e,s){const n=a(),h=new Float32Array(6);return o(t,0,s,n.boundingData,h),function s(n,l,c,u=null,d=0){if(c<=r||d>=i)return n.offset=l,n.count=c,n;const m=function(t,e,s,i,r,a){let n=-1,o=0;return n=function(t){let e=-1,s=-1/0;for(let i=0;i<3;i++){const r=t[i+3]-t[i];r>s&&(s=r,e=i)}return e}(e),-1!==n&&(o=(e[n]+e[n+3])/2),{axis:n,pos:o}}(n.boundingData,u);if(-1===m.axis)return n.offset=l,n.count=c,n;const p=function(t,e,s,i,r){let a=s,n=s+i-1;const o=r.pos,h=2*r.axis;for(;;){for(;a<=n&&e[6*a+h]<o;)a++;for(;a<=n&&e[6*n+h]>=o;)n--;if(!(a<n))return a;for(let e=0;e<3;e++){let s=t[3*a+e];t[3*a+e]=t[3*n+e],t[3*n+e]=s}for(let t=0;t<6;t++){let s=e[6*a+t];e[6*a+t]=e[6*n+t],e[6*n+t]=s}a++,n--}}(e,t,l,c,m);if(p===l||p===l+c)n.offset=l,n.count=c;else{n.splitAxis=m.axis;const e=a(),i=l,r=p-l;n.left=e,o(t,i,r,e.boundingData,h),s(e,i,r,h,d+1);const u=a(),f=p,x=c-r;n.right=u,o(t,f,x,u.boundingData,h),s(u,f,x,h,d+1)}return n}(n,0,s,h),n}(d,l,u),p=n(m),f=new ArrayBuffer(e*p);return function(t,i){let r=new Float32Array(i),a=new Uint32Array(i),n=new Uint16Array(i);(function t(i,o){const h=i/4,l=i/2,c="count"in o,u=o.boundingData;for(let t=0;t<6;t++)r[h+t]=u[t];if(c){const t=o.offset,r=o.count;return a[h+6]=t,n[l+14]=r,n[l+15]=s,i+e}{const s=o.left,r=o.right,n=o.splitAxis;let l=t(i+e,s);return a[h+6]=l/4,l=t(l,r),a[h+7]=n,l}})(0,t)}(m,f),f}self.onmessage=t=>{const e=t.data.index,s=t.data.buffer,i=t.data.vertexNum,r=t.data.faceNum,{vertexes:a,faces:n}=function(t,e,s){const i=new Float32Array(3*e),r=new Uint32Array(3*s),a=new Float32Array(t),n=new Uint32Array(t);for(let t=0;t<e;++t)i[3*t+0]=a[3*t+0],i[3*t+1]=a[3*t+1],i[3*t+2]=a[3*t+2];for(let t=0;t<s;++t){const s=3*(e+t);r[3*t+0]=n[s+0],r[3*t+1]=n[s+1],r[3*t+2]=n[s+2]}return{vertexes:i,faces:r}}(s,i,r),o=h(a,n,0,r);postMessage({index:e,vertexesBuffer:a.buffer,facesBuffer:n.buffer,bvhBuffer:o},[a.buffer,n.buffer,o])}}class jt{buffer;vertexNum;faceNum;meta;callback}class Wt{#m=!1;#tt=0;#et=[];#st=[];#it=[];#rt=0;#at=!0;constructor(t=2){for(let e=0;e<t;++e){const t=Ot(Gt);t?(this.#et.push(t),this.#tt++):console.error("create worker failed !!!")}this.#et.forEach((t=>{t.onmessage=t=>{if(this.#m)return;const e=t.data.index,s=new Float32Array(t.data.vertexesBuffer),i=new Uint32Array(t.data.facesBuffer),r=t.data.bvhBuffer,a=this.#it[e];a.callback(s,i,r,a.vertexNum,a.faceNum),this.#rt++,this.#rt>=this.#it.length&&(this.#at=!0)}}))}dispose(){this.#m=!0,this.#et.forEach((t=>{t.terminate()})),this.#et=[],this.#tt=0,this.#at=!1}#nt(){if(!this.#at||0==this.#st.length||0==this.#tt)return;this.#at=!1,this.#it=this.#st,this.#st=[],this.#rt=0;const t=this.#it.length;for(let e=0;e<t;++e){const t=e%this.#tt,s=this.#et[t],i=this.#it[e];s.postMessage({index:e,buffer:i.buffer,vertexNum:i.vertexNum,faceNum:i.faceNum},[i.buffer])}}update(t){this.#m||this.#nt()}decompress(t,e,s,i,r){let a=new jt;return a.buffer=t,a.vertexNum=e,a.faceNum=s,a.meta=i,a.callback=r,this.#st.push(a),this.#at&&this.#nt(),!0}}class Qt{renderID;url;chunk;type;cpuCache;decompressor;collBuilder;header;offset;size;meta;constructor(e,s,i,r,a,n,o,h,l){this.renderID=e,this.url=s,this.chunk=i,this.type=r,this.header=a,this.cpuCache=n,this.decompressor=o,this.collBuilder=h,this.meta=l,this.chunk.isNode?(this.offset=r===t?this.chunk.offset:this.chunk.shOffset,this.size=r===t?this.chunk.size:this.chunk.shSize):this.chunk.isUnitChunk?(this.offset=r===t?this.chunk.startAddr:this.chunk.shStartAddr,this.size=r===t?this.chunk.totalSize:this.chunk.shTotalSize):this.chunk.isColl?(this.offset=this.chunk.offset,this.size=this.chunk.size):console.error("unknow chunk.")}setPending(){this.chunk.setDownloading(this.type,!0)}setDone(){this.chunk.setDownloading(this.type,!1)}requestData(){return new Promise(((t,e)=>{ft(this.url,this.offset,this.size).then((e=>{t(e)})).catch((()=>{t(void 0)}))}))}processPayload(e,s){if(!e)return;const r=e.byteLength;if(this.chunk.isNode){const i=new Uint32Array(e);this.type===t?s?(this.chunk.setDecompressing(t,!0),this.decompressor.decompress(this.type,e,this.size,this.meta,((e,s,i)=>{this.chunk.setDecompressing(t,!1),this.cpuCache.pushData(this.renderID,this.chunk.id,e,this.size,s)}))):this.cpuCache.pushData(this.renderID,this.chunk.id,i,this.size):this.cpuCache.pushSH(this.renderID,this.chunk.id,i,this.size),this.size!=r&&console.warn("wrong data: ",this.chunk,this.size,r)}else if(this.chunk.isUnitChunk){const i=this.type===t?this.chunk.startAddr:this.chunk.shStartAddr,a=this.chunk.allUnits;let n=0;a.forEach((r=>{const a=r.nodes;a&&a.forEach((r=>{if(r&&r.points>0){const a=r.id,o=this.type===t?r.offset:r.shOffset,h=this.type===t?r.size:r.shSize,l=Number(o-i),c=new Uint32Array(e,l,h/4);if(this.type===t)if(s){const e=new Uint32Array(h/4);for(let t=0;t<e.length;++t)e[t]=c[t];r.setDecompressing(t,!0),this.decompressor.decompress(this.type,e.buffer,h,this.meta,((e,s,i)=>{r.setDecompressing(t,!1),this.cpuCache.pushData(this.renderID,a,e,h,s)}))}else this.cpuCache.pushData(this.renderID,a,c,h);else this.cpuCache.pushSH(this.renderID,a,c,h);n+=h}}))})),r!=n&&console.warn("wrong data2: ",this.chunk,n,r)}else if(this.chunk.isColl){let t=this.chunk,s=12*t.vertexNum+12*t.faceNum;s!=e.byteLength&&console.warn("wrong coll-data: ",s,e.byteLengt),t.setDecompressing(i,!0),this.collBuilder.decompress(e,t.vertexNum,t.faceNum,this.meta,((e,s,r,a,n)=>{t.setDecompressing(i,!1),t.pushCacheData(e,s,r)}))}else console.error("unknow chunk.")}}class Xt{#m=!1;#ot=5;#P;#ht;#lt;#ct=!0;#ut=!0;#dt=Object.create(null);#mt=new xt;#pt=new xt;#C=!1;#_=!1;#ft=!1;isDownloadCompleted=!1;constructor(t,e,s,i=!0,r=!0){this.#P=t,this.#ht=s,this.#lt=e,this.#ct=i,this.#ut=r}setRenderInfoMeta(t,e){this.#dt[t].meta=e}#xt(t){let e,s,i,r=new URL(t);const a=[];r.pathname.split("/").forEach((t=>{t.endsWith(".lcc")?s=t.substring(0,t.length-4):t.endsWith(".splat")?s=t.substring(0,t.length-6):a.push(t)})),e=`${r.origin}${a.join("/")}`,e=e.replace(/\/$/,"");const n=new URLSearchParams(r.search).toString().match(/(?:token)=([^&]*)/i);return n&&(i=n[1]),{rootPath:e,metaName:s,token:i}}#gt(s,r){if(r===t)return this.#dt[s].dataUrl;if(r===e)return this.#dt[s].shUrl;if(r===i)return this.#dt[s].collisionUrl;throw new Error("Unkonwn type")}init(t,e){let{rootPath:s,metaName:i,metaExtName:r,token:a}=this.#xt(e),n=s+"/meta.lcc",o=s+"/meta.splat",h={};a&&(h={Authorization:a}),i&&(n=s+"/"+i+".lcc",o=s+"/"+i+".splat"),this.#dt[t]={url:s,header:h,metaUrl:n,metaUrl2:o,indexUrl:s+"/index.bin",environmentUrl:s+"/environment.bin",dataUrl:s+"/data.bin",shUrl:s+"/shcoef.bin",collisionUrl:s+"/collision.lci",meta:{}}}dispose(){this.#m=!0,this.#dt={},this.#P=null,this.#ht=null,this.#lt=null,this.#mt.traverse((t=>{t.dispose()})),this.#pt.traverse((t=>{t.dispose()})),this.#mt=new xt,this.#pt=new xt}checkNetworkIdle(){return!(this.#C||this.#_||this.#mt.length>0||this.#pt.length>0)}async#yt(t,e){e?this.#_=!0:this.#C=!0;const s=[],i=[],r=t.length;for(let e=0;e<this.#ot&&e<r;++e){let e=t.dequeue();i.push(e),s.push(e.requestData())}const a=()=>{this.#m||(e?this.#_=!1:this.#C=!1,i.forEach((t=>{t.setDone()})))};try{const t=await Promise.all(s);if(t&&!this.#m){this.#ft=!0;for(let e=0;e<i.length;++e)i[e]?.processPayload(t[e],this.#ct)}a()}catch(t){console.error(t),a()}}#Mt(t,e){e?this.#_=!0:this.#C=!0;const s=[],i=[];for(let e=0;e<400&&0!==t.length;e++){let r=t.dequeue();s.push(r),i.push({index:e,path:r.url,offset:r.offset,size:r.size,headers:r.headers})}const r=()=>{this.#m||(e?this.#_=!1:this.#C=!1,s.forEach((t=>{t.setDone()})))},a=Ut(gt);a.addEventListener("message",(t=>{if(this.#m)return;const e=t.data.payloads,i=t.data.data,n=t.data.isFinished;if(i){this.#ft=!0;for(let t=0;t<e.length;++t){const r=e[t],a=i[t];s[r.index]?.processPayload(a,this.#ct)}}n&&(a.terminate(),r())})),a.postMessage(i)}#bt(){!this.#C&&this.#mt.length>0&&(this.#ut?this.#Mt(this.#mt,!1):this.#yt(this.#mt,!1)),!this.#_&&this.#pt.length>0&&(this.#ut?this.#Mt(this.#pt,!0):this.#yt(this.#pt,!0))}load(s,r,a=t){const n=this.#dt[s].header,o=this.#gt(s,a),h=this.#dt[s].meta;for(let l=0;l<r.length;++l){const c=new Qt(s,o,r[l],a,n,this.#P,this.#ht,this.#lt,h);c.setPending(),a===t||a===i?this.#mt.enqueue(c):a===e&&this.#pt.enqueue(c)}this.#bt()}update(t){this.#m||(this.#ft?(this.#ft=!1,this.isDownloadCompleted=!0):this.isDownloadCompleted=!1,this.#bt())}loadMetaIndex(t,e,s){const i=(s,i,r)=>{if(e){e(s,i,r);const a=this.#dt[t].meta.hasSH;this.#wt(t,(e=>{this.#vt(t,e,a)}),(()=>{console.log("load env failed...")}))}};this.#St(t,(e=>{this.#Ct(t,(s=>{this.#_t(t,(t=>{i(e,s,t)}),(()=>{i(e,s,null)}))}),(()=>{s&&s()}))}),(()=>{s&&s()}))}#St(t,e,s){const i=this.#dt[t].metaUrl,r=this.#dt[t].metaUrl2,a=this.#dt[t].header;mt(i,a).then((t=>{e(t)})).catch((t=>{mt(r,a).then((t=>{e(t)})).catch((t=>{console.error("get meta failed",t),s()}))}))}#Ct(t,e,s){pt(this.#dt[t].indexUrl,this.#dt[t].header).then((t=>{e(t)})).catch((t=>{console.error("get index failed",t),s()}))}#wt(t,e,s){pt(this.#dt[t].environmentUrl,this.#dt[t].header).then((t=>{e(t)})).catch((t=>{console.warn("get env failed"),s()}))}#vt(e,i,r){if(r){const t=96,r=i.byteLength/t;this.#ht.decompress(s,i,i.byteLength,this.#dt[e]?.meta,((t,s,i)=>{this.#m||this.#P.pushEnv(e,r,t,i,s)}))}else{const s=32,r=i.byteLength/s;this.#ht.decompress(t,i,i.byteLength,this.#dt[e]?.meta,((t,s,i)=>{this.#m||this.#P.pushEnv(e,r,t,i,s)}))}}#_t(t,e,s){const i=this.#dt[t].collisionUrl,r=this.#dt[t].header;ft(i,0,4096,r).then((t=>{let a=new Uint32Array(t);if(a.length<12)return console.warn("invalid collision size"),void s();if(1819045731!==a[0])return console.warn("invalid collision"),void s();let n=a[2];t.byteLength>=n?e(t):ft(i,0,n,r).then((t=>{t.byteLength>=n?e(t):(console.warn("get collision-hdr failed"),s())})).catch((t=>{console.warn("get collision-hdr failed"),s()}))})).catch((t=>{console.warn("get collision-hdr failed"),s()}))}}class Yt{constructor(){}dispose(){throw new Error("Must be implemented by subclass")}update(){throw new Error("Must be implemented by subclass")}createRenderer(){throw new Error("Must be implemented by subclass")}destroyRenderer(t){throw new Error("Must be implemented by subclass")}getAllRenderers(){throw new Error("Must be implemented by subclass")}raycast(t){throw new Error("Must be implemented by subclass")}raycastFromOrigin(t){throw new Error("Must be implemented by subclass")}}const Zt=2e3,Kt=2001;class Jt{constructor(t,e,s,i,r,a,n,o,h,l,c,u,d,m,p,f){Jt.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],void 0!==t&&this.set(t,e,s,i,r,a,n,o,h,l,c,u,d,m,p,f)}set(t,e,s,i,r,a,n,o,h,l,c,u,d,m,p,f){const x=this.elements;return x[0]=t,x[4]=e,x[8]=s,x[12]=i,x[1]=r,x[5]=a,x[9]=n,x[13]=o,x[2]=h,x[6]=l,x[10]=c,x[14]=u,x[3]=d,x[7]=m,x[11]=p,x[15]=f,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new Jt).fromArray(this.elements)}copy(t){const e=this.elements,s=t.elements;return e[0]=s[0],e[1]=s[1],e[2]=s[2],e[3]=s[3],e[4]=s[4],e[5]=s[5],e[6]=s[6],e[7]=s[7],e[8]=s[8],e[9]=s[9],e[10]=s[10],e[11]=s[11],e[12]=s[12],e[13]=s[13],e[14]=s[14],e[15]=s[15],this}copyPosition(t){const e=this.elements,s=t.elements;return e[12]=s[12],e[13]=s[13],e[14]=s[14],this}setFromMatrix3(t){const e=t.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}extractBasis(t,e,s){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),s.setFromMatrixColumn(this,2),this}makeBasis(t,e,s){return this.set(t.x,e.x,s.x,0,t.y,e.y,s.y,0,t.z,e.z,s.z,0,0,0,0,1),this}extractRotation(t){const e=this.elements,s=t.elements,i=1/$t.setFromMatrixColumn(t,0).length(),r=1/$t.setFromMatrixColumn(t,1).length(),a=1/$t.setFromMatrixColumn(t,2).length();return e[0]=s[0]*i,e[1]=s[1]*i,e[2]=s[2]*i,e[3]=0,e[4]=s[4]*r,e[5]=s[5]*r,e[6]=s[6]*r,e[7]=0,e[8]=s[8]*a,e[9]=s[9]*a,e[10]=s[10]*a,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromEuler(t){const e=this.elements,s=t.x,i=t.y,r=t.z,a=Math.cos(s),n=Math.sin(s),o=Math.cos(i),h=Math.sin(i),l=Math.cos(r),c=Math.sin(r);if("XYZ"===t.order){const t=a*l,s=a*c,i=n*l,r=n*c;e[0]=o*l,e[4]=-o*c,e[8]=h,e[1]=s+i*h,e[5]=t-r*h,e[9]=-n*o,e[2]=r-t*h,e[6]=i+s*h,e[10]=a*o}else if("YXZ"===t.order){const t=o*l,s=o*c,i=h*l,r=h*c;e[0]=t+r*n,e[4]=i*n-s,e[8]=a*h,e[1]=a*c,e[5]=a*l,e[9]=-n,e[2]=s*n-i,e[6]=r+t*n,e[10]=a*o}else if("ZXY"===t.order){const t=o*l,s=o*c,i=h*l,r=h*c;e[0]=t-r*n,e[4]=-a*c,e[8]=i+s*n,e[1]=s+i*n,e[5]=a*l,e[9]=r-t*n,e[2]=-a*h,e[6]=n,e[10]=a*o}else if("ZYX"===t.order){const t=a*l,s=a*c,i=n*l,r=n*c;e[0]=o*l,e[4]=i*h-s,e[8]=t*h+r,e[1]=o*c,e[5]=r*h+t,e[9]=s*h-i,e[2]=-h,e[6]=n*o,e[10]=a*o}else if("YZX"===t.order){const t=a*o,s=a*h,i=n*o,r=n*h;e[0]=o*l,e[4]=r-t*c,e[8]=i*c+s,e[1]=c,e[5]=a*l,e[9]=-n*l,e[2]=-h*l,e[6]=s*c+i,e[10]=t-r*c}else if("XZY"===t.order){const t=a*o,s=a*h,i=n*o,r=n*h;e[0]=o*l,e[4]=-c,e[8]=h*l,e[1]=t*c+r,e[5]=a*l,e[9]=s*c-i,e[2]=i*c-s,e[6]=n*l,e[10]=r*c+t}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromQuaternion(t){return this.compose(ee,t,se)}lookAt(t,e,s){const i=this.elements;return ae.subVectors(t,e),0===ae.lengthSq()&&(ae.z=1),ae.normalize(),ie.crossVectors(s,ae),0===ie.lengthSq()&&(1===Math.abs(s.z)?ae.x+=1e-4:ae.z+=1e-4,ae.normalize(),ie.crossVectors(s,ae)),ie.normalize(),re.crossVectors(ae,ie),i[0]=ie.x,i[4]=re.x,i[8]=ae.x,i[1]=ie.y,i[5]=re.y,i[9]=ae.y,i[2]=ie.z,i[6]=re.z,i[10]=ae.z,this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const s=t.elements,i=e.elements,r=this.elements,a=s[0],n=s[4],o=s[8],h=s[12],l=s[1],c=s[5],u=s[9],d=s[13],m=s[2],p=s[6],f=s[10],x=s[14],g=s[3],y=s[7],M=s[11],b=s[15],w=i[0],v=i[4],S=i[8],C=i[12],_=i[1],T=i[5],D=i[9],P=i[13],z=i[2],A=i[6],E=i[10],I=i[14],F=i[3],R=i[7],k=i[11],N=i[15];return r[0]=a*w+n*_+o*z+h*F,r[4]=a*v+n*T+o*A+h*R,r[8]=a*S+n*D+o*E+h*k,r[12]=a*C+n*P+o*I+h*N,r[1]=l*w+c*_+u*z+d*F,r[5]=l*v+c*T+u*A+d*R,r[9]=l*S+c*D+u*E+d*k,r[13]=l*C+c*P+u*I+d*N,r[2]=m*w+p*_+f*z+x*F,r[6]=m*v+p*T+f*A+x*R,r[10]=m*S+p*D+f*E+x*k,r[14]=m*C+p*P+f*I+x*N,r[3]=g*w+y*_+M*z+b*F,r[7]=g*v+y*T+M*A+b*R,r[11]=g*S+y*D+M*E+b*k,r[15]=g*C+y*P+M*I+b*N,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}determinant(){const t=this.elements,e=t[0],s=t[4],i=t[8],r=t[12],a=t[1],n=t[5],o=t[9],h=t[13],l=t[2],c=t[6],u=t[10],d=t[14];return t[3]*(+r*o*c-i*h*c-r*n*u+s*h*u+i*n*d-s*o*d)+t[7]*(+e*o*d-e*h*u+r*a*u-i*a*d+i*h*l-r*o*l)+t[11]*(+e*h*c-e*n*d-r*a*c+s*a*d+r*n*l-s*h*l)+t[15]*(-i*n*l-e*o*c+e*n*u+i*a*c-s*a*u+s*o*l)}transpose(){const t=this.elements;let e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(t,e,s){const i=this.elements;return t.isVector3?(i[12]=t.x,i[13]=t.y,i[14]=t.z):(i[12]=t,i[13]=e,i[14]=s),this}invert(){const t=this.elements,e=t[0],s=t[1],i=t[2],r=t[3],a=t[4],n=t[5],o=t[6],h=t[7],l=t[8],c=t[9],u=t[10],d=t[11],m=t[12],p=t[13],f=t[14],x=t[15],g=c*f*h-p*u*h+p*o*d-n*f*d-c*o*x+n*u*x,y=m*u*h-l*f*h-m*o*d+a*f*d+l*o*x-a*u*x,M=l*p*h-m*c*h+m*n*d-a*p*d-l*n*x+a*c*x,b=m*c*o-l*p*o-m*n*u+a*p*u+l*n*f-a*c*f,w=e*g+s*y+i*M+r*b;if(0===w)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const v=1/w;return t[0]=g*v,t[1]=(p*u*r-c*f*r-p*i*d+s*f*d+c*i*x-s*u*x)*v,t[2]=(n*f*r-p*o*r+p*i*h-s*f*h-n*i*x+s*o*x)*v,t[3]=(c*o*r-n*u*r-c*i*h+s*u*h+n*i*d-s*o*d)*v,t[4]=y*v,t[5]=(l*f*r-m*u*r+m*i*d-e*f*d-l*i*x+e*u*x)*v,t[6]=(m*o*r-a*f*r-m*i*h+e*f*h+a*i*x-e*o*x)*v,t[7]=(a*u*r-l*o*r+l*i*h-e*u*h-a*i*d+e*o*d)*v,t[8]=M*v,t[9]=(m*c*r-l*p*r-m*s*d+e*p*d+l*s*x-e*c*x)*v,t[10]=(a*p*r-m*n*r+m*s*h-e*p*h-a*s*x+e*n*x)*v,t[11]=(l*n*r-a*c*r-l*s*h+e*c*h+a*s*d-e*n*d)*v,t[12]=b*v,t[13]=(l*p*i-m*c*i+m*s*u-e*p*u-l*s*f+e*c*f)*v,t[14]=(m*n*i-a*p*i-m*s*o+e*p*o+a*s*f-e*n*f)*v,t[15]=(a*c*i-l*n*i+l*s*o-e*c*o-a*s*u+e*n*u)*v,this}scale(t){const e=this.elements,s=t.x,i=t.y,r=t.z;return e[0]*=s,e[4]*=i,e[8]*=r,e[1]*=s,e[5]*=i,e[9]*=r,e[2]*=s,e[6]*=i,e[10]*=r,e[3]*=s,e[7]*=i,e[11]*=r,this}getMaxScaleOnAxis(){const t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],s=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],i=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,s,i))}makeTranslation(t,e,s){return t.isVector3?this.set(1,0,0,t.x,0,1,0,t.y,0,0,1,t.z,0,0,0,1):this.set(1,0,0,t,0,1,0,e,0,0,1,s,0,0,0,1),this}makeRotationX(t){const e=Math.cos(t),s=Math.sin(t);return this.set(1,0,0,0,0,e,-s,0,0,s,e,0,0,0,0,1),this}makeRotationY(t){const e=Math.cos(t),s=Math.sin(t);return this.set(e,0,s,0,0,1,0,0,-s,0,e,0,0,0,0,1),this}makeRotationZ(t){const e=Math.cos(t),s=Math.sin(t);return this.set(e,-s,0,0,s,e,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,e){const s=Math.cos(e),i=Math.sin(e),r=1-s,a=t.x,n=t.y,o=t.z,h=r*a,l=r*n;return this.set(h*a+s,h*n-i*o,h*o+i*n,0,h*n+i*o,l*n+s,l*o-i*a,0,h*o-i*n,l*o+i*a,r*o*o+s,0,0,0,0,1),this}makeScale(t,e,s){return this.set(t,0,0,0,0,e,0,0,0,0,s,0,0,0,0,1),this}makeShear(t,e,s,i,r,a){return this.set(1,s,r,0,t,1,a,0,e,i,1,0,0,0,0,1),this}compose(t,e,s){const i=this.elements,r=e._x,a=e._y,n=e._z,o=e._w,h=r+r,l=a+a,c=n+n,u=r*h,d=r*l,m=r*c,p=a*l,f=a*c,x=n*c,g=o*h,y=o*l,M=o*c,b=s.x,w=s.y,v=s.z;return i[0]=(1-(p+x))*b,i[1]=(d+M)*b,i[2]=(m-y)*b,i[3]=0,i[4]=(d-M)*w,i[5]=(1-(u+x))*w,i[6]=(f+g)*w,i[7]=0,i[8]=(m+y)*v,i[9]=(f-g)*v,i[10]=(1-(u+p))*v,i[11]=0,i[12]=t.x,i[13]=t.y,i[14]=t.z,i[15]=1,this}decompose(t,e,s){const i=this.elements;let r=$t.set(i[0],i[1],i[2]).length();const a=$t.set(i[4],i[5],i[6]).length(),n=$t.set(i[8],i[9],i[10]).length();this.determinant()<0&&(r=-r),t.x=i[12],t.y=i[13],t.z=i[14],te.copy(this);const o=1/r,h=1/a,l=1/n;return te.elements[0]*=o,te.elements[1]*=o,te.elements[2]*=o,te.elements[4]*=h,te.elements[5]*=h,te.elements[6]*=h,te.elements[8]*=l,te.elements[9]*=l,te.elements[10]*=l,e.setFromRotationMatrix(te),s.x=r,s.y=a,s.z=n,this}makePerspective(t,e,s,i,r,a,n=2e3){const o=this.elements,h=2*r/(e-t),l=2*r/(s-i),c=(e+t)/(e-t),u=(s+i)/(s-i);let d,m;if(n===Zt)d=-(a+r)/(a-r),m=-2*a*r/(a-r);else{if(n!==Kt)throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+n);d=-a/(a-r),m=-a*r/(a-r)}return o[0]=h,o[4]=0,o[8]=c,o[12]=0,o[1]=0,o[5]=l,o[9]=u,o[13]=0,o[2]=0,o[6]=0,o[10]=d,o[14]=m,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this}makeOrthographic(t,e,s,i,r,a,n=2e3){const o=this.elements,h=1/(e-t),l=1/(s-i),c=1/(a-r),u=(e+t)*h,d=(s+i)*l;let m,p;if(n===Zt)m=(a+r)*c,p=-2*c;else{if(n!==Kt)throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+n);m=r*c,p=-1*c}return o[0]=2*h,o[4]=0,o[8]=0,o[12]=-u,o[1]=0,o[5]=2*l,o[9]=0,o[13]=-d,o[2]=0,o[6]=0,o[10]=p,o[14]=-m,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this}equals(t){const e=this.elements,s=t.elements;for(let t=0;t<16;t++)if(e[t]!==s[t])return!1;return!0}fromArray(t,e=0){for(let s=0;s<16;s++)this.elements[s]=t[s+e];return this}toArray(t=[],e=0){const s=this.elements;return t[e]=s[0],t[e+1]=s[1],t[e+2]=s[2],t[e+3]=s[3],t[e+4]=s[4],t[e+5]=s[5],t[e+6]=s[6],t[e+7]=s[7],t[e+8]=s[8],t[e+9]=s[9],t[e+10]=s[10],t[e+11]=s[11],t[e+12]=s[12],t[e+13]=s[13],t[e+14]=s[14],t[e+15]=s[15],t}fromCesiumMatrix4(t){return t&&this.fromArray(t),this}toCesiumMatrix4(t){if(t){const e=this.elements.length;for(let s=0;s<e;s++)t[s]=this.elements[s]}return t}}const $t=new J,te=new Jt,ee=new J(0,0,0),se=new J(1,1,1),ie=new J,re=new J,ae=new J;class ne{get isCameraChanged(){throw new Error("Must be implemented by subclass")}get fov(){throw new Error("Must be implemented by subclass")}get position(){throw new Error("Must be implemented by subclass")}get projectionMatrix(){throw new Error("Must be implemented by subclass")}get cam2WorldMatrix(){throw new Error("Must be implemented by subclass")}update(t){throw new Error("Must be implemented by subclass")}dispose(){throw new Error("Must be implemented by subclass")}}let oe=class extends ne{#Tt;#Dt;#Pt;#zt;#At;#Et;#It;#Ft=!1;constructor(t){super(),this.#Tt=t.camera,this.#Dt=t.canvas,this.#Pt=this.#Rt(),this.#zt=this.#Dt.width,this.#At=this.#Dt.height,this.#Et=this.#Tt.position.clone(),this.#It=this.#Tt.quaternion.clone()}get isCameraChanged(){return this.#Ft}get fov(){return this.#Pt}get position(){return this.#Tt.position.clone()}get projectionMatrix(){return this.#Tt.projectionMatrix}get cam2WorldMatrix(){return this.#Tt.matrixWorld}update(t){this.#Tt.updateMatrixWorld();let e=this.#Tt.position,s=this.#Tt.quaternion,i=this.#Rt(),r=this.#Dt.width,a=this.#Dt.height;this.#Ft=!1;const n=1e-6;(i>this.#Pt+n||i<this.#Pt-n)&&(this.#Pt=i,this.#Ft=!0),r==this.#zt&&a==this.#At||(this.#zt=r,this.#At=a,this.#Ft=!0),e.equals(this.#Et)||(this.#Et.copy(e),this.#Ft=!0),s.equals(this.#It)||(this.#It.copy(s),this.#Ft=!0)}dispose(){}#Rt(){let t=this.#Tt.projectionMatrix,e=Math.abs(1/t.elements[5]),s=2*Math.atan(e);return Y.RAD2DEG*s}};const he=new bt,le=new J,ce=new J;class ue{constructor(t=new J,e=-1){this.isSphere=!0,this.center=t,this.radius=e}set(t,e){return this.center.copy(t),this.radius=e,this}setFromPoints(t,e){const s=this.center;void 0!==e?s.copy(e):he.setFromPoints(t).getCenter(s);let i=0;for(let e=0,r=t.length;e<r;e++)i=Math.max(i,s.distanceToSquared(t[e]));return this.radius=Math.sqrt(i),this}copy(t){return this.center.copy(t.center),this.radius=t.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(t){return t.distanceTo(this.center)-this.radius}intersectsSphere(t){const e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e}intersectsBox(t){return t.intersectsSphere(this)}intersectsPlane(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}clampPoint(t,e){const s=this.center.distanceToSquared(t);return e.copy(t),s>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e}getBoundingBox(t){return this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)}applyMatrix4(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}translate(t){return this.center.add(t),this}expandByPoint(t){if(this.isEmpty())return this.center.copy(t),this.radius=0,this;le.subVectors(t,this.center);const e=le.lengthSq();if(e>this.radius*this.radius){const t=Math.sqrt(e),s=.5*(t-this.radius);this.center.addScaledVector(le,s/t),this.radius+=s}return this}union(t){return t.isEmpty()?this:this.isEmpty()?(this.copy(t),this):(!0===this.center.equals(t.center)?this.radius=Math.max(this.radius,t.radius):(ce.subVectors(t.center,this.center).setLength(t.radius),this.expandByPoint(le.copy(t.center).add(ce)),this.expandByPoint(le.copy(t.center).sub(ce))),this)}equals(t){return t.center.equals(this.center)&&t.radius===this.radius}clone(){return(new this.constructor).copy(this)}}class de{constructor(t,e,s,i,r,a,n,o,h){de.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],void 0!==t&&this.set(t,e,s,i,r,a,n,o,h)}set(t,e,s,i,r,a,n,o,h){const l=this.elements;return l[0]=t,l[1]=i,l[2]=n,l[3]=e,l[4]=r,l[5]=o,l[6]=s,l[7]=a,l[8]=h,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const e=this.elements,s=t.elements;return e[0]=s[0],e[1]=s[1],e[2]=s[2],e[3]=s[3],e[4]=s[4],e[5]=s[5],e[6]=s[6],e[7]=s[7],e[8]=s[8],this}extractBasis(t,e,s){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),s.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const s=t.elements,i=e.elements,r=this.elements,a=s[0],n=s[3],o=s[6],h=s[1],l=s[4],c=s[7],u=s[2],d=s[5],m=s[8],p=i[0],f=i[3],x=i[6],g=i[1],y=i[4],M=i[7],b=i[2],w=i[5],v=i[8];return r[0]=a*p+n*g+o*b,r[3]=a*f+n*y+o*w,r[6]=a*x+n*M+o*v,r[1]=h*p+l*g+c*b,r[4]=h*f+l*y+c*w,r[7]=h*x+l*M+c*v,r[2]=u*p+d*g+m*b,r[5]=u*f+d*y+m*w,r[8]=u*x+d*M+m*v,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}determinant(){const t=this.elements,e=t[0],s=t[1],i=t[2],r=t[3],a=t[4],n=t[5],o=t[6],h=t[7],l=t[8];return e*a*l-e*n*h-s*r*l+s*n*o+i*r*h-i*a*o}invert(){const t=this.elements,e=t[0],s=t[1],i=t[2],r=t[3],a=t[4],n=t[5],o=t[6],h=t[7],l=t[8],c=l*a-n*h,u=n*o-l*r,d=h*r-a*o,m=e*c+s*u+i*d;if(0===m)return this.set(0,0,0,0,0,0,0,0,0);const p=1/m;return t[0]=c*p,t[1]=(i*h-l*s)*p,t[2]=(n*s-i*a)*p,t[3]=u*p,t[4]=(l*e-i*o)*p,t[5]=(i*r-n*e)*p,t[6]=d*p,t[7]=(s*o-h*e)*p,t[8]=(a*e-s*r)*p,this}transpose(){let t;const e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}setUvTransform(t,e,s,i,r,a,n){const o=Math.cos(r),h=Math.sin(r);return this.set(s*o,s*h,-s*(o*a+h*n)+a+t,-i*h,i*o,-i*(-h*a+o*n)+n+e,0,0,1),this}scale(t,e){return this.premultiply(me.makeScale(t,e)),this}rotate(t){return this.premultiply(me.makeRotation(-t)),this}translate(t,e){return this.premultiply(me.makeTranslation(t,e)),this}makeTranslation(t,e){return t.isVector2?this.set(1,0,t.x,0,1,t.y,0,0,1):this.set(1,0,t,0,1,e,0,0,1),this}makeRotation(t){const e=Math.cos(t),s=Math.sin(t);return this.set(e,-s,0,s,e,0,0,0,1),this}makeScale(t,e){return this.set(t,0,0,0,e,0,0,0,1),this}equals(t){const e=this.elements,s=t.elements;for(let t=0;t<9;t++)if(e[t]!==s[t])return!1;return!0}fromArray(t,e=0){for(let s=0;s<9;s++)this.elements[s]=t[s+e];return this}toArray(t=[],e=0){const s=this.elements;return t[e]=s[0],t[e+1]=s[1],t[e+2]=s[2],t[e+3]=s[3],t[e+4]=s[4],t[e+5]=s[5],t[e+6]=s[6],t[e+7]=s[7],t[e+8]=s[8],t}clone(){return(new this.constructor).fromArray(this.elements)}}const me=new de,pe=new J,fe=new J,xe=new de;class ge{constructor(t=new J(1,0,0),e=0){this.isPlane=!0,this.normal=t,this.constant=e}set(t,e){return this.normal.copy(t),this.constant=e,this}setComponents(t,e,s,i){return this.normal.set(t,e,s),this.constant=i,this}setFromNormalAndCoplanarPoint(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this}setFromCoplanarPoints(t,e,s){const i=pe.subVectors(s,e).cross(fe.subVectors(t,e)).normalize();return this.setFromNormalAndCoplanarPoint(i,t),this}copy(t){return this.normal.copy(t.normal),this.constant=t.constant,this}normalize(){const t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(t){return this.normal.dot(t)+this.constant}distanceToSphere(t){return this.distanceToPoint(t.center)-t.radius}projectPoint(t,e){return e.copy(t).addScaledVector(this.normal,-this.distanceToPoint(t))}intersectLine(t,e){const s=t.delta(pe),i=this.normal.dot(s);if(0===i)return 0===this.distanceToPoint(t.start)?e.copy(t.start):null;const r=-(t.start.dot(this.normal)+this.constant)/i;return r<0||r>1?null:e.copy(t.start).addScaledVector(s,r)}intersectsLine(t){const e=this.distanceToPoint(t.start),s=this.distanceToPoint(t.end);return e<0&&s>0||s<0&&e>0}intersectsBox(t){return t.intersectsPlane(this)}intersectsSphere(t){return t.intersectsPlane(this)}coplanarPoint(t){return t.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(t,e){const s=e||xe.getNormalMatrix(t),i=this.coplanarPoint(pe).applyMatrix4(t),r=this.normal.applyMatrix3(s).normalize();return this.constant=-i.dot(r),this}translate(t){return this.constant-=t.dot(this.normal),this}equals(t){return t.normal.equals(this.normal)&&t.constant===this.constant}clone(){return(new this.constructor).copy(this)}}const ye=new ue,Me=new J;class be{constructor(t=new ge,e=new ge,s=new ge,i=new ge,r=new ge,a=new ge){this.planes=[t,e,s,i,r,a]}set(t,e,s,i,r,a){const n=this.planes;return n[0].copy(t),n[1].copy(e),n[2].copy(s),n[3].copy(i),n[4].copy(r),n[5].copy(a),this}copy(t){const e=this.planes;for(let s=0;s<6;s++)e[s].copy(t.planes[s]);return this}setFromProjectionMatrix(t,e=2e3){const s=this.planes,i=t.elements,r=i[0],a=i[1],n=i[2],o=i[3],h=i[4],l=i[5],c=i[6],u=i[7],d=i[8],m=i[9],p=i[10],f=i[11],x=i[12],g=i[13],y=i[14],M=i[15];if(s[0].setComponents(o-r,u-h,f-d,M-x).normalize(),s[1].setComponents(o+r,u+h,f+d,M+x).normalize(),s[2].setComponents(o+a,u+l,f+m,M+g).normalize(),s[3].setComponents(o-a,u-l,f-m,M-g).normalize(),s[4].setComponents(o-n,u-c,f-p,M-y).normalize(),e===Zt)s[5].setComponents(o+n,u+c,f+p,M+y).normalize();else{if(e!==Kt)throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+e);s[5].setComponents(n,c,p,y).normalize()}return this}intersectsObject(t){if(void 0!==t.boundingSphere)null===t.boundingSphere&&t.computeBoundingSphere(),ye.copy(t.boundingSphere).applyMatrix4(t.matrixWorld);else{const e=t.geometry;null===e.boundingSphere&&e.computeBoundingSphere(),ye.copy(e.boundingSphere).applyMatrix4(t.matrixWorld)}return this.intersectsSphere(ye)}intersectsSprite(t){return ye.center.set(0,0,0),ye.radius=.7071067811865476,ye.applyMatrix4(t.matrixWorld),this.intersectsSphere(ye)}intersectsSphere(t){const e=this.planes,s=t.center,i=-t.radius;for(let t=0;t<6;t++){if(e[t].distanceToPoint(s)<i)return!1}return!0}intersectsBox(t){const e=this.planes;for(let s=0;s<6;s++){const i=e[s];if(Me.x=i.normal.x>0?t.max.x:t.min.x,Me.y=i.normal.y>0?t.max.y:t.min.y,Me.z=i.normal.z>0?t.max.z:t.min.z,i.distanceToPoint(Me)<0)return!1}return!0}containsPoint(t){const e=this.planes;for(let s=0;s<6;s++)if(e[s].distanceToPoint(t)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}class we{configCommon;config;lccParam;cpuCache;gpuCache;collCache;resources;dataLoader;cameraMgr;platform;meta={};renderID;isRTK=!1;dynamicState={pointsOnly:!1,alpha:1,visible:!0,useEnv:!0,useSH:!1,useCustomColor:!0,viewport:{x:0,y:0},focal:0,frustum:new be,cmrPos:new J(0,0,0),cmrForward:new J(0,0,0),cmrPosLocal:new J(0,0,0),cmrPosModelLocal:new J(0,0,0),cmrProjMatrix:new Jt,cmr2LocalMatrix:new Jt,cmr2ModelLocalMatrix:new Jt,clipPlane:new B(0,0,0,0),clipBoxMatrixInv:new Jt,clipBoxSide:1,tick:0};performance={meshNum:0,totalPoints:0,maxPoints:0,minPoints:0,fps:0,drawcall:0};dispose(){}}class ve{#kt=[];#Nt=0;constructor(t){t&&(this.#kt=t)}get length(){return this.#kt.length-this.#Nt}isEmpty(){return this.#Nt>=this.#kt.length}read(){if(this.isEmpty())return null;let t=this.#kt[this.#Nt];return this.#Nt+=1,t}}class Se{#Bt=!0;#Lt;#N;#qt;#P;#Ht=null;#Ut;#Ot=[];#Vt;#G;#Gt;#Q;#jt={x:0,y:0};#$=[];#Wt=[];#Qt=[];#Xt=[];#Yt=!1;#Zt;#Kt=0;#Jt=!1;#$t=!1;#te=void 0;#ee=void 0;#se=void 0;#ie=void 0;#re=void 0;#ae=void 0;#ne=void 0;#oe=[];#he=[];#le=[];#ce=[];#ue=new ve;#de=0;#me=0;#pe=0;#fe=0;#xe=!1;#ge=!1;#ye=!1;#K;#J;#Me;#be;constructor(t,e,s){this.#K=new Mt,this.#J=new Mt,this.#Me=new J,this.#be=new J,this.#N=t,this.#Lt=this.#N.config,this.#P=this.#N.cpuCache,this.#qt=e,this.#Ht=s,this.#Zt=this.#N.renderID}get#we(){return this.#Vt.totalLevel}get#ve(){return 0}get#Se(){return this.#Vt.totalLevel-1}get#Ce(){return this.#Vt.cellLengthX}get#_e(){return this.#Vt.cellLengthY}get#Te(){return this.#Vt.min}get#De(){return this.#Vt.max}get#Pe(){return this.#Vt.splats?this.#Vt.splats[0]:-1}get meta(){return this.#Vt}get center(){return this.#Q}get bbox(){return this.#G}get bboxWithEnv(){return this.#Gt}get hasSH(){return this.#Vt.hasSH}get hasColl(){return this.#ye}getAllNodeID(t){this.#$.forEach((e=>{e.nodes.forEach((e=>{e&&t.push(e.id)}))}))}getAllCollID(t){this.#$.forEach((e=>{e&&e.coll&&t.push(e.coll.id)}))}getRenderNodes(){return this.#Qt}getRenderColls(){return this.#Xt}getLoadingNodes(){return this.#oe}getLoadingAroundNodes(){return this.#he}#ze(t,e){return this.#Wt[t]&&this.#Wt[t][e]?this.#Wt[t][e]:null}#Ae(t){let e=Math.floor((t.x-this.#Te.x)/this.#Ce),s=Math.floor((t.y-this.#Te.y)/this.#_e);return new Mt(e,s)}#Ee(t,e){const s=this.#Te,i=this.#De;if(e.x<s.x||t.x>i.x||e.y<s.y||t.y>i.y||e.z<s.z||t.z>i.z)return null;let r=Math.floor((t.x-this.#Te.x)/this.#Ce),a=Math.floor((e.x-this.#Te.x)/this.#Ce),n=Math.floor((t.y-this.#Te.y)/this.#_e),o=Math.floor((e.y-this.#Te.y)/this.#_e);return r=Y.clamp(r,0,this.#jt.x),a=Y.clamp(a,0,this.#jt.x),n=Y.clamp(n,0,this.#jt.y),o=Y.clamp(o,0,this.#jt.y),{startX:r,endX:a,startY:n,endY:o}}getUnitsFromBBox(t,e){const s=[],i=this.#Ee(t,e);if(!i)return s;const{startX:r,endX:a,startY:n,endY:o}=i;for(let t=r;t<=a;++t)for(let e=n;e<=o;++e)this.#Wt[t]&&this.#Wt[t][e]&&s.push(this.#Wt[t][e]);return s}#Ie(t){let e=Math.floor((t.x-this.#Te.x)/this.#Ce),s=Math.floor((t.y-this.#Te.y)/this.#_e),i=e+1,r=s-1,a=s+1,n=[];for(let t=e-1;t<=i;++t)for(let e=r;e<=a;++e)t<0||t>this.#jt.x||e<0||e>this.#jt.y||this.#Wt[t]&&this.#Wt[t][e]&&this.#Wt[t][e].coll&&n.push(this.#Wt[t][e].coll);return n}#Fe(t){if(this.#Yt)return 0;let e=t.distance2dToCameraSq;const s=this.#Ce/2,i=this.#Lt.MaxLodDistance*this.#Lt.MaxLodDistance,r=this.#Lt.LodStepDistance*this.#Lt.LodStepDistance,a=Math.min(this.#Se,this.#Lt.MinLodUsed),n=this.#Se;e<s*s&&(e=0);let o=n;return e<i&&(o=Math.round(e/r)),o=Y.clamp(o,a,n),o}#Re(e,s=t){let i=[];return e.forEach((t=>{t&&(t.isDownloadingOrDecompressing(s)||t.isCache(s)||i.push(t))})),i}#ke(t){let e=[],s=0;if(t.forEach((t=>{const i=this.#Fe(t);let r=t.searchNearestNode(i);!r||r.points<this.#Lt.MinValidSplatsInNode||(e.push(r),s+=r.points)})),this.#Yt||s<=this.#Lt.maxLoadSplatCount)return e;let i=s-this.#Lt.maxLoadSplatCount;for(let t=e.length-1;t>=0;--t){let s=e[t],r=s.parent,a=s.level,n=s.points,o=a;for(let t=a+1;t<=this.#Se;++t){if(!r.nodes[t]||r.nodes[t].points>n)continue;if(o=t,n-r.nodes[t].points>i)break}if(e[t]=r.nodes[o],i-=e[t]?n-e[t].points:n,i<=0)break}let r=[],a=0;for(let t=0;t<e.length;++t){let s=e[t];if(s){if(!this.#Yt&&a+s.points>this.#Lt.maxLoadSplatCount)break;r.push(s),a+=s.points}}return r}#Ne(t,e){let s=[];return t.forEach((t=>{const i=t.searchNearestNodeInverse(this.#Se);i&&i.visibleID!=this.#Kt&&(i.isDownloadingOrDecompressing(e)||i.isCache(e)||s.push(i))})),s}#Be(t){let e=[];return t.forEach((t=>{const s=t.coll;s&&0!=s.faceNum&&(s.isDownloadingOrDecompressing(i)||s.isCacheData()||e.push(s))})),e}#Le(){this.#Yt=!1,0<this.#Pe&&this.#Pe<this.#Lt.maxLoadSplatCount&&(this.#Yt=!0),1===this.#we&&1===this.#$.length&&(this.#Yt=!0)}#qe(s=!1,r=!1){if(this.#Kt++,0==this.#Wt.length)return;this.#Le();let a=this.#N.dynamicState.cmrPosModelLocal.clone(),n=this.#N.dynamicState.frustum;const o=this.#Lt.useSH&&this.hasSH,h=this.hasColl;let l=[],c=[],u=[],d=!!(a.z<this.#Lt.GloballHeight);this.#$.forEach((t=>{t.totalPoints<this.#Lt.MinValidSplatsInUnit||(t.updateDistanceToCamera(a),t.distance2dToCameraSq<1e4&&c.push(t),t.distance2dToCameraSq<2500&&u.push(t),!this.#Yt&&d&&t.distance2dToCameraSq>this.#Lt.MaxDistaneLimit*this.#Lt.MaxDistaneLimit||n.intersectsBox(t.getBBox())&&l.push(t))})),l.sort(((t,e)=>t.distanceToCameraSq-e.distanceToCameraSq));let m=this.#ke(l);m.forEach((t=>{t.visibleID=this.#Kt})),this.#Qt=m;let p=this.#Re(m,t),f=[];o&&(f=this.#Re(m,e));let x=this.#Ne(c,t);x.sort(((t,e)=>t.parent.distanceToCameraSq-e.parent.distanceToCameraSq));let g=[];if(h&&(g=this.#Be(u),g.sort(((t,e)=>t.parent.distanceToCameraSq-e.parent.distanceToCameraSq))),s&&(this.#ce=[...g],this.#he=[...x],this.#oe=[...p,...x],p=this.#oe),r&&o){let t=this.#Ne(c,e);t.sort(((t,e)=>t.parent.distanceToCameraSq-e.parent.distanceToCameraSq)),this.#le=[...f,...t],f=this.#le}let y=this.#He(p);if(this.#Ht.load(this.#Zt,y,t),o){let t=this.#He(f);this.#Ht.load(this.#Zt,t,e)}h&&this.#Ht.load(this.#Zt,g,i),this.#Lt.AlwaysDownloadAround&&!s&&(this.#ue=new ve(x))}#Ue(){let e;for(;!this.#ue.isEmpty();){const s=this.#ue.read();if(s&&!s.isDownloadingOrDecompressing(t)&&!s.isCache(t)){e=s;break}}e&&this.#Ht.load(this.#Zt,[e],t)}#He(t){if(!this.#Lt.MergeSplatsReqEnable){let e=[];return t.forEach((t=>{e.push(t)})),e}t.sort(((t,e)=>t.parent.sequence-e.parent.sequence));let e=[],s=0,i=[];for(let r=0;r<t.length;++r){const a=t[r],n=a.parent,o=n.totalPoints;if(i.length>0){(i[i.length-1].parent.endAddr!=n.startAddr||s+o>this.#Lt.MergeSplatsReqThreshold)&&(e.push(i),i=[],s=0)}i.push(a),s+=o}0!=i.length&&(e.push(i),i=[]);let r=[];return e.forEach((t=>{if(1==t.length)r.push(t[0]);else if(t.length>1){let e=[];t.forEach((t=>{e.push(t.parent)})),r.push(new Ht(this.#Zt,e))}})),r.sort(((t,e)=>(t.isNode?t.parent.distanceToCameraSq:t.distanceToCameraSq)-(e.isNode?e.parent.distanceToCameraSq:e.distanceToCameraSq))),r}load(t,e,s,i,r,a=void 0){this.#Bt&&t&&(this.#Bt=!1,this.#te=s,this.#ee=i,this.#se=r,this.#ie=a,t=t.replace(/\/$/,""),this.#Ht.init(this.#Zt,t),this.#Ht.loadMetaIndex(this.#Zt,((t,s,i)=>{this.#Oe(t),this.#Ve(s),this.#Ge(i),this.#$=this.#je(),this.#Le(),this.#Yt&&console.log("full rendering: "+this.#Pe),this.#Jt=!0,this.#xe=!0,this.#de=Date.now(),e&&e(this.meta),this.#Ht.setRenderInfoMeta(this.#Zt,this.meta),this.#qe(!0,!1)}),(()=>{r&&r()})))}loadSH(t,e,s){return this.hasSH?this.#ge?(console.error("loadSH is busy !!!"),void(s&&s())):(this.#re=t,this.#ae=e,this.#ne=s,this.#ge=!0,this.#me=Date.now(),void this.#qe(!1,!0)):(console.log("no sh data"),e&&e(1),void(t&&t()))}#je(){let t=[],e=this.#Wt.length;for(let s=0;s<e;s++)if(this.#Wt[s]){let e=this.#Wt[s].length;for(let i=0;i<e;i++)this.#Wt[s][i]&&(this.#Wt[s][i].sequence=t.length,t.push(this.#Wt[s][i]))}return t}setConfigDirty(){this.#$t=!0}update(t){this.#Jt&&(this.#xe&&(this.#We(),this.#Qe()),this.#ge&&(this.#Xe(),this.#Ye()),(this.#qt.isCameraChanged||this.#Ht.isDownloadCompleted||this.#$t)&&this.#qe(),this.#Lt.AlwaysDownloadAround&&this.#Ht.checkNetworkIdle()&&this.#Ue(),this.#$t=!1)}#We(){const e=this.#oe.length+this.#ce.length;let s=0;if(0==e)return console.log("total is 0 !!!"),this.#ee&&this.#ee(1),this.#te&&this.#te(),void(this.#xe=!1);this.#oe.forEach((e=>{this.#ie?this.#ie(e)&&s++:e.isCache(t)&&s++})),this.#ce.forEach((t=>{this.#ie?this.#ie(t)&&s++:t.isCacheData()&&s++}));let i=1*s/e;i>.99&&(i=1),(i-this.#pe>=.005||1==i)&&(this.#ee&&this.#ee(i),this.#pe=i),i>=1&&(this.#te&&this.#te(),this.#xe=!1)}#Xe(){const t=this.#le.length;let s=0;if(0==t)return console.log("total-sh is 0 !!!"),this.#ae&&this.#ae(1),this.#re&&this.#re(),void(this.#ge=!1);this.#le.forEach((t=>{t.isCache(e)&&s++}));let i=1*s/t;i>.99&&(i=1),(i-this.#fe>=.005||1==i)&&(this.#ae&&this.#ae(i),this.#fe=i),i>=1&&(this.#re&&this.#re(),this.#ge=!1)}#Qe(){if(!this.#xe)return;const e=Date.now();if(e-this.#de<3e3)return;this.#de=e;let s=[];this.#oe.forEach((e=>{!e||e.isDownloadingOrDecompressing(t)||e.isCache(t)||s.push(e)})),s.length>0&&(console.log("Recovering downloading data ..."),this.#Ht.load(this.#Zt,s,t));let r=[];this.#ce.forEach((t=>{!t||t.isDownloadingOrDecompressing(i)||t.isCacheData(i)||r.push(t)})),r.length>0&&(console.log("Recovering downloading coll ..."),this.#Ht.load(this.#Zt,r,i))}#Ye(){if(!this.#ge)return;const t=Date.now();if(t-this.#me<3e3)return;this.#me=t;let s=[];this.#le.forEach((t=>{!t||t.isDownloadingOrDecompressing(e)||t.isCache(e)||s.push(t)})),s.length>0&&(console.log("Recovering downloading sh ..."),this.#Ht.load(this.#Zt,s,e))}dispose(){for(let t=0;t<this.#$.length;++t)this.#$[t].dispose();this.#Qt=[],this.#$=[],this.#Wt=[],this.#Ht=null,this.#P=null,this.#N=null,this.#qt=null}#Ge(t){if(!t)return;let e=new DataView(t),s=new Uint32Array(t);s[1];let i=s[11],r=48;for(let t=0;t<i;++t){let t=e.getUint32(r,!0);r+=4;let s=e.getUint32(r,!0);r+=4;let i=e.getBigUint64(r,!0);r+=8;let a=Number(e.getBigUint64(r,!0));r+=8;let n=e.getUint32(r,!0);r+=4;let o=e.getUint32(r,!0);r+=4,r+=4,r+=4;let h=this.#Wt[t][s];h&&h.setCollInfo(i,a,n,o)}this.#ye=!0}#Ze(t){(t.x>this.#jt.x||t.y>this.#jt.y)&&(this.#jt.x=Math.max(t.x,this.#jt.x),this.#jt.y=Math.max(t.y,this.#jt.y)),this.#Wt[t.x]||(this.#Wt[t.x]=[]);let e=this.#Te.clone();e.x+=t.x*this.#Ce,e.y+=t.y*this.#_e;let s=e.clone();s.x+=this.#Ce,s.y+=this.#_e,s.z=this.#De.z,this.#Wt[t.x][t.y]=new qt(this.#Zt,this.#N,t,e,s)}#Ve(t){let e=0,s=new DataView(t);for(;!(e>s.byteLength-1);){let t={};t.x=s.getInt16(e,!0),e+=2,t.y=s.getInt16(e,!0),e+=2,t.lods=[];for(let i=0;i<this.#we;i++){let i=s.getInt32(e,!0);e+=4;let r=s.getBigInt64(e,!0);e+=8;let a=s.getInt32(e,!0);e+=4,t.lods.push({points:i,offset:r,size:a})}this.#Ze(t)}}#Oe(t){t=t.replace(/,[\s\t\r\n]*}/g,"}");let e=JSON.parse(t);e.min=new J(e.boundingBox.min[0],e.boundingBox.min[1],e.boundingBox.min[2]),e.max=new J(e.boundingBox.max[0],e.boundingBox.max[1],e.boundingBox.max[2]);const s={};e.attributes.forEach((t=>{s[t.name]=t}));const i=s.scale.min,r=s.scale.max,a=s.opacity.min,n=s.opacity.max,o=s.shcoef.min,h=s.shcoef.max,l=s.normal.min,c=s.normal.max,u=s.position.min,d=s.position.max,m={compressedScaleMin:new J(i[0],i[1],i[2]),compressedScaleMax:new J(r[0],r[1],r[2]),compressedSHMin:new J(o[0],o[1],o[2]),compressedSHMax:new J(h[0],h[1],h[2]),compressedOpacityMin:a[0],compressedOpacityMax:n[0],compressedNormalMin:new J(l[0],l[1],l[2]),compressedNormalMax:new J(c[0],c[1],c[2]),positionMin:new J(u[0],u[1],u[2]),positionMax:new J(d[0],d[1],d[2])};this.#Ke(s,m),Object.assign(e,{compressInfo:m}),this.#Je(e),this.#Vt=e,this.#N.meta.data=this.#Vt,this.#G=new bt(e.min,e.max),this.#Q=new J,this.#G.getCenter(this.#Q),this.#Gt=new bt(u,d)}#Ke(t,e){const s=t?.envscale;if(s){const{min:t,max:i}=s;e.compressedEnvScaleMin=new J(t[0],t[1],t[2]),e.compressedEnvScaleMax=new J(i[0],i[1],i[2])}const i=t?.envshcoef;if(i){const{min:t,max:s}=i;e.compressedEnvSHMin=new J(t[0],t[1],t[2]),e.compressedEnvSHMax=new J(s[0],s[1],s[2])}const r=t?.envnormal;if(r){const{min:t,max:s}=r;e.compressedEnvNormalMin=new J(t[0],t[1],t[2]),e.compressedEnvNormalMax=new J(s[0],s[1],s[2])}}#Je(t){t.hasSH=!0;const e=t.fileType;e&&"Portable"===e&&(t.hasSH=!1)}#$e(){const t=this.#N.lccParam.renderLib,e=this.#N.lccParam.scene,s=new t.PlaneGeometry(this.#Ce,this.#_e),i=new t.MeshBasicMaterial({color:65280,transparent:!0,opacity:.3,depthWrite:!1,depthTest:!1,side:t.DoubleSide}),r=new t.Mesh(s,i),a=[16711680,65280,255];for(let t=0;t<this.#$.length;++t){const e=this.#$[t].center,s=a[(this.#$[t].x%a.length+this.#$[t].y%a.length)%a.length],n=r.clone();n.position.set(e.x,e.y,.5),n.material=i.clone(),n.material.color.set(s),this.#Ot.push(n)}this.#Ut=new t.Group,this.#Ut.renderOrder=1,e.add(this.#Ut)}#ts(t){this.#Ut.clear(),t.forEach((t=>{t&&this.#Ut.add(this.#Ot[t.parent.sequence])}))}}const Ce={modelMatrix:"czm_model",projectionMatrix:"czm_projection",modelViewMatrix:"czm_modelView",modelViewProjectionMatrix:"czm_modelViewProjection",position:"position",gl_FragColor:"out_FragColor"},_e={modelMatrix:"modelMatrix",projectionMatrix:"projectionMatrix",modelViewMatrix:"modelViewMatrix",viewMatrix:"viewMatrix",modelViewProjectionMatrix:"modelViewProjectionMatrix",position:"position",gl_FragColor:"gl_FragColor"};function Te(t){const{vertexShaderCommon:e}={vertexShaderCommon:"\n    precision highp int;\n    precision highp float;\n\n    uniform vec2 dimensions;\n    uniform vec2 dataDimensions;\n    uniform vec2 shDimensions;\n    uniform vec2 viewport;\n    uniform vec2 heightRange;\n    uniform float focal;\n    uniform float splatCount;\n\n    uniform mat4 clipBoxMatrixInv;\n    uniform float clipBoxSide;\n    \n    uniform sampler2D customColors;\n\n    uniform vec3 compressedScaleMax;\n    uniform vec3 compressedScaleMin;\n\n    uniform float useIndexHost;\n    uniform float pointsOnly;\n    uniform float useSH;\n    uniform float useCustomColor;\n    uniform vec3 cmrPos;\n    uniform vec3 compressedSHMin;\n    uniform vec3 compressedSHMax;\n    \n    out vec4 vColor;\n    out vec2 vPosition;\n    out vec2 vResolution;\n\n    #ifdef HAS_NOT_ATTRIBUTE_POSITION\n    in vec3 position;\n    uniform sampler2D splatIndexes;\n    uniform sampler2D splatIndexesHost;\n    uniform sampler2D splatData;\n    uniform sampler2D shRawTexture;\n        #ifdef IS_RTK\n            uniform mat3 prj2ECEF;\n        #endif\n    #else\n    uniform isampler2D splatIndexes;\n    uniform isampler2D splatIndexesHost;\n    uniform usampler2D splatData;\n    uniform sampler2D shRawTexture;\n    #endif\n    \n    #ifndef saturate\n    #define saturate( a ) clamp( a, 0.0, 1.0 )\n    #endif\n    \n    vec2 getStrideDataUV(in int stride, in int offset, in uint Index, vec2 dimension) {\n        vec2 samplerUV = vec2(0.0, 0.0);\n        float d = float(Index * uint(stride) + uint(offset)) / dimension.x;\n        samplerUV.y = float(floor(d)) / dimension.y;\n        samplerUV.x = fract(d);\n        return samplerUV;\n    }\n    \n    vec2 getUV(in float idx) {\n        return getStrideDataUV(1, 0, uint(idx), dataDimensions);\n        //return getStrideDataUV(1, 0, uint(gl_InstanceID), dataDimensions);\n    }\n\n    ivec2 getUVivec2(int idx) {\n        ivec2 samplerUV = ivec2(0, 0);\n\n        int x = idx % int(dimensions.x);\n        int y = idx / int(dimensions.x);\n\n        samplerUV.x = int(x);\n        samplerUV.y = int(y);\n        return samplerUV;\n    }\n\n    vec4 decodeColor(uint colorv) {\n        return vec4(float(colorv & 255u) / 255.0, float((colorv >> 8) & 255u) / 255.0, float((colorv >> 16) & 255u) / 255.0, float((colorv >> 24) & 255u) / 255.0);\n    }\n\n    float lerpScales (float min, float max, float s) {\n      return (1.0 - s) * min + s * max;\n    }\n\n    vec3 decodeScale(uint scale, uint rotation) {\n        float sx = float(scale & 65535u) / 65535.0;\n        float sy = float((scale >> 16) & 65535u) / 65535.0;\n        float sz = float(((rotation) & 65535u)) / 65535.0;\n        return vec3(lerpScales(compressedScaleMin.x, compressedScaleMax.x, sx), lerpScales(compressedScaleMin.y, compressedScaleMax.y, sy), lerpScales(compressedScaleMin.z, compressedScaleMax.z, sz));\n    }\n\n    uint comRotation (uint g, uint b) {\n        return ((b & 65535u) << 16 ) | ((g >> 16) & 65535u);\n    }\n    \n    vec4 decodeRotation(uint enc)\n    {\n    \n        vec4 rotation = vec4(\n            float(enc & 1023u) / 1023.0,\n            float((enc >> 10u) & 1023u) / 1023.0,\n            float((enc >> 20u) & 1023u) / 1023.0,\n            float((enc >> 30u) & 3u) / 3.0);\n    \n        uint idx = uint(rotation.w * 3.0);\n        vec4 q;\n        q.xyz = vec3(rotation.xyz) * sqrt(2.0) - (1.0 / sqrt(2.0));\n        q.w = sqrt(1.0 - saturate(dot(q.xyz, q.xyz)));\n        if (idx == 0u) q = q.wxyz;\n        if (idx == 1u) q = q.xwyz;\n        if (idx == 2u) q = q.xywz;\n    \n        return q;\n    }\n    \n    mat3 matrixFromRotationScale(vec4 rot, vec3 scale)\n    {\n        mat3 ms = mat3(\n            scale.x, 0, 0,\n            0, scale.y, 0,\n            0, 0, scale.z\n        );\n    \n        float x = rot.x;\n        float y = rot.y;\n        float z = rot.z;\n        float w = rot.w;\n    \n        mat3 mr = mat3(\n            1.0 - 2.0 * (y*y + z*z),   2.0*(x*y - w*z),   2.0*(x*z + w*y),\n                2.0*(x*y + w*z), 1.0-2.0*(x*x + z*z),   2.0*(y*z - w*x),\n                2.0*(x*z - w*y),   2.0*(y*z + w*x), 1.0-2.0*(x*x + y*y)\n        );\n        mat3 ret = ms * mr;\n        #ifdef IS_RTK         \n            ret = ret * transpose(mat3(prj2ECEF));\n        #endif\n        ret = transpose(ret) * ret;\n    \n\n\n        return ret;\n    }\n\n    float splatVsBox(vec3 pos) {\n        vec3 localPos = (clipBoxMatrixInv * vec4(pos, 1.0)).xyz;\n        vec3 distance = abs(localPos) - vec3(0.5);\n        float outsideDist = length(max(distance, vec3(0.0)));\n        float insideDist = min(max(distance.x, max(distance.y, distance.z)), 0.0);\n        \n        return (outsideDist + insideDist) * clipBoxSide;\n    }\n    "},{vertexShaderMain:s,vertexShaderPoints:i}=function(t){const{modelViewMatrix:e,projectionMatrix:s,viewMatrix:i,modelMatrix:r}=t;return{vertexShaderMain:`\n    ivec2 splatUV = getUVivec2(int(gl_InstanceID % int(splatCount)));\n\n    int idx;\n    if (useIndexHost > 0.5) {\n        #ifdef HAS_NOT_ATTRIBUTE_POSITION\n        idx = floatBitsToInt(texelFetch(splatIndexesHost, splatUV, 0).r);\n        #else\n        idx = texelFetch(splatIndexesHost, splatUV, 0).r;\n        #endif\n    } else {\n        idx = int(texelFetch(splatIndexes, splatUV, 0).y);\n    }\n    \n    int idxNew = idx * 2;\n    int x1 = idxNew % int(dataDimensions.x);\n    int y1 = idxNew / int(dataDimensions.x);\n    int x2 = x1 + 1;\n    int y2 = y1;\n\n    #ifdef HAS_NOT_ATTRIBUTE_POSITION\n        vec4 pixel0 = texelFetch(splatData, ivec2(x1, y1), 0);\n        vec3 sampledTransform = pixel0.xyz;\n        uint color = floatBitsToUint(pixel0.w);\n    #else\n        uvec4 pixel0 = texelFetch(splatData, ivec2(x1, y1), 0);\n        vec3 sampledTransform = uintBitsToFloat(pixel0.xyz);\n        uint color = pixel0.w;\n    #endif\n\n    vec3 splatCenter = sampledTransform.xyz;\n\n    if (splatVsBox(splatCenter) > 0.0) {\n         gl_Position = vec4(0.0, 0.0, 0.0, 0.0);\n         return;\n    }\n\n    vec4 viewCenter =  ${e} * vec4(splatCenter, 1.0);\n    vec4 clipCenter = ${s} * viewCenter;\n    vec3 ndcCenter = clipCenter.xyz / clipCenter.w;\n\n\n    float bounds = 1.2 * clipCenter.w;\n    if (clipCenter.z < -bounds || clipCenter.z > bounds || clipCenter.x < -bounds || clipCenter.x > bounds\n        || clipCenter.y < -bounds || clipCenter.y > bounds) {\n        gl_Position = vec4(0.0, 0.0, ndcCenter.z, 1.0);\n        return;\n    }\n\n    #ifdef HAS_NOT_ATTRIBUTE_POSITION\n        uvec4 pixel1 = floatBitsToUint(texelFetch(splatData, ivec2(x2, y2), 0));\n    #else\n        uvec4 pixel1 = texelFetch(splatData, ivec2(x2, y2), 0);\n    #endif\n\n    uint sampledRotation = comRotation(pixel1.g, pixel1.b);\n    vec3 sampledScale = decodeScale(pixel1.r, pixel1.g);\n    vec4 rotation = decodeRotation(sampledRotation);\n    mat3 cov = matrixFromRotationScale(rotation, sampledScale);\n\n    vec3 cov3D_M11_M12_M13 = vec3(cov[0][0], cov[0][1], cov[0][2]);\n    vec3 cov3D_M22_M23_M33 = vec3(cov[1][1], cov[1][2], cov[2][2]);\n\n    vColor = decodeColor(color);\n    \n    mat3 Vrk = mat3(\n        cov3D_M11_M12_M13.x, cov3D_M11_M12_M13.y, cov3D_M11_M12_M13.z,\n        cov3D_M11_M12_M13.y, cov3D_M22_M23_M33.x, cov3D_M22_M23_M33.y,\n        cov3D_M11_M12_M13.z, cov3D_M22_M23_M33.y, cov3D_M22_M23_M33.z\n    );\n    float s = 1.0 / (viewCenter.z * viewCenter.z);\n    mat3 J = mat3(\n        focal / viewCenter.z, 0., -(focal * viewCenter.x) * s,\n        0., focal / viewCenter.z, -(focal * viewCenter.y) * s,\n        0., 0., 0.\n    );\n    mat3 W = transpose(mat3( ${e}));\n    mat3 T = W * J;\n    mat3 cov2Dm = transpose(T) * Vrk * T;\n    cov2Dm[0][0] += 0.3;\n    cov2Dm[1][1] += 0.3;\n\n    vec3 cov2d = vec3(cov2Dm[0][0], cov2Dm[0][1], cov2Dm[1][1]);\n  \n    float a = cov2d.x;\n    float d = cov2d.z;\n    float b = cov2d.y;\n    float D = a * d - b * b;\n    float trace = a + d;\n    float traceOver2 = 0.5 * trace;\n    float term2 = sqrt(trace * trace / 4.0 - D);\n    float eigenValue1 = traceOver2 + term2;\n    float eigenValue2 = max(traceOver2 - term2, 0.00); // prevent negative eigen value\n\n    float transparentAdjust = step(1.0 / 255.0, vColor.a);\n    eigenValue2 = eigenValue2 * transparentAdjust;\n\n    const float maxSplatSize = 1024.0;\n    vec2 eigenVector1 = normalize(vec2(b, eigenValue1 - a));\n    vec2 eigenVector2 = vec2(eigenVector1.y, -eigenVector1.x);\n\n    vec2 basisVector1 = eigenVector1  * min(sqrt(2.0 * eigenValue1), maxSplatSize);\n    vec2 basisVector2 = eigenVector2  * min(sqrt(2.0 * eigenValue2), maxSplatSize);\n    vPosition = position.xy* 2.0;\n\n    vec2 ndcOffset = vec2(vPosition.x * basisVector1 + vPosition.y * basisVector2) / viewport * 2.0;\n    gl_Position = vec4(ndcCenter.xy + ndcOffset, ndcCenter.z, 1.0) * clipCenter.w;\n`,vertexShaderPoints:`\n    ivec2 splatUV = getUVivec2(int(gl_InstanceID % int(splatCount)));\n\n    int idx;\n    if (useIndexHost > 0.5) {\n        #ifdef HAS_NOT_ATTRIBUTE_POSITION\n        idx = floatBitsToInt(texelFetch(splatIndexesHost, splatUV, 0).r);\n        #else\n        idx = texelFetch(splatIndexesHost, splatUV, 0).r;\n        #endif\n    } else {\n        idx = int(texelFetch(splatIndexes, splatUV, 0).y);\n    }\n    \n    int idxNew = idx * 2;\n    int x1 = idxNew % int(dataDimensions.x);\n    int y1 = idxNew / int(dataDimensions.x);\n\n#ifdef HAS_NOT_ATTRIBUTE_POSITION\n    vec4 pixel0 = texelFetch(splatData, ivec2(x1, y1), 0);\n    vec3 sampledTransform = pixel0.xyz;\n    uint color = floatBitsToUint(pixel0.w);\n#else\n    uvec4 pixel0 = texelFetch(splatData, ivec2(x1, y1), 0);\n    vec3 sampledTransform = uintBitsToFloat(pixel0.xyz);\n    uint color = pixel0.w;\n#endif\n\n    if (splatVsBox(sampledTransform.xyz) > 0.0) {\n        gl_Position = vec4(0.0, 0.0, 0.0, 0.0);\n        return;\n    }\n\n    vec4 viewCenter = ${e} * vec4(sampledTransform.xyz, 1.0);\n\n    vec4 clipCenter = ${s} * viewCenter;\n    vec3 ndcCenter = clipCenter.xyz / clipCenter.w;\n\n    if (useCustomColor > 0.0) {\n        sampledTransformLocal = sampledTransform.xyz;\n        #ifdef IS_RTK\n            sampledTransformLocal = inverse(prj2ECEF) * sampledTransformLocal;\n        #endif\n        float lerp = (sampledTransformLocal.z - heightRange.x) / (heightRange.y - heightRange.x) * 0.99;\n        vColor = vec4(texture(customColors, vec2(lerp, 0.5)));\n    } else {\n        vColor = decodeColor(color);\n    }\n\n    gl_Position = vec4(ndcCenter.xy + position.xy * 0.001 , ndcCenter.z, 1.0) * clipCenter.w;\n\n   \n`}}(t),{modelMatrix:r}=t;return{vertexShaderSH:`\n    ${e}\n    \n    const float SH_C0 = 0.28209479177387814;\n    const float SH_C1 = 0.4886025119029199;\n    const float SH_C2[5] = float[5]( 1.0925484305920792, -1.0925484305920792, 0.31539156525252005, -1.0925484305920792, 0.5462742152960396 );\n    const float SH_C3[7] = float[7](-0.5900435899266435, 2.890611442640554, -0.4570457994644658, 0.3731763325901154, -0.4570457994644658, 1.445305721320277, -0.5900435899266435 );\n    \n    struct  SH {\n        vec3 sh1;\n        vec3 sh2;\n        vec3 sh3;\n        vec3 sh4;\n        vec3 sh5;\n        vec3 sh6;\n        vec3 sh7;\n        vec3 sh8;\n        vec3 sh9;\n        vec3 sh10;\n        vec3 sh11;\n        vec3 sh12;\n        vec3 sh13;\n        vec3 sh14;\n        vec3 sh15;\n    };\n    \n    SH sh;\n    \n\n    \n    vec3 DecodePacked_11_10_11(uint enc)\n    {\n        return vec3(\n        float(enc & 2047u) / 2047.0,\n        float((enc >> 11u) & 1023u) / 1023.0,\n        float((enc >> 21u) & 2047u) / 2047.0);\n    }\n    \n    \n    vec3 mixSH(vec3 min, vec3 max, vec3 xyz)\n    {\n        return vec3(\n            mix(min.x, max.x, xyz.x),\n            mix(min.y, max.y, xyz.y),\n            mix(min.z, max.z, xyz.z)\n        );\n    }\n    \n    void handleSHRawData(uvec4 raw0, uvec4 raw1, uvec4 raw2, uvec4 raw3)\n    {\n        uint sh1 = raw0.r;\n        uint sh2 = raw0.g;\n        uint sh3 = raw0.b;\n        uint sh4 = raw0.a;\n    \n    \n        uint sh5 = raw1.r;\n        uint sh6 = raw1.g;\n        uint sh7 = raw1.b;\n        uint sh8 = raw1.a;\n    \n        uint sh9 = raw2.r;\n        uint sh10 = raw2.g;\n        uint sh11 = raw2.b;\n        uint sh12 = raw2.a;\n    \n        uint sh13 = raw3.r;\n        uint sh14 = raw3.g;\n        uint sh15 = raw3.b;\n    \n        sh.sh1 = mixSH(compressedSHMin, compressedSHMax, DecodePacked_11_10_11(sh1));\n        sh.sh2 = mixSH(compressedSHMin, compressedSHMax, DecodePacked_11_10_11(sh2));\n        sh.sh3 = mixSH(compressedSHMin, compressedSHMax, DecodePacked_11_10_11(sh3));\n        sh.sh4 = mixSH(compressedSHMin, compressedSHMax, DecodePacked_11_10_11(sh4));\n        sh.sh5 = mixSH(compressedSHMin, compressedSHMax, DecodePacked_11_10_11(sh5));\n        sh.sh6 = mixSH(compressedSHMin, compressedSHMax, DecodePacked_11_10_11(sh6));\n        sh.sh7 = mixSH(compressedSHMin, compressedSHMax, DecodePacked_11_10_11(sh7));\n        sh.sh8 = mixSH(compressedSHMin, compressedSHMax, DecodePacked_11_10_11(sh8));\n        sh.sh9 = mixSH(compressedSHMin, compressedSHMax, DecodePacked_11_10_11(sh9));\n        sh.sh10 = mixSH(compressedSHMin, compressedSHMax, DecodePacked_11_10_11(sh10));\n        sh.sh11 = mixSH(compressedSHMin, compressedSHMax, DecodePacked_11_10_11(sh11));\n        sh.sh12 = mixSH(compressedSHMin, compressedSHMax, DecodePacked_11_10_11(sh12));\n        sh.sh13 = mixSH(compressedSHMin, compressedSHMax, DecodePacked_11_10_11(sh13));\n        sh.sh14 = mixSH(compressedSHMin, compressedSHMax, DecodePacked_11_10_11(sh14));\n        sh.sh15 = mixSH(compressedSHMin, compressedSHMax, DecodePacked_11_10_11(sh15));\n    }\n    \n    vec3 ShadeSH(vec3 dir)\n    {\n        float x = dir.x, y = dir.y, z = dir.z;\n    \n        vec3 result = vec3(0., 0., 0.);\n    \n        result += SH_C1 * (-sh.sh1 * y + sh.sh2 * z - sh.sh3 * x);\n    \n        float xx = x * x, yy = y * y, zz = z * z;\n        float xy = x * y, yz = y * z, xz = x * z;\n    \n        result +=\n            (SH_C2[0] * xy) * sh.sh4 +\n            (SH_C2[1] * yz) * sh.sh5 +\n            (SH_C2[2] * (2. * zz - xx - yy)) * sh.sh6 +\n            (SH_C2[3] * xz) * sh.sh7 +\n            (SH_C2[4] * (xx - yy)) * sh.sh8;\n    \n        result +=\n            (SH_C3[0] * y * (3. * xx - yy)) * sh.sh9 +\n            (SH_C3[1] * xy * z) * sh.sh10 +\n            (SH_C3[2] * y * (4. * zz - xx - yy)) * sh.sh11 +\n            (SH_C3[3] * z * (2. * zz - 3. * xx - 3. * yy)) * sh.sh12 +\n            (SH_C3[4] * x * (4. * zz - xx - yy)) * sh.sh13 +\n            (SH_C3[5] * z * (xx - yy)) * sh.sh14 +\n            (SH_C3[6] * x * (xx - 3. * yy)) * sh.sh15;\n    \n        return result;\n    }\n\n    uint composeShRaw(in vec4 shRaw) {\n        int r = int(shRaw.r * 255.0);\n        int g = int(shRaw.g * 255.0);\n        int b = int(shRaw.b * 255.0);\n        int a = int(shRaw.a * 255.0);\n        int uint32Value = (a << 24) | (b << 16) | (g << 8) | r;\n        return uint(uint32Value);\n    }\n\n    //使用Uint8Array存储Uint32Array数据, Cesium不支持Uint32Array\n    uvec4 getRawTexture( in sampler2D shRawTexture, in int u8Index, in uint shIndex, in vec2 shDimensions){\n\n          vec4 shRaw0 = texture(shRawTexture, getStrideDataUV(4 * 4, 0 + u8Index * 4, shIndex, shDimensions));\n          vec4 shRaw1 = texture(shRawTexture, getStrideDataUV(4 * 4, 1 + u8Index * 4, shIndex, shDimensions));\n          vec4 shRaw2 = texture(shRawTexture, getStrideDataUV(4 * 4, 2 + u8Index * 4, shIndex, shDimensions));\n          vec4 shRaw3 = texture(shRawTexture, getStrideDataUV(4 * 4, 3 + u8Index * 4, shIndex, shDimensions));\n\n    \n          return uvec4(composeShRaw(shRaw0), composeShRaw(shRaw1), composeShRaw(shRaw2), composeShRaw(shRaw3));\n\n    }\n\n    // Check point visible at range [startIdx, endIdx]\n    // float computePointVisible(float startIdx, float endIdx, float idx) {\n    //     float visible = 1.0;\n    //     if (startIdx > 0.0 || endIdx > 0.0) {\n    //         if (idx > startIdx && idx < endIdx) {\n    //             visible = 0.0;\n    //         } \n    //     }\n        \n    //     return visible;\n    // }\n\n\n    void main () {\n        vec3 sampledTransformLocal;\n        if(pointsOnly > 0.0)\n        {   \n            ${i}\n        }\n        else\n        {\n    \n            ${s}\n    \n            if(useSH > 0.0)\n            {\n                // vec3 viewDir = sampledTransform.xyz - (inverse(mat4(${r})) * vec4(cmrPos, 1.0)).xyz;\n                \n                sampledTransformLocal = sampledTransform.xyz;\n                #ifdef IS_RTK\n                    sampledTransformLocal = inverse(prj2ECEF) * sampledTransformLocal;\n                #endif\n                vec3 viewDir = sampledTransformLocal.xyz -  cmrPos;\n\n                viewDir = normalize( viewDir).xyz;\n\n                int shIdxNew = idx * 4;\n                int sh_x = shIdxNew % int(shDimensions.x);\n                int sh_y = shIdxNew / int(shDimensions.x);\n\n                uvec4 shRaw0 = floatBitsToUint(texelFetch(shRawTexture, ivec2(sh_x, sh_y), 0));\n                uvec4 shRaw1 = floatBitsToUint(texelFetch(shRawTexture, ivec2(sh_x + 1, sh_y), 0));\n                uvec4 shRaw2 = floatBitsToUint(texelFetch(shRawTexture, ivec2(sh_x + 2, sh_y), 0));\n                uvec4 shRaw3 = floatBitsToUint(texelFetch(shRawTexture, ivec2(sh_x + 3, sh_y), 0));\n    \n                handleSHRawData(uvec4(shRaw0), uvec4(shRaw1), uvec4(shRaw2), uvec4(shRaw3));\n    \n                vec3 shColor = ShadeSH(viewDir);\n                //vec3 gray = vec3(dot(shColor, vec3(0.299, 0.587, 0.114))) + 1.;\n                \n                vColor.rgb += shColor;\n                // vColor.rgb = clamp(vColor.rgb, 0., 1.);\n            }\n        }\n        vResolution = viewport;\n    }\n    `}}function De(t){const{gl_FragColor:e}=t;return{fragmentShader:`\n        precision highp float;\n        uniform float alpha;\n        uniform vec4 clipPlane;\n        in vec4 vColor;\n        in vec2 vPosition;\n        in vec2 vResolution;\n        void main () {\n            // compute clip plane\n            vec2 ndc_xy = (gl_FragCoord.xy / vResolution) * 2.0 - 1.0;\n            vec3 ndc = vec3(ndc_xy.x, -ndc_xy.y, gl_FragCoord.z * 2.0 - 1.0);\n            if (dot(ndc, clipPlane.xyz) < clipPlane.w) {\n                discard;\n            }\n\n            // compute the negative squared distance from the center of the splat to the\n            // current fragment in the splat's local space.\n            \n            float A = -dot(vPosition, vPosition);\n            if (A < -4.0) discard;\n            vec3 color = vColor.rgb;\n            A = exp(A) * vColor.a;\n\n            // A = 1.0;\n\n            ${e} = vec4(color.rgb, A * alpha);\n        }\n    `}}let Pe=class{#es;#ss;#is;#rs;#as;#ns;#os;#hs;get tempTexFloatRed(){return this.#rs}get tempTexFloatRGBA(){return this.#as}get tempTexIntRGBA(){return this.#ns}get rainbowTex(){return this.#is}get baseGeometry(){return this.#os}get baseMaterial(){return this.#hs}constructor(t){this.#es=t,this.#ss=this.#es.renderLib,this.#ls("rainbow",o[1]),this.#cs(),this.#us(),this.#ds()}dispose(){this.#is?.dispose(),this.#os.dispose(),this.#hs.dispose(),this.#rs.dispose(),this.#rs.image.data=null,this.#rs=null,this.#as.dispose(),this.#as.image.data=null,this.#as=null,this.#ns.dispose(),this.#ns.image.data=null,this.#ns=null}#cs(){const t=4,e=4,s=new Float32Array(t*e);for(let t=0;t<s.length;++t)s[t]=0;this.#rs=new this.#ss.DataTexture(s,t,e,this.#ss.RedFormat,this.#ss.FloatType),this.#rs.needsUpdate=!0,this.#rs.unpackAlignment=4;const i=4,r=4,a=new Float32Array(i*r*4);for(let t=0;t<a.length;++t)a[t]=0;this.#as=new this.#ss.DataTexture(a,i,r,this.#ss.RGBAFormat,this.#ss.FloatType),this.#as.needsUpdate=!0,this.#as.unpackAlignment=4;const n=4,o=4,h=new Int32Array(n*o*4);for(let t=0;t<h.length;++t)h[t]=0;this.#ns=new this.#ss.DataTexture(h,n,o,this.#ss.RGBAIntegerFormat,this.#ss.IntType),this.#ns.internalFormat="RGBA32I",this.#ns.needsUpdate=!0,this.#ns.unpackAlignment=4}#ls(t,e){(new this.#ss.TextureLoader).load(e,(e=>{this.#is=e,this.#is.name=t}),void 0,(t=>{console.log("create texture failed: ",t)}))}#us(){this.#os=new this.#ss.BufferGeometry;let t=new Float32Array(18),e=new this.#ss.BufferAttribute(t,3);this.#os.setAttribute("position",e),e.setXYZ(2,-1,1,0),e.setXYZ(1,-1,-1,0),e.setXYZ(0,1,1,0),e.setXYZ(5,-1,-1,0),e.setXYZ(4,1,-1,0),e.setXYZ(3,1,1,0),e.needsUpdate=!0}#ds(){this.#hs=new this.#ss.ShaderMaterial({uniforms:{splatData:{value:null},splatIndexes:{value:null},splatIndexesHost:{value:null},shRawTexture:{value:null},customColors:{value:null},dimensions:{value:new this.#ss.Vector2(0,0)},dataDimensions:{value:new this.#ss.Vector2(0,0)},shDimensions:{value:new this.#ss.Vector2(0,0)},viewport:{value:new this.#ss.Vector2(0,0)},focal:{value:0},splatCount:{value:0},pointsOnly:{value:!1},useSH:{value:!1},useIndexHost:{value:!1},alpha:{value:1},useCustomColor:{value:!0},compressedScaleMin:{value:new this.#ss.Vector3(0,0,0)},compressedScaleMax:{value:new this.#ss.Vector3(0,0,0)},compressedSHMin:{value:new this.#ss.Vector3(0,0,0)},compressedSHMax:{value:new this.#ss.Vector3(0,0,0)},cmrPos:{value:new this.#ss.Vector3(0,0,0)},heightRange:{value:new this.#ss.Vector2(0,0)},clipPlane:{value:new this.#ss.Vector4(0,0,0,0)},clipBoxMatrixInv:{value:new this.#ss.Matrix4},clipBoxSide:{value:1}},vertexShader:Te(_e).vertexShaderSH,fragmentShader:De(_e).fragmentShader,transparent:!0,alphaTest:1,blending:this.#ss.NormalBlending,depthTest:!0,depthWrite:!1,side:this.#ss.DoubleSide})}};const ze=new J,Ae=new J,Ee=new J,Ie=new J;class Fe{constructor(t=new J,e=new J(0,0,-1),s=1/0){this.origin=t,this.direction=e,this.length=s}set(t,e,s=1/0){return this.origin.copy(t),this.direction.copy(e),this.length=s,this}at(t,e){return e.copy(this.origin).addScaledVector(this.direction,t)}copy(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this.length=t.length,this}intersectBox(t){let e,s,i,r,a,n;const o=1/this.direction.x,h=1/this.direction.y,l=1/this.direction.z,c=this.origin;if(o>=0?(e=(t.min.x-c.x)*o,s=(t.max.x-c.x)*o):(e=(t.max.x-c.x)*o,s=(t.min.x-c.x)*o),h>=0?(i=(t.min.y-c.y)*h,r=(t.max.y-c.y)*h):(i=(t.max.y-c.y)*h,r=(t.min.y-c.y)*h),e>r||i>s)return null;if((i>e||isNaN(e))&&(e=i),(r<s||isNaN(s))&&(s=r),l>=0?(a=(t.min.z-c.z)*l,n=(t.max.z-c.z)*l):(a=(t.max.z-c.z)*l,n=(t.min.z-c.z)*l),e>n||a>s)return null;if((a>e||e!=e)&&(e=a),(n<s||s!=s)&&(s=n),s<0)return null;let u=Math.max(0,e);return{point:this.origin.clone().addScaledVector(this.direction,u),distance:u}}intersectTriangle(t,e,s,i){Ae.subVectors(e,t),Ee.subVectors(s,t),Ie.crossVectors(Ae,Ee);let r,a=this.direction.dot(Ie);if(a>0){if(i)return null;r=1}else{if(!(a<0))return null;r=-1,a=-a}ze.subVectors(this.origin,t);const n=r*this.direction.dot(Ee.crossVectors(ze,Ee));if(n<0)return null;const o=r*this.direction.dot(Ae.cross(ze));if(o<0)return null;if(n+o>a)return null;const h=-r*ze.dot(Ie);if(h<0)return null;const l=h/a;if(l>this.length)return null;return{point:this.origin.clone().addScaledVector(this.direction,l),distance:l}}applyMatrix4(t){return this.origin.applyMatrix4(t),this.direction.transformDirection((new Jt).extractRotation(t)),this}equals(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class Re{static GlobalID=0;#m=!1;#N;#ms;#ss;#y;#ps;#fs;#xs;#gs;#ys;#Ms;#bs;#ws;#vs;#Ss;#Cs;#Q;#_s;#Ts;#Ds;#Ps=new J;#zs=new J;#As=0;#Es=new J;#Is=new J;#Fs=0;#Rs;#ks=!1;#Ns=!1;#Bs=!1;#Ls=!1;dimensions;dataDimensions;shDimensions;sortInfos;indexRT;isEnvMesh=!1;#G=new bt;#qs=0;#Hs=0;#Us=0;#Os=0;#Vs=0;get isDispose(){return this.#m}get id(){return this.#y}get object(){return this.#Ss}get node(){return this.#Cs}get size(){return this.#qs}set isFirstSorted(t){this.#Ns=t}get isFirstSorted(){return this.#Ns}set isSorting(t){this.#Bs=t}get isSorting(){return this.#Bs}get splatCount(){return this.#Rs}set pos(t){this.#_s=t}get pos(){return this.#_s}set distances(t){this.#Ts=t}get distances(){return this.#Ts}set indexes(t){this.#Ds=t}get indexes(){return this.#Ds}get sortCmrPosLast(){return this.#Ps.clone()}get sortTickLast(){return this.#As}get sortCmrPosPending(){return this.#Es}get transformsTexture(){return this.#ws?.uniforms?.splatData?.value}get hasUploadSH(){return this.#ks}constructor(t,e,s,i,r,a){this.#y=Re.GlobalID++,this.#N=t,this.#ms=this.#N.resources,this.#ss=this.#N.lccParam.renderLib,this.#Cs=e,this.#Q=e?.parent?.center||new J(0,0,0),this.#Rs=s;let n=t.meta.data;if(this.isEnvMesh=!e,this.isEnvMesh?(n.compressInfo.positionMin&&n.compressInfo.positionMax&&this.#G.set(n.compressInfo.positionMin,n.compressInfo.positionMax),this.#xs=n.compressInfo.positionMax,this.#gs=n.compressInfo.positionMin,this.#ps=n.compressInfo.compressedEnvScaleMax||n.compressInfo.compressedScaleMax,this.#fs=n.compressInfo.compressedEnvScaleMin||n.compressInfo.compressedScaleMin,this.#ys=n.compressInfo.compressedEnvSHMax||n.compressInfo.compressedSHMax,this.#Ms=n.compressInfo.compressedEnvSHMin||n.compressInfo.compressedSHMin):(this.#G.copy(this.#Cs.parent.getBBox()),this.#xs=n.max,this.#gs=n.min,this.#ps=n.compressInfo.compressedScaleMax,this.#fs=n.compressInfo.compressedScaleMin,this.#ys=n.compressInfo.compressedSHMax,this.#Ms=n.compressInfo.compressedSHMin),r){this.#_s=new Float32Array(r.length);for(let t=0;t<r.length;++t)this.#_s[t]=r[t];this.#Ts=new Int32Array(this.#Rs),this.#Ds=new Int32Array(this.#Rs)}this.dimensions=it(this.#Rs),this.dataDimensions=it(2*this.#Rs),this.shDimensions=it(4*this.#Rs);let o=this.#Gs(this.#Rs);this.sortInfos={totalDrawCount:rt(this.dimensions.x*this.dimensions.y),lastDrawCount:0,maxCountOneTime:o},this.#js(),this.#Ws(),this.#Ss=new this.#ss.Mesh(this.#bs,this.#ws),this.#Ss.frustumCulled=!1,this.#Ss.name="lccMesh",this.#Qs(),i&&this.updateSplatDataTexture(i),a&&this.updateSHTexture(a),0===this.#qs&&console.warn("has not update gpu size !!!")}dispose(){this.#m=!0,this.#_s=null,this.#Ss&&(this.#Ss.removeFromParent(),this.#Ss=null),this.#ws&&(this.#ws.uniforms.splatData.value&&(this.#ws.uniforms.splatData.value.dispose(),this.#ws.uniforms.splatData.value.image.data=null,this.#ws.uniforms.splatData.value=null),this.#ws.uniforms.splatIndexesHost.value&&(this.#ws.uniforms.splatIndexesHost.value.dispose(),this.#ws.uniforms.splatIndexesHost.value.image.data=null,this.#ws.uniforms.splatIndexesHost.value=null),this.#ws.uniforms.shRawTexture.value&&this.#ws.uniforms.shRawTexture.value!==this.#ms.tempTexFloatRGBA&&(this.#ws.uniforms.shRawTexture.value.dispose(),this.#ws.uniforms.shRawTexture.value.image.data=null,this.#ws.uniforms.shRawTexture.value=null),this.#ws.dispose(),this.#ws=null),this.#bs&&(this.#bs.dispose(),this.#bs=null),this.indexRT&&(this.indexRT.texture.dispose(),this.indexRT.dispose(),this.indexRT=null)}#js(){const t=this.#ms.baseGeometry;this.#bs=(new this.#ss.InstancedBufferGeometry).copy(t),this.#bs.instanceCount=this.#Rs}#Ws(){this.#ws=this.#ms.baseMaterial.clone()}#Qs(){const t=this.dimensions,e=this.dataDimensions,s=this.shDimensions;if(this.#N.config.WebglSortingEnable){const e=this.#ss.RGBAIntegerFormat,s=this.#ss.IntType,i="RGBA32I";this.indexRT=new this.#ss.WebGLRenderTarget(t.x,t.y,{count:1,minFilter:this.#ss.NearestFilter,magFilter:this.#ss.NearestFilter,format:e,type:s,internalFormat:i,depthBuffer:!1,stencilBuffer:!1}),this.indexRT.texture.name="SortIndex"}this.#ws.uniforms.splatCount.value=this.#Rs,this.#ws.uniforms.dimensions.value=new this.#ss.Vector2(t.x,t.y),this.#ws.uniforms.dataDimensions.value=new this.#ss.Vector2(e.x,e.y),this.#ws.uniforms.shDimensions.value=new this.#ss.Vector2(s.x,s.y),this.#ws.uniforms.heightRange.value=new this.#ss.Vector2(this.#gs.z,this.#xs.z),this.#fs&&(this.#ws.uniforms.compressedScaleMin.value=new this.#ss.Vector3(this.#fs.x,this.#fs.y,this.#fs.z)),this.#ps&&(this.#ws.uniforms.compressedScaleMax.value=new this.#ss.Vector3(this.#ps.x,this.#ps.y,this.#ps.z)),this.#Ms&&(this.#ws.uniforms.compressedSHMin.value=new this.#ss.Vector3(this.#Ms.x,this.#Ms.y,this.#Ms.z)),this.#ys&&(this.#ws.uniforms.compressedSHMax.value=new this.#ss.Vector3(this.#ys.x,this.#ys.y,this.#ys.z)),this.#ws.uniforms.customColors.value=this.#ms.rainbowTex;const i=new Uint32Array(e.x*e.y*4);this.#vs=i,this.#ws.uniforms.splatData.value=new this.#ss.DataTexture(i,e.x,e.y,this.#ss.RGBAIntegerFormat,this.#ss.UnsignedIntType),this.#ws.uniforms.splatData.value.needsUpdate=!0,this.#ws.uniforms.splatData.value.internalFormat="RGBA32UI",this.#ws.uniforms.splatData.value.unpackAlignment=4;const r=new Int32Array(t.x*t.y);this.#ws.uniforms.splatIndexesHost.value=new this.#ss.DataTexture(r,t.x,t.y,this.#ss.RedIntegerFormat,this.#ss.IntType),this.#ws.uniforms.splatIndexesHost.value.needsUpdate=!0,this.#ws.uniforms.splatIndexesHost.value.internalFormat="R32I",this.#ws.uniforms.splatIndexesHost.value.unpackAlignment=4,this.#ws.uniforms.splatIndexes.value=this.#ms.tempTexIntRGBA,this.#ws.uniforms.shRawTexture.value=this.#ms.tempTexFloatRGBA,this.#ws.uniformsNeedUpdate=!0,this.#Us=r.byteLength,this.#Os=i.byteLength,this.#Xs()}#Xs(){this.#qs=this.#Hs+this.#Us+this.#Os+this.#Vs}updateSplatDataTexture(t){if(this.#m)return;const e=this.#ws.uniforms.splatData.value,s=e.image.data,i=new Uint32Array(s.buffer);for(let e=0;e<t.length;++e)i[e]=t[e];e.needsUpdate=!0}updateIndexTextureRT(){this.#m||(this.indexRT?this.#ws.uniforms.splatIndexes.value=this.indexRT.texture:console.error("Please create RT firstly !!!"))}updateIndexTexture(t){if(this.#m)return;const e=this.#ws.uniforms.splatIndexesHost.value,s=e.image.data;t.length!==this.#Rs&&console.error("udpate error ....................fd");const i=new Int32Array(s.buffer),r=Math.min(t.length,this.#Rs);for(let e=0;e<r;++e)i[e]=t[e];e.needsUpdate=!0}updateIndexTextureWithInit(){if(this.#m)return;const t=this.#ws.uniforms.splatIndexesHost.value,e=t.image.data,s=new Int32Array(e.buffer);for(let t=0;t<this.#Rs;++t)s[t]=t;for(let t=this.#Rs;t<s.length;++t)s[t]=0;t.needsUpdate=!0,this.#Ns=!0,this.#Ls=!0;const i=this.#N.dynamicState.cmrPosLocal.clone(),r=this.#N.dynamicState.cmrForward.clone();this.#Ps.copy(i),this.#zs.copy(r),this.#As=this.#N.dynamicState.tick}updateSHTexture(t){if(this.#m||this.#ks)return;this.#ks=!0;const e=new Float32Array(this.shDimensions.x*this.shDimensions.y*4);this.#ws.uniforms.shRawTexture.value=new this.#ss.DataTexture(e,this.shDimensions.x,this.shDimensions.y,this.#ss.RGBAFormat,this.#ss.FloatType),this.#ws.uniforms.shRawTexture.value.needsUpdate=!0,this.#ws.uniforms.shRawTexture.value.unpackAlignment=4;const s=this.#ws.uniforms.shRawTexture.value,i=s.image.data,r=new Uint32Array(i.buffer);for(let e=0;e<t.length;++e)r[e]=t[e];s.needsUpdate=!0,this.#Ss.onAfterRender=()=>{this.#ws.uniforms.shRawTexture.value.image.data=null,this.#Ss.onAfterRender=()=>{}},this.#Vs=e.byteLength,this.#Xs()}updateUniformsDynamic(){if(this.#m)return;const t=this.#N.dynamicState;this.#ws.uniforms.viewport.value=new this.#ss.Vector2(t.viewport.x,t.viewport.y),this.#ws.uniforms.focal.value=t.focal,this.#ws.uniforms.pointsOnly.value=t.pointsOnly,this.#ws.uniforms.alpha.value=t.alpha,this.#ws.uniforms.useSH.value=!(!t.useSH||!this.#ks),this.#ws.uniforms.useCustomColor.value=t.useCustomColor,this.#ws.uniforms.cmrPos.value=t.cmrPosLocal.clone(),this.#ws.uniforms.clipPlane.value.copy(t.clipPlane),this.#ws.uniforms.clipBoxMatrixInv.value.copy(t.clipBoxMatrixInv),this.#ws.uniforms.clipBoxSide.value=t.clipBoxSide,this.#ws.uniforms.useIndexHost.value=this.#Ls}getBBox(){return this.#G}intersectWithRay(t,e){const s=new J,i=new J,r=new J,a=e*e;let n=-1;const o=new Float32Array(this.#vs.buffer);for(let e=0;e<this.#Rs;++e){const h=o[8*e+0],l=o[8*e+1],c=o[8*e+2],u=s.set(h,l,c),d=i.copy(u).sub(t.origin),m=d.dot(t.direction);if(m<0||m>t.length)continue;const p=r.copy(t.origin).addScaledVector(t.direction,m).sub(t.origin).sub(d);p.dot(p)>a||(t.length=m,n=m)}if(n<0)return null;return{point:t.origin.clone().addScaledVector(t.direction,n),distance:n}}#Gs(t){const e=t/1e4;return e<1?100:e<10?90:e<20?70:e<30?50:e<40?40:e<50?30:e<60?20:e<70?10:e<80||e<90||e<100||e<110||e<120||e<130||e<140||e<150||e<160?5:e<180?3:1}checkNeedSort(){if(this.#Bs)return!1;if(!this.#Ns)return!0;if(this.isEnvMesh&&this.#Ns)return!1;const t=this.#N.config.CameraPosChangedSortThreshold;this.#N.config.CameraAngleChangedSortThreshold;const e=this.#N.dynamicState.cmrPosLocal.distanceToSquared(this.#Ps),s=this.#N.dynamicState.tick-this.#As;if(e<t*t)return!1;const i=[0,160,320,480,640,800,960];return!(s<i[Math.min(i.length-1,this.#Cs.level)])}startSorting(){const t=this.#N.dynamicState.cmrPosLocal.clone(),e=this.#N.dynamicState.cmrForward.clone();this.#Es.copy(t),this.#Is.copy(e),this.#Fs=this.#N.dynamicState.tick,this.isSorting=!0}endSorting(t=!1){this.#Ls=t,this.#Ns=!0,this.#Bs=!1,this.sortInfos.lastDrawCount=0,t?this.updateIndexTexture(this.indexes):this.updateIndexTextureRT(),this.#Ps.copy(this.#Es),this.#zs.copy(this.#Is),this.#As=this.#Fs}}function ke(t){const e=new Int32Array(1e5);self.onmessage=t=>{const s=t.data.workerIndex,i=t.data.splatCount,r=t.data.camPos,a=new Int32Array(t.data.indexesBuffer),n=new Int32Array(t.data.distancesBuffer),o=new Float32Array(t.data.transformsBuffer);!function(t,s,i,r,a){let n=Number.MAX_SAFE_INTEGER,o=-Number.MAX_SAFE_INTEGER,h=s.x-a[0],l=s.y-a[1],c=s.z-a[2],u=-1e3*Math.sqrt(h*h+l*l+c*c);for(let e=0;e<t;e++){let t=s.x-a[3*e],i=s.y-a[3*e+1],h=s.z-a[3*e+2],l=-1e3*Math.sqrt(t*t+i*i+h*h),c=Math.round(l-u);c>o&&(o=c),c<n&&(n=c),r[e]=c}const d=o-n+1;let m;if(d<e.length){m=e;for(let t=0;t<d;++t)e[t]=0}else m=new Int32Array(d);for(let e=0;e<t;e++)m[r[e]-n]++;for(let t=1;t<m.length;++t)m[t]+=m[t-1];for(let t=r.length-1;t>=0;--t){const e=r[t]-n;m[e]--,i[m[e]]=t}}(i,r,a,n,o),postMessage({workerIndex:s,indexesBuffer:a.buffer,distancesBuffer:n.buffer,transformsBuffer:o.buffer},[a.buffer,n.buffer,o.buffer])}}class Ne{splatCount;camPos;indexes;distances;transforms;mesh;beginCallback;endCalllback}class Be{#m=!1;#et=[];#Ys=[];#Zs=[];#Ks=0;#Js=0;#$s=!0;constructor(t){for(let e=0;e<t;++e){const t=Ot(ke);t?(this.#Ks++,this.#et.push(t)):console.error("create worker failed !!!")}this.#et.forEach((t=>{t.onmessage=t=>{if(this.#m)return;const e=t.data.workerIndex,s=this.#Zs[e];s.indexes=new Int32Array(t.data.indexesBuffer),s.distances=new Int32Array(t.data.distancesBuffer),s.transforms=new Float32Array(t.data.transformsBuffer),s.endCalllback?.(s),this.#Js--,this.#Ys[e]=!1}}))}setEnable(t){this.#$s=t}isReady(){return this.#$s&&this.#Js<this.#Ks}dispose(){this.#m=!0,this.#et.forEach((t=>{t.terminate()})),this.#et=[],this.#Ks=0}triggerSorting(t){if(!this.isReady())return void console.error("CPUSorter is not ready !!!");let e,s=-1;for(let t=0;t<this.#et.length;++t)if(!this.#Ys[t]){s=t,e=this.#et[t];break}s<0?console.error("not find ready worker!!!"):(this.#Zs[s]=t,this.#Ys[s]=!0,this.#Js+=1,t.beginCallback?.(t),e.postMessage({workerIndex:s,splatCount:t.splatCount,camPos:{x:t.camPos.x,y:t.camPos.y,z:t.camPos.z},indexesBuffer:t.indexes.buffer,distancesBuffer:t.distances.buffer,transformsBuffer:t.transforms.buffer},[t.indexes.buffer,t.distances.buffer,t.transforms.buffer]))}update(){}}const Le="\nprecision highp float;\nin vec3 position;\nvoid main() {\n     gl_Position = vec4( position, 1.0 );\n}\n";let qe=class{#N;#Lt;#ss;#ti;#ei;#si;#ii;#ri;#ai;#ni;#oi={x:512,y:512};#hi=null;#$s=!0;constructor(t){this.#N=t,this.#ss=this.#N.lccParam.renderLib,this.#ti=this.#N.lccParam.renderer,this.#Lt=this.#N.config,this.#si=new this.#ss.BufferGeometry,this.#si.setAttribute("position",new this.#ss.Float32BufferAttribute([-1,3,0,-1,-1,0,3,-1,0],3)),this.#ei=new this.#ss.OrthographicCamera(-1,1,1,-1,0,1),this.#li(this.#oi),this.#ci()}#li(t){const e=this.#ss.RGBAIntegerFormat,s=this.#ss.IntType,i="RGBA32I";this.#ai=new this.#ss.WebGLRenderTarget(t.x,t.y,{count:1,minFilter:this.#ss.NearestFilter,magFilter:this.#ss.NearestFilter,format:e,type:s,internalFormat:i,depthBuffer:!1,stencilBuffer:!1}),this.#ai.texture.name="sortRT1",this.#ni=new this.#ss.WebGLRenderTarget(t.x,t.y,{count:1,minFilter:this.#ss.NearestFilter,magFilter:this.#ss.NearestFilter,format:e,type:s,internalFormat:i,depthBuffer:!1,stencilBuffer:!1}),this.#ni.texture.name="sortRT2"}#ci(){let t=new this.#ss.RawShaderMaterial({name:"Bitonic Sort ",uniforms:{u_data:{value:null},dimension:{value:{x:2,y:2}},stage:{value:0},pass:{value:0}},vertexShader:Le,fragmentShader:"\nprecision highp float;\nprecision highp int;\nlayout(location = 0) out ivec4 pc_FragColor;\n\nuniform highp isampler2D u_data;\n\nuniform int stage;\nuniform int pass;\nuniform ivec2 dimension;\n\nivec4 fetch(int x, int y) {\n    return texelFetch(u_data, ivec2(x, y), 0);\n}\n\nbool minOrmax(int d1_high, int d1_low, int d2_high, int d2_low) {\n    if(d1_high > d2_high) {\n     return true;\n    }\n    if(d1_high < d2_high) {\n     return false;\n    }\n\n    if(d1_low > d2_low) {\n        return true;\n    }\n\n    if(d1_low < d2_low) {\n        return false;\n    }\n\n    return false;\n}\nvoid main() {\n\n    int fx = int(gl_FragCoord.x);\n    int fy = int(gl_FragCoord.y);\n    int index = fx + fy * dimension.x;\n\n    int pairIndex = index ^ pass;\n\n    int dFx = pairIndex % dimension.x;\n    int dFy = pairIndex / dimension.x;\n\n    bool mask = index > pairIndex;\n\n    ivec4 indexValue = fetch(fx, fy);\n    ivec4 pairValue = fetch(dFx, dFy);\n\n    bool up = ((index & stage) == 0);\n\n    // int b1 = (index - pairIndex) / abs(index - pairIndex);\n\n    // int vv = indexValue.x - pairValue.x;\n\n    // int b2 = (vv) / abs(vv);\n\n    // int b3 = min(index & stage, 2) - 1;\n    \n    // int rs1 = b1 * b2 * b3;\n\n    // pc_FragColor = max(rs1 * indexValue, -rs1 * pairValue);\n\n\n    if(!up) {\n        // if(indexValue.x > pairValue.x){\n\n        if(minOrmax(indexValue.x, indexValue.z, pairValue.x, pairValue.z)){\n            if(mask) {\n                pc_FragColor = indexValue;\n            } else {\n                pc_FragColor = pairValue;\n            }\n        } else {\n            if(mask) {\n                pc_FragColor = pairValue;\n            } else {\n                pc_FragColor = indexValue;\n            }\n        }\n    } else {\n        // if(indexValue.x < pairValue.x){\n\n        if(!minOrmax(indexValue.x, indexValue.z, pairValue.x, pairValue.z)){\n            if(mask) {\n                pc_FragColor = indexValue;\n            } else {\n                pc_FragColor = pairValue;\n            }\n        } else {\n            if(mask) {\n                pc_FragColor = pairValue;\n            } else {\n                pc_FragColor = indexValue;\n            }\n        }\n    }\n    \n}\n\n\n",glslVersion:this.#ss.GLSL3,depthTest:!1,depthWrite:!1,side:this.#ss.DoubleSide}),e=new this.#ss.RawShaderMaterial({name:"Bitonic Sort Distance",uniforms:{transforms:{value:null},dimension:{value:{x:2,y:2}},dataDimensions:{value:{x:2,y:2}},splatCount:{value:0},cmrPos:{value:{x:0,y:0,z:0}}},vertexShader:Le,fragmentShader:"\nprecision highp float;\nprecision highp int;\nlayout(location = 0) out ivec4 pc_FragColor;\n\nuniform sampler2D transforms;\n\nuniform int splatCount;\nuniform ivec2 dimension;\nuniform ivec2 dataDimensions;\nuniform vec3 cmrPos;\n\nvoid main() {\n\n\n    int fx = int(gl_FragCoord.x);\n    int fy = int(gl_FragCoord.y);\n\n    int index = fx + fy * dimension.x;\n\n    int id1 = int(index * 2);\n    int x1 = id1 % int(dataDimensions.x);\n    int y1 = id1 / int(dataDimensions.x);\n\n    if(index >= splatCount) {\n      pc_FragColor = ivec4(10, index, 0, 0);\n    } else {\n      vec4 sampledTransform = texelFetch(transforms, ivec2(x1, y1), 0);\n      float distance = length(vec3(sampledTransform.xyz) - cmrPos) + 1000.0;\n      float dm = fract(distance) * 1000000000.;\n      pc_FragColor = ivec4(int(distance), index, int(dm), 0);\n    }\n}\n\n",glslVersion:this.#ss.GLSL3,depthTest:!1,depthWrite:!1,side:this.#ss.DoubleSide});this.#ri=new this.#ss.Mesh(this.#si,t),this.#ii=new this.#ss.Mesh(this.#si,e)}#ui(t,e){const s=e.sortCmrPosPending,i=e.splatCount,r=e.dimensions,a=e.transformsTexture;this.#ii.material.uniforms.splatCount.value=i,this.#ii.material.uniforms.dimension.value=r,this.#ii.material.uniforms.dataDimensions.value=e.dataDimensions,this.#ii.material.uniforms.transforms.value=a,this.#ii.material.uniforms.cmrPos.value=s,this.#oi.x*this.#oi.y<r.x*r.y&&(this.#oi.x=r.x,this.#oi.y=r.y,this.#ai.setSize(this.#oi.x,this.#oi.y),this.#ni.setSize(this.#oi.x,this.#oi.y)),t.setViewport(0,0,r.x,r.y),t.setRenderTarget(this.#ai),t.render(this.#ii,this.#ei)}#di(t,e){const s=e.sortInfos,i=e.dimensions,r=s.maxCountOneTime,a=i.x*i.y;let n=0;const o=Math.min(s.lastDrawCount+r,s.totalDrawCount);this.#ri.material.uniforms.dimension.value=i;for(let r=2;r<=a;r<<=1)for(let a=r>>1;a>0;a>>=1){if(n<s.lastDrawCount){n++;continue}if(n===o)return void(s.lastDrawCount=o);n++,this.#ri.material.uniforms.stage.value=r,this.#ri.material.uniforms.pass.value=a,this.#ri.material.uniforms.u_data.value=this.#ai.texture,t.setViewport(0,0,i.x,i.y),n===s.totalDrawCount?t.setRenderTarget(e.indexRT):t.setRenderTarget(this.#ni),t.render(this.#ri,this.#ei);let h=this.#ai;this.#ai=this.#ni,this.#ni=h}o===s.totalDrawCount&&(e.endSorting(),this.#hi=null)}update(){if(this.#hi){if(this.#hi.isDispose)return console.log("sorting mesh had been disposed !!!"),void(this.#hi=null);this.#hi.sortInfos.lastDrawCount<1&&this.#ui(this.#ti,this.#hi),this.#di(this.#ti,this.#hi),this.#ti.setRenderTarget(null)}}setEnable(t){this.#$s=t}isReady(){return this.#$s&&!this.#hi}triggerSorting(t){this.#hi||(this.#hi=t,t.startSorting())}dispose(){this.#hi=null,this.#ei=null,this.#ii&&(this.#ii.geometry=null,this.#ii.material&&(this.#ii.material.uniforms.transforms.value=null,this.#ii.material.dispose(),this.#ii.material=null),this.#ii=null),this.#ri&&(this.#ri.geometry=null,this.#ri.material&&(this.#ri.material.uniforms.u_data.value=null,this.#ri.material.dispose(),this.#ri.material=null),this.#ri=null),this.#si&&(this.#si.dispose(),this.#si=null),this.#ai&&(this.#ai.texture.dispose(),this.#ai.dispose(),this.#ai=null),this.#ni&&(this.#ni.texture.dispose(),this.#ni.dispose(),this.#ni=null)}};class He{#m=!1;#z;#P;#N;#mi;#pi;#fi;#xi=[];#gi=[];#yi=[];#Mi=[];#bi=[];#wi=[];#vi=0;constructor(t){this.#N=t,this.#z=this.#N.gpuCache,this.#P=this.#N.cpuCache,this.#mi=new Be(this.#N.config.CpuSortThreadNum),this.#N.config.WebglSortingEnable&&(this.#pi=new qe(this.#N))}dispose(){this.#m=!0,this.#mi.dispose(),this.#pi?.dispose(),this.#fi?.dispose()}#Si(t,e){const s=this.#N.lccParam.renderLib,i=new s.BufferGeometry;i.setAttribute("position",new s.BufferAttribute(t,3)),i.setIndex(new s.BufferAttribute(e,1));const r=new s.MeshBasicMaterial({color:8421504,side:s.DoubleSide});return new s.Mesh(i,r)}#Ci(){if(this.#fi)return this.#fi;const t=this.#N.meta,e=this.#P.queryEnv(this.#N.renderID);if(!e||!t)return null;const{splatCounts:s,data:i,sh:r,pos:a}=e;return this.#fi=new Re(this.#N,null,s,i,a,r),this.#fi.object.renderOrder=0,this.#fi}getEnvmesh(t=!0){return this.#fi||this.#Ci(),this.#fi?t&&!this.#fi.isFirstSorted?null:this.#fi:null}getMesh(t,e=!0){let s=this.#z.queryMesh(t.renderID,t.id);return s?e&&!s.isFirstSorted?null:s:null}clearCacheCollQueue(){this.#gi=[]}pushCacheCollQueue(t){this.#gi.push(t)}clearCacheQueue(){this.#xi=[]}pushCacheQueue(t){this.#xi.push(t)}clearCacheSHQueue(){this.#yi=[]}pushCacheSHQueue(t){this.#yi.push(t)}clearSortQueue(){this.#Mi=[],this.#bi=[]}pushSortQueue(t){t.isSorting||(t.isFirstSorted,this.#bi.push(t))}update(s){if(!this.#m){for(let t=0;t<this.#gi.length;++t){const e=this.#gi[t],s=e.queryCacheData();if(!s)continue;const i=this.#Si(s.vertexes,s.faces);e.pushCacheMesh(i)||(console.error("push coll mesh fail."),i.dispose())}for(let e=0;e<this.#xi.length;++e){const s=this.#xi[e];if(!s||!s.isCache(t)||this.#z.queryMesh(s.renderID,s.id))continue;const{data:i,sh:r,pos:a}=s.queryCache(),n=new Re(this.#N,s,s.points,i,a,r);this.#z.pushMesh(s.renderID,s.id,n,n.size)||(console.log("push mesh failed..."),n.dispose())}for(let t=0;t<this.#yi.length;++t){const s=this.#yi[t],i=s.node;if(s.hasUploadSH||!i||!i.isCache(e))continue;const{data:r,sh:a,pos:n}=i.queryCache();s.updateSHTexture(a),this.#z.flushMesh(i.renderID,i.id,s,s.size)}for(0==this.#wi.length&&(this.#wi=[...this.#Mi,...this.#bi]);this.#wi.length>0&&(this.#pi?.isReady()||this.#mi.isReady());){let t=this.#wi.shift();if(t&&!t.isDispose&&t.checkNeedSort()){if(this.#mi.isReady()){const e=this.#N.dynamicState.cmrPosLocal,s=new Ne;s.splatCount=t.splatCount,s.camPos={x:e.x,y:e.y,z:e.z},s.distances=t.distances,s.indexes=t.indexes,s.transforms=t.pos,s.mesh=t,s.beginCallback=t=>{t.mesh&&!t.mesh.isDispose&&t.mesh.startSorting()},s.endCalllback=t=>{t.mesh&&!t.mesh.isDispose&&(t.mesh.pos=t.transforms,t.mesh.indexes=t.indexes,t.mesh.distances=t.distances,t.mesh.endSorting(!0))},this.#mi.triggerSorting(s)}this.#pi?.isReady()&&this.#pi.triggerSorting(t)}}this.#pi?.update()}}}class Ue{#_i=new Jt;#Ti=1;#Di=new J;#Pi=new J;#zi=new J;constructor(){this.update()}get matrix(){return this.#_i}get matrixInverse(){return this.matrix.clone().invert()}get clipSide(){return this.#Ti}get position(){return this.#Di}get rotation(){return this.#zi}get scale(){return this.#Pi}setSize(t,e,s){this.#Pi(t,e,s)}reset(){this.#Di=new J,this.#zi=new J,this.#Pi=new J,this.#Ti=1,this.update()}copy(t){this.#Di.copy(t.position),this.#Pi.copy(t.scale),this.#zi.copy(t.rotation),this.#Ti=t.clipSide,this.#_i.copy(t.matrix)}update(t,e,s,i=1){t?.isVector3&&this.#Di.copy(t),e?.isVector3&&this.#zi.copy(e),s?.isVector3&&this.#Pi.copy(s);const r=(new Jt).makeRotationX(this.#zi.x).multiply((new Jt).makeRotationY(this.#zi.y)).multiply((new Jt).makeRotationZ(this.#zi.z)),a=(new Z).setFromRotationMatrix(r),n=(new Jt).compose(this.#Di,a,this.#Pi);this.#_i=n,this.#Ti=i}}class Oe{constructor(t=new J(0,0,0),e=new J(0,1,0),s=1){this.start=t,this.end=e,this.radius=s}clone(){return new Oe(this.start.clone(),this.end.clone(),this.radius)}set(t,e,s){this.start.copy(t),this.end.copy(e),this.radius=s}copy(t){this.start.copy(t.start),this.end.copy(t.end),this.radius=t.radius}getCenter(t){return t.copy(this.end).add(this.start).multiplyScalar(.5)}translate(t){this.start.add(t),this.end.add(t)}applyMatrix4(t){return this.start.applyMatrix4(t),this.end.applyMatrix4(t),this}calAABB(t){let e=t;return e||(e=new bt),e.makeEmpty(),e.expandByPoint(this.start),e.expandByPoint(this.end),e.min.addScalar(-this.radius),e.max.addScalar(this.radius),e}checkAABBAxis(t,e,s,i,r,a,n,o,h){return(r-t<h||r-s<h)&&(t-a<h||s-a<h)&&(n-e<h||n-i<h)&&(e-o<h||i-o<h)}intersectsBox(t){return this.checkAABBAxis(this.start.x,this.start.y,this.end.x,this.end.y,t.min.x,t.max.x,t.min.y,t.max.y,this.radius)&&this.checkAABBAxis(this.start.x,this.start.z,this.end.x,this.end.z,t.min.x,t.max.x,t.min.z,t.max.z,this.radius)&&this.checkAABBAxis(this.start.y,this.start.z,this.end.y,this.end.z,t.min.y,t.max.y,t.min.z,t.max.z,this.radius)}}const Ve=new J,Ge=new J,je=new J,We=new J,Qe=new J,Xe=new J,Ye=new J,Ze=new J,Ke=new J,Je=new J,$e=new B,ts=new B,es=new B;class ss{constructor(t=new J,e=new J,s=new J){this.a=t,this.b=e,this.c=s}static getNormal(t,e,s,i){i.subVectors(s,e),Ve.subVectors(t,e),i.cross(Ve);const r=i.lengthSq();return r>0?i.multiplyScalar(1/Math.sqrt(r)):i.set(0,0,0)}static getBarycoord(t,e,s,i,r){Ve.subVectors(i,e),Ge.subVectors(s,e),je.subVectors(t,e);const a=Ve.dot(Ve),n=Ve.dot(Ge),o=Ve.dot(je),h=Ge.dot(Ge),l=Ge.dot(je),c=a*h-n*n;if(0===c)return r.set(0,0,0),null;const u=1/c,d=(h*o-n*l)*u,m=(a*l-n*o)*u;return r.set(1-d-m,m,d)}static containsPoint(t,e,s,i){return null!==this.getBarycoord(t,e,s,i,We)&&(We.x>=0&&We.y>=0&&We.x+We.y<=1)}static getInterpolation(t,e,s,i,r,a,n,o){return null===this.getBarycoord(t,e,s,i,We)?(o.x=0,o.y=0,"z"in o&&(o.z=0),"w"in o&&(o.w=0),null):(o.setScalar(0),o.addScaledVector(r,We.x),o.addScaledVector(a,We.y),o.addScaledVector(n,We.z),o)}static getInterpolatedAttribute(t,e,s,i,r,a){return $e.setScalar(0),ts.setScalar(0),es.setScalar(0),$e.fromBufferAttribute(t,e),ts.fromBufferAttribute(t,s),es.fromBufferAttribute(t,i),a.setScalar(0),a.addScaledVector($e,r.x),a.addScaledVector(ts,r.y),a.addScaledVector(es,r.z),a}static isFrontFacing(t,e,s,i){return Ve.subVectors(s,e),Ge.subVectors(t,e),Ve.cross(Ge).dot(i)<0}set(t,e,s){return this.a.copy(t),this.b.copy(e),this.c.copy(s),this}setFromPointsAndIndices(t,e,s,i){return this.a.copy(t[e]),this.b.copy(t[s]),this.c.copy(t[i]),this}setFromAttributeAndIndices(t,e,s,i){return this.a.fromBufferAttribute(t,e),this.b.fromBufferAttribute(t,s),this.c.fromBufferAttribute(t,i),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this}getArea(){return Ve.subVectors(this.c,this.b),Ge.subVectors(this.a,this.b),.5*Ve.cross(Ge).length()}getMidpoint(t){return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(t){return ss.getNormal(this.a,this.b,this.c,t)}getPlane(t){return t.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(t,e){return ss.getBarycoord(t,this.a,this.b,this.c,e)}getInterpolation(t,e,s,i,r){return ss.getInterpolation(t,this.a,this.b,this.c,e,s,i,r)}containsPoint(t){return ss.containsPoint(t,this.a,this.b,this.c)}isFrontFacing(t){return ss.isFrontFacing(this.a,this.b,this.c,t)}intersectsBox(t){return t.intersectsTriangle(this)}closestPointToPoint(t,e){const s=this.a,i=this.b,r=this.c;let a,n;Qe.subVectors(i,s),Xe.subVectors(r,s),Ze.subVectors(t,s);const o=Qe.dot(Ze),h=Xe.dot(Ze);if(o<=0&&h<=0)return e.copy(s);Ke.subVectors(t,i);const l=Qe.dot(Ke),c=Xe.dot(Ke);if(l>=0&&c<=l)return e.copy(i);const u=o*c-l*h;if(u<=0&&o>=0&&l<=0)return a=o/(o-l),e.copy(s).addScaledVector(Qe,a);Je.subVectors(t,r);const d=Qe.dot(Je),m=Xe.dot(Je);if(m>=0&&d<=m)return e.copy(r);const p=d*h-o*m;if(p<=0&&h>=0&&m<=0)return n=h/(h-m),e.copy(s).addScaledVector(Xe,n);const f=l*m-d*c;if(f<=0&&c-l>=0&&d-m>=0)return Ye.subVectors(r,i),n=(c-l)/(c-l+(d-m)),e.copy(i).addScaledVector(Ye,n);const x=1/(f+p+u);return a=p*x,n=u*x,e.copy(s).addScaledVector(Qe,a).addScaledVector(Xe,n)}equals(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}}const is=new J,rs=new J;class as{constructor(t=new J,e=new J){this.start=t,this.end=e}set(t,e){return this.start.copy(t),this.end.copy(e),this}copy(t){return this.start.copy(t.start),this.end.copy(t.end),this}getCenter(t){return t.addVectors(this.start,this.end).multiplyScalar(.5)}delta(t){return t.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(t,e){return this.delta(e).multiplyScalar(t).add(this.start)}closestPointToPointParameter(t,e){is.subVectors(t,this.start),rs.subVectors(this.end,this.start);const s=rs.dot(rs);let i=rs.dot(is)/s;return e&&(i=W(i,0,1)),i}closestPointToPoint(t,e,s){const i=this.closestPointToPointParameter(t,e);return this.delta(s).multiplyScalar(i).add(this.start)}applyMatrix4(t){return this.start.applyMatrix4(t),this.end.applyMatrix4(t),this}equals(t){return t.start.equals(this.start)&&t.end.equals(this.end)}clone(){return(new this.constructor).copy(this)}}class ns{constructor(){this.min=1/0,this.max=-1/0}setFromPointsField(t,e){let s=1/0,i=-1/0;for(let r=0,a=t.length;r<a;r++){const a=t[r][e];s=a<s?a:s,i=a>i?a:i}this.min=s,this.max=i}setFromPoints(t,e){let s=1/0,i=-1/0;for(let r=0,a=e.length;r<a;r++){const a=e[r],n=t.dot(a);s=n<s?n:s,i=n>i?n:i}this.min=s,this.max=i}isSeparated(t){return this.min>t.max||t.min>this.max}}ns.prototype.setFromBox=function(){const t=new J;return function(e,s){const i=s.min,r=s.max;let a=1/0,n=-1/0;for(let s=0;s<=1;s++)for(let o=0;o<=1;o++)for(let h=0;h<=1;h++){t.x=i.x*s+r.x*(1-s),t.y=i.y*o+r.y*(1-o),t.z=i.z*h+r.z*(1-h);const l=e.dot(t);a=Math.min(l,a),n=Math.max(l,n)}this.min=a,this.max=n}}();const os=function(){const t=new J,e=new J,s=new J;return function(i,r,a){const n=i.start,o=t,h=r.start,l=e;s.subVectors(n,h),t.subVectors(i.end,i.start),e.subVectors(r.end,r.start);const c=s.dot(l),u=l.dot(o),d=l.dot(l),m=s.dot(o),p=o.dot(o)*d-u*u;let f,x;f=0!==p?(c*u-m*d)/p:0,x=(c+f*u)/d,a.x=f,a.y=x}}(),hs=function(){const t=new Mt,e=new J,s=new J;return function(i,r,a,n){os(i,r,t);let o=t.x,h=t.y;if(o>=0&&o<=1&&h>=0&&h<=1)return i.at(o,a),void r.at(h,n);if(o>=0&&o<=1)return h<0?r.at(0,n):r.at(1,n),void i.closestPointToPoint(n,!0,a);if(h>=0&&h<=1)return o<0?i.at(0,a):i.at(1,a),void r.closestPointToPoint(a,!0,n);{let t,l;t=o<0?i.start:i.end,l=h<0?r.start:r.end;const c=e,u=s;return i.closestPointToPoint(l,!0,e),r.closestPointToPoint(t,!0,s),c.distanceToSquared(l)<=u.distanceToSquared(t)?(a.copy(c),void n.copy(l)):(a.copy(t),void n.copy(u))}}}(),ls=function(){const t=new J,e=new J,s=new ge,i=new as;return function(r,a){const{radius:n,center:o}=r,{a:h,b:l,c:c}=a;i.start=h,i.end=l;if(i.closestPointToPoint(o,!0,t).distanceTo(o)<=n)return!0;i.start=h,i.end=c;if(i.closestPointToPoint(o,!0,t).distanceTo(o)<=n)return!0;i.start=l,i.end=c;if(i.closestPointToPoint(o,!0,t).distanceTo(o)<=n)return!0;const u=a.getPlane(s);if(Math.abs(u.distanceToPoint(o))<=n){const t=u.projectPoint(o,e);if(a.containsPoint(t))return!0}return!1}}();function cs(t){return Math.abs(t)<1e-15}class us extends ss{constructor(...t){super(...t),this.isExtendedTriangle=!0,this.satAxes=new Array(4).fill().map((()=>new J)),this.satBounds=new Array(4).fill().map((()=>new ns)),this.points=[this.a,this.b,this.c],this.sphere=new ue,this.plane=new ge,this.needsUpdate=!0}intersectsSphere(t){return ls(t,this)}update(){const t=this.a,e=this.b,s=this.c,i=this.points,r=this.satAxes,a=this.satBounds,n=r[0],o=a[0];this.getNormal(n),o.setFromPoints(n,i);const h=r[1],l=a[1];h.subVectors(t,e),l.setFromPoints(h,i);const c=r[2],u=a[2];c.subVectors(e,s),u.setFromPoints(c,i);const d=r[3],m=a[3];d.subVectors(s,t),m.setFromPoints(d,i),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(n,t),this.needsUpdate=!1}}us.prototype.closestPointToSegment=function(){const t=new J,e=new J,s=new as;return function(i,r=null,a=null){const{start:n,end:o}=i,h=this.points;let l,c=1/0;for(let n=0;n<3;n++){const o=(n+1)%3;s.start.copy(h[n]),s.end.copy(h[o]),hs(s,i,t,e),l=t.distanceToSquared(e),l<c&&(c=l,r&&r.copy(t),a&&a.copy(e))}return this.closestPointToPoint(n,t),l=n.distanceToSquared(t),l<c&&(c=l,r&&r.copy(t),a&&a.copy(n)),this.closestPointToPoint(o,t),l=o.distanceToSquared(t),l<c&&(c=l,r&&r.copy(t),a&&a.copy(o)),Math.sqrt(c)}}(),us.prototype.intersectsTriangle=function(){const t=new us,e=new Array(3),s=new Array(3),i=new ns,r=new ns,a=new J,n=new J,o=new J,h=new J,l=new J,c=new as,u=new as,d=new as,m=new J;function p(t,e,s){const i=t.points;let r=0,a=-1;for(let t=0;t<3;t++){const{start:o,end:h}=c;o.copy(i[t]),h.copy(i[(t+1)%3]),c.delta(n);const l=cs(e.distanceToPoint(o));if(cs(e.normal.dot(n))&&l){s.copy(c),r=2;break}const u=e.intersectLine(c,m);if(!u&&l&&m.copy(o),(u||l)&&!cs(m.distanceTo(h))){if(r<=1){(1===r?s.start:s.end).copy(m),l&&(a=r)}else if(r>=2){(1===a?s.start:s.end).copy(m),r=2;break}if(r++,2===r&&-1===a)break}}return r}return function(n,c=null,m=!1){this.needsUpdate&&this.update(),n.isExtendedTriangle?n.needsUpdate&&n.update():(t.copy(n),t.update(),n=t);const f=this.plane,x=n.plane;if(Math.abs(f.normal.dot(x.normal))>1-1e-10){const t=this.satBounds,o=this.satAxes;s[0]=n.a,s[1]=n.b,s[2]=n.c;for(let e=0;e<4;e++){const r=t[e],a=o[e];if(i.setFromPoints(a,s),r.isSeparated(i))return!1}const h=n.satBounds,l=n.satAxes;e[0]=this.a,e[1]=this.b,e[2]=this.c;for(let t=0;t<4;t++){const s=h[t],r=l[t];if(i.setFromPoints(r,e),s.isSeparated(i))return!1}for(let t=0;t<4;t++){const n=o[t];for(let t=0;t<4;t++){const o=l[t];if(a.crossVectors(n,o),i.setFromPoints(a,e),r.setFromPoints(a,s),i.isSeparated(r))return!1}}return c&&(m||console.warn("ExtendedTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."),c.start.set(0,0,0),c.end.set(0,0,0)),!0}{const t=p(this,x,u);if(1===t&&n.containsPoint(u.end))return c&&(c.start.copy(u.end),c.end.copy(u.end)),!0;if(2!==t)return!1;const e=p(n,f,d);if(1===e&&this.containsPoint(d.end))return c&&(c.start.copy(d.end),c.end.copy(d.end)),!0;if(2!==e)return!1;if(u.delta(o),d.delta(h),o.dot(h)<0){let t=d.start;d.start=d.end,d.end=t}const s=u.start.dot(o),i=u.end.dot(o),r=d.start.dot(o),a=d.end.dot(o);return(s===a||r===i||i<r!==s<a)&&(c&&(l.subVectors(u.start,d.start),l.dot(o)>0?c.start.copy(u.start):c.start.copy(d.start),l.subVectors(u.end,d.end),l.dot(o)<0?c.end.copy(u.end):c.end.copy(d.end)),!0)}}}(),us.prototype.distanceToPoint=function(){const t=new J;return function(e){return this.closestPointToPoint(e,t),e.distanceTo(t)}}(),us.prototype.distanceToTriangle=function(){const t=new J,e=new J,s=["a","b","c"],i=new as,r=new as;return function(a,n=null,o=null){const h=n||o?i:null;if(this.intersectsTriangle(a,h))return(n||o)&&(n&&h.getCenter(n),o&&h.getCenter(o)),0;let l=1/0;for(let e=0;e<3;e++){let i;const r=s[e],h=a[r];this.closestPointToPoint(h,t),i=h.distanceToSquared(t),i<l&&(l=i,n&&n.copy(t),o&&o.copy(h));const c=this[r];a.closestPointToPoint(c,t),i=c.distanceToSquared(t),i<l&&(l=i,n&&n.copy(c),o&&o.copy(t))}for(let h=0;h<3;h++){const c=s[h],u=s[(h+1)%3];i.set(this[c],this[u]);for(let h=0;h<3;h++){const c=s[h],u=s[(h+1)%3];r.set(a[c],a[u]),hs(i,r,t,e);const d=t.distanceToSquared(e);d<l&&(l=d,n&&n.copy(t),o&&o.copy(e))}}return Math.sqrt(l)}}();const ds=new J,ms=new J,ps=new J;new J,new bt;const fs=new bt,xs=new bt,gs=new us,ys=2;function Ms(t,e){return e[t+6]}function bs(t,e){return e[t+14]}function ws(t,e){return 65535===e[t+15]}function vs(t){return t+8}function Ss(t,e){return e[t+6]}function Cs(t,e,s){let i=2*t;for(;!ws(i,e);)i=2*(t=vs(t));return Ms(t,s)}function _s(t,e,s){let i=2*t;for(;!ws(i,e);)i=2*(t=Ss(t,s));return Ms(t,s)+bs(i,e)}function Ts(t,e,s){return s.min.x=e[t],s.min.y=e[t+1],s.min.z=e[t+2],s.max.x=e[t+3],s.max.y=e[t+4],s.max.z=e[t+5],s}function Ds(t,e,s,i,r){let a,n,o,h,l,c;const u=1/s.direction.x,d=1/s.direction.y,m=1/s.direction.z,p=s.origin.x,f=s.origin.y,x=s.origin.z;let g=e[t],y=e[t+3],M=e[t+1],b=e[t+3+1],w=e[t+2],v=e[t+3+2];return u>=0?(a=(g-p)*u,n=(y-p)*u):(a=(y-p)*u,n=(g-p)*u),d>=0?(o=(M-f)*d,h=(b-f)*d):(o=(b-f)*d,h=(M-f)*d),!(a>h||o>n)&&((o>a||isNaN(a))&&(a=o),(h<n||isNaN(n))&&(n=h),m>=0?(l=(w-x)*m,c=(v-x)*m):(l=(v-x)*m,c=(w-x)*m),!(a>c||l>n)&&((l>a||a!=a)&&(a=l),(c<n||n!=n)&&(n=c),a<=r&&n>=i))}function Ps(t,e,s,i){const r=t.vertexes,a=t.faces;for(let t=e,n=e+s;t<n;++t){let e=a[3*t+0],s=a[3*t+1],n=a[3*t+2],o=r[3*e+0],h=r[3*e+1],l=r[3*e+2],c=r[3*s+0],u=r[3*s+1],d=r[3*s+2],m=r[3*n+0],p=r[3*n+1],f=r[3*n+2];if(gs.a.set(o,h,l),gs.b.set(c,u,d),gs.c.set(m,p,f),gs.needsUpdate=!0,i(gs))return!0}return!1}function zs(t,e){const s=[];return function t(e,s,i,r){const a=s.bvh_f32,n=s.bvh_u16,o=s.bvh_u32,h=2*e;if(ws(h,n)){!function(t,e,s,i,r,a=!0){const n=t.vertexes,o=t.faces;for(let t=s,h=s+i;t<h;++t){let s=o[3*t+0],i=o[3*t+1],h=o[3*t+2],l=n[3*s+0],c=n[3*s+1],u=n[3*s+2],d=n[3*i+0],m=n[3*i+1],p=n[3*i+2],f=n[3*h+0],x=n[3*h+1],g=n[3*h+2];ds.set(l,c,u),ms.set(d,m,p),ps.set(f,x,g);const y=e.intersectTriangle(ds,ms,ps,!1);y&&(a&&(e.length=y.distance),r.push(y))}}(s,i,Ms(e,o),bs(h,n),r)}else{const n=vs(e);Ds(n,a,i,0,i.length)&&t(n,s,i,r);const h=Ss(e,o);Ds(h,a,i,0,i.length)&&t(h,s,i,r)}}(0,t,e,s),0==s.length?null:s[s.length-1]}function As(t,e,s){return function t(e,s,i,r){const a=s.bvh_f32,n=s.bvh_u16,o=s.bvh_u32;let h=2*e;if(ws(h,n)){return Ps(s,Ms(e,o),bs(h,n),r)}{let n,h=vs(e),l=Ss(e,o),c=fs;Ts(h,a,c);const u=i(c);if(u===ys){const t=Cs(h);n=Ps(s,t,_s(h)-t,r)}else n=u&&t(h,s,i,r);if(n)return!0;let d,m=xs;Ts(l,a,m);const p=i(m);if(p===ys){const t=Cs(l);d=Ps(s,t,_s(l)-t,r)}else d=p&&t(l,s,i,r);return!!d}}(0,t,e,s)}function Es(t,e){return As(t,(t=>e.intersectsBox(t)),(t=>t.intersectsSphere(e)))}function Is(t,e){const s=new bt;e.calAABB(s);const i=e.radius,r=new as(e.start.clone(),e.end.clone());let a=!1,n=new J(0,0,0);const o=new J,h=new J;return As(t,(t=>t.intersectsBox(s)),(t=>{const e=t.closestPointToSegment(r,o,h);if(e<i){const t=i-e;let s=h.sub(o).normalize();r.start.addScaledVector(s,t),r.end.addScaledVector(s,t),a=!0}return!1})),a&&n.copy(r.start).sub(e.start),{hit:a,delta:n}}let Fs=class e extends lt{static GlobalID=0;#m=!1;#y;#ss;#qt;#Ai;#es;#P;#z;#Ei;#Ht;#Ii;#Lt;#N;#Fi;#Ri=[];#ki=[];#Ni=new Ue;#Jt=!1;#Bi=!1;#Li=!0;#qi;constructor(t){super(),this.#y=e.GlobalID++,this.#N=t,this.#N.renderID=this.#y,this.#es=this.#N.lccParam,this.#qt=this.#N.cameraMgr,this.#P=this.#N.cpuCache,this.#z=this.#N.gpuCache,this.#Ei=this.#N.collCache,this.#Ht=this.#N.dataLoader,this.#Lt=this.#N.config,this.#ss=this.#N.lccParam.renderLib,this.#Ai=new Se(this.#N,this.#qt,this.#Ht),this.#Ii=new He(this.#N),this.#Fi=new this.#ss.Group}get id(){return this.#y}get distanceToCam(){if(!this.#Jt)return 1e6;return this.#Ai.center.distanceToSquared(this.#N.dynamicState.cmrPosLocal)}get root(){return this.#Fi}get maxLoadSplatCount(){return this.#Lt.maxLoadSplatCount}set maxLoadSplatCount(t){console.log("set max splats: "+t),this.#Lt.maxLoadSplatCount=t,this.#Ai.setConfigDirty()}dispose(){this.#m=!0,this.#Fi.clear(),this.#Ii.dispose();const t=[],e=[];this.#Ai.getAllNodeID(t),this.#Ai.getAllCollID(e),this.#Ai.dispose(),this.#P.clear(this.id,t),this.#z.clear(this.id,t),this.#Ei?.clear(this.id,e)}getInstancedMesh(){return this.#Fi}getEnvInstancedMesh(){return this.#Fi}togglePointsDisplayMode(){this.#Lt.pointsOnly=!this.#Lt.pointsOnly}useEnvironment(t){this.#Lt.useEnv=!!t,this.#Ai.setConfigDirty()}useShcoef(t,e){this.#Lt.useSH=!!t,this.#Ai.setConfigDirty(),this.#Jt?t&&this.#Li&&(this.#Li=!1,this.#Ai.loadSH((()=>{}),(t=>{e&&e(t)}),(()=>{console.error("load sh failed...")}))):console.error("meta is not ready")}hasShcoef(){return!!this.#Jt&&this.#Ai.hasSH}hasCollision(){return!!this.#Jt&&this.#Ai.hasColl}getBounds(){if(!this.#Jt)return null;let t=this.#Ai.bbox;if(!t)return null;let e=t.min,s=t.max;return{min:{x:e.x,y:e.y,z:e.z},max:{x:s.x,y:s.y,z:s.z}}}setVisible(t){this.#Lt.visible=!!t}setAlpha(t){st(t)?console.error("set failed !!!"):(t=Y.clamp(t,0,1),this.#Lt.alpha=t)}setClipBox(t){if(!(t&&t.scale&&t.rotation&&t.position))return void console.error("set failed !!!");const e=t.clipSide||1,s=at("scale",t),i=at("rotation",t),r=at("position",t);s&&i&&r?this.#Ni.update(r,i,s,e):console.error("set failed !!!")}setClipPlane(t,e){Array.isArray(t)&&"number"==typeof e?this.#N.dynamicState.clipPlane.set(t[0],t[1],t[2],e):console.error("setClipPlane failed: param error")}setStartLod(t){st(t)||t<0?console.error("set failed !!!"):(this.#Lt.MinLodUsed=t,this.#Ai.setConfigDirty())}setMaxDistance(t){st(t)||t<0?console.error("set failed !!!"):(this.#Lt.MaxDistaneLimit=t,this.#Ai.setConfigDirty())}setMaxSplats(t){st(t)||t<0?console.error("set failed !!!"):(console.log("set max splats: "+t),this.#Lt.maxLoadSplatCount=t,this.#Ai.setConfigDirty())}getCurrentConfig(){return this.#Lt.getUserConfig()}updateCurrentConfig(t){this.#Lt.setUserConfig(t),this.#Ai.setConfigDirty()}_paramToRay(t){const e=this.#qt.projectionMatrix.clone().invert(),s=nt(this.#es.canvas,t.evt);s.applyMatrix4(e).applyMatrix4(this.#qt.cam2WorldMatrix);const i=this.#qt.position.clone(),r=s.sub(i).normalize();return new Fe(i,r,t.maxDistance)}_paramToRayFromOrigin(t){const e=new J(t.origin.x,t.origin.y,t.origin.z),s=new J(t.direction.x,t.direction.y,t.direction.z).normalize();return new Fe(e,s,t.maxDistance)}#Hi(t){const e=this.#qt.projectionMatrix.clone().invert(),s=nt(this.#es.canvas,t.evt);s.applyMatrix4(e).applyMatrix4(this.#qt.cam2WorldMatrix);const i=this.#qt.position.clone(),r=s.sub(i).normalize();return new Fe(i,r,t.maxDistance).applyMatrix4((new Jt).copy(this.#Fi.matrixWorld).invert()).intersectBox(this.#Ai.bbox)}#Ui(t){const e=new J(t.origin.x,t.origin.y,t.origin.z),s=new J(t.direction.x,t.direction.y,t.direction.z).normalize();return new Fe(e,s,t.maxDistance).applyMatrix4((new Jt).copy(this.#Fi.matrixWorld).invert()).intersectBox(this.#Ai.bbox)}raycast(t){if(this.#m)return console.error("The renderer had been dispose !!!"),null;if(!t||!t.evt||st(t.evt.x)||st(t.evt.y)||st(t.maxDistance)||st(t.radius))return null;if(t.maxDistance<0||t.radius<0)return null;const e=this.#qt.projectionMatrix.clone().invert(),s=nt(this.#es.canvas,t.evt);s.applyMatrix4(e).applyMatrix4(this.#qt.cam2WorldMatrix);const i=this.#qt.position.clone(),r=s.sub(i).normalize();return this.raycastFromOrigin({origin:{x:i.x,y:i.y,z:i.z},direction:{x:r.x,y:r.y,z:r.z},maxDistance:t.maxDistance,radius:t.radius})}raycastFromOrigin(t){if(this.#m)return console.error("The renderer had been dispose !!!"),null;if(!t||!t.origin||!t.direction||st(t.maxDistance)||st(t.radius))return null;if(st(t.origin.x)||st(t.origin.y)||st(t.origin.z))return null;if(st(t.direction.x)||st(t.direction.y)||st(t.direction.z))return null;if(t.maxDistance<0||t.radius<0)return null;const e=new J(t.origin.x,t.origin.y,t.origin.z),s=new J(t.direction.x,t.direction.y,t.direction.z).normalize(),i=new Fe(e,s,t.maxDistance).applyMatrix4((new Jt).copy(this.#Fi.matrixWorld).invert()),r=t.radius;let a=[];this.#Ri.forEach((t=>{if(t.isEnvMesh)return;const e=t.getBBox(),s=i.intersectBox(e);s&&a.push({mesh:t,distance:s.distance})})),a.sort(((t,e)=>t.distance-e.distance));for(let t=0;t<a.length;++t){let e=a[t].mesh.intersectWithRay(i,r);if(e){const t=e.point;return t.applyMatrix4(this.#Fi.matrixWorld),{x:t.x,y:t.y,z:t.z}}}return null}intersectsRay(t){if(this.#m)return console.error("The renderer had been dispose !!!"),null;if(!t||!t.evt||st(t.evt.x)||st(t.evt.y)||st(t.maxDistance))return null;if(t.maxDistance<0)return null;if(!this.hasCollision())return null;const e=this.#qt.projectionMatrix.clone().invert(),s=nt(this.#es.canvas,t.evt);s.applyMatrix4(e).applyMatrix4(this.#qt.cam2WorldMatrix);const i=this.#qt.position.clone(),r=s.sub(i).normalize();return this.intersectsRayFromOrigin({origin:{x:i.x,y:i.y,z:i.z},direction:{x:r.x,y:r.y,z:r.z},maxDistance:t.maxDistance})}intersectsRayFromOrigin(t){if(this.#m)return console.error("The renderer had been dispose !!!"),null;if(!t||!t.origin||!t.direction||st(t.maxDistance))return null;if(st(t.origin.x)||st(t.origin.y)||st(t.origin.z))return null;if(st(t.direction.x)||st(t.direction.y)||st(t.direction.z))return null;if(t.maxDistance<0)return null;if(!this.hasCollision())return null;const e=new J(t.origin.x,t.origin.y,t.origin.z),s=new J(t.direction.x,t.direction.y,t.direction.z).normalize(),i=new Fe(e,s,t.maxDistance).applyMatrix4((new Jt).copy(this.#Fi.matrixWorld).invert());let r,a=i.origin;r=i.length===1/0?i.origin.clone().addScaledVector(i.direction,1e5):i.origin.clone().addScaledVector(i.direction,i.length);const n=(new bt).setFromPoints([a,r]),o=this.#Ai.getUnitsFromBBox(n.min,n.max);let h=[];for(let t=0;t<o.length;++t){const e=o[t];if(!e||!e.coll)continue;const s=e.coll.queryCacheData();if(!s)continue;const r=i.intersectBox(e.getBBox());r&&h.push({ccd:s,distance:r.distance})}h.sort(((t,e)=>t.distance-e.distance));for(let t=0;t<h.length;++t){const e=zs(h[t].ccd,i);if(!e)continue;const s=e.point;return s.applyMatrix4(this.#Fi.matrixWorld),{x:s.x,y:s.y,z:s.z}}return null}intersectsSphere(t){let e={hit:!1};if(this.#m)return console.error("The renderer had been dispose !!!"),e;if(!t||!t.center||st(t.radius))return e;if(st(t.center.x)||st(t.center.y)||st(t.center.z))return e;if(!this.hasCollision())return e;const s=new J(t.center.x,t.center.y,t.center.z).applyMatrix4((new Jt).copy(this.#Fi.matrixWorld).invert()),i=new ue(s,t.radius),r=new bt;i.getBoundingBox(r);const a=this.#Ai.getUnitsFromBBox(r.min,r.max);let n=[];for(let t=0;t<a.length;++t){const e=a[t];if(!e||!e.coll)continue;const s=e.coll.queryCacheData();s&&n.push(s)}for(let t=0;t<n.length;++t){if(Es(n[t],i))return{hit:!0}}return e}intersectsCapsule(t){let e={hit:!1,delta:{x:0,y:0,z:0}};if(this.#m)return console.error("The renderer had been dispose !!!"),e;if(!t||!t.start||!t.end||st(t.radius))return e;if(st(t.start.x)||st(t.start.y)||st(t.start.z))return e;if(st(t.end.x)||st(t.end.y)||st(t.end.z))return e;if(!this.hasCollision())return e;const s=(new Jt).copy(this.#Fi.matrixWorld).invert(),i=new J(t.start.x,t.start.y,t.start.z).applyMatrix4(s),r=new J(t.end.x,t.end.y,t.end.z).applyMatrix4(s),a=new Oe(i,r,t.radius),n=new bt;a.calAABB(n);const o=this.#Ai.getUnitsFromBBox(n.min,n.max);let h=[];for(let t=0;t<o.length;++t){const e=o[t];if(!e||!e.coll)continue;const s=e.coll.queryCacheData();s&&h.push(s)}let l=!1,c=new J(0,0,0);for(let t=0;t<h.length;++t){const e=h[t],{hit:s,delta:i}=Is(e,a);s&&(l=!0,c.add(i),a.translate(i))}return l&&c.transformDirectionWithoutNormlize(this.#Fi.matrixWorld),e.hit=l,e.delta={x:c.x,y:c.y,z:c.z},e}#Oi(t){const e=this.#es.canvas,s=this.#N.dynamicState,i=e.width,r=e.height,a=this.#qt.fov,n=this.#qt.projectionMatrix,o=this.#qt.cam2WorldMatrix,h=(new Jt).copy(this.#Fi.matrixWorld).invert(),c=(new Jt).multiplyMatrices(h,o),u=this.#qt.position,d=new J(0,0,-1).applyMatrix4(o),m=this.#qt.position.clone().applyMatrix4(h);let p=new be;p.setFromProjectionMatrix(n),p.planes.forEach((t=>{t.applyMatrix4(c)})),s.frustum=p,s.focal=r/2/Math.tan(a/2/180*Math.PI),s.viewport.x=i,s.viewport.y=r,s.cmrPos.copy(u),s.cmrForward.copy(d),s.cmrPosLocal.copy(m),s.cmrProjMatrix.copy(n),s.cmr2LocalMatrix.copy(c),s.cmrPosModelLocal.copy(m),s.cmr2ModelLocalMatrix.copy(c),s.alpha=this.#Lt.alpha,s.visible=this.#Lt.visible,s.useEnv=this.#Lt.useEnv,s.useSH=this.#Lt.useSH,s.pointsOnly=this.#Lt.pointsOnly,s.useCustomColor=!(this.#Lt.pointsColor!==l),s.clipBoxSide=this.#Ni.clipSide,s.clipBoxMatrixInv.copy(this.#Ni.matrixInverse),s.tick=t}load(t,e,s,i){this.#Ai.load(t,(t=>{this.#Jt=!0}),(()=>{console.log("loading ready ..."),this.#Bi=!0;const t=this.getInstancedMesh();e&&e(t)}),(t=>{s&&s(t)}),(()=>{i&&i()}),(t=>{if(!t)return!0;if(t.isColl)return!!t.isCacheData();if(t.isNode){let e=this.#z.queryMesh(t.renderID,t.id);return!(!e||!e.isFirstSorted)}return console.error("unknow chunk...(render)"),!0}))}update(t){if(this.#Ri=[],this.#ki=[],this.#Fi.clear(),this.#Fi.updateMatrixWorld(!0),this.#Oi(t),this.#Ii.clearCacheQueue(),this.#Ii.clearCacheSHQueue(),this.#Ii.clearSortQueue(),this.#Ii.clearCacheCollQueue(),this.#Ai.update(t),!this.#Jt)return;const e=this.#Ai.getRenderNodes();this.#Vi(e),this.#Gi(),this.#ji(),this.#Wi(),this.#Ri.forEach(((t,e,s)=>{t.updateUniformsDynamic(),this.#Lt.useSH&&!t.hasUploadSH&&this.#Ii.pushCacheSHQueue(t),t.object.renderOrder=-e-1,this.#Fi.add(t.object)})),this.#ki.forEach(((t,e,s)=>{this.#Fi.add(t)})),this.#Fi.visible=this.#N.dynamicState.visible,this.#Ii.update(t),this.#Qi()}#Vi(e){if(0!=e.length)for(let s=0;s<e.length;++s){const i=e[s];if(!i)continue;const r=i.parent,a=i.level,n=r.nodes.length;let o,h=this.#z.queryMesh(i.renderID,i.id);if(h){if(!h.checkNeedSort()){this.#Ri.push(h);continue}this.#Ii.pushSortQueue(h)}else i.isCache(t)&&this.#Ii.pushCacheQueue(i);let l,c,u=0;for(let t=a;t<n;++t){const e=r.nodes[t];if(!e||e.points<this.#Lt.MinValidSplatsInNode)continue;let s=this.#z.queryMesh(e.renderID,e.id);if(!s||!s.isFirstSorted)continue;const i=s.sortTickLast;i>u&&(u=i,o=s)}if(o)this.#Ri.push(o);else{for(let t=a;t<n;++t){const e=r.nodes[t];if(!e||e.points<this.#Lt.MinValidSplatsInNode)continue;let s=this.#z.queryMesh(e.renderID,e.id);if(s){l=s;break}}if(l&&l!==h)this.#Ii.pushSortQueue(l);else{for(let e=a;e<n;++e){const s=r.nodes[e];if(s&&!(s.points<this.#Lt.MinValidSplatsInNode)&&s.isCache(t)){c=s;break}}c&&c!==i&&this.#Ii.pushCacheQueue(c)}}}}#Gi(){const t=this.#Ii.getEnvmesh();if(this.#N.dynamicState.useEnv)if(t)this.#Bi&&this.#Ri.push(t),t.checkNeedSort()&&this.#Ii.pushSortQueue(t);else{const t=this.#Ii.getEnvmesh(!1);t&&this.#Ii.pushSortQueue(t)}}#ji(){if(this.#Bi)return;const e=this.#Ai.getLoadingNodes();for(let s=0;s<e.length;++s){const i=e[s];if(!i)continue;let r=this.#z.queryMesh(i.renderID,i.id);!r&&i.isCache(t)?this.#Ii.pushCacheQueue(i):r&&!r.isFirstSorted&&this.#Ii.pushSortQueue(r)}}#Wi(){const t=this.#Ai.getRenderColls();for(let e=0;e<t.length;++e){const s=t[e],i=s.queryCacheMesh();i?this.#ki.push(i):s.isCacheData()&&this.#Ii.pushCacheCollQueue(s)}}#Qi(){let t=0,e=0,s=1e9;this.#Ri.forEach((i=>{t+=i.splatCount,e=Math.max(e,i.splatCount),s=Math.min(s,i.splatCount)}));const i=this.#N.performance;i.totalPoints=t,i.maxPoints=e,i.minPoints=s,i.meshNum=this.#Ri.length;const r=this.#N.dynamicState.tick;void 0===this.#qi&&(this.#qi=r),r-this.#qi>2e3&&(this.#qi=r)}};function Rs(t){const e=0,s=2,i=t.data.index,r=t.data.type,a=t.data.buffer;if(r==e){const{pos:t}=(t=>{const e=t.byteLength/32,s=new Uint32Array(t),i=new Uint32Array(3*e);for(let t=0;t<e;++t)i[3*t+0]=s[8*t+0],i[3*t+1]=s[8*t+1],i[3*t+2]=s[8*t+2];return{pos:i}})(a);postMessage({index:i,dataBuffer:a,posBuffer:t.buffer},[a,t.buffer])}else if(r==s){const{pos:t,sh:e,data:s}=(t=>{const e=24,s=t.byteLength/96,i=new Uint32Array(t),r=new Uint32Array(3*s),a=new Uint32Array(8*s),n=new Uint32Array(16*s);for(let t=0;t<s;++t){r[3*t+0]=i[t*e+0],r[3*t+1]=i[t*e+1],r[3*t+2]=i[t*e+2];for(let s=0;s<8;++s)a[8*t+s]=i[t*e+s];for(let s=0;s<16;++s)n[16*t+s]=i[t*e+8+s]}return{pos:r,sh:n,data:a}})(a);postMessage({index:i,dataBuffer:s.buffer,posBuffer:t.buffer,shBuffer:e.buffer},[s.buffer,t.buffer,e.buffer])}else console.error("unkonw type......")}let ks=class{type;buffer;size;meta;callback},Ns=class extends Vt{#m=!1;#tt=0;#et=[];#st=[];#it=[];#rt=0;#at=!0;constructor(e=4){super();for(let t=0;t<e;++t){const t=Ut(Rs);t?(this.#et.push(t),this.#tt++):console.error("create worker failed !!!")}this.#et.forEach((e=>{e.onmessage=e=>{if(this.#m)return;const i=e.data.index,r=this.#it[i];if(r.type===t){const t=new Uint32Array(e.data.dataBuffer),s=new Float32Array(e.data.posBuffer);r.callback(t,s,void 0)}else if(r.type===s){const t=new Uint32Array(e.data.dataBuffer),s=new Float32Array(e.data.posBuffer),i=new Uint32Array(e.data.shBuffer);r.callback(t,s,i)}this.#rt++,this.#rt>=this.#it.length&&(this.#at=!0)}}))}dispose(){this.#m=!0,this.#et.forEach((t=>{t.terminate()})),this.#et=[],this.#tt=0,this.#at=!1}#nt(){if(!this.#at||0==this.#st.length||0==this.#tt)return;this.#at=!1,this.#it=this.#st,this.#st=[],this.#rt=0;const t=this.#it.length;for(let e=0;e<t;++e){const t=e%this.#tt,s=this.#et[t],i=this.#it[e];s.postMessage({index:e,type:i.type,buffer:i.buffer},[i.buffer])}}update(t){this.#m||this.#nt()}decompress(e,i,r,a,n){if(e!==t&&e!==s)return console.error("unkonw type: "+e),!1;let o=new ks;return o.type=e,o.buffer=i,o.size=r,o.meta=a,o.callback=n,this.#st.push(o),this.#at&&this.#nt(),!0}},Bs=class extends Yt{#m=!1;#Xi;#es;#qt;#P;#z;#Ei;#Ht;#ht;#lt;#Yi=[];#ms;#Fi;#Zi;constructor(t,e){super(),this.#Xi=t,this.#es=e,this.#Zi=new ot(t),this.#ms=new Pe(e),this.#qt=new oe(e),this.#P=new dt(this.#Zi.MaxCPUCacheSize,void 0),this.#z=new kt(this.#Zi.MaxGPUCacheSize,((t,e,s)=>{e?.dispose()})),this.#Ei=new Nt(this.#Zi.MaxCPUCollCacheSize,void 0,this.#Zi.MaxGPUCollCacheSize,((t,e,s)=>{e?.dispose()})),this.#ht=new Ns(this.#Zi.DecompressThreadNum),this.#lt=new Wt(this.#Zi.CollBuildThreadNum),this.#Ht=new Xt(this.#P,this.#lt,this.#ht,!0),this.#Fi=new this.#es.renderLib.Group,this.#Fi.renderOrder=0,this.#es.scene.add(this.#Fi)}get isDispose(){return this.#m}dispose(){this.#m||(this.#m=!0,this.#es.scene.remove(this.#Fi),this.#Yi.forEach((t=>{t.dispose()})),this.#Yi=[],this.#Ht.dispose(),this.#ht.dispose(),this.#lt.dispose(),this.#z.dispose(),this.#P.dispose(),this.#Ei.dispose(),this.#qt.dispose(),this.#ms.dispose())}update(t){if(this.#qt.update(t),this.#P.update(t),this.#z.update(t),this.#Ei.update(t),this.#Ht.update(t),this.#ht.update?.(t),this.#lt.update(t),this.#Yi.forEach((e=>{e.update(t)})),this.#Yi.length>1){const t=this.#Yi.map(((t,e)=>e));t.sort(((t,e)=>this.#Yi[e].distanceToCam-this.#Yi[t].distanceToCam));let e=this.#Yi[t[0]].root.children.length;for(let s=1;s<t.length;++s){const i=t[s];this.#Yi[i].root.children.forEach(((t,s,i)=>{t.renderOrder-=e})),e+=this.#Yi[i].root.children.length}}}createRenderer(){let t=new ht(this.#Xi);t.useEnv=this.#es.useEnv,t.gpuAcceleration=this.#es.gpuAcceleration,t.pointsColor=this.#es.pointsColor;let e=new we;e.config=t,e.configCommon=this.#Zi,e.lccParam=this.#es,e.cpuCache=this.#P,e.gpuCache=this.#z,e.collCache=this.#Ei,e.dataLoader=this.#Ht,e.resources=this.#ms,e.cameraMgr=this.#qt,e.platform=this.#Xi;let s=new Fs(e);return this.#Yi.push(s),this.#Fi.add(s.root),s}destroyRenderer(t){this.#Yi.indexOf(t)<0||(this.#Fi.remove(t?.root),this.#Yi=this.#Yi.filter((e=>e!==t)),t?.dispose())}getAllRenderers(){return this.#Yi}raycast(t){if(0==this.#Yi.length)return null;if(1==this.#Yi.length)return this.#Yi[0].raycast(t);const e=[];return this.#Yi.forEach(((s,i,r)=>{let a=s._paramToRay(t),n=s.raycast(t);if(n){let t=a.origin.distanceToSquared(new J(n.x,n.y,n.z));e.push({intersect:n,distance:t,renderIndex:i})}})),e.sort(((t,e)=>t.distance-e.distance)),e.length>0?e[0].intersect:null}raycastFromOrigin(t){if(0==this.#Yi.length)return null;if(1==this.#Yi.length)return this.#Yi[0].raycastFromOrigin(t);const e=[];return this.#Yi.forEach(((s,i,r)=>{let a=s._paramToRayFromOrigin(t),n=s.raycastFromOrigin(t);if(n){let t=a.origin.distanceToSquared(new J(n.x,n.y,n.z));e.push({intersect:n,distance:t,renderIndex:i})}})),e.sort(((t,e)=>t.distance-e.distance)),e.length>0?e[0].intersect:null}};class Ls extends ne{#Tt;#Dt;#Pt;#zt;#At;#Et;#It;#Ft=!1;#Di=new J;#zi=new Z;#Ki=new Jt;#Ji=new Jt;constructor(t){super(),this.#Tt=t.camera,this.#Dt=t.canvas,this.#Pt=this.fov,this.#zt=this.#Dt.width,this.#At=this.#Dt.height,this.#Et=this.position.clone(),this.#It=this.rotation.clone()}get isCameraChanged(){return this.#Ft}get fov(){return 180*this.#Tt.frustum.fov/Math.PI}get fovy(){return 180*this.#Tt.frustum.fovy/Math.PI}get position(){return this.#Di.copy(this.#Tt.positionWC)}get projectionMatrix(){return this.#Ki.fromCesiumMatrix4(this.#Tt.frustum.projectionMatrix)}get rotation(){return this.#zi.fromCesiumMatrix4(this.#Tt.inverseViewMatrix)}get cam2WorldMatrix(){return this.#Ji.fromCesiumMatrix4(this.#Tt.inverseViewMatrix)}_update(t){let e=this.position,s=this.rotation,i=this.fov,r=this.#Dt.width,a=this.#Dt.height;this.#Ft=!1,i!=this.#Pt&&(this.#Pt=i,this.#Ft=!0),r==this.#zt&&a==this.#At||(this.#zt=r,this.#At=a,this.#Ft=!0),e.equals(this.#Et)||(this.#Et.copy(e),this.#Ft=!0),s.equals(this.#It)||(this.#It.copy(s),this.#Ft=!0)}_dispose(){}}function qs(t){var e=1,s=2,i=3,r=5,a=6378137,n=6356752.314,o=.0066943799901413165,h=484813681109536e-20,l=Math.PI/2,c=.16666666666666666,u=.04722222222222222,d=.022156084656084655,m=1e-10,p=.017453292519943295,f=57.29577951308232,x=Math.PI/4,g=2*Math.PI,y=3.14159265359,M={greenwich:0,lisbon:-9.131906111111,paris:2.337229166667,bogota:-74.080916666667,madrid:-3.687938888889,rome:12.452333333333,bern:7.439583333333,jakarta:106.807719444444,ferro:-17.666666666667,brussels:4.367975,stockholm:18.058277777778,athens:23.7163375,oslo:10.722916666667},b={ft:{to_meter:.3048},"us-ft":{to_meter:1200/3937}},w=/[\s_\-\/\(\)]/g;function v(t,e){if(t[e])return t[e];for(var s,i=Object.keys(t),r=e.toLowerCase().replace(w,""),a=-1;++a<i.length;)if((s=i[a]).toLowerCase().replace(w,"")===r)return t[s]}function S(t){var e,s,i,r={},a=t.split("+").map((function(t){return t.trim()})).filter((function(t){return t})).reduce((function(t,e){var s=e.split("=");return s.push(!0),t[s[0].toLowerCase()]=s[1],t}),{}),n={proj:"projName",datum:"datumCode",rf:function(t){r.rf=parseFloat(t)},lat_0:function(t){r.lat0=t*p},lat_1:function(t){r.lat1=t*p},lat_2:function(t){r.lat2=t*p},lat_ts:function(t){r.lat_ts=t*p},lon_0:function(t){r.long0=t*p},lon_1:function(t){r.long1=t*p},lon_2:function(t){r.long2=t*p},alpha:function(t){r.alpha=parseFloat(t)*p},gamma:function(t){r.rectified_grid_angle=parseFloat(t)},lonc:function(t){r.longc=t*p},x_0:function(t){r.x0=parseFloat(t)},y_0:function(t){r.y0=parseFloat(t)},k_0:function(t){r.k0=parseFloat(t)},k:function(t){r.k0=parseFloat(t)},a:function(t){r.a=parseFloat(t)},b:function(t){r.b=parseFloat(t)},r:function(t){r.a=r.b=parseFloat(t)},r_a:function(){r.R_A=!0},zone:function(t){r.zone=parseInt(t,10)},south:function(){r.utmSouth=!0},towgs84:function(t){r.datum_params=t.split(",").map((function(t){return parseFloat(t)}))},to_meter:function(t){r.to_meter=parseFloat(t)},units:function(t){r.units=t;var e=v(b,t);e&&(r.to_meter=e.to_meter)},from_greenwich:function(t){r.from_greenwich=t*p},pm:function(t){var e=v(M,t);r.from_greenwich=(e||parseFloat(t))*p},nadgrids:function(t){"@null"===t?r.datumCode="none":r.nadgrids=t},axis:function(t){var e="ewnsud";3===t.length&&-1!==e.indexOf(t.substr(0,1))&&-1!==e.indexOf(t.substr(1,1))&&-1!==e.indexOf(t.substr(2,1))&&(r.axis=t)},approx:function(){r.approx=!0}};for(e in a)s=a[e],e in n?"function"==typeof(i=n[e])?i(s):r[i]=s:r[e]=s;return"string"==typeof r.datumCode&&"WGS84"!==r.datumCode&&(r.datumCode=r.datumCode.toLowerCase()),r}var C=function(t){return new E(t).output()},_=1,T=/\s/,D=/[A-Za-z]/,P=/[A-Za-z84_]/,z=/[,\]]/,A=/[\d\.E\-\+]/;function E(t){if("string"!=typeof t)throw new Error("not a string");this.text=t.trim(),this.level=0,this.place=0,this.root=null,this.stack=[],this.currentObject=null,this.state=_}function I(t,e,s){Array.isArray(e)&&(s.unshift(e),e=null);var i=e?{}:t,r=s.reduce((function(t,e){return F(e,t),t}),i);e&&(t[e]=r)}function F(t,e){if(Array.isArray(t)){var s=t.shift();if("PARAMETER"===s&&(s=t.shift()),1===t.length)return Array.isArray(t[0])?(e[s]={},void F(t[0],e[s])):void(e[s]=t[0]);if(t.length)if("TOWGS84"!==s){if("AXIS"===s)return s in e||(e[s]=[]),void e[s].push(t);var i;switch(Array.isArray(s)||(e[s]={}),s){case"UNIT":case"PRIMEM":case"VERT_DATUM":return e[s]={name:t[0].toLowerCase(),convert:t[1]},void(3===t.length&&F(t[2],e[s]));case"SPHEROID":case"ELLIPSOID":return e[s]={name:t[0],a:t[1],rf:t[2]},void(4===t.length&&F(t[3],e[s]));case"PROJECTEDCRS":case"PROJCRS":case"GEOGCS":case"GEOCCS":case"PROJCS":case"LOCAL_CS":case"GEODCRS":case"GEODETICCRS":case"GEODETICDATUM":case"EDATUM":case"ENGINEERINGDATUM":case"VERT_CS":case"VERTCRS":case"VERTICALCRS":case"COMPD_CS":case"COMPOUNDCRS":case"ENGINEERINGCRS":case"ENGCRS":case"FITTED_CS":case"LOCAL_DATUM":case"DATUM":return t[0]=["name",t[0]],void I(e,s,t);default:for(i=-1;++i<t.length;)if(!Array.isArray(t[i]))return F(t,e[s]);return I(e,s,t)}}else e[s]=t;else e[s]=!0}else e[t]=!0}E.prototype.readCharicter=function(){var t=this.text[this.place++];if(4!==this.state)for(;T.test(t);){if(this.place>=this.text.length)return;t=this.text[this.place++]}switch(this.state){case _:return this.neutral(t);case 2:return this.keyword(t);case 4:return this.quoted(t);case 5:return this.afterquote(t);case 3:return this.number(t);case-1:return}},E.prototype.afterquote=function(t){if('"'===t)return this.word+='"',void(this.state=4);if(z.test(t))return this.word=this.word.trim(),void this.afterItem(t);throw new Error("havn't handled \""+t+'" in afterquote yet, index '+this.place)},E.prototype.afterItem=function(t){return","===t?(null!==this.word&&this.currentObject.push(this.word),this.word=null,void(this.state=_)):"]"===t?(this.level--,null!==this.word&&(this.currentObject.push(this.word),this.word=null),this.state=_,this.currentObject=this.stack.pop(),void(this.currentObject||(this.state=-1))):void 0},E.prototype.number=function(t){if(!A.test(t)){if(z.test(t))return this.word=parseFloat(this.word),void this.afterItem(t);throw new Error("havn't handled \""+t+'" in number yet, index '+this.place)}this.word+=t},E.prototype.quoted=function(t){'"'!==t?this.word+=t:this.state=5},E.prototype.keyword=function(t){if(P.test(t))this.word+=t;else{if("["===t){var e=[];return e.push(this.word),this.level++,null===this.root?this.root=e:this.currentObject.push(e),this.stack.push(this.currentObject),this.currentObject=e,void(this.state=_)}if(!z.test(t))throw new Error("havn't handled \""+t+'" in keyword yet, index '+this.place);this.afterItem(t)}},E.prototype.neutral=function(t){if(D.test(t))return this.word=t,void(this.state=2);if('"'===t)return this.word="",void(this.state=4);if(A.test(t))return this.word=t,void(this.state=3);if(!z.test(t))throw new Error("havn't handled \""+t+'" in neutral yet, index '+this.place);this.afterItem(t)},E.prototype.output=function(){for(;this.place<this.text.length;)this.readCharicter();if(-1===this.state)return this.root;throw new Error('unable to parse string "'+this.text+'". State is '+this.state)};var R,k=.017453292519943295;function N(t){return t*k}function B(t){var e=C(t),s=e.shift(),i=e.shift();e.unshift(["name",i]),e.unshift(["type",s]);var r={};return F(e,r),function(t){if("GEOGCS"===t.type?t.projName="longlat":"LOCAL_CS"===t.type?(t.projName="identity",t.local=!0):"object"==typeof t.PROJECTION?t.projName=Object.keys(t.PROJECTION)[0]:t.projName=t.PROJECTION,t.AXIS){for(var e="",s=0,i=t.AXIS.length;s<i;++s){var r=[t.AXIS[s][0].toLowerCase(),t.AXIS[s][1].toLowerCase()];-1!==r[0].indexOf("north")||("y"===r[0]||"lat"===r[0])&&"north"===r[1]?e+="n":-1!==r[0].indexOf("south")||("y"===r[0]||"lat"===r[0])&&"south"===r[1]?e+="s":-1!==r[0].indexOf("east")||("x"===r[0]||"lon"===r[0])&&"east"===r[1]?e+="e":-1===r[0].indexOf("west")&&("x"!==r[0]&&"lon"!==r[0]||"west"!==r[1])||(e+="w")}2===e.length&&(e+="u"),3===e.length&&(t.axis=e)}t.UNIT&&(t.units=t.UNIT.name.toLowerCase(),"metre"===t.units&&(t.units="meter"),t.UNIT.convert&&("GEOGCS"===t.type?t.DATUM&&t.DATUM.SPHEROID&&(t.to_meter=t.UNIT.convert*t.DATUM.SPHEROID.a):t.to_meter=t.UNIT.convert));var a=t.GEOGCS;function n(e){return e*(t.to_meter||1)}"GEOGCS"===t.type&&(a=t),a&&(a.DATUM?t.datumCode=a.DATUM.name.toLowerCase():t.datumCode=a.name.toLowerCase(),"d_"===t.datumCode.slice(0,2)&&(t.datumCode=t.datumCode.slice(2)),"new_zealand_geodetic_datum_1949"!==t.datumCode&&"new_zealand_1949"!==t.datumCode||(t.datumCode="nzgd49"),"wgs_1984"!==t.datumCode&&"world_geodetic_system_1984"!==t.datumCode||("Mercator_Auxiliary_Sphere"===t.PROJECTION&&(t.sphere=!0),t.datumCode="wgs84"),"_ferro"===t.datumCode.slice(-6)&&(t.datumCode=t.datumCode.slice(0,-6)),"_jakarta"===t.datumCode.slice(-8)&&(t.datumCode=t.datumCode.slice(0,-8)),~t.datumCode.indexOf("belge")&&(t.datumCode="rnb72"),a.DATUM&&a.DATUM.SPHEROID&&(t.ellps=a.DATUM.SPHEROID.name.replace("_19","").replace(/[Cc]larke\_18/,"clrk"),"international"===t.ellps.toLowerCase().slice(0,13)&&(t.ellps="intl"),t.a=a.DATUM.SPHEROID.a,t.rf=parseFloat(a.DATUM.SPHEROID.rf,10)),a.DATUM&&a.DATUM.TOWGS84&&(t.datum_params=a.DATUM.TOWGS84),~t.datumCode.indexOf("osgb_1936")&&(t.datumCode="osgb36"),~t.datumCode.indexOf("osni_1952")&&(t.datumCode="osni52"),(~t.datumCode.indexOf("tm65")||~t.datumCode.indexOf("geodetic_datum_of_1965"))&&(t.datumCode="ire65"),"ch1903+"===t.datumCode&&(t.datumCode="ch1903"),~t.datumCode.indexOf("israel")&&(t.datumCode="isr93")),t.b&&!isFinite(t.b)&&(t.b=t.a),[["standard_parallel_1","Standard_Parallel_1"],["standard_parallel_1","Latitude of 1st standard parallel"],["standard_parallel_2","Standard_Parallel_2"],["standard_parallel_2","Latitude of 2nd standard parallel"],["false_easting","False_Easting"],["false_easting","False easting"],["false-easting","Easting at false origin"],["false_northing","False_Northing"],["false_northing","False northing"],["false_northing","Northing at false origin"],["central_meridian","Central_Meridian"],["central_meridian","Longitude of natural origin"],["central_meridian","Longitude of false origin"],["latitude_of_origin","Latitude_Of_Origin"],["latitude_of_origin","Central_Parallel"],["latitude_of_origin","Latitude of natural origin"],["latitude_of_origin","Latitude of false origin"],["scale_factor","Scale_Factor"],["k0","scale_factor"],["latitude_of_center","Latitude_Of_Center"],["latitude_of_center","Latitude_of_center"],["lat0","latitude_of_center",N],["longitude_of_center","Longitude_Of_Center"],["longitude_of_center","Longitude_of_center"],["longc","longitude_of_center",N],["x0","false_easting",n],["y0","false_northing",n],["long0","central_meridian",N],["lat0","latitude_of_origin",N],["lat0","standard_parallel_1",N],["lat1","standard_parallel_1",N],["lat2","standard_parallel_2",N],["azimuth","Azimuth"],["alpha","azimuth",N],["srsCode","name"]].forEach((function(e){return s=t,r=(i=e)[0],a=i[1],void(!(r in s)&&a in s&&(s[r]=s[a],3===i.length&&(s[r]=i[2](s[r]))));var s,i,r,a})),t.long0||!t.longc||"Albers_Conic_Equal_Area"!==t.projName&&"Lambert_Azimuthal_Equal_Area"!==t.projName||(t.long0=t.longc),t.lat_ts||!t.lat1||"Stereographic_South_Pole"!==t.projName&&"Polar Stereographic (variant B)"!==t.projName?!t.lat_ts&&t.lat0&&"Polar_Stereographic"===t.projName&&(t.lat_ts=t.lat0,t.lat0=N(t.lat0>0?90:-90)):(t.lat0=N(t.lat1>0?90:-90),t.lat_ts=t.lat1)}(r),r}function L(t){var e=this;if(2===arguments.length){var s=arguments[1];"string"==typeof s?"+"===s.charAt(0)?L[t]=S(arguments[1]):L[t]=B(arguments[1]):L[t]=s}else if(1===arguments.length){if(Array.isArray(t))return t.map((function(t){Array.isArray(t)?L.apply(e,t):L(t)}));if("string"==typeof t){if(t in L)return L[t]}else"EPSG"in t?L["EPSG:"+t.EPSG]=t:"ESRI"in t?L["ESRI:"+t.ESRI]=t:"IAU2000"in t?L["IAU2000:"+t.IAU2000]=t:console.log(t);return}}(R=L)("EPSG:4326","+title=WGS 84 (long/lat) +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees"),R("EPSG:4269","+title=NAD83 (long/lat) +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees"),R("EPSG:3857","+title=WGS 84 / Pseudo-Mercator +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs"),R.WGS84=R["EPSG:4326"],R["EPSG:3785"]=R["EPSG:3857"],R.GOOGLE=R["EPSG:3857"],R["EPSG:900913"]=R["EPSG:3857"],R["EPSG:102113"]=R["EPSG:3857"];var q=L;var H=["PROJECTEDCRS","PROJCRS","GEOGCS","GEOCCS","PROJCS","LOCAL_CS","GEODCRS","GEODETICCRS","GEODETICDATUM","ENGCRS","ENGINEERINGCRS"];var U=["3857","900913","3785","102113"];var O=function(t){if(!function(t){return"string"==typeof t}(t))return t;if(function(t){return t in q}(t))return q[t];if(function(t){return H.some((function(e){return t.indexOf(e)>-1}))}(t)){var e=B(t);if(function(t){var e=v(t,"authority");if(e){var s=v(e,"epsg");return s&&U.indexOf(s)>-1}}(e))return q["EPSG:3857"];var s=function(t){var e=v(t,"extension");if(e)return v(e,"proj4")}(e);return s?S(s):e}return function(t){return"+"===t[0]}(t)?S(t):void 0};function V(t,e){var s,i;if(t=t||{},!e)return t;for(i in e)void 0!==(s=e[i])&&(t[i]=s);return t}function G(t,e,s){var i=t*e;return s/Math.sqrt(1-i*i)}function j(t){return t<0?-1:1}function W(t){return Math.abs(t)<=y?t:t-j(t)*g}function Q(t,e,s){var i=t*s,r=.5*t;return i=Math.pow((1-i)/(1+i),r),Math.tan(.5*(l-e))/i}function X(t,e){for(var s,i,r=.5*t,a=l-2*Math.atan(e),n=0;n<=15;n++)if(s=t*Math.sin(a),a+=i=l-2*Math.atan(e*Math.pow((1-s)/(1+s),r))-a,Math.abs(i)<=1e-10)return a;return-9999}function Y(t){return t}var Z=[{init:function(){var t=this.b/this.a;this.es=1-t*t,"x0"in this||(this.x0=0),"y0"in this||(this.y0=0),this.e=Math.sqrt(this.es),this.lat_ts?this.sphere?this.k0=Math.cos(this.lat_ts):this.k0=G(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)):this.k0||(this.k?this.k0=this.k:this.k0=1)},forward:function(t){var e,s,i=t.x,r=t.y;if(r*f>90&&r*f<-90&&i*f>180&&i*f<-180)return null;if(Math.abs(Math.abs(r)-l)<=m)return null;if(this.sphere)e=this.x0+this.a*this.k0*W(i-this.long0),s=this.y0+this.a*this.k0*Math.log(Math.tan(x+.5*r));else{var a=Math.sin(r),n=Q(this.e,r,a);e=this.x0+this.a*this.k0*W(i-this.long0),s=this.y0-this.a*this.k0*Math.log(n)}return t.x=e,t.y=s,t},inverse:function(t){var e,s,i=t.x-this.x0,r=t.y-this.y0;if(this.sphere)s=l-2*Math.atan(Math.exp(-r/(this.a*this.k0)));else{var a=Math.exp(-r/(this.a*this.k0));if(-9999===(s=X(this.e,a)))return null}return e=W(this.long0+i/(this.a*this.k0)),t.x=e,t.y=s,t},names:["Mercator","Popular Visualisation Pseudo Mercator","Mercator_1SP","Mercator_Auxiliary_Sphere","merc"]},{init:function(){},forward:Y,inverse:Y,names:["longlat","identity"]}],K={},J=[];function $(t,e){var s=J.length;return t.names?(J[s]=t,t.names.forEach((function(t){K[t.toLowerCase()]=s})),this):(console.log(e),!0)}var tt={start:function(){Z.forEach($)},add:$,get:function(t){if(!t)return!1;var e=t.toLowerCase();return void 0!==K[e]&&J[K[e]]?J[K[e]]:void 0}},et={MERIT:{a:6378137,rf:298.257,ellipseName:"MERIT 1983"},SGS85:{a:6378136,rf:298.257,ellipseName:"Soviet Geodetic System 85"},GRS80:{a:6378137,rf:298.257222101,ellipseName:"GRS 1980(IUGG, 1980)"},IAU76:{a:6378140,rf:298.257,ellipseName:"IAU 1976"},airy:{a:6377563.396,b:6356256.91,ellipseName:"Airy 1830"},APL4:{a:6378137,rf:298.25,ellipseName:"Appl. Physics. 1965"},NWL9D:{a:6378145,rf:298.25,ellipseName:"Naval Weapons Lab., 1965"},mod_airy:{a:6377340.189,b:6356034.446,ellipseName:"Modified Airy"},andrae:{a:6377104.43,rf:300,ellipseName:"Andrae 1876 (Den., Iclnd.)"},aust_SA:{a:6378160,rf:298.25,ellipseName:"Australian Natl & S. Amer. 1969"},GRS67:{a:6378160,rf:298.247167427,ellipseName:"GRS 67(IUGG 1967)"},bessel:{a:6377397.155,rf:299.1528128,ellipseName:"Bessel 1841"},bess_nam:{a:6377483.865,rf:299.1528128,ellipseName:"Bessel 1841 (Namibia)"},clrk66:{a:6378206.4,b:6356583.8,ellipseName:"Clarke 1866"},clrk80:{a:6378249.145,rf:293.4663,ellipseName:"Clarke 1880 mod."},clrk80ign:{a:6378249.2,b:6356515,rf:293.4660213,ellipseName:"Clarke 1880 (IGN)"},clrk58:{a:6378293.645208759,rf:294.2606763692654,ellipseName:"Clarke 1858"},CPM:{a:6375738.7,rf:334.29,ellipseName:"Comm. des Poids et Mesures 1799"},delmbr:{a:6376428,rf:311.5,ellipseName:"Delambre 1810 (Belgium)"},engelis:{a:6378136.05,rf:298.2566,ellipseName:"Engelis 1985"},evrst30:{a:6377276.345,rf:300.8017,ellipseName:"Everest 1830"},evrst48:{a:6377304.063,rf:300.8017,ellipseName:"Everest 1948"},evrst56:{a:6377301.243,rf:300.8017,ellipseName:"Everest 1956"},evrst69:{a:6377295.664,rf:300.8017,ellipseName:"Everest 1969"},evrstSS:{a:6377298.556,rf:300.8017,ellipseName:"Everest (Sabah & Sarawak)"},fschr60:{a:6378166,rf:298.3,ellipseName:"Fischer (Mercury Datum) 1960"},fschr60m:{a:6378155,rf:298.3,ellipseName:"Fischer 1960"},fschr68:{a:6378150,rf:298.3,ellipseName:"Fischer 1968"},helmert:{a:6378200,rf:298.3,ellipseName:"Helmert 1906"},hough:{a:6378270,rf:297,ellipseName:"Hough"},intl:{a:6378388,rf:297,ellipseName:"International 1909 (Hayford)"},kaula:{a:6378163,rf:298.24,ellipseName:"Kaula 1961"},lerch:{a:6378139,rf:298.257,ellipseName:"Lerch 1979"},mprts:{a:6397300,rf:191,ellipseName:"Maupertius 1738"},new_intl:{a:6378157.5,b:6356772.2,ellipseName:"New International 1967"},plessis:{a:6376523,rf:6355863,ellipseName:"Plessis 1817 (France)"},krass:{a:6378245,rf:298.3,ellipseName:"Krassovsky, 1942"},SEasia:{a:6378155,b:6356773.3205,ellipseName:"Southeast Asia"},walbeck:{a:6376896,b:6355834.8467,ellipseName:"Walbeck"},WGS60:{a:6378165,rf:298.3,ellipseName:"WGS 60"},WGS66:{a:6378145,rf:298.25,ellipseName:"WGS 66"},WGS7:{a:6378135,rf:298.26,ellipseName:"WGS 72"}},st=et.WGS84={a:6378137,rf:298.257223563,ellipseName:"WGS 84"};et.sphere={a:6370997,b:6370997,ellipseName:"Normal Sphere (r=6370997)"};var it={};it.wgs84={towgs84:"0,0,0",ellipse:"WGS84",datumName:"WGS84"},it.ch1903={towgs84:"674.374,15.056,405.346",ellipse:"bessel",datumName:"swiss"},it.ggrs87={towgs84:"-199.87,74.79,246.62",ellipse:"GRS80",datumName:"Greek_Geodetic_Reference_System_1987"},it.nad83={towgs84:"0,0,0",ellipse:"GRS80",datumName:"North_American_Datum_1983"},it.nad27={nadgrids:"@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat",ellipse:"clrk66",datumName:"North_American_Datum_1927"},it.potsdam={towgs84:"598.1,73.7,418.2,0.202,0.045,-2.455,6.7",ellipse:"bessel",datumName:"Potsdam Rauenberg 1950 DHDN"},it.carthage={towgs84:"-263.0,6.0,431.0",ellipse:"clark80",datumName:"Carthage 1934 Tunisia"},it.hermannskogel={towgs84:"577.326,90.129,463.919,5.137,1.474,5.297,2.4232",ellipse:"bessel",datumName:"Hermannskogel"},it.militargeographische_institut={towgs84:"577.326,90.129,463.919,5.137,1.474,5.297,2.4232",ellipse:"bessel",datumName:"Militar-Geographische Institut"},it.osni52={towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"airy",datumName:"Irish National"},it.ire65={towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"mod_airy",datumName:"Ireland 1965"},it.rassadiran={towgs84:"-133.63,-157.5,-158.62",ellipse:"intl",datumName:"Rassadiran"},it.nzgd49={towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993",ellipse:"intl",datumName:"New Zealand Geodetic Datum 1949"},it.osgb36={towgs84:"446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894",ellipse:"airy",datumName:"Airy 1830"},it.s_jtsk={towgs84:"589,76,480",ellipse:"bessel",datumName:"S-JTSK (Ferro)"},it.beduaram={towgs84:"-106,-87,188",ellipse:"clrk80",datumName:"Beduaram"},it.gunung_segara={towgs84:"-403,684,41",ellipse:"bessel",datumName:"Gunung Segara Jakarta"},it.rnb72={towgs84:"106.869,-52.2978,103.724,-0.33657,0.456955,-1.84218,1",ellipse:"intl",datumName:"Reseau National Belge 1972"};var rt=function(t,a,n,o,l,c,u){var d={};return d.datum_type=void 0===t||"none"===t?r:4,a&&(d.datum_params=a.map(parseFloat),0===d.datum_params[0]&&0===d.datum_params[1]&&0===d.datum_params[2]||(d.datum_type=e),d.datum_params.length>3&&(0===d.datum_params[3]&&0===d.datum_params[4]&&0===d.datum_params[5]&&0===d.datum_params[6]||(d.datum_type=s,d.datum_params[3]*=h,d.datum_params[4]*=h,d.datum_params[5]*=h,d.datum_params[6]=d.datum_params[6]/1e6+1))),u&&(d.datum_type=i,d.grids=u),d.a=n,d.b=o,d.es=l,d.ep2=c,d},at={};function nt(t){if(0===t.length)return null;var e="@"===t[0];return e&&(t=t.slice(1)),"null"===t?{name:"null",mandatory:!e,grid:null,isNull:!0}:{name:t,mandatory:!e,grid:at[t]||null,isNull:!1}}function ot(t){return t/3600*Math.PI/180}function ht(t,e,s){return String.fromCharCode.apply(null,new Uint8Array(t.buffer.slice(e,s)))}function lt(t){return t.map((function(t){return[ot(t.longitudeShift),ot(t.latitudeShift)]}))}function ct(t,e,s){return{name:ht(t,e+8,e+16).trim(),parent:ht(t,e+24,e+24+8).trim(),lowerLatitude:t.getFloat64(e+72,s),upperLatitude:t.getFloat64(e+88,s),lowerLongitude:t.getFloat64(e+104,s),upperLongitude:t.getFloat64(e+120,s),latitudeInterval:t.getFloat64(e+136,s),longitudeInterval:t.getFloat64(e+152,s),gridNodeCount:t.getInt32(e+168,s)}}function ut(t,e,s,i){for(var r=e+176,a=[],n=0;n<s.gridNodeCount;n++){var o={latitudeShift:t.getFloat32(r+16*n,i),longitudeShift:t.getFloat32(r+16*n+4,i),latitudeAccuracy:t.getFloat32(r+16*n+8,i),longitudeAccuracy:t.getFloat32(r+16*n+12,i)};a.push(o)}return a}function dt(t,e){if(!(this instanceof dt))return new dt(t);e=e||function(t){if(t)throw t};var s=O(t);if("object"==typeof s){var i=dt.projections.get(s.projName);if(i){if(s.datumCode&&"none"!==s.datumCode){var r=v(it,s.datumCode);r&&(s.datum_params=s.datum_params||(r.towgs84?r.towgs84.split(","):null),s.ellps=r.ellipse,s.datumName=r.datumName?r.datumName:s.datumCode)}s.k0=s.k0||1,s.axis=s.axis||"enu",s.ellps=s.ellps||"wgs84",s.lat1=s.lat1||s.lat0;var a,n,o,h,l,p,f,x=function(t,e,s,i,r){if(!t){var a=v(et,i);a||(a=st),t=a.a,e=a.b,s=a.rf}return s&&!e&&(e=(1-1/s)*t),(0===s||Math.abs(t-e)<m)&&(r=!0,e=t),{a:t,b:e,rf:s,sphere:r}}(s.a,s.b,s.rf,s.ellps,s.sphere),g=(a=x.a,n=x.b,x.rf,o=s.R_A,p=((h=a*a)-(l=n*n))/h,f=0,o?(h=(a*=1-p*(c+p*(u+p*d)))*a,p=0):f=Math.sqrt(p),{es:p,e:f,ep2:(h-l)/l}),y=function(t){return void 0===t?null:t.split(",").map(nt)}(s.nadgrids),M=s.datum||rt(s.datumCode,s.datum_params,x.a,x.b,g.es,g.ep2,y);V(this,s),V(this,i),this.a=x.a,this.b=x.b,this.rf=x.rf,this.sphere=x.sphere,this.es=g.es,this.e=g.e,this.ep2=g.ep2,this.datum=M,this.init(),e(null,this)}else e(t)}else e(t)}dt.projections=tt,dt.projections.start();var mt=dt;function pt(t,e,s){var i,r,a,n,o=t.x,h=t.y,c=t.z?t.z:0;if(h<-l&&h>-1.001*l)h=-l;else if(h>l&&h<1.001*l)h=l;else{if(h<-l)return{x:-1/0,y:-1/0,z:t.z};if(h>l)return{x:1/0,y:1/0,z:t.z}}return o>Math.PI&&(o-=2*Math.PI),r=Math.sin(h),n=Math.cos(h),a=r*r,{x:((i=s/Math.sqrt(1-e*a))+c)*n*Math.cos(o),y:(i+c)*n*Math.sin(o),z:(i*(1-e)+c)*r}}function ft(t,e,s,i){var r,a,n,o,h,l,c,u,d,m,p,f,x,g,y,M=1e-12,b=t.x,w=t.y,v=t.z?t.z:0;if(r=Math.sqrt(b*b+w*w),a=Math.sqrt(b*b+w*w+v*v),r/s<M){if(g=0,a/s<M)return y=-i,{x:t.x,y:t.y,z:t.z}}else g=Math.atan2(w,b);n=v/a,u=(o=r/a)*(1-e)*(h=1/Math.sqrt(1-e*(2-e)*o*o)),d=n*h,x=0;do{x++,l=e*(c=s/Math.sqrt(1-e*d*d))/(c+(y=r*u+v*d-c*(1-e*d*d))),f=(p=n*(h=1/Math.sqrt(1-l*(2-l)*o*o)))*u-(m=o*(1-l)*h)*d,u=m,d=p}while(f*f>1e-24&&x<30);return{x:g,y:Math.atan(p/Math.abs(m)),z:y}}function xt(t){return t===e||t===s}function gt(t,h,l){if(function(t,i){return t.datum_type===i.datum_type&&!(t.a!==i.a||Math.abs(t.es-i.es)>5e-11)&&(t.datum_type===e?t.datum_params[0]===i.datum_params[0]&&t.datum_params[1]===i.datum_params[1]&&t.datum_params[2]===i.datum_params[2]:t.datum_type!==s||t.datum_params[0]===i.datum_params[0]&&t.datum_params[1]===i.datum_params[1]&&t.datum_params[2]===i.datum_params[2]&&t.datum_params[3]===i.datum_params[3]&&t.datum_params[4]===i.datum_params[4]&&t.datum_params[5]===i.datum_params[5]&&t.datum_params[6]===i.datum_params[6])}(t,h))return l;if(t.datum_type===r||h.datum_type===r)return l;var c=t.a,u=t.es;if(t.datum_type===i){if(0!==yt(t,!1,l))return;c=a,u=o}var d=h.a,m=h.b,p=h.es;if(h.datum_type===i&&(d=a,m=n,p=o),u===p&&c===d&&!xt(t.datum_type)&&!xt(h.datum_type))return l;if((l=pt(l,u,c),xt(t.datum_type)&&(l=function(t,i,r){if(i===e)return{x:t.x+r[0],y:t.y+r[1],z:t.z+r[2]};if(i===s){var a=r[0],n=r[1],o=r[2],h=r[3],l=r[4],c=r[5],u=r[6];return{x:u*(t.x-c*t.y+l*t.z)+a,y:u*(c*t.x+t.y-h*t.z)+n,z:u*(-l*t.x+h*t.y+t.z)+o}}}(l,t.datum_type,t.datum_params)),xt(h.datum_type)&&(l=function(t,i,r){if(i===e)return{x:t.x-r[0],y:t.y-r[1],z:t.z-r[2]};if(i===s){var a=r[0],n=r[1],o=r[2],h=r[3],l=r[4],c=r[5],u=r[6],d=(t.x-a)/u,m=(t.y-n)/u,p=(t.z-o)/u;return{x:d+c*m-l*p,y:-c*d+m+h*p,z:l*d-h*m+p}}}(l,h.datum_type,h.datum_params)),l=ft(l,p,d,m),h.datum_type===i)&&0!==yt(h,!0,l))return;return l}function yt(t,e,s){if(null===t.grids||0===t.grids.length)return console.log("Grid shift grids not found"),-1;var i={x:-s.x,y:s.y},r={x:Number.NaN,y:Number.NaN},a=[];t:for(var n=0;n<t.grids.length;n++){var o=t.grids[n];if(a.push(o.name),o.isNull){r=i;break}if(o.mandatory,null!==o.grid)for(var h=o.grid.subgrids,l=0,c=h.length;l<c;l++){var u=h[l],d=(Math.abs(u.del[1])+Math.abs(u.del[0]))/1e4,m=u.ll[0]-d,p=u.ll[1]-d,x=u.ll[0]+(u.lim[0]-1)*u.del[0]+d,g=u.ll[1]+(u.lim[1]-1)*u.del[1]+d;if(!(p>i.y||m>i.x||g<i.y||x<i.x)&&(r=Mt(i,e,u),!isNaN(r.x)))break t}else if(o.mandatory)return console.log("Unable to find mandatory grid '"+o.name+"'"),-1}return isNaN(r.x)?(console.log("Failed to find a grid shift table for location '"+-i.x*f+" "+i.y*f+" tried: '"+a+"'"),-1):(s.x=-r.x,s.y=r.y,0)}function Mt(t,e,s){var i={x:Number.NaN,y:Number.NaN};if(isNaN(t.x))return i;var r={x:t.x,y:t.y};r.x-=s.ll[0],r.y-=s.ll[1],r.x=W(r.x-Math.PI)+Math.PI;var a=bt(r,s);if(e){if(isNaN(a.x))return i;a.x=r.x-a.x,a.y=r.y-a.y;var n,o,h=9;do{if(o=bt(a,s),isNaN(o.x)){console.log("Inverse grid shift iteration failed, presumably at grid edge.  Using first approximation.");break}n={x:r.x-(o.x+a.x),y:r.y-(o.y+a.y)},a.x+=n.x,a.y+=n.y}while(h--&&Math.abs(n.x)>1e-12&&Math.abs(n.y)>1e-12);if(h<0)return console.log("Inverse grid shift iterator failed to converge."),i;i.x=W(a.x+s.ll[0]),i.y=a.y+s.ll[1]}else isNaN(a.x)||(i.x=t.x+a.x,i.y=t.y+a.y);return i}function bt(t,e){var s,i={x:t.x/e.del[0],y:t.y/e.del[1]},r=Math.floor(i.x),a=Math.floor(i.y),n=i.x-1*r,o=i.y-1*a,h={x:Number.NaN,y:Number.NaN};if(r<0||r>=e.lim[0])return h;if(a<0||a>=e.lim[1])return h;s=a*e.lim[0]+r;var l=e.cvs[s][0],c=e.cvs[s][1];s++;var u=e.cvs[s][0],d=e.cvs[s][1];s+=e.lim[0];var m=e.cvs[s][0],p=e.cvs[s][1];s--;var f=e.cvs[s][0],x=e.cvs[s][1],g=n*o,y=n*(1-o),M=(1-n)*(1-o),b=(1-n)*o;return h.x=M*l+y*u+b*f+g*m,h.y=M*c+y*d+b*x+g*p,h}function wt(t,e,s){var i,r,a,n=s.x,o=s.y,h=s.z||0,l={};for(a=0;a<3;a++)if(!e||2!==a||void 0!==s.z)switch(0===a?(i=n,r=-1!=="ew".indexOf(t.axis[a])?"x":"y"):1===a?(i=o,r=-1!=="ns".indexOf(t.axis[a])?"y":"x"):(i=h,r="z"),t.axis[a]){case"e":case"n":l[r]=i;break;case"w":case"s":l[r]=-i;break;case"u":void 0!==s[r]&&(l.z=i);break;case"d":void 0!==s[r]&&(l.z=-i);break;default:return null}return l}function vt(t){var e={x:t[0],y:t[1]};return t.length>2&&(e.z=t[2]),t.length>3&&(e.m=t[3]),e}function St(t){if("function"==typeof Number.isFinite){if(Number.isFinite(t))return;throw new TypeError("coordinates must be finite numbers")}if("number"!=typeof t||t!=t||!isFinite(t))throw new TypeError("coordinates must be finite numbers")}function Ct(t,r,a,n){var o,h=void 0!==(a=Array.isArray(a)?vt(a):{x:a.x,y:a.y,z:a.z,m:a.m}).z;if(function(t){St(t.x),St(t.y)}(a),t.datum&&r.datum&&function(t,r){return(t.datum.datum_type===e||t.datum.datum_type===s||t.datum.datum_type===i)&&"WGS84"!==r.datumCode||(r.datum.datum_type===e||r.datum.datum_type===s||r.datum.datum_type===i)&&"WGS84"!==t.datumCode}(t,r)&&(a=Ct(t,o=new mt("WGS84"),a,n),t=o),n&&"enu"!==t.axis&&(a=wt(t,!1,a)),"longlat"===t.projName)a={x:a.x*p,y:a.y*p,z:a.z||0};else if(t.to_meter&&(a={x:a.x*t.to_meter,y:a.y*t.to_meter,z:a.z||0}),!(a=t.inverse(a)))return;if(t.from_greenwich&&(a.x+=t.from_greenwich),a=gt(t.datum,r.datum,a))return r.from_greenwich&&(a={x:a.x-r.from_greenwich,y:a.y,z:a.z||0}),"longlat"===r.projName?a={x:a.x*f,y:a.y*f,z:a.z||0}:(a=r.forward(a),r.to_meter&&(a={x:a.x/r.to_meter,y:a.y/r.to_meter,z:a.z||0})),n&&"enu"!==r.axis?wt(r,!0,a):(a&&!h&&delete a.z,a)}var _t=mt("WGS84");function Tt(t,e,s,i){var r,a,n;return Array.isArray(s)?(r=Ct(t,e,s,i)||{x:NaN,y:NaN},s.length>2?void 0!==t.name&&"geocent"===t.name||void 0!==e.name&&"geocent"===e.name?"number"==typeof r.z?[r.x,r.y,r.z].concat(s.splice(3)):[r.x,r.y,s[2]].concat(s.splice(3)):[r.x,r.y].concat(s.splice(2)):[r.x,r.y]):(a=Ct(t,e,s,i),2===(n=Object.keys(s)).length||n.forEach((function(i){if(void 0!==t.name&&"geocent"===t.name||void 0!==e.name&&"geocent"===e.name){if("x"===i||"y"===i||"z"===i)return}else if("x"===i||"y"===i)return;a[i]=s[i]})),a)}function Dt(t){return t instanceof mt?t:t.oProj?t.oProj:mt(t)}function Pt(t,e,s){t=Dt(t);var i,r=!1;return void 0===e?(e=t,t=_t,r=!0):(void 0!==e.x||Array.isArray(e))&&(s=e,e=t,t=_t,r=!0),e=Dt(e),s?Tt(t,e,s):(i={forward:function(s,i){return Tt(t,e,s,i)},inverse:function(s,i){return Tt(e,t,s,i)}},r&&(i.oProj=e),i)}var zt=Pt,At=6,Et="AJSAJS",It="AFAFAF",Ft=65,Rt=73,kt=79,Nt=86,Bt=90,Lt={forward:qt,inverse:function(t){var e=Vt(Wt(t.toUpperCase()));if(e.lat&&e.lon)return[e.lon,e.lat,e.lon,e.lat];return[e.left,e.bottom,e.right,e.top]},toPoint:Ht};function qt(t,e){return e=e||5,function(t,e){var s="00000"+t.easting,i="00000"+t.northing;return t.zoneNumber+t.zoneLetter+(m=t.easting,p=t.northing,f=t.zoneNumber,x=jt(f),g=Math.floor(m/1e5),y=Math.floor(p/1e5)%20,r=g,a=y,n=x,o=n-1,h=Et.charCodeAt(o),l=It.charCodeAt(o),c=h+r-1,u=l+a,d=!1,c>Bt&&(c=c-Bt+Ft-1,d=!0),(c===Rt||h<Rt&&c>Rt||(c>Rt||h<Rt)&&d)&&c++,(c===kt||h<kt&&c>kt||(c>kt||h<kt)&&d)&&++c===Rt&&c++,c>Bt&&(c=c-Bt+Ft-1),u>Nt?(u=u-Nt+Ft-1,d=!0):d=!1,(u===Rt||l<Rt&&u>Rt||(u>Rt||l<Rt)&&d)&&u++,(u===kt||l<kt&&u>kt||(u>kt||l<kt)&&d)&&++u===Rt&&u++,u>Nt&&(u=u-Nt+Ft-1),String.fromCharCode(c)+String.fromCharCode(u))+s.substr(s.length-5,e)+i.substr(i.length-5,e);var r,a,n,o,h,l,c,u,d;var m,p,f,x,g,y}(function(t){var e,s,i,r,a,n,o,h,l=t.lat,c=t.lon,u=6378137,d=.00669438,m=.9996,p=Ut(l),f=Ut(c);h=Math.floor((c+180)/6)+1,180===c&&(h=60);l>=56&&l<64&&c>=3&&c<12&&(h=32);l>=72&&l<84&&(c>=0&&c<9?h=31:c>=9&&c<21?h=33:c>=21&&c<33?h=35:c>=33&&c<42&&(h=37));o=Ut(6*(h-1)-180+3),e=d/(1-d),s=u/Math.sqrt(1-d*Math.sin(p)*Math.sin(p)),i=Math.tan(p)*Math.tan(p),r=e*Math.cos(p)*Math.cos(p),a=Math.cos(p)*(f-o),n=u*((1-d/4-3*d*d/64-5*d*d*d/256)*p-(3*d/8+3*d*d/32+45*d*d*d/1024)*Math.sin(2*p)+(15*d*d/256+45*d*d*d/1024)*Math.sin(4*p)-35*d*d*d/3072*Math.sin(6*p));var x=m*s*(a+(1-i+r)*a*a*a/6+(5-18*i+i*i+72*r-58*e)*a*a*a*a*a/120)+5e5,g=m*(n+s*Math.tan(p)*(a*a/2+(5-i+9*r+4*r*r)*a*a*a*a/24+(61-58*i+i*i+600*r-330*e)*a*a*a*a*a*a/720));l<0&&(g+=1e7);return{northing:Math.round(g),easting:Math.round(x),zoneNumber:h,zoneLetter:Gt(l)}}({lat:t[1],lon:t[0]}),e)}function Ht(t){var e=Vt(Wt(t.toUpperCase()));return e.lat&&e.lon?[e.lon,e.lat]:[(e.left+e.right)/2,(e.top+e.bottom)/2]}function Ut(t){return t*(Math.PI/180)}function Ot(t){return t/Math.PI*180}function Vt(t){var e=t.northing,s=t.easting,i=t.zoneLetter,r=t.zoneNumber;if(r<0||r>60)return null;var a,n,o,h,l,c,u,d,m,p=.9996,f=6378137,x=.00669438,g=(1-Math.sqrt(.99330562))/(1+Math.sqrt(.99330562)),y=s-5e5,M=e;i<"N"&&(M-=1e7),u=6*(r-1)-180+3,a=.006739496752268451,m=(d=M/p/6367449.145945056)+(3*g/2-27*g*g*g/32)*Math.sin(2*d)+(21*g*g/16-55*g*g*g*g/32)*Math.sin(4*d)+151*g*g*g/96*Math.sin(6*d),n=f/Math.sqrt(1-x*Math.sin(m)*Math.sin(m)),o=Math.tan(m)*Math.tan(m),h=a*Math.cos(m)*Math.cos(m),l=.99330562*f/Math.pow(1-x*Math.sin(m)*Math.sin(m),1.5),c=y/(n*p);var b=m-n*Math.tan(m)/l*(c*c/2-(5+3*o+10*h-4*h*h-9*a)*c*c*c*c/24+(61+90*o+298*h+45*o*o-1.6983531815716497-3*h*h)*c*c*c*c*c*c/720);b=Ot(b);var w,v=(c-(1+2*o+h)*c*c*c/6+(5-2*h+28*o-3*h*h+8*a+24*o*o)*c*c*c*c*c/120)/Math.cos(m);if(v=u+Ot(v),t.accuracy){var S=Vt({northing:t.northing+t.accuracy,easting:t.easting+t.accuracy,zoneLetter:t.zoneLetter,zoneNumber:t.zoneNumber});w={top:S.lat,right:S.lon,bottom:b,left:v}}else w={lat:b,lon:v};return w}function Gt(t){var e="Z";return 84>=t&&t>=72?e="X":72>t&&t>=64?e="W":64>t&&t>=56?e="V":56>t&&t>=48?e="U":48>t&&t>=40?e="T":40>t&&t>=32?e="S":32>t&&t>=24?e="R":24>t&&t>=16?e="Q":16>t&&t>=8?e="P":8>t&&t>=0?e="N":0>t&&t>=-8?e="M":-8>t&&t>=-16?e="L":-16>t&&t>=-24?e="K":-24>t&&t>=-32?e="J":-32>t&&t>=-40?e="H":-40>t&&t>=-48?e="G":-48>t&&t>=-56?e="F":-56>t&&t>=-64?e="E":-64>t&&t>=-72?e="D":-72>t&&t>=-80&&(e="C"),e}function jt(t){var e=t%At;return 0===e&&(e=At),e}function Wt(t){if(t&&0===t.length)throw"MGRSPoint coverting from nothing";for(var e,s=t.length,i=null,r="",a=0;!/[A-Z]/.test(e=t.charAt(a));){if(a>=2)throw"MGRSPoint bad conversion from: "+t;r+=e,a++}var n=parseInt(r,10);if(0===a||a+3>s)throw"MGRSPoint bad conversion from: "+t;var o=t.charAt(a++);if(o<="A"||"B"===o||"Y"===o||o>="Z"||"I"===o||"O"===o)throw"MGRSPoint zone letter "+o+" not handled: "+t;i=t.substring(a,a+=2);for(var h=jt(n),l=function(t,e){var s=Et.charCodeAt(e-1),i=1e5,r=!1;for(;s!==t.charCodeAt(0);){if(++s===Rt&&s++,s===kt&&s++,s>Bt){if(r)throw"Bad character: "+t;s=Ft,r=!0}i+=1e5}return i}(i.charAt(0),h),c=function(t,e){if(t>"V")throw"MGRSPoint given invalid Northing "+t;var s=It.charCodeAt(e-1),i=0,r=!1;for(;s!==t.charCodeAt(0);){if(++s===Rt&&s++,s===kt&&s++,s>Nt){if(r)throw"Bad character: "+t;s=Ft,r=!0}i+=1e5}return i}(i.charAt(1),h);c<Qt(o);)c+=2e6;var u=s-a;if(u%2!=0)throw"MGRSPoint has to have an even number \nof digits after the zone letter and two 100km letters - front \nhalf for easting meters, second half for \nnorthing meters"+t;var d,m,p,f=u/2,x=0,g=0;return f>0&&(d=1e5/Math.pow(10,f),m=t.substring(a,a+f),x=parseFloat(m)*d,p=t.substring(a+f),g=parseFloat(p)*d),{easting:x+l,northing:g+c,zoneLetter:o,zoneNumber:n,accuracy:d}}function Qt(t){var e;switch(t){case"C":e=11e5;break;case"D":e=2e6;break;case"E":e=28e5;break;case"F":e=37e5;break;case"G":e=46e5;break;case"H":e=55e5;break;case"J":e=64e5;break;case"K":e=73e5;break;case"L":e=82e5;break;case"M":e=91e5;break;case"N":e=0;break;case"P":e=8e5;break;case"Q":e=17e5;break;case"R":e=26e5;break;case"S":e=35e5;break;case"T":e=44e5;break;case"U":e=53e5;break;case"V":e=62e5;break;case"W":e=7e6;break;case"X":e=79e5;break;default:e=-1}if(e>=0)return e;throw"Invalid zone letter: "+t}function Xt(t,e,s){if(!(this instanceof Xt))return new Xt(t,e,s);if(Array.isArray(t))this.x=t[0],this.y=t[1],this.z=t[2]||0;else if("object"==typeof t)this.x=t.x,this.y=t.y,this.z=t.z||0;else if("string"==typeof t&&void 0===e){var i=t.split(",");this.x=parseFloat(i[0],10),this.y=parseFloat(i[1],10),this.z=parseFloat(i[2],10)||0}else this.x=t,this.y=e,this.z=s||0;console.warn("proj4.Point will be removed in version 3, use proj4.toPoint")}Xt.fromMGRS=function(t){return new Xt(Ht(t))},Xt.prototype.toMGRS=function(t){return qt([this.x,this.y],t)};var Yt=Xt,Zt=1,Kt=.25,Jt=.046875,$t=.01953125,te=.01068115234375,ee=.75,se=.46875,ie=.013020833333333334,re=.007120768229166667,ae=.3645833333333333,ne=.005696614583333333,oe=.3076171875;function he(t){var e=[];e[0]=Zt-t*(Kt+t*(Jt+t*($t+t*te))),e[1]=t*(ee-t*(Jt+t*($t+t*te)));var s=t*t;return e[2]=s*(se-t*(ie+t*re)),s*=t,e[3]=s*(ae-t*ne),e[4]=s*t*oe,e}function le(t,e,s,i){return s*=e,e*=e,i[0]*t-s*(i[1]+e*(i[2]+e*(i[3]+e*i[4])))}var ce=20;function ue(t,e,s){for(var i=1/(1-e),r=t,a=ce;a;--a){var n=Math.sin(r),o=1-e*n*n;if(r-=o=(le(r,n,Math.cos(r),s)-t)*(o*Math.sqrt(o))*i,Math.abs(o)<m)return r}return r}var de={init:function(){this.x0=void 0!==this.x0?this.x0:0,this.y0=void 0!==this.y0?this.y0:0,this.long0=void 0!==this.long0?this.long0:0,this.lat0=void 0!==this.lat0?this.lat0:0,this.es&&(this.en=he(this.es),this.ml0=le(this.lat0,Math.sin(this.lat0),Math.cos(this.lat0),this.en))},forward:function(t){var e,s,i,r=t.x,a=t.y,n=W(r-this.long0),o=Math.sin(a),h=Math.cos(a);if(this.es){var l=h*n,c=Math.pow(l,2),u=this.ep2*Math.pow(h,2),d=Math.pow(u,2),p=Math.abs(h)>m?Math.tan(a):0,f=Math.pow(p,2),x=Math.pow(f,2);e=1-this.es*Math.pow(o,2),l/=Math.sqrt(e);var g=le(a,o,h,this.en);s=this.a*(this.k0*l*(1+c/6*(1-f+u+c/20*(5-18*f+x+14*u-58*f*u+c/42*(61+179*x-x*f-479*f)))))+this.x0,i=this.a*(this.k0*(g-this.ml0+o*n*l/2*(1+c/12*(5-f+9*u+4*d+c/30*(61+x-58*f+270*u-330*f*u+c/56*(1385+543*x-x*f-3111*f))))))+this.y0}else{var y=h*Math.sin(n);if(Math.abs(Math.abs(y)-1)<m)return 93;if(s=.5*this.a*this.k0*Math.log((1+y)/(1-y))+this.x0,i=h*Math.cos(n)/Math.sqrt(1-Math.pow(y,2)),(y=Math.abs(i))>=1){if(y-1>m)return 93;i=0}else i=Math.acos(i);a<0&&(i=-i),i=this.a*this.k0*(i-this.lat0)+this.y0}return t.x=s,t.y=i,t},inverse:function(t){var e,s,i,r,a=(t.x-this.x0)*(1/this.a),n=(t.y-this.y0)*(1/this.a);if(this.es)if(s=ue(e=this.ml0+n/this.k0,this.es,this.en),Math.abs(s)<l){var o=Math.sin(s),h=Math.cos(s),c=Math.abs(h)>m?Math.tan(s):0,u=this.ep2*Math.pow(h,2),d=Math.pow(u,2),p=Math.pow(c,2),f=Math.pow(p,2);e=1-this.es*Math.pow(o,2);var x=a*Math.sqrt(e)/this.k0,g=Math.pow(x,2);i=s-(e*=c)*g/(1-this.es)*.5*(1-g/12*(5+3*p-9*u*p+u-4*d-g/30*(61+90*p-252*u*p+45*f+46*u-g/56*(1385+3633*p+4095*f+1574*f*p)))),r=W(this.long0+x*(1-g/6*(1+2*p+u-g/20*(5+28*p+24*f+8*u*p+6*u-g/42*(61+662*p+1320*f+720*f*p))))/h)}else i=l*j(n),r=0;else{var y=Math.exp(a/this.k0),M=.5*(y-1/y),b=this.lat0+n/this.k0,w=Math.cos(b);e=Math.sqrt((1-Math.pow(w,2))/(1+Math.pow(M,2))),i=Math.asin(e),n<0&&(i=-i),r=0===M&&0===w?0:W(Math.atan2(M,w)+this.long0)}return t.x=r,t.y=i,t},names:["Fast_Transverse_Mercator","Fast Transverse Mercator"]};function me(t){var e=Math.exp(t);return e=(e-1/e)/2}function pe(t,e){t=Math.abs(t),e=Math.abs(e);var s=Math.max(t,e),i=Math.min(t,e)/(s||1);return s*Math.sqrt(1+Math.pow(i,2))}function fe(t){var e=Math.abs(t);return e=function(t){var e=1+t,s=e-1;return 0===s?t:t*Math.log(e)/s}(e*(1+e/(pe(1,e)+1))),t<0?-e:e}function xe(t,e){for(var s,i=2*Math.cos(2*e),r=t.length-1,a=t[r],n=0;--r>=0;)s=i*a-n+t[r],n=a,a=s;return e+s*Math.sin(2*e)}function ge(t,e,s){for(var i,r,a=Math.sin(e),n=Math.cos(e),o=me(s),h=function(t){var e=Math.exp(t);return(e+1/e)/2}(s),l=2*n*h,c=-2*a*o,u=t.length-1,d=t[u],m=0,p=0,f=0;--u>=0;)i=p,r=m,d=l*(p=d)-i-c*(m=f)+t[u],f=c*p-r+l*m;return[(l=a*h)*d-(c=n*o)*f,l*f+c*d]}var ye={init:function(){if(!this.approx&&(isNaN(this.es)||this.es<=0))throw new Error('Incorrect elliptical usage. Try using the +approx option in the proj string, or PROJECTION["Fast_Transverse_Mercator"] in the WKT.');this.approx&&(de.init.apply(this),this.forward=de.forward,this.inverse=de.inverse),this.x0=void 0!==this.x0?this.x0:0,this.y0=void 0!==this.y0?this.y0:0,this.long0=void 0!==this.long0?this.long0:0,this.lat0=void 0!==this.lat0?this.lat0:0,this.cgb=[],this.cbg=[],this.utg=[],this.gtu=[];var t=this.es/(1+Math.sqrt(1-this.es)),e=t/(2-t),s=e;this.cgb[0]=e*(2+e*(-2/3+e*(e*(116/45+e*(26/45+e*(-2854/675)))-2))),this.cbg[0]=e*(e*(2/3+e*(4/3+e*(-82/45+e*(32/45+e*(4642/4725)))))-2),s*=e,this.cgb[1]=s*(7/3+e*(e*(-227/45+e*(2704/315+e*(2323/945)))-1.6)),this.cbg[1]=s*(5/3+e*(-16/15+e*(-13/9+e*(904/315+e*(-1522/945))))),s*=e,this.cgb[2]=s*(56/15+e*(-136/35+e*(-1262/105+e*(73814/2835)))),this.cbg[2]=s*(-26/15+e*(34/21+e*(1.6+e*(-12686/2835)))),s*=e,this.cgb[3]=s*(4279/630+e*(-332/35+e*(-399572/14175))),this.cbg[3]=s*(1237/630+e*(e*(-24832/14175)-2.4)),s*=e,this.cgb[4]=s*(4174/315+e*(-144838/6237)),this.cbg[4]=s*(-734/315+e*(109598/31185)),s*=e,this.cgb[5]=s*(601676/22275),this.cbg[5]=s*(444337/155925),s=Math.pow(e,2),this.Qn=this.k0/(1+e)*(1+s*(1/4+s*(1/64+s/256))),this.utg[0]=e*(e*(2/3+e*(-37/96+e*(1/360+e*(81/512+e*(-96199/604800)))))-.5),this.gtu[0]=e*(.5+e*(-2/3+e*(5/16+e*(41/180+e*(-127/288+e*(7891/37800)))))),this.utg[1]=s*(-1/48+e*(-1/15+e*(437/1440+e*(-46/105+e*(1118711/3870720))))),this.gtu[1]=s*(13/48+e*(e*(557/1440+e*(281/630+e*(-1983433/1935360)))-.6)),s*=e,this.utg[2]=s*(-17/480+e*(37/840+e*(209/4480+e*(-5569/90720)))),this.gtu[2]=s*(61/240+e*(-103/140+e*(15061/26880+e*(167603/181440)))),s*=e,this.utg[3]=s*(-4397/161280+e*(11/504+e*(830251/7257600))),this.gtu[3]=s*(49561/161280+e*(-179/168+e*(6601661/7257600))),s*=e,this.utg[4]=s*(-4583/161280+e*(108847/3991680)),this.gtu[4]=s*(34729/80640+e*(-3418889/1995840)),s*=e,this.utg[5]=s*(-20648693/638668800),this.gtu[5]=.6650675310896665*s;var i=xe(this.cbg,this.lat0);this.Zb=-this.Qn*(i+function(t,e){for(var s,i=2*Math.cos(e),r=t.length-1,a=t[r],n=0;--r>=0;)s=i*a-n+t[r],n=a,a=s;return Math.sin(e)*s}(this.gtu,2*i))},forward:function(t){var e=W(t.x-this.long0),s=t.y;s=xe(this.cbg,s);var i=Math.sin(s),r=Math.cos(s),a=Math.sin(e),n=Math.cos(e);s=Math.atan2(i,n*r),e=Math.atan2(a*r,pe(i,r*n)),e=fe(Math.tan(e));var o,h,l=ge(this.gtu,2*s,2*e);return s+=l[0],e+=l[1],Math.abs(e)<=2.623395162778?(o=this.a*(this.Qn*e)+this.x0,h=this.a*(this.Qn*s+this.Zb)+this.y0):(o=1/0,h=1/0),t.x=o,t.y=h,t},inverse:function(t){var e,s,i=(t.x-this.x0)*(1/this.a),r=(t.y-this.y0)*(1/this.a);if(r=(r-this.Zb)/this.Qn,i/=this.Qn,Math.abs(i)<=2.623395162778){var a=ge(this.utg,2*r,2*i);r+=a[0],i+=a[1],i=Math.atan(me(i));var n=Math.sin(r),o=Math.cos(r),h=Math.sin(i),l=Math.cos(i);r=Math.atan2(n*l,pe(h,l*o)),e=W((i=Math.atan2(h,l*o))+this.long0),s=xe(this.cgb,r)}else e=1/0,s=1/0;return t.x=e,t.y=s,t},names:["Extended_Transverse_Mercator","Extended Transverse Mercator","etmerc","Transverse_Mercator","Transverse Mercator","Gauss Kruger","Gauss_Kruger","tmerc"]};var Me={init:function(){var t=function(t,e){if(void 0===t){if((t=Math.floor(30*(W(e)+Math.PI)/Math.PI)+1)<0)return 0;if(t>60)return 60}return t}(this.zone,this.long0);if(void 0===t)throw new Error("unknown utm zone");this.lat0=0,this.long0=(6*Math.abs(t)-183)*p,this.x0=5e5,this.y0=this.utmSouth?1e7:0,this.k0=.9996,ye.init.apply(this),this.forward=ye.forward,this.inverse=ye.inverse},names:["Universal Transverse Mercator System","utm"],dependsOn:"etmerc"};function be(t,e){return Math.pow((1-t)/(1+t),e)}var we={init:function(){var t=Math.sin(this.lat0),e=Math.cos(this.lat0);e*=e,this.rc=Math.sqrt(1-this.es)/(1-this.es*t*t),this.C=Math.sqrt(1+this.es*e*e/(1-this.es)),this.phic0=Math.asin(t/this.C),this.ratexp=.5*this.C*this.e,this.K=Math.tan(.5*this.phic0+x)/(Math.pow(Math.tan(.5*this.lat0+x),this.C)*be(this.e*t,this.ratexp))},forward:function(t){var e=t.x,s=t.y;return t.y=2*Math.atan(this.K*Math.pow(Math.tan(.5*s+x),this.C)*be(this.e*Math.sin(s),this.ratexp))-l,t.x=this.C*e,t},inverse:function(t){for(var e=t.x/this.C,s=t.y,i=Math.pow(Math.tan(.5*s+x)/this.K,1/this.C),r=20;r>0&&(s=2*Math.atan(i*be(this.e*Math.sin(t.y),-.5*this.e))-l,!(Math.abs(s-t.y)<1e-14));--r)t.y=s;return r?(t.x=e,t.y=s,t):null},names:["gauss"]};var ve={init:function(){we.init.apply(this),this.rc&&(this.sinc0=Math.sin(this.phic0),this.cosc0=Math.cos(this.phic0),this.R2=2*this.rc,this.title||(this.title="Oblique Stereographic Alternative"))},forward:function(t){var e,s,i,r;return t.x=W(t.x-this.long0),we.forward.apply(this,[t]),e=Math.sin(t.y),s=Math.cos(t.y),i=Math.cos(t.x),r=this.k0*this.R2/(1+this.sinc0*e+this.cosc0*s*i),t.x=r*s*Math.sin(t.x),t.y=r*(this.cosc0*e-this.sinc0*s*i),t.x=this.a*t.x+this.x0,t.y=this.a*t.y+this.y0,t},inverse:function(t){var e,s,i,r,a;if(t.x=(t.x-this.x0)/this.a,t.y=(t.y-this.y0)/this.a,t.x/=this.k0,t.y/=this.k0,a=pe(t.x,t.y)){var n=2*Math.atan2(a,this.R2);e=Math.sin(n),s=Math.cos(n),r=Math.asin(s*this.sinc0+t.y*e*this.cosc0/a),i=Math.atan2(t.x*e,a*this.cosc0*s-t.y*this.sinc0*e)}else r=this.phic0,i=0;return t.x=i,t.y=r,we.inverse.apply(this,[t]),t.x=W(t.x+this.long0),t},names:["Stereographic_North_Pole","Oblique_Stereographic","sterea","Oblique Stereographic Alternative","Double_Stereographic"]};var Se={init:function(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.coslat0=Math.cos(this.lat0),this.sinlat0=Math.sin(this.lat0),this.sphere?1===this.k0&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=m&&(this.k0=.5*(1+j(this.lat0)*Math.sin(this.lat_ts))):(Math.abs(this.coslat0)<=m&&(this.lat0>0?this.con=1:this.con=-1),this.cons=Math.sqrt(Math.pow(1+this.e,1+this.e)*Math.pow(1-this.e,1-this.e)),1===this.k0&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=m&&Math.abs(Math.cos(this.lat_ts))>m&&(this.k0=.5*this.cons*G(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts))/Q(this.e,this.con*this.lat_ts,this.con*Math.sin(this.lat_ts))),this.ms1=G(this.e,this.sinlat0,this.coslat0),this.X0=2*Math.atan(this.ssfn_(this.lat0,this.sinlat0,this.e))-l,this.cosX0=Math.cos(this.X0),this.sinX0=Math.sin(this.X0))},forward:function(t){var e,s,i,r,a,n,o=t.x,h=t.y,c=Math.sin(h),u=Math.cos(h),d=W(o-this.long0);return Math.abs(Math.abs(o-this.long0)-Math.PI)<=m&&Math.abs(h+this.lat0)<=m?(t.x=NaN,t.y=NaN,t):this.sphere?(e=2*this.k0/(1+this.sinlat0*c+this.coslat0*u*Math.cos(d)),t.x=this.a*e*u*Math.sin(d)+this.x0,t.y=this.a*e*(this.coslat0*c-this.sinlat0*u*Math.cos(d))+this.y0,t):(s=2*Math.atan(this.ssfn_(h,c,this.e))-l,r=Math.cos(s),i=Math.sin(s),Math.abs(this.coslat0)<=m?(a=Q(this.e,h*this.con,this.con*c),n=2*this.a*this.k0*a/this.cons,t.x=this.x0+n*Math.sin(o-this.long0),t.y=this.y0-this.con*n*Math.cos(o-this.long0),t):(Math.abs(this.sinlat0)<m?(e=2*this.a*this.k0/(1+r*Math.cos(d)),t.y=e*i):(e=2*this.a*this.k0*this.ms1/(this.cosX0*(1+this.sinX0*i+this.cosX0*r*Math.cos(d))),t.y=e*(this.cosX0*i-this.sinX0*r*Math.cos(d))+this.y0),t.x=e*r*Math.sin(d)+this.x0,t))},inverse:function(t){var e,s,i,r,a;t.x-=this.x0,t.y-=this.y0;var n=Math.sqrt(t.x*t.x+t.y*t.y);if(this.sphere){var o=2*Math.atan(n/(2*this.a*this.k0));return e=this.long0,s=this.lat0,n<=m?(t.x=e,t.y=s,t):(s=Math.asin(Math.cos(o)*this.sinlat0+t.y*Math.sin(o)*this.coslat0/n),e=Math.abs(this.coslat0)<m?this.lat0>0?W(this.long0+Math.atan2(t.x,-1*t.y)):W(this.long0+Math.atan2(t.x,t.y)):W(this.long0+Math.atan2(t.x*Math.sin(o),n*this.coslat0*Math.cos(o)-t.y*this.sinlat0*Math.sin(o))),t.x=e,t.y=s,t)}if(Math.abs(this.coslat0)<=m){if(n<=m)return s=this.lat0,e=this.long0,t.x=e,t.y=s,t;t.x*=this.con,t.y*=this.con,i=n*this.cons/(2*this.a*this.k0),s=this.con*X(this.e,i),e=this.con*W(this.con*this.long0+Math.atan2(t.x,-1*t.y))}else r=2*Math.atan(n*this.cosX0/(2*this.a*this.k0*this.ms1)),e=this.long0,n<=m?a=this.X0:(a=Math.asin(Math.cos(r)*this.sinX0+t.y*Math.sin(r)*this.cosX0/n),e=W(this.long0+Math.atan2(t.x*Math.sin(r),n*this.cosX0*Math.cos(r)-t.y*this.sinX0*Math.sin(r)))),s=-1*X(this.e,Math.tan(.5*(l+a)));return t.x=e,t.y=s,t},names:["stere","Stereographic_South_Pole","Polar Stereographic (variant B)","Polar_Stereographic"],ssfn_:function(t,e,s){return e*=s,Math.tan(.5*(l+t))*Math.pow((1-e)/(1+e),.5*s)}};var Ce={init:function(){var t=this.lat0;this.lambda0=this.long0;var e=Math.sin(t),s=this.a,i=1/this.rf,r=2*i-Math.pow(i,2),a=this.e=Math.sqrt(r);this.R=this.k0*s*Math.sqrt(1-r)/(1-r*Math.pow(e,2)),this.alpha=Math.sqrt(1+r/(1-r)*Math.pow(Math.cos(t),4)),this.b0=Math.asin(e/this.alpha);var n=Math.log(Math.tan(Math.PI/4+this.b0/2)),o=Math.log(Math.tan(Math.PI/4+t/2)),h=Math.log((1+a*e)/(1-a*e));this.K=n-this.alpha*o+this.alpha*a/2*h},forward:function(t){var e=Math.log(Math.tan(Math.PI/4-t.y/2)),s=this.e/2*Math.log((1+this.e*Math.sin(t.y))/(1-this.e*Math.sin(t.y))),i=-this.alpha*(e+s)+this.K,r=2*(Math.atan(Math.exp(i))-Math.PI/4),a=this.alpha*(t.x-this.lambda0),n=Math.atan(Math.sin(a)/(Math.sin(this.b0)*Math.tan(r)+Math.cos(this.b0)*Math.cos(a))),o=Math.asin(Math.cos(this.b0)*Math.sin(r)-Math.sin(this.b0)*Math.cos(r)*Math.cos(a));return t.y=this.R/2*Math.log((1+Math.sin(o))/(1-Math.sin(o)))+this.y0,t.x=this.R*n+this.x0,t},inverse:function(t){for(var e=t.x-this.x0,s=t.y-this.y0,i=e/this.R,r=2*(Math.atan(Math.exp(s/this.R))-Math.PI/4),a=Math.asin(Math.cos(this.b0)*Math.sin(r)+Math.sin(this.b0)*Math.cos(r)*Math.cos(i)),n=Math.atan(Math.sin(i)/(Math.cos(this.b0)*Math.cos(i)-Math.sin(this.b0)*Math.tan(r))),o=this.lambda0+n/this.alpha,h=0,l=a,c=-1e3,u=0;Math.abs(l-c)>1e-7;){if(++u>20)return;h=1/this.alpha*(Math.log(Math.tan(Math.PI/4+a/2))-this.K)+this.e*Math.log(Math.tan(Math.PI/4+Math.asin(this.e*Math.sin(l))/2)),c=l,l=2*Math.atan(Math.exp(h))-Math.PI/2}return t.x=o,t.y=l,t},names:["somerc"]},_e=1e-7;var Te={init:function(){var t,e,s,i,r,a,n,o,h,c,u,d,f,y=0,M=0,b=0,w=0,v=0,S=0,C=0;this.no_off=(f="object"==typeof(d=this).PROJECTION?Object.keys(d.PROJECTION)[0]:d.PROJECTION,"no_uoff"in d||"no_off"in d||-1!==["Hotine_Oblique_Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin"].indexOf(f)),this.no_rot="no_rot"in this;var _=!1;"alpha"in this&&(_=!0);var T=!1;if("rectified_grid_angle"in this&&(T=!0),_&&(C=this.alpha),T&&(y=this.rectified_grid_angle*p),_||T)M=this.longc;else if(b=this.long1,v=this.lat1,w=this.long2,S=this.lat2,Math.abs(v-S)<=_e||(t=Math.abs(v))<=_e||Math.abs(t-l)<=_e||Math.abs(Math.abs(this.lat0)-l)<=_e||Math.abs(Math.abs(S)-l)<=_e)throw new Error;var D=1-this.es;e=Math.sqrt(D),Math.abs(this.lat0)>m?(o=Math.sin(this.lat0),s=Math.cos(this.lat0),t=1-this.es*o*o,this.B=s*s,this.B=Math.sqrt(1+this.es*this.B*this.B/D),this.A=this.B*this.k0*e/t,(r=(i=this.B*e/(s*Math.sqrt(t)))*i-1)<=0?r=0:(r=Math.sqrt(r),this.lat0<0&&(r=-r)),this.E=r+=i,this.E*=Math.pow(Q(this.e,this.lat0,o),this.B)):(this.B=1/e,this.A=this.k0,this.E=i=r=1),_||T?(_?(u=Math.asin(Math.sin(C)/i),T||(y=C)):(u=y,C=Math.asin(i*Math.sin(u))),this.lam0=M-Math.asin(.5*(r-1/r)*Math.tan(u))/this.B):(a=Math.pow(Q(this.e,v,Math.sin(v)),this.B),n=Math.pow(Q(this.e,S,Math.sin(S)),this.B),r=this.E/a,h=(n-a)/(n+a),c=((c=this.E*this.E)-n*a)/(c+n*a),(t=b-w)<-Math.pi?w-=g:t>Math.pi&&(w+=g),this.lam0=W(.5*(b+w)-Math.atan(c*Math.tan(.5*this.B*(b-w))/h)/this.B),u=Math.atan(2*Math.sin(this.B*W(b-this.lam0))/(r-1/r)),y=C=Math.asin(i*Math.sin(u))),this.singam=Math.sin(u),this.cosgam=Math.cos(u),this.sinrot=Math.sin(y),this.cosrot=Math.cos(y),this.rB=1/this.B,this.ArB=this.A*this.rB,this.BrA=1/this.ArB,this.A,this.B,this.no_off?this.u_0=0:(this.u_0=Math.abs(this.ArB*Math.atan(Math.sqrt(i*i-1)/Math.cos(C))),this.lat0<0&&(this.u_0=-this.u_0)),r=.5*u,this.v_pole_n=this.ArB*Math.log(Math.tan(x-r)),this.v_pole_s=this.ArB*Math.log(Math.tan(x+r))},forward:function(t){var e,s,i,r,a,n,o,h,c={};if(t.x=t.x-this.lam0,Math.abs(Math.abs(t.y)-l)>m){if(e=.5*((a=this.E/Math.pow(Q(this.e,t.y,Math.sin(t.y)),this.B))-(n=1/a)),s=.5*(a+n),r=Math.sin(this.B*t.x),i=(e*this.singam-r*this.cosgam)/s,Math.abs(Math.abs(i)-1)<m)throw new Error;h=.5*this.ArB*Math.log((1-i)/(1+i)),n=Math.cos(this.B*t.x),o=Math.abs(n)<_e?this.A*t.x:this.ArB*Math.atan2(e*this.cosgam+r*this.singam,n)}else h=t.y>0?this.v_pole_n:this.v_pole_s,o=this.ArB*t.y;return this.no_rot?(c.x=o,c.y=h):(o-=this.u_0,c.x=h*this.cosrot+o*this.sinrot,c.y=o*this.cosrot-h*this.sinrot),c.x=this.a*c.x+this.x0,c.y=this.a*c.y+this.y0,c},inverse:function(t){var e,s,i,r,a,n,o,h={};if(t.x=(t.x-this.x0)*(1/this.a),t.y=(t.y-this.y0)*(1/this.a),this.no_rot?(s=t.y,e=t.x):(s=t.x*this.cosrot-t.y*this.sinrot,e=t.y*this.cosrot+t.x*this.sinrot+this.u_0),r=.5*((i=Math.exp(-this.BrA*s))-1/i),a=.5*(i+1/i),o=((n=Math.sin(this.BrA*e))*this.cosgam+r*this.singam)/a,Math.abs(Math.abs(o)-1)<m)h.x=0,h.y=o<0?-l:l;else{if(h.y=this.E/Math.sqrt((1+o)/(1-o)),h.y=X(this.e,Math.pow(h.y,1/this.B)),h.y===1/0)throw new Error;h.x=-this.rB*Math.atan2(r*this.cosgam-n*this.singam,Math.cos(this.BrA*e))}return h.x+=this.lam0,h},names:["Hotine_Oblique_Mercator","Hotine Oblique Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin","Hotine_Oblique_Mercator_Two_Point_Natural_Origin","Hotine_Oblique_Mercator_Azimuth_Center","Oblique_Mercator","omerc"]};var De={init:function(){if(this.lat2||(this.lat2=this.lat1),this.k0||(this.k0=1),this.x0=this.x0||0,this.y0=this.y0||0,!(Math.abs(this.lat1+this.lat2)<m)){var t=this.b/this.a;this.e=Math.sqrt(1-t*t);var e=Math.sin(this.lat1),s=Math.cos(this.lat1),i=G(this.e,e,s),r=Q(this.e,this.lat1,e),a=Math.sin(this.lat2),n=Math.cos(this.lat2),o=G(this.e,a,n),h=Q(this.e,this.lat2,a),l=Q(this.e,this.lat0,Math.sin(this.lat0));Math.abs(this.lat1-this.lat2)>m?this.ns=Math.log(i/o)/Math.log(r/h):this.ns=e,isNaN(this.ns)&&(this.ns=e),this.f0=i/(this.ns*Math.pow(r,this.ns)),this.rh=this.a*this.f0*Math.pow(l,this.ns),this.title||(this.title="Lambert Conformal Conic")}},forward:function(t){var e=t.x,s=t.y;Math.abs(2*Math.abs(s)-Math.PI)<=m&&(s=j(s)*(l-2*m));var i,r,a=Math.abs(Math.abs(s)-l);if(a>m)i=Q(this.e,s,Math.sin(s)),r=this.a*this.f0*Math.pow(i,this.ns);else{if((a=s*this.ns)<=0)return null;r=0}var n=this.ns*W(e-this.long0);return t.x=this.k0*(r*Math.sin(n))+this.x0,t.y=this.k0*(this.rh-r*Math.cos(n))+this.y0,t},inverse:function(t){var e,s,i,r,a,n=(t.x-this.x0)/this.k0,o=this.rh-(t.y-this.y0)/this.k0;this.ns>0?(e=Math.sqrt(n*n+o*o),s=1):(e=-Math.sqrt(n*n+o*o),s=-1);var h=0;if(0!==e&&(h=Math.atan2(s*n,s*o)),0!==e||this.ns>0){if(s=1/this.ns,i=Math.pow(e/(this.a*this.f0),s),-9999===(r=X(this.e,i)))return null}else r=-l;return a=W(h/this.ns+this.long0),t.x=a,t.y=r,t},names:["Lambert Tangential Conformal Conic Projection","Lambert_Conformal_Conic","Lambert_Conformal_Conic_1SP","Lambert_Conformal_Conic_2SP","lcc","Lambert Conic Conformal (1SP)","Lambert Conic Conformal (2SP)"]};var Pe={init:function(){this.a=6377397.155,this.es=.006674372230614,this.e=Math.sqrt(this.es),this.lat0||(this.lat0=.863937979737193),this.long0||(this.long0=.4334234309119251),this.k0||(this.k0=.9999),this.s45=.785398163397448,this.s90=2*this.s45,this.fi0=this.lat0,this.e2=this.es,this.e=Math.sqrt(this.e2),this.alfa=Math.sqrt(1+this.e2*Math.pow(Math.cos(this.fi0),4)/(1-this.e2)),this.uq=1.04216856380474,this.u0=Math.asin(Math.sin(this.fi0)/this.alfa),this.g=Math.pow((1+this.e*Math.sin(this.fi0))/(1-this.e*Math.sin(this.fi0)),this.alfa*this.e/2),this.k=Math.tan(this.u0/2+this.s45)/Math.pow(Math.tan(this.fi0/2+this.s45),this.alfa)*this.g,this.k1=this.k0,this.n0=this.a*Math.sqrt(1-this.e2)/(1-this.e2*Math.pow(Math.sin(this.fi0),2)),this.s0=1.37008346281555,this.n=Math.sin(this.s0),this.ro0=this.k1*this.n0/Math.tan(this.s0),this.ad=this.s90-this.uq},forward:function(t){var e,s,i,r,a,n,o,h=t.x,l=t.y,c=W(h-this.long0);return e=Math.pow((1+this.e*Math.sin(l))/(1-this.e*Math.sin(l)),this.alfa*this.e/2),s=2*(Math.atan(this.k*Math.pow(Math.tan(l/2+this.s45),this.alfa)/e)-this.s45),i=-c*this.alfa,r=Math.asin(Math.cos(this.ad)*Math.sin(s)+Math.sin(this.ad)*Math.cos(s)*Math.cos(i)),a=Math.asin(Math.cos(s)*Math.sin(i)/Math.cos(r)),n=this.n*a,o=this.ro0*Math.pow(Math.tan(this.s0/2+this.s45),this.n)/Math.pow(Math.tan(r/2+this.s45),this.n),t.y=o*Math.cos(n)/1,t.x=o*Math.sin(n)/1,this.czech||(t.y*=-1,t.x*=-1),t},inverse:function(t){var e,s,i,r,a,n,o,h=t.x;t.x=t.y,t.y=h,this.czech||(t.y*=-1,t.x*=-1),a=Math.sqrt(t.x*t.x+t.y*t.y),r=Math.atan2(t.y,t.x)/Math.sin(this.s0),i=2*(Math.atan(Math.pow(this.ro0/a,1/this.n)*Math.tan(this.s0/2+this.s45))-this.s45),e=Math.asin(Math.cos(this.ad)*Math.sin(i)-Math.sin(this.ad)*Math.cos(i)*Math.cos(r)),s=Math.asin(Math.cos(i)*Math.sin(r)/Math.cos(e)),t.x=this.long0-s/this.alfa,n=e,o=0;var l=0;do{t.y=2*(Math.atan(Math.pow(this.k,-1/this.alfa)*Math.pow(Math.tan(e/2+this.s45),1/this.alfa)*Math.pow((1+this.e*Math.sin(n))/(1-this.e*Math.sin(n)),this.e/2))-this.s45),Math.abs(n-t.y)<1e-10&&(o=1),n=t.y,l+=1}while(0===o&&l<15);return l>=15?null:t},names:["Krovak","krovak"]};function ze(t,e,s,i,r){return t*r-e*Math.sin(2*r)+s*Math.sin(4*r)-i*Math.sin(6*r)}function Ae(t){return 1-.25*t*(1+t/16*(3+1.25*t))}function Ee(t){return.375*t*(1+.25*t*(1+.46875*t))}function Ie(t){return.05859375*t*t*(1+.75*t)}function Fe(t){return t*t*t*(35/3072)}function Re(t,e,s){var i=e*s;return t/Math.sqrt(1-i*i)}function ke(t){return Math.abs(t)<l?t:t-j(t)*Math.PI}function Ne(t,e,s,i,r){var a,n;a=t/e;for(var o=0;o<15;o++)if(a+=n=(t-(e*a-s*Math.sin(2*a)+i*Math.sin(4*a)-r*Math.sin(6*a)))/(e-2*s*Math.cos(2*a)+4*i*Math.cos(4*a)-6*r*Math.cos(6*a)),Math.abs(n)<=1e-10)return a;return NaN}var Be={init:function(){this.sphere||(this.e0=Ae(this.es),this.e1=Ee(this.es),this.e2=Ie(this.es),this.e3=Fe(this.es),this.ml0=this.a*ze(this.e0,this.e1,this.e2,this.e3,this.lat0))},forward:function(t){var e,s,i=t.x,r=t.y;if(i=W(i-this.long0),this.sphere)e=this.a*Math.asin(Math.cos(r)*Math.sin(i)),s=this.a*(Math.atan2(Math.tan(r),Math.cos(i))-this.lat0);else{var a=Math.sin(r),n=Math.cos(r),o=Re(this.a,this.e,a),h=Math.tan(r)*Math.tan(r),l=i*Math.cos(r),c=l*l,u=this.es*n*n/(1-this.es);e=o*l*(1-c*h*(1/6-(8-h+8*u)*c/120)),s=this.a*ze(this.e0,this.e1,this.e2,this.e3,r)-this.ml0+o*a/n*c*(.5+(5-h+6*u)*c/24)}return t.x=e+this.x0,t.y=s+this.y0,t},inverse:function(t){t.x-=this.x0,t.y-=this.y0;var e,s,i=t.x/this.a,r=t.y/this.a;if(this.sphere){var a=r+this.lat0;e=Math.asin(Math.sin(a)*Math.cos(i)),s=Math.atan2(Math.tan(i),Math.cos(a))}else{var n=Ne(this.ml0/this.a+r,this.e0,this.e1,this.e2,this.e3);if(Math.abs(Math.abs(n)-l)<=m)return t.x=this.long0,t.y=l,r<0&&(t.y*=-1),t;var o=Re(this.a,this.e,Math.sin(n)),h=o*o*o/this.a/this.a*(1-this.es),c=Math.pow(Math.tan(n),2),u=i*this.a/o,d=u*u;e=n-o*Math.tan(n)/h*u*u*(.5-(1+3*c)*u*u/24),s=u*(1-d*(c/3+(1+3*c)*c*d/15))/Math.cos(n)}return t.x=W(s+this.long0),t.y=ke(e),t},names:["Cassini","Cassini_Soldner","cass"]};function Le(t,e){var s;return t>1e-7?(1-t*t)*(e/(1-(s=t*e)*s)-.5/t*Math.log((1-s)/(1+s))):2*e}var qe=.3333333333333333,He=.17222222222222222,Ue=.10257936507936508,Oe=.06388888888888888,Ve=.0664021164021164,Ge=.016415012942191543;var je={init:function(){var t,e=Math.abs(this.lat0);if(Math.abs(e-l)<m?this.mode=this.lat0<0?this.S_POLE:this.N_POLE:Math.abs(e)<m?this.mode=this.EQUIT:this.mode=this.OBLIQ,this.es>0)switch(this.qp=Le(this.e,1),this.mmf=.5/(1-this.es),this.apa=function(t){var e,s=[];return s[0]=t*qe,e=t*t,s[0]+=e*He,s[1]=e*Oe,e*=t,s[0]+=e*Ue,s[1]+=e*Ve,s[2]=e*Ge,s}(this.es),this.mode){case this.N_POLE:case this.S_POLE:this.dd=1;break;case this.EQUIT:this.rq=Math.sqrt(.5*this.qp),this.dd=1/this.rq,this.xmf=1,this.ymf=.5*this.qp;break;case this.OBLIQ:this.rq=Math.sqrt(.5*this.qp),t=Math.sin(this.lat0),this.sinb1=Le(this.e,t)/this.qp,this.cosb1=Math.sqrt(1-this.sinb1*this.sinb1),this.dd=Math.cos(this.lat0)/(Math.sqrt(1-this.es*t*t)*this.rq*this.cosb1),this.ymf=(this.xmf=this.rq)/this.dd,this.xmf*=this.dd}else this.mode===this.OBLIQ&&(this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0))},forward:function(t){var e,s,i,r,a,n,o,h,c,u,d=t.x,p=t.y;if(d=W(d-this.long0),this.sphere){if(a=Math.sin(p),u=Math.cos(p),i=Math.cos(d),this.mode===this.OBLIQ||this.mode===this.EQUIT){if((s=this.mode===this.EQUIT?1+u*i:1+this.sinph0*a+this.cosph0*u*i)<=m)return null;e=(s=Math.sqrt(2/s))*u*Math.sin(d),s*=this.mode===this.EQUIT?a:this.cosph0*a-this.sinph0*u*i}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(i=-i),Math.abs(p+this.lat0)<m)return null;s=x-.5*p,e=(s=2*(this.mode===this.S_POLE?Math.cos(s):Math.sin(s)))*Math.sin(d),s*=i}}else{switch(o=0,h=0,c=0,i=Math.cos(d),r=Math.sin(d),a=Math.sin(p),n=Le(this.e,a),this.mode!==this.OBLIQ&&this.mode!==this.EQUIT||(o=n/this.qp,h=Math.sqrt(1-o*o)),this.mode){case this.OBLIQ:c=1+this.sinb1*o+this.cosb1*h*i;break;case this.EQUIT:c=1+h*i;break;case this.N_POLE:c=l+p,n=this.qp-n;break;case this.S_POLE:c=p-l,n=this.qp+n}if(Math.abs(c)<m)return null;switch(this.mode){case this.OBLIQ:case this.EQUIT:c=Math.sqrt(2/c),s=this.mode===this.OBLIQ?this.ymf*c*(this.cosb1*o-this.sinb1*h*i):(c=Math.sqrt(2/(1+h*i)))*o*this.ymf,e=this.xmf*c*h*r;break;case this.N_POLE:case this.S_POLE:n>=0?(e=(c=Math.sqrt(n))*r,s=i*(this.mode===this.S_POLE?c:-c)):e=s=0}}return t.x=this.a*e+this.x0,t.y=this.a*s+this.y0,t},inverse:function(t){t.x-=this.x0,t.y-=this.y0;var e,s,i,r,a,n,o,h,c,u,d=t.x/this.a,p=t.y/this.a;if(this.sphere){var f,x=0,g=0;if((s=.5*(f=Math.sqrt(d*d+p*p)))>1)return null;switch(s=2*Math.asin(s),this.mode!==this.OBLIQ&&this.mode!==this.EQUIT||(g=Math.sin(s),x=Math.cos(s)),this.mode){case this.EQUIT:s=Math.abs(f)<=m?0:Math.asin(p*g/f),d*=g,p=x*f;break;case this.OBLIQ:s=Math.abs(f)<=m?this.lat0:Math.asin(x*this.sinph0+p*g*this.cosph0/f),d*=g*this.cosph0,p=(x-Math.sin(s)*this.sinph0)*f;break;case this.N_POLE:p=-p,s=l-s;break;case this.S_POLE:s-=l}e=0!==p||this.mode!==this.EQUIT&&this.mode!==this.OBLIQ?Math.atan2(d,p):0}else{if(o=0,this.mode===this.OBLIQ||this.mode===this.EQUIT){if(d/=this.dd,p*=this.dd,(n=Math.sqrt(d*d+p*p))<m)return t.x=this.long0,t.y=this.lat0,t;r=2*Math.asin(.5*n/this.rq),i=Math.cos(r),d*=r=Math.sin(r),this.mode===this.OBLIQ?(o=i*this.sinb1+p*r*this.cosb1/n,a=this.qp*o,p=n*this.cosb1*i-p*this.sinb1*r):(o=p*r/n,a=this.qp*o,p=n*i)}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(p=-p),!(a=d*d+p*p))return t.x=this.long0,t.y=this.lat0,t;o=1-a/this.qp,this.mode===this.S_POLE&&(o=-o)}e=Math.atan2(d,p),h=Math.asin(o),c=this.apa,u=h+h,s=h+c[0]*Math.sin(u)+c[1]*Math.sin(u+u)+c[2]*Math.sin(u+u+u)}return t.x=W(this.long0+e),t.y=s,t},names:["Lambert Azimuthal Equal Area","Lambert_Azimuthal_Equal_Area","laea"],S_POLE:1,N_POLE:2,EQUIT:3,OBLIQ:4};function We(t){return Math.abs(t)>1&&(t=t>1?1:-1),Math.asin(t)}var Qe={init:function(){Math.abs(this.lat1+this.lat2)<m||(this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e3=Math.sqrt(this.es),this.sin_po=Math.sin(this.lat1),this.cos_po=Math.cos(this.lat1),this.t1=this.sin_po,this.con=this.sin_po,this.ms1=G(this.e3,this.sin_po,this.cos_po),this.qs1=Le(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat2),this.cos_po=Math.cos(this.lat2),this.t2=this.sin_po,this.ms2=G(this.e3,this.sin_po,this.cos_po),this.qs2=Le(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat0),this.cos_po=Math.cos(this.lat0),this.t3=this.sin_po,this.qs0=Le(this.e3,this.sin_po),Math.abs(this.lat1-this.lat2)>m?this.ns0=(this.ms1*this.ms1-this.ms2*this.ms2)/(this.qs2-this.qs1):this.ns0=this.con,this.c=this.ms1*this.ms1+this.ns0*this.qs1,this.rh=this.a*Math.sqrt(this.c-this.ns0*this.qs0)/this.ns0)},forward:function(t){var e=t.x,s=t.y;this.sin_phi=Math.sin(s),this.cos_phi=Math.cos(s);var i=Le(this.e3,this.sin_phi),r=this.a*Math.sqrt(this.c-this.ns0*i)/this.ns0,a=this.ns0*W(e-this.long0),n=r*Math.sin(a)+this.x0,o=this.rh-r*Math.cos(a)+this.y0;return t.x=n,t.y=o,t},inverse:function(t){var e,s,i,r,a,n;return t.x-=this.x0,t.y=this.rh-t.y+this.y0,this.ns0>=0?(e=Math.sqrt(t.x*t.x+t.y*t.y),i=1):(e=-Math.sqrt(t.x*t.x+t.y*t.y),i=-1),r=0,0!==e&&(r=Math.atan2(i*t.x,i*t.y)),i=e*this.ns0/this.a,this.sphere?n=Math.asin((this.c-i*i)/(2*this.ns0)):(s=(this.c-i*i)/this.ns0,n=this.phi1z(this.e3,s)),a=W(r/this.ns0+this.long0),t.x=a,t.y=n,t},names:["Albers_Conic_Equal_Area","Albers","aea"],phi1z:function(t,e){var s,i,r,a,n=We(.5*e);if(t<m)return n;for(var o=t*t,h=1;h<=25;h++)if(n+=a=.5*(r=1-(i=t*(s=Math.sin(n)))*i)*r/Math.cos(n)*(e/(1-o)-s/r+.5/t*Math.log((1-i)/(1+i))),Math.abs(a)<=1e-7)return n;return null}};var Xe={init:function(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0),this.infinity_dist=1e3*this.a,this.rc=1},forward:function(t){var e,s,i,r,a,n,o,h=t.x,l=t.y;return i=W(h-this.long0),e=Math.sin(l),s=Math.cos(l),r=Math.cos(i),(a=this.sin_p14*e+this.cos_p14*s*r)>0||Math.abs(a)<=m?(n=this.x0+1*this.a*s*Math.sin(i)/a,o=this.y0+1*this.a*(this.cos_p14*e-this.sin_p14*s*r)/a):(n=this.x0+this.infinity_dist*s*Math.sin(i),o=this.y0+this.infinity_dist*(this.cos_p14*e-this.sin_p14*s*r)),t.x=n,t.y=o,t},inverse:function(t){var e,s,i,r,a,n;return t.x=(t.x-this.x0)/this.a,t.y=(t.y-this.y0)/this.a,t.x/=this.k0,t.y/=this.k0,(e=Math.sqrt(t.x*t.x+t.y*t.y))?(r=Math.atan2(e,this.rc),s=Math.sin(r),n=We((i=Math.cos(r))*this.sin_p14+t.y*s*this.cos_p14/e),a=Math.atan2(t.x*s,e*this.cos_p14*i-t.y*this.sin_p14*s),a=W(this.long0+a)):(n=this.phic0,a=0),t.x=a,t.y=n,t},names:["gnom"]};var Ye={init:function(){this.sphere||(this.k0=G(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)))},forward:function(t){var e,s,i=t.x,r=t.y,a=W(i-this.long0);if(this.sphere)e=this.x0+this.a*a*Math.cos(this.lat_ts),s=this.y0+this.a*Math.sin(r)/Math.cos(this.lat_ts);else{var n=Le(this.e,Math.sin(r));e=this.x0+this.a*this.k0*a,s=this.y0+this.a*n*.5/this.k0}return t.x=e,t.y=s,t},inverse:function(t){var e,s;return t.x-=this.x0,t.y-=this.y0,this.sphere?(e=W(this.long0+t.x/this.a/Math.cos(this.lat_ts)),s=Math.asin(t.y/this.a*Math.cos(this.lat_ts))):(s=function(t,e){var s=1-(1-t*t)/(2*t)*Math.log((1-t)/(1+t));if(Math.abs(Math.abs(e)-s)<1e-6)return e<0?-1*l:l;for(var i,r,a,n,o=Math.asin(.5*e),h=0;h<30;h++)if(r=Math.sin(o),a=Math.cos(o),n=t*r,o+=i=Math.pow(1-n*n,2)/(2*a)*(e/(1-t*t)-r/(1-n*n)+.5/t*Math.log((1-n)/(1+n))),Math.abs(i)<=1e-10)return o;return NaN}(this.e,2*t.y*this.k0/this.a),e=W(this.long0+t.x/(this.a*this.k0))),t.x=e,t.y=s,t},names:["cea"]};var Ze={init:function(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Equidistant Cylindrical (Plate Carre)",this.rc=Math.cos(this.lat_ts)},forward:function(t){var e=t.x,s=t.y,i=W(e-this.long0),r=ke(s-this.lat0);return t.x=this.x0+this.a*i*this.rc,t.y=this.y0+this.a*r,t},inverse:function(t){var e=t.x,s=t.y;return t.x=W(this.long0+(e-this.x0)/(this.a*this.rc)),t.y=ke(this.lat0+(s-this.y0)/this.a),t},names:["Equirectangular","Equidistant_Cylindrical","eqc"]};var Ke={init:function(){this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=Ae(this.es),this.e1=Ee(this.es),this.e2=Ie(this.es),this.e3=Fe(this.es),this.ml0=this.a*ze(this.e0,this.e1,this.e2,this.e3,this.lat0)},forward:function(t){var e,s,i,r=t.x,a=t.y,n=W(r-this.long0);if(i=n*Math.sin(a),this.sphere)Math.abs(a)<=m?(e=this.a*n,s=-1*this.a*this.lat0):(e=this.a*Math.sin(i)/Math.tan(a),s=this.a*(ke(a-this.lat0)+(1-Math.cos(i))/Math.tan(a)));else if(Math.abs(a)<=m)e=this.a*n,s=-1*this.ml0;else{var o=Re(this.a,this.e,Math.sin(a))/Math.tan(a);e=o*Math.sin(i),s=this.a*ze(this.e0,this.e1,this.e2,this.e3,a)-this.ml0+o*(1-Math.cos(i))}return t.x=e+this.x0,t.y=s+this.y0,t},inverse:function(t){var e,s,i,r,a,n,o,h,l;if(i=t.x-this.x0,r=t.y-this.y0,this.sphere)if(Math.abs(r+this.a*this.lat0)<=m)e=W(i/this.a+this.long0),s=0;else{var c;for(n=this.lat0+r/this.a,o=i*i/this.a/this.a+n*n,h=n,a=20;a;--a)if(h+=l=-1*(n*(h*(c=Math.tan(h))+1)-h-.5*(h*h+o)*c)/((h-n)/c-1),Math.abs(l)<=m){s=h;break}e=W(this.long0+Math.asin(i*Math.tan(h)/this.a)/Math.sin(s))}else if(Math.abs(r+this.ml0)<=m)s=0,e=W(this.long0+i/this.a);else{var u,d,p,f,x;for(n=(this.ml0+r)/this.a,o=i*i/this.a/this.a+n*n,h=n,a=20;a;--a)if(x=this.e*Math.sin(h),u=Math.sqrt(1-x*x)*Math.tan(h),d=this.a*ze(this.e0,this.e1,this.e2,this.e3,h),p=this.e0-2*this.e1*Math.cos(2*h)+4*this.e2*Math.cos(4*h)-6*this.e3*Math.cos(6*h),h-=l=(n*(u*(f=d/this.a)+1)-f-.5*u*(f*f+o))/(this.es*Math.sin(2*h)*(f*f+o-2*n*f)/(4*u)+(n-f)*(u*p-2/Math.sin(2*h))-p),Math.abs(l)<=m){s=h;break}u=Math.sqrt(1-this.es*Math.pow(Math.sin(s),2))*Math.tan(s),e=W(this.long0+Math.asin(i*u/this.a)/Math.sin(s))}return t.x=e,t.y=s,t},names:["Polyconic","poly"]};var Je={init:function(){this.A=[],this.A[1]=.6399175073,this.A[2]=-.1358797613,this.A[3]=.063294409,this.A[4]=-.02526853,this.A[5]=.0117879,this.A[6]=-.0055161,this.A[7]=.0026906,this.A[8]=-.001333,this.A[9]=67e-5,this.A[10]=-34e-5,this.B_re=[],this.B_im=[],this.B_re[1]=.7557853228,this.B_im[1]=0,this.B_re[2]=.249204646,this.B_im[2]=.003371507,this.B_re[3]=-.001541739,this.B_im[3]=.04105856,this.B_re[4]=-.10162907,this.B_im[4]=.01727609,this.B_re[5]=-.26623489,this.B_im[5]=-.36249218,this.B_re[6]=-.6870983,this.B_im[6]=-1.1651967,this.C_re=[],this.C_im=[],this.C_re[1]=1.3231270439,this.C_im[1]=0,this.C_re[2]=-.577245789,this.C_im[2]=-.007809598,this.C_re[3]=.508307513,this.C_im[3]=-.112208952,this.C_re[4]=-.15094762,this.C_im[4]=.18200602,this.C_re[5]=1.01418179,this.C_im[5]=1.64497696,this.C_re[6]=1.9660549,this.C_im[6]=2.5127645,this.D=[],this.D[1]=1.5627014243,this.D[2]=.5185406398,this.D[3]=-.03333098,this.D[4]=-.1052906,this.D[5]=-.0368594,this.D[6]=.007317,this.D[7]=.0122,this.D[8]=.00394,this.D[9]=-.0013},forward:function(t){var e,s=t.x,i=t.y-this.lat0,r=s-this.long0,a=i/h*1e-5,n=r,o=1,l=0;for(e=1;e<=10;e++)o*=a,l+=this.A[e]*o;var c,u=l,d=n,m=1,p=0,f=0,x=0;for(e=1;e<=6;e++)c=p*u+m*d,m=m*u-p*d,p=c,f=f+this.B_re[e]*m-this.B_im[e]*p,x=x+this.B_im[e]*m+this.B_re[e]*p;return t.x=x*this.a+this.x0,t.y=f*this.a+this.y0,t},inverse:function(t){var e,s,i=t.x,r=t.y,a=i-this.x0,n=(r-this.y0)/this.a,o=a/this.a,l=1,c=0,u=0,d=0;for(e=1;e<=6;e++)s=c*n+l*o,l=l*n-c*o,c=s,u=u+this.C_re[e]*l-this.C_im[e]*c,d=d+this.C_im[e]*l+this.C_re[e]*c;for(var m=0;m<this.iterations;m++){var p,f=u,x=d,g=n,y=o;for(e=2;e<=6;e++)p=x*u+f*d,f=f*u-x*d,x=p,g+=(e-1)*(this.B_re[e]*f-this.B_im[e]*x),y+=(e-1)*(this.B_im[e]*f+this.B_re[e]*x);f=1,x=0;var M=this.B_re[1],b=this.B_im[1];for(e=2;e<=6;e++)p=x*u+f*d,f=f*u-x*d,x=p,M+=e*(this.B_re[e]*f-this.B_im[e]*x),b+=e*(this.B_im[e]*f+this.B_re[e]*x);var w=M*M+b*b;u=(g*M+y*b)/w,d=(y*M-g*b)/w}var v=u,S=d,C=1,_=0;for(e=1;e<=9;e++)C*=v,_+=this.D[e]*C;var T=this.lat0+_*h*1e5,D=this.long0+S;return t.x=D,t.y=T,t},names:["New_Zealand_Map_Grid","nzmg"]};var $e={init:function(){},forward:function(t){var e=t.x,s=t.y,i=W(e-this.long0),r=this.x0+this.a*i,a=this.y0+this.a*Math.log(Math.tan(Math.PI/4+s/2.5))*1.25;return t.x=r,t.y=a,t},inverse:function(t){t.x-=this.x0,t.y-=this.y0;var e=W(this.long0+t.x/this.a),s=2.5*(Math.atan(Math.exp(.8*t.y/this.a))-Math.PI/4);return t.x=e,t.y=s,t},names:["Miller_Cylindrical","mill"]};var ts={init:function(){this.sphere?(this.n=1,this.m=0,this.es=0,this.C_y=Math.sqrt((this.m+1)/this.n),this.C_x=this.C_y/(this.m+1)):this.en=he(this.es)},forward:function(t){var e,s,i=t.x,r=t.y;if(i=W(i-this.long0),this.sphere){if(this.m)for(var a=this.n*Math.sin(r),n=20;n;--n){var o=(this.m*r+Math.sin(r)-a)/(this.m+Math.cos(r));if(r-=o,Math.abs(o)<m)break}else r=1!==this.n?Math.asin(this.n*Math.sin(r)):r;e=this.a*this.C_x*i*(this.m+Math.cos(r)),s=this.a*this.C_y*r}else{var h=Math.sin(r),l=Math.cos(r);s=this.a*le(r,h,l,this.en),e=this.a*i*l/Math.sqrt(1-this.es*h*h)}return t.x=e,t.y=s,t},inverse:function(t){var e,s,i;return t.x-=this.x0,s=t.x/this.a,t.y-=this.y0,e=t.y/this.a,this.sphere?(e/=this.C_y,s/=this.C_x*(this.m+Math.cos(e)),this.m?e=We((this.m*e+Math.sin(e))/this.n):1!==this.n&&(e=We(Math.sin(e)/this.n)),s=W(s+this.long0),e=ke(e)):(e=ue(t.y/this.a,this.es,this.en),(i=Math.abs(e))<l?(i=Math.sin(e),s=W(this.long0+t.x*Math.sqrt(1-this.es*i*i)/(this.a*Math.cos(e)))):i-m<l&&(s=this.long0)),t.x=s,t.y=e,t},names:["Sinusoidal","sinu"]};var es={init:function(){},forward:function(t){for(var e=t.x,s=t.y,i=W(e-this.long0),r=s,a=Math.PI*Math.sin(s);;){var n=-(r+Math.sin(r)-a)/(1+Math.cos(r));if(r+=n,Math.abs(n)<m)break}r/=2,Math.PI/2-Math.abs(s)<m&&(i=0);var o=.900316316158*this.a*i*Math.cos(r)+this.x0,h=1.4142135623731*this.a*Math.sin(r)+this.y0;return t.x=o,t.y=h,t},inverse:function(t){var e,s;t.x-=this.x0,t.y-=this.y0,s=t.y/(1.4142135623731*this.a),Math.abs(s)>.999999999999&&(s=.999999999999),e=Math.asin(s);var i=W(this.long0+t.x/(.900316316158*this.a*Math.cos(e)));i<-Math.PI&&(i=-Math.PI),i>Math.PI&&(i=Math.PI),s=(2*e+Math.sin(2*e))/Math.PI,Math.abs(s)>1&&(s=1);var r=Math.asin(s);return t.x=i,t.y=r,t},names:["Mollweide","moll"]};var ss={init:function(){Math.abs(this.lat1+this.lat2)<m||(this.lat2=this.lat2||this.lat1,this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=Ae(this.es),this.e1=Ee(this.es),this.e2=Ie(this.es),this.e3=Fe(this.es),this.sinphi=Math.sin(this.lat1),this.cosphi=Math.cos(this.lat1),this.ms1=G(this.e,this.sinphi,this.cosphi),this.ml1=ze(this.e0,this.e1,this.e2,this.e3,this.lat1),Math.abs(this.lat1-this.lat2)<m?this.ns=this.sinphi:(this.sinphi=Math.sin(this.lat2),this.cosphi=Math.cos(this.lat2),this.ms2=G(this.e,this.sinphi,this.cosphi),this.ml2=ze(this.e0,this.e1,this.e2,this.e3,this.lat2),this.ns=(this.ms1-this.ms2)/(this.ml2-this.ml1)),this.g=this.ml1+this.ms1/this.ns,this.ml0=ze(this.e0,this.e1,this.e2,this.e3,this.lat0),this.rh=this.a*(this.g-this.ml0))},forward:function(t){var e,s=t.x,i=t.y;if(this.sphere)e=this.a*(this.g-i);else{var r=ze(this.e0,this.e1,this.e2,this.e3,i);e=this.a*(this.g-r)}var a=this.ns*W(s-this.long0),n=this.x0+e*Math.sin(a),o=this.y0+this.rh-e*Math.cos(a);return t.x=n,t.y=o,t},inverse:function(t){var e,s,i,r;t.x-=this.x0,t.y=this.rh-t.y+this.y0,this.ns>=0?(s=Math.sqrt(t.x*t.x+t.y*t.y),e=1):(s=-Math.sqrt(t.x*t.x+t.y*t.y),e=-1);var a=0;return 0!==s&&(a=Math.atan2(e*t.x,e*t.y)),this.sphere?(r=W(this.long0+a/this.ns),i=ke(this.g-s/this.a),t.x=r,t.y=i,t):(i=Ne(this.g-s/this.a,this.e0,this.e1,this.e2,this.e3),r=W(this.long0+a/this.ns),t.x=r,t.y=i,t)},names:["Equidistant_Conic","eqdc"]};var is={init:function(){this.R=this.a},forward:function(t){var e,s,i=t.x,r=t.y,a=W(i-this.long0);Math.abs(r)<=m&&(e=this.x0+this.R*a,s=this.y0);var n=We(2*Math.abs(r/Math.PI));(Math.abs(a)<=m||Math.abs(Math.abs(r)-l)<=m)&&(e=this.x0,s=r>=0?this.y0+Math.PI*this.R*Math.tan(.5*n):this.y0+Math.PI*this.R*-Math.tan(.5*n));var o=.5*Math.abs(Math.PI/a-a/Math.PI),h=o*o,c=Math.sin(n),u=Math.cos(n),d=u/(c+u-1),p=d*d,f=d*(2/c-1),x=f*f,g=Math.PI*this.R*(o*(d-x)+Math.sqrt(h*(d-x)*(d-x)-(x+h)*(p-x)))/(x+h);a<0&&(g=-g),e=this.x0+g;var y=h+d;return g=Math.PI*this.R*(f*y-o*Math.sqrt((x+h)*(h+1)-y*y))/(x+h),s=r>=0?this.y0+g:this.y0-g,t.x=e,t.y=s,t},inverse:function(t){var e,s,i,r,a,n,o,h,l,c,u,d;return t.x-=this.x0,t.y-=this.y0,u=Math.PI*this.R,a=(i=t.x/u)*i+(r=t.y/u)*r,u=3*(r*r/(h=-2*(n=-Math.abs(r)*(1+a))+1+2*r*r+a*a)+(2*(o=n-2*r*r+i*i)*o*o/h/h/h-9*n*o/h/h)/27)/(l=(n-o*o/3/h)/h)/(c=2*Math.sqrt(-l/3)),Math.abs(u)>1&&(u=u>=0?1:-1),d=Math.acos(u)/3,s=t.y>=0?(-c*Math.cos(d+Math.PI/3)-o/3/h)*Math.PI:-(-c*Math.cos(d+Math.PI/3)-o/3/h)*Math.PI,e=Math.abs(i)<m?this.long0:W(this.long0+Math.PI*(a-1+Math.sqrt(1+2*(i*i-r*r)+a*a))/2/i),t.x=e,t.y=s,t},names:["Van_der_Grinten_I","VanDerGrinten","vandg"]};var rs={init:function(){this.sin_p12=Math.sin(this.lat0),this.cos_p12=Math.cos(this.lat0)},forward:function(t){var e,s,i,r,a,n,o,h,c,u,d,p,f,x,g,y,M,b,w,v,S,C,_=t.x,T=t.y,D=Math.sin(t.y),P=Math.cos(t.y),z=W(_-this.long0);return this.sphere?Math.abs(this.sin_p12-1)<=m?(t.x=this.x0+this.a*(l-T)*Math.sin(z),t.y=this.y0-this.a*(l-T)*Math.cos(z),t):Math.abs(this.sin_p12+1)<=m?(t.x=this.x0+this.a*(l+T)*Math.sin(z),t.y=this.y0+this.a*(l+T)*Math.cos(z),t):(b=this.sin_p12*D+this.cos_p12*P*Math.cos(z),M=(y=Math.acos(b))?y/Math.sin(y):1,t.x=this.x0+this.a*M*P*Math.sin(z),t.y=this.y0+this.a*M*(this.cos_p12*D-this.sin_p12*P*Math.cos(z)),t):(e=Ae(this.es),s=Ee(this.es),i=Ie(this.es),r=Fe(this.es),Math.abs(this.sin_p12-1)<=m?(a=this.a*ze(e,s,i,r,l),n=this.a*ze(e,s,i,r,T),t.x=this.x0+(a-n)*Math.sin(z),t.y=this.y0-(a-n)*Math.cos(z),t):Math.abs(this.sin_p12+1)<=m?(a=this.a*ze(e,s,i,r,l),n=this.a*ze(e,s,i,r,T),t.x=this.x0+(a+n)*Math.sin(z),t.y=this.y0+(a+n)*Math.cos(z),t):(o=D/P,h=Re(this.a,this.e,this.sin_p12),c=Re(this.a,this.e,D),u=Math.atan((1-this.es)*o+this.es*h*this.sin_p12/(c*P)),w=0===(d=Math.atan2(Math.sin(z),this.cos_p12*Math.tan(u)-this.sin_p12*Math.cos(z)))?Math.asin(this.cos_p12*Math.sin(u)-this.sin_p12*Math.cos(u)):Math.abs(Math.abs(d)-Math.PI)<=m?-Math.asin(this.cos_p12*Math.sin(u)-this.sin_p12*Math.cos(u)):Math.asin(Math.sin(z)*Math.cos(u)/Math.sin(d)),p=this.e*this.sin_p12/Math.sqrt(1-this.es),y=h*w*(1-(v=w*w)*(g=(f=this.e*this.cos_p12*Math.cos(d)/Math.sqrt(1-this.es))*f)*(1-g)/6+(S=v*w)/8*(x=p*f)*(1-2*g)+(C=S*w)/120*(g*(4-7*g)-3*p*p*(1-7*g))-C*w/48*x),t.x=this.x0+y*Math.sin(d),t.y=this.y0+y*Math.cos(d),t))},inverse:function(t){var e,s,i,r,a,n,o,h,c,u,d,p,f,x,g,y,M,b,w,v,S,C,_;if(t.x-=this.x0,t.y-=this.y0,this.sphere){if((e=Math.sqrt(t.x*t.x+t.y*t.y))>2*l*this.a)return;return s=e/this.a,i=Math.sin(s),r=Math.cos(s),a=this.long0,Math.abs(e)<=m?n=this.lat0:(n=We(r*this.sin_p12+t.y*i*this.cos_p12/e),o=Math.abs(this.lat0)-l,a=Math.abs(o)<=m?this.lat0>=0?W(this.long0+Math.atan2(t.x,-t.y)):W(this.long0-Math.atan2(-t.x,t.y)):W(this.long0+Math.atan2(t.x*i,e*this.cos_p12*r-t.y*this.sin_p12*i))),t.x=a,t.y=n,t}return h=Ae(this.es),c=Ee(this.es),u=Ie(this.es),d=Fe(this.es),Math.abs(this.sin_p12-1)<=m?(n=Ne(((p=this.a*ze(h,c,u,d,l))-(e=Math.sqrt(t.x*t.x+t.y*t.y)))/this.a,h,c,u,d),a=W(this.long0+Math.atan2(t.x,-1*t.y)),t.x=a,t.y=n,t):Math.abs(this.sin_p12+1)<=m?(p=this.a*ze(h,c,u,d,l),n=Ne(((e=Math.sqrt(t.x*t.x+t.y*t.y))-p)/this.a,h,c,u,d),a=W(this.long0+Math.atan2(t.x,t.y)),t.x=a,t.y=n,t):(e=Math.sqrt(t.x*t.x+t.y*t.y),g=Math.atan2(t.x,t.y),f=Re(this.a,this.e,this.sin_p12),y=Math.cos(g),b=-(M=this.e*this.cos_p12*y)*M/(1-this.es),w=3*this.es*(1-b)*this.sin_p12*this.cos_p12*y/(1-this.es),C=1-b*(S=(v=e/f)-b*(1+b)*Math.pow(v,3)/6-w*(1+3*b)*Math.pow(v,4)/24)*S/2-v*S*S*S/6,x=Math.asin(this.sin_p12*Math.cos(S)+this.cos_p12*Math.sin(S)*y),a=W(this.long0+Math.asin(Math.sin(g)*Math.sin(S)/Math.cos(x))),_=Math.sin(x),n=Math.atan2((_-this.es*C*this.sin_p12)*Math.tan(x),_*(1-this.es)),t.x=a,t.y=n,t)},names:["Azimuthal_Equidistant","aeqd"]};var as={init:function(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0)},forward:function(t){var e,s,i,r,a,n,o,h=t.x,l=t.y;return i=W(h-this.long0),e=Math.sin(l),s=Math.cos(l),r=Math.cos(i),((a=this.sin_p14*e+this.cos_p14*s*r)>0||Math.abs(a)<=m)&&(n=1*this.a*s*Math.sin(i),o=this.y0+1*this.a*(this.cos_p14*e-this.sin_p14*s*r)),t.x=n,t.y=o,t},inverse:function(t){var e,s,i,r,a,n,o;return t.x-=this.x0,t.y-=this.y0,s=We((e=Math.sqrt(t.x*t.x+t.y*t.y))/this.a),i=Math.sin(s),r=Math.cos(s),n=this.long0,Math.abs(e)<=m?(o=this.lat0,t.x=n,t.y=o,t):(o=We(r*this.sin_p14+t.y*i*this.cos_p14/e),a=Math.abs(this.lat0)-l,Math.abs(a)<=m?(n=this.lat0>=0?W(this.long0+Math.atan2(t.x,-t.y)):W(this.long0-Math.atan2(-t.x,t.y)),t.x=n,t.y=o,t):(n=W(this.long0+Math.atan2(t.x*i,e*this.cos_p14*r-t.y*this.sin_p14*i)),t.x=n,t.y=o,t))},names:["ortho"]},ns=1,os=2,hs=3,ls=4,cs=5,us=6,ds={AREA_0:1,AREA_1:2,AREA_2:3,AREA_3:4};function ms(t,e,s,i){var r;return t<m?(i.value=ds.AREA_0,r=0):(r=Math.atan2(e,s),Math.abs(r)<=x?i.value=ds.AREA_0:r>x&&r<=l+x?(i.value=ds.AREA_1,r-=l):r>l+x||r<=-(l+x)?(i.value=ds.AREA_2,r=r>=0?r-y:r+y):(i.value=ds.AREA_3,r+=l)),r}function ps(t,e){var s=t+e;return s<-y?s+=g:s>+y&&(s-=g),s}var fs={init:function(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Quadrilateralized Spherical Cube",this.lat0>=l-x/2?this.face=cs:this.lat0<=-(l-x/2)?this.face=us:Math.abs(this.long0)<=x?this.face=ns:Math.abs(this.long0)<=l+x?this.face=this.long0>0?os:ls:this.face=hs,0!==this.es&&(this.one_minus_f=1-(this.a-this.b)/this.a,this.one_minus_f_squared=this.one_minus_f*this.one_minus_f)},forward:function(t){var e,s,i,r,a,n,o={x:0,y:0},h={value:0};if(t.x-=this.long0,e=0!==this.es?Math.atan(this.one_minus_f_squared*Math.tan(t.y)):t.y,s=t.x,this.face===cs)r=l-e,s>=x&&s<=l+x?(h.value=ds.AREA_0,i=s-l):s>l+x||s<=-(l+x)?(h.value=ds.AREA_1,i=s>0?s-y:s+y):s>-(l+x)&&s<=-x?(h.value=ds.AREA_2,i=s+l):(h.value=ds.AREA_3,i=s);else if(this.face===us)r=l+e,s>=x&&s<=l+x?(h.value=ds.AREA_0,i=-s+l):s<x&&s>=-x?(h.value=ds.AREA_1,i=-s):s<-x&&s>=-(l+x)?(h.value=ds.AREA_2,i=-s-l):(h.value=ds.AREA_3,i=s>0?-s+y:-s-y);else{var c,u,d,m,p,f;this.face===os?s=ps(s,+l):this.face===hs?s=ps(s,+y):this.face===ls&&(s=ps(s,-l)),m=Math.sin(e),p=Math.cos(e),f=Math.sin(s),c=p*Math.cos(s),u=p*f,d=m,this.face===ns?i=ms(r=Math.acos(c),d,u,h):this.face===os?i=ms(r=Math.acos(u),d,-c,h):this.face===hs?i=ms(r=Math.acos(-c),d,-u,h):this.face===ls?i=ms(r=Math.acos(-u),d,c,h):(r=i=0,h.value=ds.AREA_0)}return n=Math.atan(12/y*(i+Math.acos(Math.sin(i)*Math.cos(x))-l)),a=Math.sqrt((1-Math.cos(r))/(Math.cos(n)*Math.cos(n))/(1-Math.cos(Math.atan(1/Math.cos(i))))),h.value===ds.AREA_1?n+=l:h.value===ds.AREA_2?n+=y:h.value===ds.AREA_3&&(n+=1.5*y),o.x=a*Math.cos(n),o.y=a*Math.sin(n),o.x=o.x*this.a+this.x0,o.y=o.y*this.a+this.y0,t.x=o.x,t.y=o.y,t},inverse:function(t){var e,s,i,r,a,n,o,h,c,u,d,m,p={lam:0,phi:0},f={value:0};if(t.x=(t.x-this.x0)/this.a,t.y=(t.y-this.y0)/this.a,s=Math.atan(Math.sqrt(t.x*t.x+t.y*t.y)),e=Math.atan2(t.y,t.x),t.x>=0&&t.x>=Math.abs(t.y)?f.value=ds.AREA_0:t.y>=0&&t.y>=Math.abs(t.x)?(f.value=ds.AREA_1,e-=l):t.x<0&&-t.x>=Math.abs(t.y)?(f.value=ds.AREA_2,e=e<0?e+y:e-y):(f.value=ds.AREA_3,e+=l),c=y/12*Math.tan(e),a=Math.sin(c)/(Math.cos(c)-1/Math.sqrt(2)),n=Math.atan(a),(o=1-(i=Math.cos(e))*i*(r=Math.tan(s))*r*(1-Math.cos(Math.atan(1/Math.cos(n)))))<-1?o=-1:o>1&&(o=1),this.face===cs)h=Math.acos(o),p.phi=l-h,f.value===ds.AREA_0?p.lam=n+l:f.value===ds.AREA_1?p.lam=n<0?n+y:n-y:f.value===ds.AREA_2?p.lam=n-l:p.lam=n;else if(this.face===us)h=Math.acos(o),p.phi=h-l,f.value===ds.AREA_0?p.lam=-n+l:f.value===ds.AREA_1?p.lam=-n:f.value===ds.AREA_2?p.lam=-n-l:p.lam=n<0?-n-y:-n+y;else{var x,g,M;c=(x=o)*x,g=(c+=(M=c>=1?0:Math.sqrt(1-c)*Math.sin(n))*M)>=1?0:Math.sqrt(1-c),f.value===ds.AREA_1?(c=g,g=-M,M=c):f.value===ds.AREA_2?(g=-g,M=-M):f.value===ds.AREA_3&&(c=g,g=M,M=-c),this.face===os?(c=x,x=-g,g=c):this.face===hs?(x=-x,g=-g):this.face===ls&&(c=x,x=g,g=-c),p.phi=Math.acos(-M)-l,p.lam=Math.atan2(g,x),this.face===os?p.lam=ps(p.lam,-l):this.face===hs?p.lam=ps(p.lam,-y):this.face===ls&&(p.lam=ps(p.lam,+l))}return 0!==this.es&&(u=p.phi<0?1:0,d=Math.tan(p.phi),m=this.b/Math.sqrt(d*d+this.one_minus_f_squared),p.phi=Math.atan(Math.sqrt(this.a*this.a-m*m)/(this.one_minus_f*m)),u&&(p.phi=-p.phi)),p.lam+=this.long0,t.x=p.lam,t.y=p.phi,t},names:["Quadrilateralized Spherical Cube","Quadrilateralized_Spherical_Cube","qsc"]},xs=[[1,22199e-21,-715515e-10,31103e-10],[.9986,-482243e-9,-24897e-9,-13309e-10],[.9954,-83103e-8,-448605e-10,-9.86701e-7],[.99,-.00135364,-59661e-9,36777e-10],[.9822,-.00167442,-449547e-11,-572411e-11],[.973,-.00214868,-903571e-10,1.8736e-8],[.96,-.00305085,-900761e-10,164917e-11],[.9427,-.00382792,-653386e-10,-26154e-10],[.9216,-.00467746,-10457e-8,481243e-11],[.8962,-.00536223,-323831e-10,-543432e-11],[.8679,-.00609363,-113898e-9,332484e-11],[.835,-.00698325,-640253e-10,9.34959e-7],[.7986,-.00755338,-500009e-10,9.35324e-7],[.7597,-.00798324,-35971e-9,-227626e-11],[.7186,-.00851367,-701149e-10,-86303e-10],[.6732,-.00986209,-199569e-9,191974e-10],[.6213,-.010418,883923e-10,624051e-11],[.5722,-.00906601,182e-6,624051e-11],[.5322,-.00677797,275608e-9,624051e-11]],gs=[[-520417e-23,.0124,121431e-23,-845284e-16],[.062,.0124,-1.26793e-9,4.22642e-10],[.124,.0124,5.07171e-9,-1.60604e-9],[.186,.0123999,-1.90189e-8,6.00152e-9],[.248,.0124002,7.10039e-8,-2.24e-8],[.31,.0123992,-2.64997e-7,8.35986e-8],[.372,.0124029,9.88983e-7,-3.11994e-7],[.434,.0123893,-369093e-11,-4.35621e-7],[.4958,.0123198,-102252e-10,-3.45523e-7],[.5571,.0121916,-154081e-10,-5.82288e-7],[.6176,.0119938,-241424e-10,-5.25327e-7],[.6769,.011713,-320223e-10,-5.16405e-7],[.7346,.0113541,-397684e-10,-6.09052e-7],[.7903,.0109107,-489042e-10,-104739e-11],[.8435,.0103431,-64615e-9,-1.40374e-9],[.8936,.00969686,-64636e-9,-8547e-9],[.9394,.00840947,-192841e-9,-42106e-10],[.9761,.00616527,-256e-6,-42106e-10],[1,.00328947,-319159e-9,-42106e-10]],ys=.8487,Ms=1.3523,bs=f/5,ws=1/bs,vs=18,Ss=function(t,e){return t[0]+e*(t[1]+e*(t[2]+e*t[3]))};var Cs={init:function(){this.x0=this.x0||0,this.y0=this.y0||0,this.long0=this.long0||0,this.es=0,this.title=this.title||"Robinson"},forward:function(t){var e=W(t.x-this.long0),s=Math.abs(t.y),i=Math.floor(s*bs);i<0?i=0:i>=vs&&(i=17);var r={x:Ss(xs[i],s=f*(s-ws*i))*e,y:Ss(gs[i],s)};return t.y<0&&(r.y=-r.y),r.x=r.x*this.a*ys+this.x0,r.y=r.y*this.a*Ms+this.y0,r},inverse:function(t){var e={x:(t.x-this.x0)/(this.a*ys),y:Math.abs(t.y-this.y0)/(this.a*Ms)};if(e.y>=1)e.x/=xs[18][0],e.y=t.y<0?-l:l;else{var s=Math.floor(e.y*vs);for(s<0?s=0:s>=vs&&(s=17);;)if(gs[s][0]>e.y)--s;else{if(!(gs[s+1][0]<=e.y))break;++s}var i=gs[s],r=5*(e.y-i[0])/(gs[s+1][0]-i[0]);r=function(t,e,s,i){for(var r=e;i;--i){var a=t(r);if(r-=a,Math.abs(a)<s)break}return r}((function(t){return(Ss(i,t)-e.y)/function(t,e){return t[1]+e*(2*t[2]+3*e*t[3])}(i,t)}),r,m,100),e.x/=Ss(xs[s],r),e.y=(5*s+r)*p,t.y<0&&(e.y=-e.y)}return e.x=W(e.x+this.long0),e},names:["Robinson","robin"]};var _s={init:function(){this.name="geocent"},forward:function(t){return pt(t,this.es,this.a)},inverse:function(t){return ft(t,this.es,this.a,this.b)},names:["Geocentric","geocentric","geocent","Geocent"]},Ts=0,Ds=1,Ps=2,zs=3,As={h:{def:1e5,num:!0},azi:{def:0,num:!0,degrees:!0},tilt:{def:0,num:!0,degrees:!0},long0:{def:0,num:!0},lat0:{def:0,num:!0}};var Es={init:function(){if(Object.keys(As).forEach(function(t){if(void 0===this[t])this[t]=As[t].def;else{if(As[t].num&&isNaN(this[t]))throw new Error("Invalid parameter value, must be numeric "+t+" = "+this[t]);As[t].num&&(this[t]=parseFloat(this[t]))}As[t].degrees&&(this[t]=this[t]*p)}.bind(this)),Math.abs(Math.abs(this.lat0)-l)<m?this.mode=this.lat0<0?Ds:Ts:Math.abs(this.lat0)<m?this.mode=Ps:(this.mode=zs,this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0)),this.pn1=this.h/this.a,this.pn1<=0||this.pn1>1e10)throw new Error("Invalid height");this.p=1+this.pn1,this.rp=1/this.p,this.h1=1/this.pn1,this.pfact=(this.p+1)*this.h1,this.es=0;var t=this.tilt,e=this.azi;this.cg=Math.cos(e),this.sg=Math.sin(e),this.cw=Math.cos(t),this.sw=Math.sin(t)},forward:function(t){t.x-=this.long0;var e,s,i,r,a=Math.sin(t.y),n=Math.cos(t.y),o=Math.cos(t.x);switch(this.mode){case zs:s=this.sinph0*a+this.cosph0*n*o;break;case Ps:s=n*o;break;case Ds:s=-a;break;case Ts:s=a}switch(e=(s=this.pn1/(this.p-s))*n*Math.sin(t.x),this.mode){case zs:s*=this.cosph0*a-this.sinph0*n*o;break;case Ps:s*=a;break;case Ts:s*=-n*o;break;case Ds:s*=n*o}return r=1/((i=s*this.cg+e*this.sg)*this.sw*this.h1+this.cw),e=(e*this.cg-s*this.sg)*this.cw*r,s=i*r,t.x=e*this.a,t.y=s*this.a,t},inverse:function(t){t.x/=this.a,t.y/=this.a;var e,s,i,r={x:t.x,y:t.y};i=1/(this.pn1-t.y*this.sw),e=this.pn1*t.x*i,s=this.pn1*t.y*this.cw*i,t.x=e*this.cg+s*this.sg,t.y=s*this.cg-e*this.sg;var a=pe(t.x,t.y);if(Math.abs(a)<m)r.x=0,r.y=t.y;else{var n,o;switch(o=1-a*a*this.pfact,o=(this.p-Math.sqrt(o))/(this.pn1/a+a/this.pn1),n=Math.sqrt(1-o*o),this.mode){case zs:r.y=Math.asin(n*this.sinph0+t.y*o*this.cosph0/a),t.y=(n-this.sinph0*Math.sin(r.y))*a,t.x*=o*this.cosph0;break;case Ps:r.y=Math.asin(t.y*o/a),t.y=n*a,t.x*=o;break;case Ts:r.y=Math.asin(n),t.y=-t.y;break;case Ds:r.y=-Math.asin(n)}r.x=Math.atan2(t.x,t.y)}return t.x=r.x+this.long0,t.y=r.y,t},names:["Tilted_Perspective","tpers"]};var Is={init:function(){if(this.flip_axis="x"===this.sweep?1:0,this.h=Number(this.h),this.radius_g_1=this.h/this.a,this.radius_g_1<=0||this.radius_g_1>1e10)throw new Error;if(this.radius_g=1+this.radius_g_1,this.C=this.radius_g*this.radius_g-1,0!==this.es){var t=1-this.es,e=1/t;this.radius_p=Math.sqrt(t),this.radius_p2=t,this.radius_p_inv2=e,this.shape="ellipse"}else this.radius_p=1,this.radius_p2=1,this.radius_p_inv2=1,this.shape="sphere";this.title||(this.title="Geostationary Satellite View")},forward:function(t){var e,s,i,r,a=t.x,n=t.y;if(a-=this.long0,"ellipse"===this.shape){n=Math.atan(this.radius_p2*Math.tan(n));var o=this.radius_p/pe(this.radius_p*Math.cos(n),Math.sin(n));if(s=o*Math.cos(a)*Math.cos(n),i=o*Math.sin(a)*Math.cos(n),r=o*Math.sin(n),(this.radius_g-s)*s-i*i-r*r*this.radius_p_inv2<0)return t.x=Number.NaN,t.y=Number.NaN,t;e=this.radius_g-s,this.flip_axis?(t.x=this.radius_g_1*Math.atan(i/pe(r,e)),t.y=this.radius_g_1*Math.atan(r/e)):(t.x=this.radius_g_1*Math.atan(i/e),t.y=this.radius_g_1*Math.atan(r/pe(i,e)))}else"sphere"===this.shape&&(e=Math.cos(n),s=Math.cos(a)*e,i=Math.sin(a)*e,r=Math.sin(n),e=this.radius_g-s,this.flip_axis?(t.x=this.radius_g_1*Math.atan(i/pe(r,e)),t.y=this.radius_g_1*Math.atan(r/e)):(t.x=this.radius_g_1*Math.atan(i/e),t.y=this.radius_g_1*Math.atan(r/pe(i,e))));return t.x=t.x*this.a,t.y=t.y*this.a,t},inverse:function(t){var e,s,i,r,a=-1,n=0,o=0;if(t.x=t.x/this.a,t.y=t.y/this.a,"ellipse"===this.shape){this.flip_axis?(o=Math.tan(t.y/this.radius_g_1),n=Math.tan(t.x/this.radius_g_1)*pe(1,o)):(n=Math.tan(t.x/this.radius_g_1),o=Math.tan(t.y/this.radius_g_1)*pe(1,n));var h=o/this.radius_p;if(e=n*n+h*h+a*a,(i=(s=2*this.radius_g*a)*s-4*e*this.C)<0)return t.x=Number.NaN,t.y=Number.NaN,t;r=(-s-Math.sqrt(i))/(2*e),a=this.radius_g+r*a,n*=r,o*=r,t.x=Math.atan2(n,a),t.y=Math.atan(o*Math.cos(t.x)/a),t.y=Math.atan(this.radius_p_inv2*Math.tan(t.y))}else if("sphere"===this.shape){if(this.flip_axis?(o=Math.tan(t.y/this.radius_g_1),n=Math.tan(t.x/this.radius_g_1)*Math.sqrt(1+o*o)):(n=Math.tan(t.x/this.radius_g_1),o=Math.tan(t.y/this.radius_g_1)*Math.sqrt(1+n*n)),e=n*n+o*o+a*a,(i=(s=2*this.radius_g*a)*s-4*e*this.C)<0)return t.x=Number.NaN,t.y=Number.NaN,t;r=(-s-Math.sqrt(i))/(2*e),a=this.radius_g+r*a,n*=r,o*=r,t.x=Math.atan2(n,a),t.y=Math.atan(o*Math.cos(t.x)/a)}return t.x=t.x+this.long0,t},names:["Geostationary Satellite View","Geostationary_Satellite","geos"]},Fs=1.340264,Rs=-.081106,ks=893e-6,Ns=.003796,Bs=Math.sqrt(3)/2;var Ls,qs={init:function(){this.es=0,this.long0=void 0!==this.long0?this.long0:0},forward:function(t){var e=W(t.x-this.long0),s=t.y,i=Math.asin(Bs*Math.sin(s)),r=i*i,a=r*r*r;return t.x=e*Math.cos(i)/(Bs*(Fs+3*Rs*r+a*(7*ks+9*Ns*r))),t.y=i*(Fs+Rs*r+a*(ks+Ns*r)),t.x=this.a*t.x+this.x0,t.y=this.a*t.y+this.y0,t},inverse:function(t){t.x=(t.x-this.x0)/this.a,t.y=(t.y-this.y0)/this.a;var e,s,i,r,a=t.y;for(r=0;r<12&&(a-=i=(a*(Fs+Rs*(e=a*a)+(s=e*e*e)*(ks+Ns*e))-t.y)/(Fs+3*Rs*e+s*(7*ks+9*Ns*e)),!(Math.abs(i)<1e-9));++r);return s=(e=a*a)*e*e,t.x=Bs*t.x*(Fs+3*Rs*e+s*(7*ks+9*Ns*e))/Math.cos(a),t.y=Math.asin(Math.sin(a)/Bs),t.x=W(t.x+this.long0),t},names:["eqearth","Equal Earth","Equal_Earth"]};function Hs(t){const e=6378137,s=6356752.314245,i=Math.sqrt((e*e-s*s)/(e*e)),r=Math.PI;let a=t[1]*r/180,n=t[0]*r/180,o=t[2],h=e/Math.sqrt(1-i*i*Math.sin(a)*Math.sin(a));return[(h+o)*Math.cos(a)*Math.cos(n),(h+o)*Math.cos(a)*Math.sin(n),(h*(1-i*i)+o)*Math.sin(a)]}if(zt.defaultDatum="WGS84",zt.Proj=mt,zt.WGS84=new zt.Proj("WGS84"),zt.Point=Yt,zt.toPoint=vt,zt.defs=q,zt.nadgrid=function(t,e){var s=new DataView(e),i=function(t){var e=t.getInt32(8,!1);if(11===e)return!1;e=t.getInt32(8,!0),11!==e&&console.warn("Failed to detect nadgrid endian-ness, defaulting to little-endian");return!0}(s),r=function(t,e){return{nFields:t.getInt32(8,e),nSubgridFields:t.getInt32(24,e),nSubgrids:t.getInt32(40,e),shiftType:ht(t,56,64).trim(),fromSemiMajorAxis:t.getFloat64(120,e),fromSemiMinorAxis:t.getFloat64(136,e),toSemiMajorAxis:t.getFloat64(152,e),toSemiMinorAxis:t.getFloat64(168,e)}}(s,i),a=function(t,e,s){for(var i=176,r=[],a=0;a<e.nSubgrids;a++){var n=ct(t,i,s),o=ut(t,i,n,s),h=Math.round(1+(n.upperLongitude-n.lowerLongitude)/n.longitudeInterval),l=Math.round(1+(n.upperLatitude-n.lowerLatitude)/n.latitudeInterval);r.push({ll:[ot(n.lowerLongitude),ot(n.lowerLatitude)],del:[ot(n.longitudeInterval),ot(n.latitudeInterval)],lim:[h,l],count:n.gridNodeCount,cvs:lt(o)}),i+=176+16*n.gridNodeCount}return r}(s,r,i),n={header:r,subgrids:a};return at[t]=n,n},zt.transform=Ct,zt.mgrs=Lt,zt.version="__VERSION__",(Ls=zt).Proj.projections.add(de),Ls.Proj.projections.add(ye),Ls.Proj.projections.add(Me),Ls.Proj.projections.add(ve),Ls.Proj.projections.add(Se),Ls.Proj.projections.add(Ce),Ls.Proj.projections.add(Te),Ls.Proj.projections.add(De),Ls.Proj.projections.add(Pe),Ls.Proj.projections.add(Be),Ls.Proj.projections.add(je),Ls.Proj.projections.add(Qe),Ls.Proj.projections.add(Xe),Ls.Proj.projections.add(Ye),Ls.Proj.projections.add(Ze),Ls.Proj.projections.add(Ke),Ls.Proj.projections.add(Je),Ls.Proj.projections.add($e),Ls.Proj.projections.add(ts),Ls.Proj.projections.add(es),Ls.Proj.projections.add(ss),Ls.Proj.projections.add(is),Ls.Proj.projections.add(rs),Ls.Proj.projections.add(as),Ls.Proj.projections.add(fs),Ls.Proj.projections.add(Cs),Ls.Proj.projections.add(_s),Ls.Proj.projections.add(Es),Ls.Proj.projections.add(Is),Ls.Proj.projections.add(qs),function(t){let e=0,s=0;for(let i=1;i<=60;i++)e=i,s=32600+i,t.defs(`EPSG:${s}`,`+proj=utm +zone=${e} +datum=WGS84 +units=m +no_defs`),s=32700+i,t.defs(`EPSG:${s}`,`+proj=utm +zone=${e} +datum=WGS84 +units=m +south +no_defs`);e=25;for(let i=0;i<=20;i++)e=25+i,s=4534+i,t.defs(`EPSG:${s}`,`+proj=tmerc +lat_0=0 +lon_0=${75+3*i} +k=1 +x_0=500000 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs`),s=4513+i,t.defs(`EPSG:${s}`,`+proj=tmerc +lat_0=0 +lon_0=${75+3*i} +k=1 +x_0=${e}500000 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs`);e=13;for(let i=0;i<=10;i++)e=13+i,s=4502+i,t.defs(`EPSG:${s}`,`+proj=tmerc +lat_0=0 +lon_0=${75+6*i} +k=1 +x_0=500000 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs`),s=4491+i,t.defs(`EPSG:${s}`,`+proj=tmerc +lat_0=0 +lon_0=${75+6*i} +k=1 +x_0=${e}500000 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs`)}(zt),!t)return function(t,e,s){return Pt(t,e,s)};!function(t){const e=t.data.srcCode,s=t.data.targetCode,i=t.data.metaOffset,r=t.data.wgs84Offset,a=t.data.isRTK,n=0,o=2,h=(t,n,o,h=!1)=>{const l=t.byteLength/o,c=new Float32Array(4*l),u=new Float32Array(n);let d,m,p,f,x;h&&(d=new Uint32Array(16*l),m=new Uint32Array(8*l),p=new Float32Array(m.buffer));let g=[0,0,0],y=o/4;for(let n=0;n<l;n++){const l=t.getFloat32(n*o,!0),M=t.getFloat32(n*o+4,!0),b=t.getFloat32(n*o+8,!0);if(a?(f=Pt(e,s,[l+i.x,M+i.y,b+i.z]),x=Hs(f),g[0]=x[0]-r.x,g[1]=x[1]-r.y,g[2]=x[2]-r.z):(g[0]=l,g[1]=M,g[2]=b),c.set(g,3*n),h){const e=[],s=n*o+0;for(let i=0;i<8;i++)e[i]=t.getUint32(s+4*i,!0);m.set(e,8*n),a&&(p[8*n]=g[0],p[8*n+1]=g[1],p[8*n+2]=g[2]);const i=[],r=n*o+32;for(let e=0;e<15;e++)i[e]=t.getUint32(r+4*e,!0);d.set(i,16*n)}else a&&(u[n*y]=g[0],u[n*y+1]=g[1],u[n*y+2]=g[2])}return h?{pos:c,sh:d,data:m}:{pos:c}};if(t.data.type==n){const e=new DataView(t.data.buffer),s=32,{pos:i}=h(e,t.data.buffer,s);postMessage({index:t.data.index,dataBuffer:e.buffer,posBuffer:i.buffer},[e.buffer,i.buffer])}if(t.data.type==o){const e=new DataView(t.data.buffer),s=96,{pos:i,sh:r,data:a}=h(e,t.data.buffer,s,!0);postMessage({index:t.data.index,dataBuffer:a.buffer,posBuffer:i.buffer,shBuffer:r.buffer},[i.buffer,r.buffer,a.buffer])}}(t)}class Hs{type;buffer;size;meta;callback}class Us extends Vt{#m=!1;#tt=0;#et=[];#st=[];#it=[];#rt=0;#at=!0;constructor(e=4){super();for(let t=0;t<e;++t){const t=Ut(qs);t?(this.#et.push(t),this.#tt++):console.error("create worker failed !!!")}this.#et.forEach((e=>{e.onmessage=e=>{if(this.#m)return;const i=e.data.index,r=this.#it[i];if(r.type===t){const t=new Uint32Array(e.data.dataBuffer),s=new Float32Array(e.data.posBuffer);r.callback(t,s,void 0)}else if(r.type===s){const t=new Uint32Array(e.data.dataBuffer),s=new Float32Array(e.data.posBuffer),i=new Uint32Array(e.data.shBuffer);r.callback(t,s,i)}this.#rt++,this.#rt>=this.#it.length&&(this.#at=!0)}}))}dispose(){this.#m=!0,this.#et.forEach((t=>{t.terminate()})),this.#et=[],this.#tt=0,this.#at=!1}#nt(){if(!this.#at||0==this.#st.length||0==this.#tt)return;this.#at=!1,this.#it=this.#st,this.#st=[],this.#rt=0;const t=this.#it.length;for(let e=0;e<t;++e){const t=e%this.#tt,s=this.#et[t],i=this.#it[e],r=i.meta?.epsg>0;let a={};r&&(a.srcCode=i.meta.srcCode,a.targetCode=i.meta.targetCode,a.metaOffset=i.meta.metaOffset,a.wgs84Offset=i.meta.wgs84Offset),s.postMessage({index:e,type:i.type,buffer:i.buffer,isRTK:r,...a},[i.buffer])}}update(t){this.#m||this.#nt()}decompress(e,i,r,a,n){if(e!==t&&e!==s)return console.error("unkonw type: "+e),!1;let o=new Hs;return o.type=e,o.buffer=i,o.size=r,o.meta=a,o.callback=n,this.#st.push(o),this.#at&&this.#nt(),!0}}class Os{static GlobalID=0;#y;#ss;#$i;#tr;#er;#N;#sr=!0;#ir;#ms;#rr=!1;#ar=!1;#nr=0;#or=!1;#hr=[];#lr=void 0;_createVertexArray=!0;#cr=void 0;#ur=!1;#dr=!1;#mr=!1;#Bs=!1;#As=0;#Fs=0;#pr=void 0;#fr=void 0;#xr=void 0;#gr=void 0;hasUploadSH=!1;node;splatCount=0;dimensions;dataDimensions;_sortInfos;size=0;#yr;#Mr;pos;indexes;distances;#br;#wr=!1;#Et=new J;#vr=new J;#G=new bt;#Sr=!1;#Cr=!1;#_r;#Tr;useLogDepth=!1;#Vt;#Dr;#Pr=null;#zr;#Ar;#Er;constructor(t,e){let s,i,r,a,n,o;this.#y=Os.GlobalID++,this.#N=t,this.#ss=this.#N.lccParam.renderLib,this.#$i=e.context,this.#nr=e.splatCount||10,this.renderID=e?.renderID,this.#tr=e.data,this.#ms=this.#N.resources,this.#wr=this.#N.isRTK,this.node=e?.node,this.#ar=e?.isEnv,this.#Mr=e?.sh,this._sp=void 0,this._rs=void 0,this.#cr=this.#ss.Pass.CESIUM_3D_TILE,this.#Tr=new this.#ss.Matrix4,this.#Ar=new this.#ss.Cartesian3,this._vs=void 0,this._fs=void 0,this.#_r=e?.matrix||new this.#ss.Matrix4,this.#yr=e?.prj2ECEF||new this.#ss.Matrix3,this.#Dr=null,this.#Vt=this.#N?.meta?.data,this.#ir={position:0},this.splatCount=e?.splatCount,this.dimensions=it(e?.splatCount),this.dataDimensions=it(2*e?.splatCount),this.shDimensions=it(4*this.splatCount),this.size=this.#Ir(),e?.isEnv?(this.#Vt.compressInfo.positionMin&&this.#Vt.compressInfo.positionMax&&this.#G.set(this.#Vt.compressInfo.positionMin,this.#Vt.compressInfo.positionMax),n=this.#Vt.compressInfo.positionMin,o=this.#Vt.compressInfo.positionMax,s=this.#Vt.compressInfo.compressedEnvScaleMin||s,i=this.#Vt.compressInfo.compressedEnvScaleMax||i,r=this.#Vt.compressInfo.compressedEnvSHMin||r,a=this.#Vt.compressInfo.compressedEnvSHMax||r):(this.#G.copy(this.node.parent.getBBox()),n=this.#Vt.min,o=this.#Vt.max,s=this.#Vt.compressInfo.compressedScaleMin,i=this.#Vt.compressInfo.compressedScaleMax,r=this.#Vt.compressInfo.compressedSHMin,a=this.#Vt.compressInfo.compressedSHMax);const h=this.dimensions.x*this.dimensions.y;if(e.pos&&(this.pos=new Float32Array(e.pos.length),this.pos.set(e.pos,0),this.distances=new Int32Array(this.splatCount),this.indexes=new Int32Array(this.splatCount),this.#br=new Int32Array(this.splatCount)),this._sortInfos={totalDrawCount:rt(h),lastDrawCount:0},this.#er=this.#Fr({compressedScaleMin:s,compressedScaleMax:i,compressedSHMin:r,compressedSHMax:a,positionMin:n,positionMax:o}),this.#Rr(),this.#Vt){const t=this.#ss.Matrix4.getTranslation(this.#_r,new this.#ss.Cartesian3);if(this.#ar){const e=this.#Vt.boundingBox;this.setBoundingVolume(t,{max:[...e.max],min:[...e.min]})}else{const e=this.node?.parent?.getBBox();this.setBoundingVolume(t,{max:e.max?.toArray(),min:e.min?.toArray()})}}this.#Qs(this.#$i)}get id(){return this.#y}get isInitialized(){return this.#ur}get isFirstSorted(){return this.isInitialized}get isCached(){return this.#dr}get isSorted(){return this.#mr}get isSorting(){return this.#Bs}get show(){return this.#sr}set show(t){this.#sr=!!t}get transformsTexture(){return this.#pr}get indexRT(){return this.#kr()}get cmrPos(){return this.#Et}get sortTickLast(){return this.#As}#Fr(t){const{compressedScaleMin:e,compressedScaleMax:s,compressedSHMin:i,compressedSHMax:r,positionMin:a,positionMax:n}=t,o=new Mt(a.z,n.z);return{dimensions:()=>({x:this.dimensions.x,y:this.dimensions.y}),dataDimensions:()=>({x:this.dataDimensions.x,y:this.dataDimensions.y}),shDimensions:()=>({x:this.shDimensions.x,y:this.shDimensions.y}),viewport:()=>({x:0,y:0}),focal:()=>0,cmrPos:()=>({x:0,y:0,z:0}),splatCount:()=>this.splatCount,pointsOnly:()=>0,useSH:()=>0,compressedSHMin:()=>i,compressedSHMax:()=>r,compressedScaleMax:()=>s,compressedScaleMin:()=>e,splatData:()=>this.#pr,splatIndexes:()=>this.#fr,shRawTexture:()=>this.#gr,customColors:()=>this.customColors,alpha:()=>1,useCustomColor:()=>0,heightRange:()=>o,clipPlane:()=>({x:0,y:0,z:0,w:0}),clipBoxMatrixInv:()=>this.#Tr,clipBoxSide:()=>1,prj2ECEF:()=>this.#yr,splatIndexesHost:()=>this.#xr,useIndexHost:()=>!1}}#Rr(){this._vs=Te(Ce).vertexShaderSH,this._fs=De(Ce).fragmentShader}#Nr(t,e,s){const i=t.context,r=["INSTANCED","HAS_NOT_ATTRIBUTE_POSITION","LccShader"];this.#wr&&r.push("IS_RTK");const a=new this.#ss.ShaderSource({defines:r,sources:[e]}),n=new this.#ss.ShaderSource({defines:r,sources:[s]});this._sp=this.#ss.ShaderProgram.replaceCache({context:i,shaderProgram:this._sp,vertexShaderSource:a,fragmentShaderSource:n,attributeLocations:this.#ir}),this._rs=this.#ss.RenderState.fromCache({blending:this.#ss.BlendingState.ALPHA_BLEND,depthTest:{enabled:!0,func:this.#ss.WebGLConstants.ALWAYS},depthMask:!0,cull:{enabled:!1}}),this.#rr=!0}#Ir(){const t=this.dimensions,e=this.dataDimensions,s=this.shDimensions;let i=0,r=e.x*e.y*16,a=t.x*t.y*4,n=s.x*s.y*16;return i=r+a,this.hasUploadSH&&(i+=n),i}setSorted(t){this.#mr=t,t&&(this.#Bs=!1,this.#ur=!0,this.#Sr=!1,this._sortInfos.lastDrawCount=0,this.#As=this.#Fs)}setCPUSorted(t){if(this.#mr=t,t){this.#Bs=!1,this.#ur=!0,this.#As=this.#Fs,this.#Sr=!0,this.#Cr=!0;let t=this.indexes;this.indexes=this.#br,this.#br=t}}startSorting(){this.getSortLocalCmrPos(),this.#Bs=!0}getSortLocalCmrPos(){return this.#Et.copy(this.#N.dynamicState.cmrPosLocal),this.#vr.copy(this.#N.dynamicState.cmrForward),this.#Fs=this.#N.dynamicState.tick,this.#Bs=!0,this.cmrPos}checkNeedSort(){if(this.#Bs)return!1;if(!this.isInitialized||!this.#mr)return!0;const t=this.#N.dynamicState.cmrPosLocal,e=this.#N.dynamicState.cmrForward;this.#N.config.CameraAngleChangedSortThreshold;const s=this.#N.config.CameraPosChangedSortThreshold,i=t.distanceToSquared(this.#Et);if(e.dot(this.#vr),i<s*s)return!1;const r=[0,160,320,480,640,800,960];return!(this.#N.dynamicState.tick-this.#As<r[Math.min(r.length-1,this.node.level)])}setModelMatrix(t){t&&(this.#_r=t)}setPrj2ECEFMatrix(t){t&&(this.prj2ECEF=t)}setTranslation(t){this.#_r?this.#ss.Matrix4.setTranslation(this.#_r,t,this.#_r):this.#_r=this.#ss.Matrix4.fromTranslation(t),this.updateBoundingVolume(t,!1)}setRotation(t){if(this.#_r){const e=this.#ss.Matrix4.getTranslation(this.#_r,new this.#ss.Cartesian3),s=this.#ss.Transforms.eastNorthUpToFixedFrame(e),i=this.#ss.Matrix3.multiply(this.#ss.Matrix4.getRotation(s,new this.#ss.Matrix3),t,new this.#ss.Matrix3);this.#ss.Matrix4.setRotation(this.#_r,i,this.#_r)}else this.#_r=this.#ss.Matrix4.fromRotation(t)}setScale(t){this.#_r?(this.#ss.Matrix4.setScale(this.#_r,t,this.#_r),this.updateBoundingVolume(!1,t)):this.#_r=this.#ss.Matrix4.fromScale(t)}setTranslationOffset(t){if(this.#_r){const e=this.#ss.Matrix4.fromTranslation(t);this.#ss.Matrix4.multiply(this.#_r,e,this.#_r);const s=this.#ss.Matrix4.getTranslation(this.#_r,new this.#ss.Cartesian3);this.updateBoundingVolume(s,!1)}}getTranslation(){return this.#_r?this.#ss.Matrix4.getTranslation(this.#_r,new this.#ss.Cartesian3):null}setBoundingVolume(t,e,s){if(s){const t=s.flat();let e=Math.max(t[0],t[3],t[6],t[9],t[12],t[15],t[18],t[21]),i=Math.max(t[1],t[4],t[7],t[10],t[13],t[16],t[19],t[22]),r=Math.max(t[2],t[5],t[8],t[11],t[14],t[17],t[20],t[23]),a=Math.min(t[0],t[3],t[6],t[9],t[12],t[15],t[18],t[21]),n=Math.min(t[1],t[4],t[7],t[10],t[13],t[16],t[19],t[22]),o=Math.min(t[2],t[5],t[8],t[11],t[14],t[17],t[20],t[23]),h=new this.#ss.Cartesian3((e+a)/2,(i+n)/2,(r+o)/2);const l=Math.max(e-a,i-n,r-o);return this.#Dr=new this.#ss.BoundingSphere(h,l/2),this.#Dr}if(e){const s=1,{max:i,min:r}=e,a=[(i[0]+r[0])/2,(i[1]+r[1])/2,(i[2]+r[2])/2/s],n=Math.max(i[0]-r[0],i[1]-r[1],(i[2]-r[2])/s),o=new this.#ss.Cartesian3(a[0],a[1],a[2]);this.#ss.Matrix3.multiplyByVector(this.#yr,o,o);const h=new this.#ss.Cartesian3(t.x+o.x,t.y+o.y,t.z+o.z),l=this.#ar?n:n/2;return this.#Dr=new this.#ss.BoundingSphere(h,l),this.#Pr=[o.x,o.y,o.z],this.#zr=2*l,this.#Ar=t,this.#Er=this.#ss.Matrix4.getScale(this.#_r,new this.#ss.Cartesian3),this.#Dr}}#Br(){const t=this.getTranslation(),e=this.#ss.Matrix4.getScale(this.#_r,new this.#ss.Cartesian3);(this.#ss.Cartesian3.distance(t,this.#Ar)>1e-6||this.#ss.Cartesian3.distance(e,this.#Er)>1e-6)&&this.#Lr(t)}#Lr(){if(this.#Dr){const t=this.#Pr,e=this.#zr,s=this.getTranslation(),i=new this.#ss.Cartesian3(s.x+t[0],s.y+t[1],s.z+t[2]),r=this.#ss.Matrix4.getScale(this.#_r,new this.#ss.Cartesian3);this.#Ar=s,this.#Er=this.#ss.Matrix4.getScale(this.#_r,new this.#ss.Cartesian3),this.#Dr=new this.#ss.BoundingSphere(i,e/2*Math.max(r.x,r.y,r.z))}}setPassIndex(t){t>-1&&(this.#cr=t)}getBBox(){return this.#G}intersectWithRay(t,e){const s=new J,i=new J,r=new J,a=e*e;let n=-1;const o=new Float32Array(this.#tr.buffer);for(let e=0;e<this.splatCount;++e){const h=o[8*e+0],l=o[8*e+1],c=o[8*e+2],u=s.set(h,l,c),d=i.copy(u).sub(t.origin),m=d.dot(t.direction);if(m<0||m>t.length)continue;const p=r.copy(t.origin).addScaledVector(t.direction,m).sub(t.origin).sub(d);p.dot(p)>a||(t.length=m,n=m)}if(n<0)return null;return{point:t.origin.clone().addScaledVector(t.direction,n),distance:n}}#qr(t){const e=t.passes,s=this.#er,i=t.commandList;if(e.render){let t=this.#lr;this.#ss.defined(t)||(t=this.#lr=new this.#ss.DrawCommand),t.pass=this.#cr,this.#Dr&&(t.boundingVolume=this.#Dr),t.owner=this,t.uniformMap=s,t.vertexArray=this._va,t.shaderProgram=this._sp,t.renderState=this._rs,t.modelMatrix=this.#_r,this.#or&&(t.count=6,t.instanceCount=this.#nr),i.push(t)}}#Hr(t){let e=t.cache.lccMesh_vertexBufferInstanced;return this.#ss.defined(e)||(e=this.#ss.Buffer.createVertexBuffer({context:t,typedArray:new Float32Array([1,1,0,-1,-1,0,-1,1,0,1,1,0,1,-1,0,-1,-1,0]),usage:this.#ss.BufferUsage.STATIC_DRAW}),e.vertexArrayDestroyable=!1,t.cache.lccMesh_vertexBufferInstanced=e),e}#Ur(t){return[{index:0,componentsPerAttribute:3,componentDatatype:this.#ss.ComponentDatatype.FLOAT,vertexBuffer:this.#Hr(t),normalize:!1,offsetInBytes:0,strideInBytes:0,instanceDivisor:0}]}#Or(t,e){return this._va=new this.#ss.VertexArray({context:t,attributes:e}),this._createVertexArray=!1,this._va}#Vr(t,e){const s=this.dataDimensions.x,i=this.dataDimensions.y,r=new Float32Array(this.#tr.buffer),a=new this.#ss.Texture({context:t,width:s,height:i,flipY:!1,skipColorSpaceConversion:!0,pixelDatatype:this.#ss.PixelDatatype.FLOAT,pixelFormat:this.#ss.PixelFormat.RGBA,sampler:new this.#ss.Sampler({wrapS:this.#ss.TextureWrap.CLAMP_TO_EDGE,wrapT:this.#ss.TextureWrap.CLAMP_TO_EDGE,minificationFilter:this.#ss.TextureMinificationFilter.NEAREST,magnificationFilter:this.#ss.TextureMagnificationFilter.NEAREST})});return this.#Gr(2*this.splatCount,this.dataDimensions,a,r),a}#Gr(t,e,s,i,r=4){const a=[],n=e.x;e.y;const o=Math.floor(t/n),h=t%n;if(o>0){const e=n*o*r;a.push({offsetX:0,offsetY:0,width:n,height:o,offsetCount:0,count:e}),h>0&&a.push({offsetX:0,OffsetY:o,width:h,height:1,offsetCount:e,count:t*r})}else a.push({offsetX:0,OffsetY:0,width:h,height:1,offsetCount:0,count:t*r});for(;a.length>0;){const t=a.shift(),{offsetX:e,offsetY:r,width:n,height:o,offsetCount:h,count:l}=t;s.copyFrom({xOffset:e,yOffset:r,source:{width:t.width,height:t.height,arrayBufferView:i.subarray(h,l)},skipColorSpaceConversion:!0,flipY:!1})}}#jr(t,e=4,s){const i=this.dimensions.x,r=this.dimensions.y;return new this.#ss.Texture({context:t,width:i,height:r,flipY:!1,skipColorSpaceConversion:!0,pixelDatatype:this.#ss.PixelDatatype.FLOAT,pixelFormat:1===e?this.#ss.PixelFormat.RED:this.#ss.PixelFormat.RGBA,sampler:new this.#ss.Sampler({wrapS:this.#ss.TextureWrap.CLAMP_TO_EDGE,wrapT:this.#ss.TextureWrap.CLAMP_TO_EDGE,minificationFilter:this.#ss.TextureMinificationFilter.NEAREST,magnificationFilter:this.#ss.TextureMagnificationFilter.NEAREST})})}#Wr(t,e){const s=this.dimensions.x,i=this.dimensions.y;return new this.#ss.Texture({context:t,width:s,height:i,flipY:!1,skipColorSpaceConversion:!0,pixelDatatype:this.#ss.PixelDatatype.FLOAT,pixelFormat:this.#ss.PixelFormat.RED,sampler:new this.#ss.Sampler({wrapS:this.#ss.TextureWrap.CLAMP_TO_EDGE,wrapT:this.#ss.TextureWrap.CLAMP_TO_EDGE,minificationFilter:this.#ss.TextureMinificationFilter.NEAREST,magnificationFilter:this.#ss.TextureMagnificationFilter.NEAREST})})}#Qr(t){if(!this.#br)return;const e=new Float32Array(this.#br.buffer);this.#Gr(this.splatCount,this.dimensions,this.#xr,e,1)}#Xr(){const t=this.#N.dynamicState,e=t.useSH&&this.hasUploadSH,s=this.#Sr,i=t.clipBoxMatrixInv.toCesiumMatrix4(this.#Tr);this.#er.viewport=function(){return{x:t.viewport.x,y:t.viewport.y}},this.#er.focal=function(){return t.focal},this.#er.pointsOnly=function(){return t.pointsOnly},this.#er.alpha=function(){return t.alpha},this.#er.useSH=function(){return e},this.#er.useCustomColor=function(){return t.useCustomColor},this.#er.cmrPos=function(){return t.cmrPosModelLocal.clone()},this.#er.clipPlane=function(){return t.clipPlane},this.#er.clipBoxMatrixInv=function(){return i},this.#er.clipBoxSide=function(){return t.clipBoxSide},this.#er.useIndexHost=function(){return s},this._rs!==t.renderState&&(this._rs=t.renderState),this.#cr!==t.passIndex&&(this.#cr=t.passIndex)}_setSHTexture(t){if(this.isDestroyed())return;if(this.hasUploadSH)return;this.hasUploadSH=!0,this.size=this.#Ir();const e=this.#$i,s=this.shDimensions.x,i=this.shDimensions.y,r=new Float32Array(t.buffer),a=new this.#ss.Texture({context:e,width:s,height:i,flipY:!1,skipColorSpaceConversion:!0,pixelDatatype:this.#ss.PixelDatatype.FLOAT,pixelFormat:this.#ss.PixelFormat.RGBA,sampler:new this.#ss.Sampler({wrapS:this.#ss.TextureWrap.CLAMP_TO_EDGE,wrapT:this.#ss.TextureWrap.CLAMP_TO_EDGE,minificationFilter:this.#ss.TextureMinificationFilter.NEAREST,magnificationFilter:this.#ss.TextureMagnificationFilter.NEAREST})});return this.#Gr(4*this.splatCount,this.shDimensions,a,r),this.#er.shRawTexture=()=>a,a}#kr(){if(this.#fr===this.#ms.splatIndexTex){const t=this.#fr=this.#jr(this.#$i);this.#er.splatIndexes=function(){return t}}return this.#fr}#Qs(t){const e=this.#pr=this.#Vr(t,!0),s=this.#fr=this.#ms.splatIndexTex,i=this.#xr=this.#Wr(t,this.#br),r=this.#ms.rainbowTex;let a;this.#ar&&this.#Mr?this.#gr=a=this._setSHTexture(this.#Mr):this.#gr=a=this.#ms.shTex,this.#er.splatData=()=>e,this.#er.splatIndexes=()=>s,this.#er.shRawTexture=()=>a,this.#er.customColors=()=>r,this.#er.splatIndexesHost=()=>i,this.#dr=!0}update(t){this.isDestroyed()||this.show&&(this.isCached||this.#Qs(t),this.isInitialized&&(this.#Br(),this.#Cr&&(this.#Qr(t.context),this.#Cr=!1),this.#Xr(),this.#or=t.context.instancedArrays,this._createVertexArray&&(this.#hr=this.#Ur(t.context),this.#Or(t.context,this.#hr)),this.#rr||this.#Nr(t,this._vs,this._fs),this.#qr(t)))}isDestroyed(){return!1}destroy(){if(!this.isDestroyed())return this.#tr=void 0,this.distances=void 0,this.indexes=void 0,this.#br=void 0,this.pos=void 0,this.#pr&&(!this.#pr.isDestroyed()&&this.#pr.destroy(),this.#pr=void 0),this.#fr!==this.#ms.splatIndexTex&&(!this.#fr.isDestroyed()&&this.#fr.destroy(),this.#fr=void 0),this.#xr&&(!this.#xr.isDestroyed()&&this.#xr.destroy(),this.#xr=void 0),this.#gr!==this.#ms.shTex&&(!this.#gr.isDestroyed()&&this.#gr.destroy(),this.#gr=void 0),this.#ms=null,this._sp=this._sp&&this._sp.destroy(),this._va=this._va&&this._va.destroy(),this.#ss.destroyObject(this)}}const Vs="#version 300 es\nprecision highp float;\nin vec3 position;\nvoid main() {\n     gl_Position = vec4( position, 1.0 );\n}\n";class Gs{#m=!1;#Yr;#hi;#Zr={x:1024,y:2048};#Kr=void 0;#Jr=void 0;#$r=void 0;#ta;#ea;#sa;constructor(t){this.#Yr=t,this.#ia()}#ia(){this.#ta=this.#ra(Vs,"#version 300 es\nprecision highp float;\nprecision highp int;\nlayout(location = 0) out vec4 pc_FragColor;\n\nuniform highp sampler2D u_data;\n\nuniform int stage;\nuniform int pass;\nuniform ivec2 dimension;\n\nvec4 fetch(int x, int y) {\n    return texelFetch(u_data, ivec2(x, y), 0);\n}\n\nvoid main () {\n\n    int fx = int(gl_FragCoord.x);\n    int fy = int(gl_FragCoord.y);\n    int index = fx + fy * dimension.x;\n\n    int pairIndex = index ^ pass;\n\n    int dFx = pairIndex % dimension.x;\n    int dFy = pairIndex / dimension.x;\n\n    bool mask = index > pairIndex;\n\n    vec4 indexValue = fetch(fx, fy);\n    vec4 pairValue = fetch(dFx, dFy);\n\n    bool up = !((index & stage) == 0); // 降序\n\n    // int b1 = (index - pairIndex) / abs(index - pairIndex);\n\n    // int vv = indexValue.x - pairValue.x;\n\n    // int b2 = (vv) / abs(vv);\n\n    // int b3 = min(index & stage, 2) - 1;\n    \n    // int rs1 = b1 * b2 * b3;\n\n    // pc_FragColor = max(rs1 * indexValue, -rs1 * pairValue);\n\n    if(up) {\n        if(indexValue.x > pairValue.x){\n            if(mask) {\n                pc_FragColor = indexValue;\n            } else {\n                pc_FragColor = pairValue;\n            }\n        } else {\n            if(mask) {\n                pc_FragColor = pairValue;\n            } else {\n                pc_FragColor = indexValue;\n            }\n        }\n    } else {\n        if(indexValue.x < pairValue.x){\n            if(mask) {\n                pc_FragColor = indexValue;\n            } else {\n                pc_FragColor = pairValue;\n            }\n        } else {\n            if(mask) {\n                pc_FragColor = pairValue;\n            } else {\n                pc_FragColor = indexValue;\n            }\n        }\n    }\n\n    \n}\n\n\n"),this.#ea=this.#ra(Vs,"#version 300 es\nprecision highp float;\nprecision highp int;\nlayout(location = 0) out vec4 pc_FragColor;\n\nuniform sampler2D transforms;\n\nuniform int splatCount;\nuniform ivec2 dimension;\nuniform ivec2 dataDimensions;\nuniform vec3 cmrPos;\n\nvoid main() {\n\n\n    int fx = int(gl_FragCoord.x);\n    int fy = int(gl_FragCoord.y);\n\n    int index = fx + fy * dimension.x;\n\n    int id1 = int(index * 2);\n    int x1 = id1 % int(dataDimensions.x);\n    int y1 = id1 / int(dataDimensions.x);\n\n    if(index >= splatCount) {\n      pc_FragColor = vec4(10., float(index), .0, .0);\n    } else {\n      vec4 sampledTransform = texelFetch(transforms, ivec2(x1, y1), 0);\n      float distance = length(vec3(sampledTransform.xyz) - cmrPos) * 1000.0 + 1000.0;\n      pc_FragColor = vec4(distance, float(index), .0, .0);\n    }\n}\n\n"),this.#sa=this.#aa(this.#Yr),this.#na(this.#Yr),this.#$r=this.#oa(this.#Yr)}#ra(t,e){const s=this.#Yr.createShader(this.#Yr.VERTEX_SHADER);if(this.#Yr.shaderSource(s,t),this.#Yr.compileShader(s),!this.#Yr.getShaderParameter(s,this.#Yr.COMPILE_STATUS))return console.error("An error occurred compiling the vertex shader: "+this.#Yr.getShaderInfoLog(s)),this.#Yr.deleteShader(s),null;const i=this.#Yr.createShader(this.#Yr.FRAGMENT_SHADER);if(this.#Yr.shaderSource(i,e),this.#Yr.compileShader(i),!this.#Yr.getShaderParameter(i,this.#Yr.COMPILE_STATUS))return console.error("An error occurred compiling the fragment shader: "+this.#Yr.getShaderInfoLog(i)),this.#Yr.deleteShader(i),null;const r=this.#Yr.createProgram();return this.#Yr.attachShader(r,s),this.#Yr.attachShader(r,i),this.#Yr.linkProgram(r),this.#Yr.getProgramParameter(r,this.#Yr.LINK_STATUS)?r:(console.error("Unable to initialize the shader program: "+this.#Yr.getProgramInfoLog(r)),null)}#aa(t){const e=new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]),s=t.createBuffer();return t.bindBuffer(t.ARRAY_BUFFER,s),t.bufferData(t.ARRAY_BUFFER,e,t.STATIC_DRAW),s}#na(t){const e=this.#Zr.x,s=this.#Zr.y;this.#Kr=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this.#Kr),t.texImage2D(t.TEXTURE_2D,0,t.RGBA32F,e,s,0,t.RGBA,t.FLOAT,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),this.#Jr=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this.#Jr),t.texImage2D(t.TEXTURE_2D,0,t.RGBA32F,e,s,0,t.RGBA,t.FLOAT,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST)}#oa(t){const e=t.createFramebuffer();return t.bindFramebuffer(t.FRAMEBUFFER,e),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.#Kr._texture,0),e}#ha(t,e,s){const i=s.getSortLocalCmrPos(),r=s.splatCount,a=s.dimensions,n=s.dataDimensions,o=s.transformsTexture;t.useProgram(e);const h=t.getUniformLocation(e,"transforms"),l=t.getUniformLocation(e,"splatCount"),c=t.getUniformLocation(e,"dimension"),u=t.getUniformLocation(e,"dataDimensions"),d=t.getUniformLocation(e,"cmrPos"),m=t.getAttribLocation(e,"position"),p=this.#sa;t.bindBuffer(t.ARRAY_BUFFER,p),t.vertexAttribPointer(m,2,t.FLOAT,!1,0,0),t.enableVertexAttribArray(m),t.uniform1i(l,r),t.uniform2i(c,a.x,a.y),t.uniform2i(u,n.x,n.y),t.uniform3f(d,i.x,i.y,i.z),t.uniform1i(h,0),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,o._texture),t.disable(t.DEPTH_TEST),t.disable(t.STENCIL_TEST),t.depthMask(!1),t.bindFramebuffer(t.FRAMEBUFFER,this.#$r),t.viewport(0,0,a.x,a.y),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.#Kr,0),t.drawArrays(t.TRIANGLES,0,6)}#di(t,e,s){t.useProgram(e),t.bindFramebuffer(t.FRAMEBUFFER,this.#$r);const i=s.dimensions,r=s._sortInfos,a=t.getAttribLocation(e,"position"),n=this.#sa;t.bindBuffer(t.ARRAY_BUFFER,n),t.vertexAttribPointer(a,2,t.FLOAT,!1,0,0),t.enableVertexAttribArray(a);const o=t.getUniformLocation(e,"stage"),h=t.getUniformLocation(e,"pass"),l=t.getUniformLocation(e,"dimension"),c=t.getUniformLocation(e,"u_data");t.uniform2i(l,i.x,i.y),t.uniform1i(c,0),t.activeTexture(t.TEXTURE0);const u=i.x*i.y;let d,m=0;const p=Math.min(r.lastDrawCount+50,r.totalDrawCount);console.log("sorting !");for(let e=2;e<=u;e<<=1)for(let a=e>>1;a>0;a>>=1)if(m<r.lastDrawCount)m++;else{if(m===p)return void(r.lastDrawCount=p);m++,t.uniform1i(o,e),t.uniform1i(h,a),t.bindTexture(t.TEXTURE_2D,this.#Kr),t.viewport(0,0,i.x,i.y),m===r.totalDrawCount?t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,s.indexRT._texture,0):t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.#Jr,0),t.drawArrays(t.TRIANGLES,0,6),d=this.#Jr,this.#Jr=this.#Kr,this.#Kr=d}p===r.totalDrawCount&&(s.setSorted(!0),this.#hi=null,console.log("sort finished!"))}update(){this.#m||this.#hi&&(this.#hi?.transformsTexture?(this.#hi._sortInfos.lastDrawCount<1&&this.#ha(this.#Yr,this.#ea,this.#hi),this.#di(this.#Yr,this.#ta,this.#hi),this.#Yr.useProgram(null),this.#Yr.bindFramebuffer(this.#Yr.FRAMEBUFFER,null)):this.#hi=null)}triggerSorting(t){this.#hi||(this.#hi=t)}dispose(){this.#m||this.#Yr&&(this.#Kr&&(this.#Yr.deleteTexture(this.#Kr),this.#Kr=void 0),this.#Jr&&(this.#Yr.deleteTexture(this.#Jr),this.#Jr=void 0),this.#$r&&(this.#Yr.deleteFramebuffer(this.#$r),this.#$r=void 0),this.#sa&&(this.#Yr.deleteBuffer(this.#sa),this.#sa=void 0),this.#ta&&(this.#Yr.deleteProgram(this.#ta),this.#ta=void 0),this.#ea&&(this.#Yr.deleteProgram(this.#ea),this.#ea=void 0))}}class js{#m=!1;#ss=void 0;#$i=void 0;#N=void 0;#z=void 0;#P=void 0;#fi=void 0;#_i;#la;#xi=[];#yi=[];#bi=[];#Mi=[];#pi=void 0;#mi=void 0;#Zt;constructor(t,e,s,i){this.#Zt=t,this.#ss=e,this.#N=s,this.#z=this.#N.gpuCache,this.#P=this.#N.cpuCache,this.#$i=s.lccParam.scene.context,this.#_i=i,this.#mi=new Be(this.#N.config.CpuSortThreadNum),this.#N.config.WebglSortingEnable&&(this.#pi=new Gs(this.#$i._gl,this.#ss))}setModelMatrix(t){t&&(this.#_i=t)}setPrj2ECEFMatrix(t){t&&(this.#la=t)}#Ci(){if(this.#fi)return this.#fi;const t=this.#N.meta,e=this.#P.queryEnv(this.#N.renderID);if(!e||!t)return null;const{splatCounts:s,data:i,sh:r,pos:a}=e;return this.#fi=new Os(this.#N,{context:this.#$i,matrix:this.#_i,prj2ECEF:this.#la,node:e,splatCount:s,data:i,pos:a,sh:r,isEnv:!0,meta:t,renderID:this.#Zt}),this.#fi}getEnvMesh(t=!0){return this.#fi||this.#Ci(),this.#fi?this.#fi:null}getMesh(t,e=!0){let s=this.#z.queryMesh(t.renderID,t.id);if(s&&(!e||s.isInitialized))return s}clearCacheSHQueue(){this.#yi=[]}pushCacheSHQueue(t){this.#yi.push(t)}pushCacheQueue(t){this.#xi.push(t)}clearCacheQueue(){this.#xi=[]}pushSortQueue(t){this.#bi.push(t)}clearSortQueue(){this.#bi=[]}update(){if(this.#m)return;let s=null,i=null,r=null;for(let e=0;e<this.#xi.length;e++)if(s=this.#xi[e],!this.#z.hasMesh(s.renderID,s.id)&&s?.isCache(t)){i=s.queryCache();const t=i.pos;r=new Os(this.#N,{context:this.#$i,matrix:this.#_i,prj2ECEF:this.#la,splatCount:s.points,data:i.data,pos:t,sh:i.sh,node:s,renderID:this.#Zt}),this.#z.pushMesh(s.renderID,s.id,r,r.size);break}for(let t=0;t<this.#yi.length;++t){const s=this.#yi[t],i=s.node;if(s.hasUploadSH||!i||!i.isCache(e))continue;const{sh:r}=i.queryCache();s._setSHTexture(r),this.#z.flushMesh(this.#Zt,i.id,s,s.size)}const a=this.#bi;for(let t=0;t<a.length;++t){const e=a[t];if(e?.isSorting)continue;let s=!1;if(this.#mi.isReady()){s=!0;const t=new Ne;t.splatCount=e.splatCount,t.distances=e.distances,t.indexes=e.indexes,t.transforms=e.pos,t.mesh=e,t.beginCallback=t=>{const s=e.getSortLocalCmrPos();t.camPos={x:s.x,y:s.y,z:s.z},t.mesh.startSorting()},t.endCalllback=t=>{t.mesh.pos=t.transforms,t.mesh.indexes=t.indexes,t.mesh.distances=t.distances,t.mesh.setCPUSorted(!0)},this.#mi.triggerSorting(t)}this.#N.config.WebglSortingEnable&&!s&&this.#pi.triggerSorting(e)}this.#N.config.WebglSortingEnable&&this.#pi.update()}dispose(){this.#m||(this.#m=!0,this.#N=void 0,this.#z=void 0,this.#P=void 0,this.#$i=void 0,this.#_i=void 0,this.#mi&&(this.#mi.dispose(),this.#mi=void 0),this.#pi&&(this.#pi.dispose(),this.#pi=void 0),this.#fi&&(this.#fi.destroy(),this.#fi=void 0))}}class Ws extends lt{static GlobalID=0;#m=!1;#y;#ss;#qt;#Ai;#es;#P;#z;#Ei;#Ht;#Ii;#ca;#ua;#cr;#Fi;#Ri=[];#_r;#la;#da;#Lt=new ht;#N;#Jt=!1;#Li=!0;#Ni=new Ue;#qi;#Bi=!1;#ma=new J;constructor(t){super(),this.#y=Ws.GlobalID++,this.#N=t,this.#N.renderID=this.#y,this.#es=this.#N.lccParam,this.#qt=this.#N.cameraMgr,this.#P=this.#N.cpuCache,this.#z=this.#N.gpuCache,this.#Ei=this.#N.collCache,this.#Ht=this.#N.dataLoader,this.#Lt=this.#N.config,this.#ss=this.#N.lccParam.renderLib,this.#_r=this.#es.modelMatrix,this.#la,this.#Ai=new Se(this.#N,this.#qt,this.#Ht),this.#ca=qs(),this.#ua=this.#pa(),this.#cr=this.#ss.Pass.CESIUM_3D_TILE,this.#Ii=new js(this.#y,this.#es.renderLib,this.#N,this.#_r),this.#Fi=new this.#ss.PrimitiveCollection({destroyPrimitives:!1}),this.#es.scene.primitives.add(this.#Fi)}get id(){return this.#y}get root(){return this.#Fi}get maxLoadSplatCount(){return this.#Lt.maxLoadSplatCount}set maxLoadSplatCount(t){this.#Lt.maxLoadSplatCount=t}get matrixWorld(){return(new Jt).fromCesiumMatrix4(this.#_r)}get matrixWorldInverse(){return this.matrixWorld.invert()}get modelMatrix(){return this.#_r}set modelMatrix(t){this.#_r=t}get modelOffsetLocal(){}#pa(){return this.#ss.RenderState.fromCache({blending:this.#ss.BlendingState.ALPHA_BLEND,depthTest:{enabled:!0,func:this.#ss.WebGLConstants.ALWAYS},depthMask:!0,cull:{enabled:!1}})}setTranslation(t){if(this.modelMatrix?this.#ss.Matrix4.setTranslation(this.modelMatrix,t,this.modelMatrix):this.modelMatrix=this.#ss.Matrix4.fromTranslation(t),this.#N.isRTK){this.#ss.Matrix4.setTranslation(this.#la,t,this.#la),this.#da.fromCesiumMatrix4(this.#la).invert();const e=this.#fa(t);this.#ma.copy(e)}}setRotation(t){if(this.modelMatrix){const e=this.#ss.Matrix4.getTranslation(this.modelMatrix,new this.#ss.Cartesian3),s=this.#ss.Transforms.eastNorthUpToFixedFrame(e),i=this.#ss.Matrix3.multiply(this.#ss.Matrix4.getRotation(s,new this.#ss.Matrix3),t,new this.#ss.Matrix3);this.#ss.Matrix4.setRotation(this.modelMatrix,i,this.modelMatrix)}else this.modelMatrix=this.#ss.Matrix4.fromRotation(t)}setScale(t){this.modelMatrix?this.#ss.Matrix4.setScale(this.modelMatrix,t,this.modelMatrix):this.modelMatrix=this.#ss.Matrix4.fromScale(t)}setTranslationOffset(t){if(this.modelMatrix){let e=this.getTranslation();e.x+=t.x,e.y+=t.y,e.z+=t.z,this.setTranslation(e)}}getTranslation(){return this.modelMatrix?this.#ss.Matrix4.getTranslation(this.modelMatrix,new this.#ss.Cartesian3):null}getInstancedMesh(){return this}getEnvInstancedMesh(){return this}togglePointsDisplayMode(){this.#Lt.pointsOnly=!this.#Lt.pointsOnly}useEnvironment(t){this.#Lt.useEnv=t,this.#Ai.setConfigDirty()}useShcoef(t,e){this.#Lt.useSH=t,this.#Ai.setConfigDirty(),this.#Jt?t&&this.#Li&&(this.#Li=!1,this.#Ai.loadSH((()=>{}),(t=>{e&&e(t)}),(()=>{console.error("load sh failed...")}))):console.error("meta is not ready")}setVisible(t){this.#Lt.visible=t}setAlpha(t){t=Y.clamp(t,0,1),this.#Lt.alpha=t}setClipBox(t){if(!(t&&t.scale&&t.rotation&&t.position))return void console.error("set failed !!!");const e=t.clipSide||1,s=at("scale",t),i=at("rotation",t),r=at("position",t);s&&i&&r?this.#Ni.update(r,i,s,e):console.error("set failed !!!")}setClipPlane(t,e){Array.isArray(t)&&"number"==typeof e?this.#N.dynamicState.clipPlane.set(t[0],t[1],t[2],e):console.error("setClipPlane failed: param error")}setStartLod(t){isNaN(t)||t<0?console.error("set failed !!!"):(this.#Lt.MinLodUsed=t,this.#Ai.setConfigDirty())}setMaxDistance(t){isNaN(t)||t<0?console.error("set failed !!!"):(this.#Lt.MaxDistaneLimit=t,this.#Ai.setConfigDirty())}setMaxSplats(t){isNaN(t)||t<0?console.error("set failed !!!"):(this.#Lt.maxLoadSplatCount=t,this.#Ai.setConfigDirty())}getCurrentConfig(){return this.#Lt.getUserConfig()}getProjectionCoordinateSystemInfos(){const t=this.#N.meta?.data;if(t)return{epsg:t?.epsg,offset:{x:t.offset[0],y:t.offset[1],z:t.offset[2]}}}updateCurrentConfig(t){this.#Lt.setUserConfig(t),this.#Ai.setConfigDirty()}update(t){if(this.#m)return;if(this.#Ri=[],this.#Fi.removeAll(),this.#Oi(t),this.#Ai.update(t),!this.#Jt)return;const e=this.#Ai.getRenderNodes();if(this.#Vi(e),this.#ji(),this.#N.dynamicState.useEnv){const t=this.#Ii.getEnvMesh();t&&(t.isInitialized&&this.#Bi&&this.#Fi.add(t),t.checkNeedSort()&&this.#Ii.pushSortQueue(t))}this.#Fi._primitives.reverse(),this.#Ri.forEach((t=>{this.#Lt.useSH&&!t.hasUploadSH&&this.#Ii.pushCacheSHQueue(t)})),this.#Ii.update(t),this.#Fi.show=this.#Lt.visible,this.#Qi()}load(t,e,s,i){console.log("load ..."),this.#Ai.load(t,(t=>{this.#Jt=!0,this.#xa(t),console.log("meta: ",t),this.#Oi(Date.now())}),(()=>{console.log("loading ready ..."),this.#Bi=!0,this.getInstancedMesh(),e&&e(this)}),(t=>{s&&s(t)}),(()=>{i&&i()}),(t=>{if(!t)return!0;if(t.isColl)return!!t.isCacheData();if(t.isNode){let e=this.#z.queryMesh(t.renderID,t.id);return!(!e||!e.isFirstSorted)}return console.error("unknow chunk...(render)"),!0}))}#xa(t){!t.epsg||t.epsg<1?this.#N.isRTK=!1:this.#N.isRTK=!0;const{epsg:e,offset:s}=t;if(e>0){let i=`EPSG:${e}`,r="EPSG:4326",a=(new J).fromArray(s),n=this.#ca(i,r,a.toArray()),o=this.#ss.Cartesian3.fromDegrees(n[0],n[1],n[2]);t.srcCode=i,t.targetCode=r,t.metaOffset=a,t.wgs84BLH=(new J).fromArray(n),t.wgs84Offset=(new J).copy(o),t.ecefMatrix=this.#ss.Transforms.eastNorthUpToFixedFrame(o),t.prj2EcefMatrix=(new Jt).fromCesiumMatrix4(t.ecefMatrix),t.prj2EcefMatrixInverse=t.prj2EcefMatrix.clone().invert(),this.#_r=this.#ss.Matrix4.fromTranslation(o),this.#la=t.ecefMatrix,this.#da=t.prj2EcefMatrixInverse,this.#ma.copy(a),this.#Ii.setModelMatrix(this.#_r),this.#Ii.setPrj2ECEFMatrix(this.#ss.Matrix4.getMatrix3(this.#la,new this.#ss.Matrix3))}else this.#Ii.setModelMatrix(this.#_r),this.#la=this.#_r,this.#Ii.setPrj2ECEFMatrix(this.#ss.Matrix4.getMatrix3(this.#la,new this.#ss.Matrix3))}proj4(t,e,s){return this.#ca(t,e,s)}prj2Ecef(t,e=!0){const s=[t.x,t.y,t.z];if(e){const t=this.#N.meta.data.offset;s[0]+=t[0],s[1]+=t[1],s[2]+=t[2]}const i=this.#N.meta.data.srcCode,r=this.#N.meta.data.targetCode,a=this.#ca(i,r,s);return this.#ss.Cartesian3.fromDegrees(a[0],a[1],a[2])}#fa(t){var e=this.#ss.Cartographic.fromCartesian(t);const s=[this.#ss.Math.toDegrees(e.longitude),this.#ss.Math.toDegrees(e.latitude),e.height],i=this.#N.meta.data.srcCode,r=this.#N.meta.data.targetCode,a=this.#ca(r,i,s);return(new J).fromArray(a)}raycast(t){if(this.#m)return console.error("The renderer had been dispose !!!"),null;if(!t||!t.evt||st(t.evt.x)||st(t.evt.y)||st(t.maxDistance)||st(t.radius))return null;if(t.maxDistance<0||t.radius<0)return null;const e=this.#qt.projectionMatrix.clone().invert(),s=nt(this.#es.canvas,t.evt);s.applyMatrix4(e).applyMatrix4(this.#qt.cam2WorldMatrix);const i=this.#qt.position.clone(),r=s.sub(i).normalize();return this.raycastFromOrigin({origin:{x:i.x,y:i.y,z:i.z},direction:{x:r.x,y:r.y,z:r.z},maxDistance:t.maxDistance,radius:t.radius})}raycastFromOrigin(t){if(this.#m)return console.error("The renderer had been dispose !!!"),null;if(!t||!t.origin||!t.direction||st(t.maxDistance)||st(t.radius))return null;if(st(t.origin.x)||st(t.origin.y)||st(t.origin.z))return null;if(st(t.direction.x)||st(t.direction.y)||st(t.direction.z))return null;if(t.maxDistance<0||t.radius<0)return null;const e=new J(t.origin.x,t.origin.y,t.origin.z),s=new J(t.direction.x,t.direction.y,t.direction.z).normalize(),i=new Fe(e,s,t.maxDistance);let r,a;this.#N.isRTK?(r=i.clone().applyMatrix4((new Jt).copy(this.#da)),a=i.clone().applyMatrix4((new Jt).copy(this.matrixWorldInverse))):r=a=i.clone().applyMatrix4((new Jt).copy(this.matrixWorldInverse));const n=t.radius;let o=[];this.#Ri.forEach((t=>{if(t.isEnv)return;const e=t.getBBox(),s=r.intersectBox(e);s&&o.push({mesh:t,distance:s.distance})})),o.sort(((t,e)=>t.distance-e.distance));for(let t=0;t<o.length;++t){let e=o[t].mesh.intersectWithRay(a,n);if(e){const t=e.point;return t.applyMatrix4(this.matrixWorld),{x:t.x,y:t.y,z:t.z}}}return null}_paramToRay(t){const e=this.#qt.projectionMatrix.clone().invert(),s=nt(this.#es.canvas,t.evt);s.applyMatrix4(e).applyMatrix4(this.#qt.cam2WorldMatrix);const i=this.#qt.position.clone(),r=s.sub(i).normalize();return new Fe(i,r,t.maxDistance)}_paramToRayFromOrigin(t){const e=new J(t.origin.x,t.origin.y,t.origin.z),s=new J(t.direction.x,t.direction.y,t.direction.z).normalize();return new Fe(e,s,t.maxDistance)}setRenderState(t){if(!t)return;t.hasOwnProperty("passIndex")&&t.passIndex!==this.#cr&&(this.#cr=t.passIndex);const e={blending:this.#ss.BlendingState.ALPHA_BLEND,depthTest:{enabled:this.#ua.depthTest.enabled,func:this.#ua.depthTest.func},depthMask:this.#ua.depthMask,cull:{enabled:!1}};let s=!1;if(t.hasOwnProperty("depthTest")){const i=t.depthTest;i&&(i.hasOwnProperty("enabled")&&e.depthTest.enabled!==t.depthTest.enabled&&(e.depthTest.enabled=t.depthTest.enabled,s=!0),i.hasOwnProperty("func")&&e.depthTest.func!==t.depthTest.func&&(e.depthTest.func=t.depthTest.func,s=!0))}t.hasOwnProperty("depthMask")&&e.depthMask!==t.depthMask&&(e.depthMask=t.depthMask,s=!0),s&&(this.#ua=this.#ss.RenderState.fromCache(e))}lowerToBottom(){this.#es.scene.primitives.lowerToBottom(this.#Fi)}raiseToTop(){this.#es.scene.primitives.raiseToTop(this.#Fi)}hasShcoef(){return!!this.#Jt&&this.#Ai.hasSH}getBounds(){if(!this.#Jt)return null;const t=this.getTranslation();let e=this.#Ai.bbox;if(!e)return null;let s=e.min,i=e.max;return{min:{x:s.x,y:s.y,z:s.z},max:{x:i.x,y:i.y,z:i.z},origin:{x:t.x,y:t.y,z:t.z}}}#Hi(t){const e=this.#qt.projectionMatrix.clone().invert(),s=nt(this.#es.canvas,t.evt);s.applyMatrix4(e).applyMatrix4(this.#qt.cam2WorldMatrix);const i=this.#qt.position.clone(),r=s.sub(i).normalize();return new Fe(i,r,t.maxDistance).applyMatrix4((new Jt).copy(this.matrixWorld).invert()).intersectBox(this.#Ai.bbox)}getInstancedMesh(){return this.#Fi}getEnvInstancedMesh(){return this.#Fi}#Oi(t){const e=this.#es.canvas,s=this.#N.dynamicState,i=e.width,r=e.height,a=this.#qt.fov,n=this.#qt.projectionMatrix,o=this.#qt.cam2WorldMatrix,h=(new Jt).copy(this.matrixWorld).invert(),c=(new Jt).multiplyMatrices(h,o),u=this.#qt.position,d=new J(0,0,-1).applyMatrix4(o),m=this.#qt.position.clone().applyMatrix4(h);if(s.focal=Math.max(i,r)/2/Math.tan(a/2/180*Math.PI),s.viewport.x=i,s.viewport.y=r,s.cmrPos.copy(u),s.cmrForward.copy(d),s.cmrPosLocal.copy(m),s.cmrProjMatrix.copy(n),s.cmr2LocalMatrix.copy(c),s.frustum=new be,s.frustum.setFromProjectionMatrix(n),this.#N.isRTK){const t=this.#fa(u).sub(this.#ma);s.cmrPosModelLocal.copy(t),s.cmr2ModelLocalMatrix.copy((new Jt).multiplyMatrices(this.#da,o)),s.frustum.planes.forEach((t=>t.applyMatrix4(s.cmr2ModelLocalMatrix)))}else s.cmrPosModelLocal.copy(m),s.cmr2ModelLocalMatrix.copy(c),s.frustum.planes.forEach((t=>t.applyMatrix4(c)));s.alpha=this.#Lt.alpha,s.visible=this.#Lt.visible,s.useEnv=this.#Lt.useEnv,s.useSH=this.#Lt.useSH,s.pointsOnly=this.#Lt.pointsOnly,s.useCustomColor=!(this.#Lt.pointsColor!==l),s.clipBoxSide=this.#Ni.clipSide,s.clipBoxMatrixInv.copy(this.#Ni.matrixInverse),s.renderState=this.#ua,s.passIndex=this.#cr,s.tick=t}#Vi(e){if(0!=e.length){this.#Ii.clearCacheQueue(),this.#Ii.clearCacheSHQueue(),this.#Ii.clearSortQueue();for(let s=0;s<e.length;++s){const i=e[s];if(!i)continue;const r=i.parent,a=i.level,n=r.nodes.length;let o,h=this.#z.queryMesh(i.renderID,i.id);if(!h&&i.isCache(t)?this.#Ii.pushCacheQueue(i):h&&h.checkNeedSort()?this.#Ii.pushSortQueue(h):h?.isFirstSorted&&(o=h),!o){let t=0;for(let e=a;e<n;e++){const s=r.nodes[e];if(!s||s.points<this.#Lt.MinValidSplatsInNode)continue;const i=this.#z.queryMesh(s.renderID,s.id);if(!i||!i.isInitialized)continue;const a=i.sortTickLast;a>t&&(t=a,o=i)}}o&&(this.#Ri.push(o),this.#Fi.add(o))}}}#ji(){if(this.#Bi)return;const e=this.#Ai.getLoadingNodes();for(let s=0;s<e.length;++s){const i=e[s];if(!i)continue;let r=this.#z.queryMesh(i.renderID,i.id);!r&&i.isCache(t)?this.#Ii.pushCacheQueue(i):r&&!r.isFirstSorted&&this.#Ii.pushSortQueue(r)}}#Qi(){let t=0,e=0,s=1e9;this.#Ri.forEach((i=>{t+=i.splatCount,e=Math.max(e,i.splatCount),s=Math.min(s,i.splatCount)}));const i=this.#N.performance;i.totalPoints=t,i.maxPoints=e,i.minPoints=s,i.meshNum=this.#Ri.length;const r=this.#N.dynamicState.tick;void 0===this.#qi&&(this.#qi=r),r-this.#qi>2e3&&(this.#qi=r)}dispose(){if(this.#m)return;this.#m=!0,this.#Fi&&!this.#Fi.isDestroyed()&&(this.#es.scene.primitives.remove(this.#Fi),this.#Fi=void 0),this.#Ii.dispose();const t=[],e=[];this.#Ai.getAllNodeID(t),this.#Ai.getAllCollID(e),this.#Ai.dispose(),this.#P.clear(this.id,t),this.#z.clear(this.id,t),this.#Ei?.clear(this.id,e)}}class Qs{#es;#ss;#is;#ga;#ya;#Ma;#$i;get rainbowTex(){return this.#is}get shTex(){return this.#ga}get indexHostTex(){return this.#ya}get splatIndexTex(){return this.#Ma}constructor(t){this.#es=t,this.#ss=this.#es.renderLib,this.#$i=this.#es.scene.context,this.#ls(),this.#ba(),this.#wa()}_dispose(){this.#is&&(!this.#is.isDestroyed()&&this.#is.destroy(),this.#is=void 0),this.#ga&&(!this.#ga.isDestroyed()&&this.#ga.destroy(),this.#ga=void 0),this.#Ma&&(!this.#Ma.isDestroyed()&&this.#Ma.destroy(),this.#Ma=void 0),this.#es=void 0,this.#ss=void 0,this.#$i=void 0}#ls(){const t=new Image;t.src=o[1],t.onload=()=>{this.#is=new this.#ss.Texture({context:this.#$i,width:t.width,height:t.height,flipY:!1,skipColorSpaceConversion:!1,source:t,pixelDatatype:this.#ss.PixelDatatype.UNSIGNED_BYTE,pixelFormat:this.#ss.PixelFormat.RGBA,sampler:new this.#ss.Sampler({wrapS:this.#ss.TextureWrap.CLAMP_TO_EDGE,wrapT:this.#ss.TextureWrap.CLAMP_TO_EDGE,minificationFilter:this.#ss.TextureMinificationFilter.NEAREST,magnificationFilter:this.#ss.TextureMagnificationFilter.NEAREST})})}}#ba(){if(this.#ga)return;this.#ga=new this.#ss.Texture({context:this.#$i,width:1,height:1,flipY:!1,skipColorSpaceConversion:!0,source:{arrayBufferView:new Float32Array(4)},pixelDatatype:this.#ss.PixelDatatype.FLOAT,pixelFormat:this.#ss.PixelFormat.RGBA,sampler:new this.#ss.Sampler({wrapS:this.#ss.TextureWrap.CLAMP_TO_EDGE,wrapT:this.#ss.TextureWrap.CLAMP_TO_EDGE,minificationFilter:this.#ss.TextureMinificationFilter.NEAREST,magnificationFilter:this.#ss.TextureMagnificationFilter.NEAREST})})}#va(){if(this.#ya)return;this.#ya=new this.#ss.Texture({context:this.#$i,width:1,height:1,flipY:!1,skipColorSpaceConversion:!0,source:{arrayBufferView:new Float32Array(1)},pixelDatatype:this.#ss.PixelDatatype.FLOAT,pixelFormat:this.#ss.PixelFormat.RED,sampler:new this.#ss.Sampler({wrapS:this.#ss.TextureWrap.CLAMP_TO_EDGE,wrapT:this.#ss.TextureWrap.CLAMP_TO_EDGE,minificationFilter:this.#ss.TextureMinificationFilter.NEAREST,magnificationFilter:this.#ss.TextureMagnificationFilter.NEAREST})})}#wa(){if(this.#Ma)return;this.#Ma=new this.#ss.Texture({context:this.#$i,width:1,height:1,flipY:!1,skipColorSpaceConversion:!0,source:{arrayBufferView:new Float32Array(4)},pixelDatatype:this.#ss.PixelDatatype.FLOAT,pixelFormat:this.#ss.PixelFormat.RGBA,sampler:new this.#ss.Sampler({wrapS:this.#ss.TextureWrap.CLAMP_TO_EDGE,wrapT:this.#ss.TextureWrap.CLAMP_TO_EDGE,minificationFilter:this.#ss.TextureMinificationFilter.NEAREST,magnificationFilter:this.#ss.TextureMagnificationFilter.NEAREST})})}}class Xs extends Yt{#Xi;#es;#qt;#P;#z;#Ei;#Ht;#ht;#Yi=[];#ms;isDispose=!1;#Zi;#lt;constructor(t,e){super(),this.#Xi=t,this.#es=e,this.#Zi=new ot(t),this.#ms=new Qs(e),this.#qt=new Ls(e),this.#P=new dt(this.#Zi.MaxCPUCacheSize,void 0),this.#z=new kt(this.#Zi.MaxGPUCacheSize,((t,e,s)=>{e&&e.destroy()})),this.#Ei=new Nt(this.#Zi.MaxCPUCollCacheSize,void 0,this.#Zi.MaxGPUCollCacheSize,((t,e,s)=>{e&&e.destroy()})),this.#ht=new Us(this.#Zi.DecompressThreadNum),this.#lt=new Wt(this.#Zi.CollBuildThreadNum),this.#Ht=new Xt(this.#P,this.#lt,this.#ht,!0)}createRenderer(){let t=new ht(this.#Xi);t.useEnv=this.#es.useEnv,t.gpuAcceleration=this.#es.gpuAcceleration,t.pointsColor=this.#es.pointsColor;let e=new we;e.config=t,e.configCommon=this.#Zi,e.lccParam=this.#es,e.cpuCache=this.#P,e.gpuCache=this.#z,e.collCache=this.#Ei,e.dataLoader=this.#Ht,e.resources=this.#ms,e.cameraMgr=this.#qt,e.platform=this.#Xi;let s=new Ws(e);return this.#Yi.push(s),s}update(t){this.#qt._update(t),this.#P.update(t),this.#z.update(t),this.#Ei.update(t),this.#Ht.update(t),this.#ht?.update(t),this.#lt.update(t),this.#Yi.forEach((e=>{e.update(t)}))}getAllRenderers(){return this.#Yi}destroyRenderer(t){this.#Yi.indexOf(t)<0||(this.#Yi=this.#Yi.filter((e=>e!==t)),t?.dispose())}dispose(){this.isDispose||(this.#Yi.forEach((t=>{t.dispose()})),this.#Yi=[],this.#Ht.dispose(),this.#ht.dispose(),this.#lt.dispose(),this.#z.dispose(),this.#P.dispose(),this.#Ei.dispose(),this.#qt._dispose(),this.#ms._dispose(),this.isDispose=!0)}raycast(t){if(0==this.#Yi.length)return null;if(1==this.#Yi.length)return this.#Yi[0].raycast(t);const e=[];return this.#Yi.forEach(((s,i,r)=>{let a=s._paramToRay(t),n=s.raycast(t);if(n){let t=a.origin.distanceToSquared(new J(n.x,n.y,n.z));e.push({intersect:n,distance:t,renderIndex:i})}})),e.sort(((t,e)=>t.distance-e.distance)),e.length>0?e[0].intersect:null}raycastFromOrigin(t){if(0==this.#Yi.length)return null;if(1==this.#Yi.length)return this.#Yi[0].raycastFromOrigin(t);const e=[];return this.#Yi.forEach(((s,i,r)=>{let a=s._paramToRayFromOrigin(t),n=s.raycastFromOrigin(t);if(n){let t=a.origin.distanceToSquared(new J(n.x,n.y,n.z));e.push({intersect:n,distance:t,renderIndex:i})}})),e.sort(((t,e)=>t.distance-e.distance)),e.length>0?e[0].intersect:null}}class Ys{#m=!1;#Sa=null;#Ca=null;#_a;constructor(t){if(!t)throw new Error("no params !");if(!t.scene)throw new Error("no scene !");if(!t.camera)throw new Error("no camera !");if(!t.canvas)throw new Error("no canvas !");if(!t.renderLib)throw new Error("no renderLib !");const e=new U(t.renderLib);if(e.libType===n)throw new Error("unknow engine type !");if(e.libType===r&&!t.renderer)throw new Error("no renderer !");this.#Ca=t;const s="boolean"!=typeof t.useEnv||t.useEnv,i="boolean"==typeof t.gpuAcceleration&&t.gpuAcceleration,a="default"===t.pointsColor?h:l;let o={scene:t.scene,camera:t.camera,canvas:t.canvas,renderLib:t.renderLib,renderer:t.renderer,modelMatrix:t.modelMatrix,useEnv:s,gpuAcceleration:i,pointsColor:a};e.libType===r?this.#Sa=new Bs(e,o):(this.#Sa=new Xs(e,o),this.#_a=t.scene.render,this.#Ta(this.#Ca))}#Ta(t){if(t?.scene){const s=this.#Sa;t.scene.render=(e=t.scene.render,function(){if(s&&!s?.isDispose){const t=Date.now();s.update(t)}e.apply(this,arguments)})}var e}#Da(t){t.scene.render=(()=>this.#_a)(),this.#_a=void 0}load(t,e,s,i){if(this.#m||!t)return;let r=this.#Sa.createRenderer();return r.load(t,e,s,i),r}unload(t){!this.#m&&t&&this.#Sa.destroyRenderer(t)}getAllRenderers(){return this.#m?[]:this.#Sa.getAllRenderers()}update(){if(this.#m)return;const t=Date.now();this.#Sa.update(t)}dispose(){this.#m?console.error("LccManager had been disposed !!!"):(this.#m=!0,this.#_a&&this.#Ca?.scene&&this.#Da(this.#Ca),this.#Sa.dispose(),this.#Sa=null)}raycast(t){return this.#m||!t||!t.evt||st(t.evt.x)||st(t.evt.y)||st(t.maxDistance)||st(t.radius)||t.maxDistance<0||t.radius<0?null:this.#Sa.raycast(t)}raycastFromOrigin(t){return this.#m?null:t&&t.origin&&t.direction&&!st(t.maxDistance)&&!st(t.radius)?st(t.origin.x)||st(t.origin.y)||st(t.origin.z)||st(t.direction.x)||st(t.direction.y)||st(t.direction.z)||t.maxDistance<0||t.radius<0?null:this.#Sa.raycastFromOrigin(t):null}}let Zs=null;const Ks={load:function(t,e,s,i){return Zs||(Zs=new Ys(t)),Zs.load(t?.dataPath,e,s,i)},update:function(){Zs?.update()},unload:function(t){Zs?.unload(t)},dispose:function(){Zs?.dispose(),Zs=void 0},raycast:function(t){return Zs?.raycast(t)},raycastFromOrigin:function(t){return Zs?.raycastFromOrigin(t)}};export{Ks as LCCRender};
